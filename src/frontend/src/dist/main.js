var{defineProperty:B4,getOwnPropertyDescriptor:Z5}=Object,$5=(q,Y)=>{for(var G in Y)B4(q,G,{get:Y[G],enumerable:!0})},a=(q,Y,G,H)=>{for(var F=H>1?void 0:H?Z5(Y,G):Y,Z=q.length-1,$;Z>=0;Z--)($=q[Z])&&(F=(H?$(Y,G,F):$(F))||F);return H&&F&&B4(Y,G,F),F},A=(q,Y)=>(G,H)=>Y(G,H,q),C3="Terminal input",x2={get:()=>C3,set:(q)=>C3=q},U3="Too much output to announce, navigate to rows manually to read",y2={get:()=>U3,set:(q)=>U3=q};function J5(q){return q.replace(/\r?\n/g,"\r")}function V5(q,Y){return Y?"\x1B[200~"+q+"\x1B[201~":q}function X5(q,Y){q.clipboardData&&q.clipboardData.setData("text/plain",Y.selectionText),q.preventDefault()}function z5(q,Y,G,H){if(q.stopPropagation(),q.clipboardData){let F=q.clipboardData.getData("text/plain");D4(F,Y,G,H)}}function D4(q,Y,G,H){q=J5(q),q=V5(q,G.decPrivateModes.bracketedPasteMode&&H.rawOptions.ignoreBracketedPasteMode!==!0),G.triggerDataEvent(q,!0),Y.value=""}function R4(q,Y,G){let H=G.getBoundingClientRect(),F=q.clientX-H.left-10,Z=q.clientY-H.top-10;Y.style.width="20px",Y.style.height="20px",Y.style.left=`${F}px`,Y.style.top=`${Z}px`,Y.style.zIndex="1000",Y.focus()}function N3(q,Y,G,H,F){R4(q,Y,G),F&&H.rightClickSelect(q),Y.value=H.selectionText,Y.select()}function u0(q){return q>65535?(q-=65536,String.fromCharCode((q>>10)+55296)+String.fromCharCode(q%1024+56320)):String.fromCharCode(q)}function H2(q,Y=0,G=q.length){let H="";for(let F=Y;F<G;++F){let Z=q[F];Z>65535?(Z-=65536,H+=String.fromCharCode((Z>>10)+55296)+String.fromCharCode(Z%1024+56320)):H+=String.fromCharCode(Z)}return H}var M5=class{constructor(){this._interim=0}clear(){this._interim=0}decode(q,Y){let G=q.length;if(!G)return 0;let H=0,F=0;if(this._interim){let Z=q.charCodeAt(F++);56320<=Z&&Z<=57343?Y[H++]=(this._interim-55296)*1024+Z-56320+65536:(Y[H++]=this._interim,Y[H++]=Z),this._interim=0}for(let Z=F;Z<G;++Z){let $=q.charCodeAt(Z);if(55296<=$&&$<=56319){if(++Z>=G)return this._interim=$,H;let V=q.charCodeAt(Z);56320<=V&&V<=57343?Y[H++]=($-55296)*1024+V-56320+65536:(Y[H++]=$,Y[H++]=V);continue}$!==65279&&(Y[H++]=$)}return H}},j5=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(q,Y){let G=q.length;if(!G)return 0;let H=0,F,Z,$,V,X=0,J=0;if(this.interim[0]){let K=!1,W=this.interim[0];W&=(W&224)===192?31:(W&240)===224?15:7;let j=0,C;for(;(C=this.interim[++j]&63)&&j<4;)W<<=6,W|=C;let L=(this.interim[0]&224)===192?2:(this.interim[0]&240)===224?3:4,x=L-j;for(;J<x;){if(J>=G)return 0;if(C=q[J++],(C&192)!==128){J--,K=!0;break}else this.interim[j++]=C,W<<=6,W|=C&63}K||(L===2?W<128?J--:Y[H++]=W:L===3?W<2048||W>=55296&&W<=57343||W===65279||(Y[H++]=W):W<65536||W>1114111||(Y[H++]=W)),this.interim.fill(0)}let M=G-4,z=J;for(;z<G;){for(;z<M&&!((F=q[z])&128)&&!((Z=q[z+1])&128)&&!(($=q[z+2])&128)&&!((V=q[z+3])&128);)Y[H++]=F,Y[H++]=Z,Y[H++]=$,Y[H++]=V,z+=4;if(F=q[z++],F<128)Y[H++]=F;else if((F&224)===192){if(z>=G)return this.interim[0]=F,H;if(Z=q[z++],(Z&192)!==128){z--;continue}if(X=(F&31)<<6|Z&63,X<128){z--;continue}Y[H++]=X}else if((F&240)===224){if(z>=G)return this.interim[0]=F,H;if(Z=q[z++],(Z&192)!==128){z--;continue}if(z>=G)return this.interim[0]=F,this.interim[1]=Z,H;if($=q[z++],($&192)!==128){z--;continue}if(X=(F&15)<<12|(Z&63)<<6|$&63,X<2048||X>=55296&&X<=57343||X===65279)continue;Y[H++]=X}else if((F&248)===240){if(z>=G)return this.interim[0]=F,H;if(Z=q[z++],(Z&192)!==128){z--;continue}if(z>=G)return this.interim[0]=F,this.interim[1]=Z,H;if($=q[z++],($&192)!==128){z--;continue}if(z>=G)return this.interim[0]=F,this.interim[1]=Z,this.interim[2]=$,H;if(V=q[z++],(V&192)!==128){z--;continue}if(X=(F&7)<<18|(Z&63)<<12|($&63)<<6|V&63,X<65536||X>1114111)continue;Y[H++]=X}}return H}},A4="",c0=" ",w1=class q{constructor(){this.fg=0,this.bg=0,this.extended=new n1}static toColorRGB(Y){return[Y>>>16&255,Y>>>8&255,Y&255]}static fromColorRGB(Y){return(Y[0]&255)<<16|(Y[1]&255)<<8|Y[2]&255}clone(){let Y=new q;return Y.fg=this.fg,Y.bg=this.bg,Y.extended=this.extended.clone(),Y}isInverse(){return this.fg&67108864}isBold(){return this.fg&134217728}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:this.fg&268435456}isBlink(){return this.fg&536870912}isInvisible(){return this.fg&1073741824}isItalic(){return this.bg&67108864}isDim(){return this.bg&134217728}isStrikethrough(){return this.fg&2147483648}isProtected(){return this.bg&536870912}isOverline(){return this.bg&1073741824}getFgColorMode(){return this.fg&50331648}getBgColorMode(){return this.bg&50331648}isFgRGB(){return(this.fg&50331648)===50331648}isBgRGB(){return(this.bg&50331648)===50331648}isFgPalette(){return(this.fg&50331648)===16777216||(this.fg&50331648)===33554432}isBgPalette(){return(this.bg&50331648)===16777216||(this.bg&50331648)===33554432}isFgDefault(){return(this.fg&50331648)===0}isBgDefault(){return(this.bg&50331648)===0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(this.fg&50331648){case 16777216:case 33554432:return this.fg&255;case 50331648:return this.fg&16777215;default:return-1}}getBgColor(){switch(this.bg&50331648){case 16777216:case 33554432:return this.bg&255;case 50331648:return this.bg&16777215;default:return-1}}hasExtendedAttrs(){return this.bg&268435456}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(this.bg&268435456&&~this.extended.underlineColor)switch(this.extended.underlineColor&50331648){case 16777216:case 33554432:return this.extended.underlineColor&255;case 50331648:return this.extended.underlineColor&16777215;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return this.bg&268435456&&~this.extended.underlineColor?this.extended.underlineColor&50331648:this.getFgColorMode()}isUnderlineColorRGB(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===50331648:this.isFgRGB()}isUnderlineColorPalette(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===16777216||(this.extended.underlineColor&50331648)===33554432:this.isFgPalette()}isUnderlineColorDefault(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===0:this.isFgDefault()}getUnderlineStyle(){return this.fg&268435456?this.bg&268435456?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}},n1=class q{constructor(Y=0,G=0){this._ext=0,this._urlId=0,this._ext=Y,this._urlId=G}get ext(){return this._urlId?this._ext&-469762049|this.underlineStyle<<26:this._ext}set ext(Y){this._ext=Y}get underlineStyle(){return this._urlId?5:(this._ext&469762048)>>26}set underlineStyle(Y){this._ext&=-469762049,this._ext|=Y<<26&469762048}get underlineColor(){return this._ext&67108863}set underlineColor(Y){this._ext&=-67108864,this._ext|=Y&67108863}get urlId(){return this._urlId}set urlId(Y){this._urlId=Y}get underlineVariantOffset(){let Y=(this._ext&3758096384)>>29;return Y<0?Y^4294967288:Y}set underlineVariantOffset(Y){this._ext&=536870911,this._ext|=Y<<29&3758096384}clone(){return new q(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}},B0=class q extends w1{constructor(){super(...arguments);this.content=0,this.fg=0,this.bg=0,this.extended=new n1,this.combinedData=""}static fromCharData(Y){let G=new q;return G.setFromCharData(Y),G}isCombined(){return this.content&2097152}getWidth(){return this.content>>22}getChars(){return this.content&2097152?this.combinedData:this.content&2097151?u0(this.content&2097151):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):this.content&2097151}setFromCharData(Y){this.fg=Y[0],this.bg=0;let G=!1;if(Y[1].length>2)G=!0;else if(Y[1].length===2){let H=Y[1].charCodeAt(0);if(55296<=H&&H<=56319){let F=Y[1].charCodeAt(1);56320<=F&&F<=57343?this.content=(H-55296)*1024+F-56320+65536|Y[2]<<22:G=!0}else G=!0}else this.content=Y[1].charCodeAt(0)|Y[2]<<22;G&&(this.combinedData=Y[1],this.content=2097152|Y[2]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},B3="di$target",S2="di$dependencies",M2=new Map;function K5(q){return q[S2]||[]}function H0(q){if(M2.has(q))return M2.get(q);let Y=function(G,H,F){if(arguments.length!==3)throw Error("@IServiceName-decorator can only be used to decorate a parameter");W5(Y,G,F)};return Y._id=q,M2.set(q,Y),Y}function W5(q,Y,G){Y[B3]===Y?Y[S2].push({id:q,index:G}):(Y[S2]=[{id:q,index:G}],Y[B3]=Y)}var X0=H0("BufferService"),k4=H0("CoreMouseService"),q1=H0("CoreService"),C5=H0("CharsetService"),H3=H0("InstantiationService"),L4=H0("LogService"),z0=H0("OptionsService"),Q4=H0("OscLinkService"),U5=H0("UnicodeService"),I1=H0("DecorationService"),w2=class{constructor(q,Y,G){this._bufferService=q,this._optionsService=Y,this._oscLinkService=G}provideLinks(q,Y){let G=this._bufferService.buffer.lines.get(q-1);if(!G){Y(void 0);return}let H=[],F=this._optionsService.rawOptions.linkHandler,Z=new B0,$=G.getTrimmedLength(),V=-1,X=-1,J=!1;for(let M=0;M<$;M++)if(!(X===-1&&!G.hasContent(M))){if(G.loadCell(M,Z),Z.hasExtendedAttrs()&&Z.extended.urlId)if(X===-1){X=M,V=Z.extended.urlId;continue}else J=Z.extended.urlId!==V;else X!==-1&&(J=!0);if(J||X!==-1&&M===$-1){let z=this._oscLinkService.getLinkData(V)?.uri;if(z){let K={start:{x:X+1,y:q},end:{x:M+(!J&&M===$-1?1:0),y:q}},W=!1;if(!F?.allowNonHttpProtocols)try{let j=new URL(z);["http:","https:"].includes(j.protocol)||(W=!0)}catch{W=!0}W||H.push({text:z,range:K,activate:(j,C)=>F?F.activate(j,C,K):N5(j,C),hover:(j,C)=>F?.hover?.(j,C,K),leave:(j,C)=>F?.leave?.(j,C,K)})}J=!1,Z.hasExtendedAttrs()&&Z.extended.urlId?(X=M,V=Z.extended.urlId):(X=-1,V=-1)}}Y(H)}};w2=a([A(0,X0),A(1,z0),A(2,Q4)],w2);function N5(q,Y){if(confirm(`Do you want to navigate to ${Y}?

WARNING: This link could potentially be dangerous`)){let G=window.open();if(G){try{G.opener=null}catch{}G.location.href=Y}else console.warn("Opening link blocked as opener could not be cleared")}}var F2=H0("CharSizeService"),_0=H0("CoreBrowserService"),F3=H0("MouseService"),E0=H0("RenderService"),B5=H0("SelectionService"),P4=H0("CharacterJoinerService"),Z1=H0("ThemeService"),O4=H0("LinkProviderService"),D5=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(q){setTimeout(()=>{throw q.stack?D3.isErrorNoTelemetry(q)?new D3(q.message+`

`+q.stack):Error(q.message+`

`+q.stack):q},0)}}addListener(q){return this.listeners.push(q),()=>{this._removeListener(q)}}emit(q){this.listeners.forEach((Y)=>{Y(q)})}_removeListener(q){this.listeners.splice(this.listeners.indexOf(q),1)}setUnexpectedErrorHandler(q){this.unexpectedErrorHandler=q}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(q){this.unexpectedErrorHandler(q),this.emit(q)}onUnexpectedExternalError(q){this.unexpectedErrorHandler(q)}},R5=new D5;function g1(q){A5(q)||R5.onUnexpectedError(q)}var I2="Canceled";function A5(q){return q instanceof k5?!0:q instanceof Error&&q.name===I2&&q.message===I2}var k5=class extends Error{constructor(){super(I2),this.name=this.message}};function L5(q){return q?Error(`Illegal argument: ${q}`):Error("Illegal argument")}var D3=class q extends Error{constructor(Y){super(Y),this.name="CodeExpectedError"}static fromError(Y){if(Y instanceof q)return Y;let G=new q;return G.message=Y.message,G.stack=Y.stack,G}static isErrorNoTelemetry(Y){return Y.name==="CodeExpectedError"}},T2=class q extends Error{constructor(Y){super(Y||"An unexpected bug occurred."),Object.setPrototypeOf(this,q.prototype)}};function Q5(q,Y,G=0,H=q.length){let F=G,Z=H;for(;F<Z;){let $=Math.floor((F+Z)/2);Y(q[$])?F=$+1:Z=$}return F-1}var P5=class q{constructor(Y){this._array=Y,this._findLastMonotonousLastIdx=0}findLastMonotonous(Y){if(q.assertInvariants){if(this._prevFindLastPredicate){for(let H of this._array)if(this._prevFindLastPredicate(H)&&!Y(H))throw Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=Y}let G=Q5(this._array,Y,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=G+1,G===-1?void 0:this._array[G]}};P5.assertInvariants=!1;function j0(q,Y=0){return q[q.length-(1+Y)]}var x4;((q)=>{function Y(Z){return Z<0}q.isLessThan=Y;function G(Z){return Z<=0}q.isLessThanOrEqual=G;function H(Z){return Z>0}q.isGreaterThan=H;function F(Z){return Z===0}q.isNeitherLessOrGreaterThan=F,q.greaterThan=1,q.lessThan=-1,q.neitherLessOrGreaterThan=0})(x4||={});function O5(q,Y){return(G,H)=>Y(q(G),q(H))}var x5=(q,Y)=>q-Y,R3=class q{constructor(Y){this.iterate=Y}forEach(Y){this.iterate((G)=>(Y(G),!0))}toArray(){let Y=[];return this.iterate((G)=>(Y.push(G),!0)),Y}filter(Y){return new q((G)=>this.iterate((H)=>Y(H)?G(H):!0))}map(Y){return new q((G)=>this.iterate((H)=>G(Y(H))))}some(Y){let G=!1;return this.iterate((H)=>(G=Y(H),!G)),G}findFirst(Y){let G;return this.iterate((H)=>Y(H)?(G=H,!1):!0),G}findLast(Y){let G;return this.iterate((H)=>(Y(H)&&(G=H),!0)),G}findLastMaxBy(Y){let G,H=!0;return this.iterate((F)=>((H||x4.isGreaterThan(Y(F,G)))&&(H=!1,G=F),!0)),G}};R3.empty=new R3((q)=>{});function y5(q,Y){let G=Object.create(null);for(let H of q){let F=Y(H),Z=G[F];Z||(Z=G[F]=[]),Z.push(H)}return G}var A3,k3,e8=class{constructor(q,Y){this.toKey=Y,this._map=new Map,this[A3]="SetWithKey";for(let G of q)this.add(G)}get size(){return this._map.size}add(q){let Y=this.toKey(q);return this._map.set(Y,q),this}delete(q){return this._map.delete(this.toKey(q))}has(q){return this._map.has(this.toKey(q))}*entries(){for(let q of this._map.values())yield[q,q]}keys(){return this.values()}*values(){for(let q of this._map.values())yield q}clear(){this._map.clear()}forEach(q,Y){this._map.forEach((G)=>q.call(Y,G,G,this))}[(k3=Symbol.iterator,A3=Symbol.toStringTag,k3)](){return this.values()}},S5=class{constructor(){this.map=new Map}add(q,Y){let G=this.map.get(q);G||(G=new Set,this.map.set(q,G)),G.add(Y)}delete(q,Y){let G=this.map.get(q);G&&(G.delete(Y),G.size===0&&this.map.delete(q))}forEach(q,Y){let G=this.map.get(q);G&&G.forEach(Y)}get(q){return this.map.get(q)||new Set}};function w5(q,Y){let G=this,H=!1,F;return function(){if(H)return F;if(H=!0,Y)try{F=q.apply(G,arguments)}finally{Y()}else F=q.apply(G,arguments);return F}}var y4;((q)=>{function Y(P){return P&&typeof P=="object"&&typeof P[Symbol.iterator]=="function"}q.is=Y;let G=Object.freeze([]);function H(){return G}q.empty=H;function*F(P){yield P}q.single=F;function Z(P){return Y(P)?P:F(P)}q.wrap=Z;function $(P){return P||G}q.from=$;function*V(P){for(let _=P.length-1;_>=0;_--)yield P[_]}q.reverse=V;function X(P){return!P||P[Symbol.iterator]().next().done===!0}q.isEmpty=X;function J(P){return P[Symbol.iterator]().next().value}q.first=J;function M(P,_){let E=0;for(let F0 of P)if(_(F0,E++))return!0;return!1}q.some=M;function z(P,_){for(let E of P)if(_(E))return E}q.find=z;function*K(P,_){for(let E of P)_(E)&&(yield E)}q.filter=K;function*W(P,_){let E=0;for(let F0 of P)yield _(F0,E++)}q.map=W;function*j(P,_){let E=0;for(let F0 of P)yield*_(F0,E++)}q.flatMap=j;function*C(...P){for(let _ of P)yield*_}q.concat=C;function L(P,_,E){let F0=E;for(let D0 of P)F0=_(F0,D0);return F0}q.reduce=L;function*x(P,_,E=P.length){for(_<0&&(_+=P.length),E<0?E+=P.length:E>P.length&&(E=P.length);_<E;_++)yield P[_]}q.slice=x;function v(P,_=Number.POSITIVE_INFINITY){let E=[];if(_===0)return[E,P];let F0=P[Symbol.iterator]();for(let D0=0;D0<_;D0++){let A0=F0.next();if(A0.done)return[E,q.empty()];E.push(A0.value)}return[E,{[Symbol.iterator](){return F0}}]}q.consume=v;async function I(P){let _=[];for await(let E of P)_.push(E);return Promise.resolve(_)}q.asyncToArray=I})(y4||={});var I5=!1,i0=null,T5=class q{constructor(){this.livingDisposables=new Map}getDisposableData(Y){let G=this.livingDisposables.get(Y);return G||(G={parent:null,source:null,isSingleton:!1,value:Y,idx:q.idx++},this.livingDisposables.set(Y,G)),G}trackDisposable(Y){let G=this.getDisposableData(Y);G.source||(G.source=Error().stack)}setParent(Y,G){let H=this.getDisposableData(Y);H.parent=G}markAsDisposed(Y){this.livingDisposables.delete(Y)}markAsSingleton(Y){this.getDisposableData(Y).isSingleton=!0}getRootParent(Y,G){let H=G.get(Y);if(H)return H;let F=Y.parent?this.getRootParent(this.getDisposableData(Y.parent),G):Y;return G.set(Y,F),F}getTrackedDisposables(){let Y=new Map;return[...this.livingDisposables.entries()].filter(([,G])=>G.source!==null&&!this.getRootParent(G,Y).isSingleton).flatMap(([G])=>G)}computeLeakingDisposables(Y=10,G){let H;if(G)H=G;else{let X=new Map,J=[...this.livingDisposables.values()].filter((z)=>z.source!==null&&!this.getRootParent(z,X).isSingleton);if(J.length===0)return;let M=new Set(J.map((z)=>z.value));if(H=J.filter((z)=>!(z.parent&&M.has(z.parent))),H.length===0)throw Error("There are cyclic diposable chains!")}if(!H)return;function F(X){function J(z,K){for(;z.length>0&&K.some((W)=>typeof W=="string"?W===z[0]:z[0].match(W));)z.shift()}let M=X.source.split(`
`).map((z)=>z.trim().replace("at ","")).filter((z)=>z!=="");return J(M,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),M.reverse()}let Z=new S5;for(let X of H){let J=F(X);for(let M=0;M<=J.length;M++)Z.add(J.slice(0,M).join(`
`),X)}H.sort(O5((X)=>X.idx,x5));let $="",V=0;for(let X of H.slice(0,Y)){V++;let J=F(X),M=[];for(let z=0;z<J.length;z++){let K=J[z];K=`(shared with ${Z.get(J.slice(0,z+1).join(`
`)).size}/${H.length} leaks) at ${K}`;let W=Z.get(J.slice(0,z).join(`
`)),j=y5([...W].map((C)=>F(C)[z]),(C)=>C);delete j[J[z]];for(let[C,L]of Object.entries(j))M.unshift(`    - stacktraces of ${L.length} other leaks continue with ${C}`);M.unshift(K)}$+=`


==================== Leaking disposable ${V}/${H.length}: ${X.value.constructor.name} ====================
${M.join(`
`)}
============================================================

`}return H.length>Y&&($+=`


... and ${H.length-Y} more leaking disposables

`),{leaks:H,details:$}}};T5.idx=0;function _5(q){i0=q}if(I5){let q="__is_disposable_tracked__";_5(new class{trackDisposable(Y){let G=Error("Potentially leaked disposable").stack;setTimeout(()=>{Y[q]||console.log(G)},3000)}setParent(Y,G){if(Y&&Y!==S.None)try{Y[q]=!0}catch{}}markAsDisposed(Y){if(Y&&Y!==S.None)try{Y[q]=!0}catch{}}markAsSingleton(Y){}})}function Z2(q){return i0?.trackDisposable(q),q}function $2(q){i0?.markAsDisposed(q)}function O1(q,Y){i0?.setParent(q,Y)}function E5(q,Y){if(i0)for(let G of q)i0.setParent(G,Y)}function L3(q){return i0?.markAsSingleton(q),q}function t0(q){if(y4.is(q)){let Y=[];for(let G of q)if(G)try{G.dispose()}catch(H){Y.push(H)}if(Y.length===1)throw Y[0];if(Y.length>1)throw AggregateError(Y,"Encountered errors while disposing of store");return Array.isArray(q)?[]:q}else if(q)return q.dispose(),q}function b5(...q){let Y=m(()=>t0(q));return E5(q,Y),Y}function m(q){let Y=Z2({dispose:w5(()=>{$2(Y),q()})});return Y}var S4=class q{constructor(){this._toDispose=new Set,this._isDisposed=!1,Z2(this)}dispose(){this._isDisposed||($2(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{t0(this._toDispose)}finally{this._toDispose.clear()}}add(Y){if(!Y)return Y;if(Y===this)throw Error("Cannot register a disposable on itself!");return O1(Y,this),this._isDisposed?q.DISABLE_DISPOSED_WARNING||console.warn(Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(Y),Y}delete(Y){if(Y){if(Y===this)throw Error("Cannot dispose a disposable on itself!");this._toDispose.delete(Y),Y.dispose()}}deleteAndLeak(Y){Y&&this._toDispose.has(Y)&&(this._toDispose.delete(Y),O1(Y,null))}};S4.DISABLE_DISPOSED_WARNING=!1;var a0=S4,S=class{constructor(){this._store=new a0,Z2(this),O1(this._store,this)}dispose(){$2(this),this._store.dispose()}_register(q){if(q===this)throw Error("Cannot register a disposable on itself!");return this._store.add(q)}};S.None=Object.freeze({dispose(){}});var F1=class{constructor(){this._isDisposed=!1,Z2(this)}get value(){return this._isDisposed?void 0:this._value}set value(q){this._isDisposed||q===this._value||(this._value?.dispose(),q&&O1(q,this),this._value=q)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,$2(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){let q=this._value;return this._value=void 0,q&&O1(q,null),q}},C0=typeof window=="object"?window:globalThis,_2=class q{constructor(Y){this.element=Y,this.next=q.Undefined,this.prev=q.Undefined}};_2.Undefined=new _2(void 0);var d=_2,Q3=class{constructor(){this._first=d.Undefined,this._last=d.Undefined,this._size=0}get size(){return this._size}isEmpty(){return this._first===d.Undefined}clear(){let q=this._first;for(;q!==d.Undefined;){let Y=q.next;q.prev=d.Undefined,q.next=d.Undefined,q=Y}this._first=d.Undefined,this._last=d.Undefined,this._size=0}unshift(q){return this._insert(q,!1)}push(q){return this._insert(q,!0)}_insert(q,Y){let G=new d(q);if(this._first===d.Undefined)this._first=G,this._last=G;else if(Y){let F=this._last;this._last=G,G.prev=F,F.next=G}else{let F=this._first;this._first=G,G.next=F,F.prev=G}this._size+=1;let H=!1;return()=>{H||(H=!0,this._remove(G))}}shift(){if(this._first!==d.Undefined){let q=this._first.element;return this._remove(this._first),q}}pop(){if(this._last!==d.Undefined){let q=this._last.element;return this._remove(this._last),q}}_remove(q){if(q.prev!==d.Undefined&&q.next!==d.Undefined){let Y=q.prev;Y.next=q.next,q.next.prev=Y}else q.prev===d.Undefined&&q.next===d.Undefined?(this._first=d.Undefined,this._last=d.Undefined):q.next===d.Undefined?(this._last=this._last.prev,this._last.next=d.Undefined):q.prev===d.Undefined&&(this._first=this._first.next,this._first.prev=d.Undefined);this._size-=1}*[Symbol.iterator](){let q=this._first;for(;q!==d.Undefined;)yield q.element,q=q.next}},v5=globalThis.performance&&typeof globalThis.performance.now=="function",f5=class q{static create(Y){return new q(Y)}constructor(Y){this._now=v5&&Y===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}},p5=!1,P3=!1,m5=!1,$0;((q)=>{q.None=()=>S.None;function Y(N){if(m5){let{onDidAddListener:D}=N,Q=b2.create(),k=0;N.onDidAddListener=()=>{++k===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),Q.print()),D?.()}}}function G(N,D){return K(N,()=>{},0,void 0,!0,void 0,D)}q.defer=G;function H(N){return(D,Q=null,k)=>{let O=!1,R;return R=N((T)=>{if(!O)return R?R.dispose():O=!0,D.call(Q,T)},null,k),O&&R.dispose(),R}}q.once=H;function F(N,D,Q){return M((k,O=null,R)=>N((T)=>k.call(O,D(T)),null,R),Q)}q.map=F;function Z(N,D,Q){return M((k,O=null,R)=>N((T)=>{D(T),k.call(O,T)},null,R),Q)}q.forEach=Z;function $(N,D,Q){return M((k,O=null,R)=>N((T)=>D(T)&&k.call(O,T),null,R),Q)}q.filter=$;function V(N){return N}q.signal=V;function X(...N){return(D,Q=null,k)=>{let O=b5(...N.map((R)=>R((T)=>D.call(Q,T))));return z(O,k)}}q.any=X;function J(N,D,Q,k){let O=Q;return F(N,(R)=>(O=D(O,R),O),k)}q.reduce=J;function M(N,D){let Q,k={onWillAddFirstListener(){Q=N(O.fire,O)},onDidRemoveLastListener(){Q?.dispose()}};D||Y(k);let O=new B(k);return D?.add(O),O.event}function z(N,D){return D instanceof Array?D.push(N):D&&D.add(N),N}function K(N,D,Q=100,k=!1,O=!1,R,T){let h,Z0,k0,y0=0,t,v0={leakWarningThreshold:R,onWillAddFirstListener(){h=N((l0)=>{y0++,Z0=D(Z0,l0),k&&!k0&&(J0.fire(Z0),Z0=void 0),t=()=>{let X1=Z0;Z0=void 0,k0=void 0,(!k||y0>1)&&J0.fire(X1),y0=0},typeof Q=="number"?(clearTimeout(k0),k0=setTimeout(t,Q)):k0===void 0&&(k0=0,queueMicrotask(t))})},onWillRemoveListener(){O&&y0>0&&t?.()},onDidRemoveLastListener(){t=void 0,h.dispose()}};T||Y(v0);let J0=new B(v0);return T?.add(J0),J0.event}q.debounce=K;function W(N,D=0,Q){return q.debounce(N,(k,O)=>k?(k.push(O),k):[O],D,void 0,!0,void 0,Q)}q.accumulate=W;function j(N,D=(k,O)=>k===O,Q){let k=!0,O;return $(N,(R)=>{let T=k||!D(R,O);return k=!1,O=R,T},Q)}q.latch=j;function C(N,D,Q){return[q.filter(N,D,Q),q.filter(N,(k)=>!D(k),Q)]}q.split=C;function L(N,D=!1,Q=[],k){let O=Q.slice(),R=N((Z0)=>{O?O.push(Z0):h.fire(Z0)});k&&k.add(R);let T=()=>{O?.forEach((Z0)=>h.fire(Z0)),O=null},h=new B({onWillAddFirstListener(){R||(R=N((Z0)=>h.fire(Z0)),k&&k.add(R))},onDidAddFirstListener(){O&&(D?setTimeout(T):T())},onDidRemoveLastListener(){R&&R.dispose(),R=null}});return k&&k.add(h),h.event}q.buffer=L;function x(N,D){return(Q,k,O)=>{let R=D(new I);return N(function(T){let h=R.evaluate(T);h!==v&&Q.call(k,h)},void 0,O)}}q.chain=x;let v=Symbol("HaltChainable");class I{constructor(){this.steps=[]}map(N){return this.steps.push(N),this}forEach(N){return this.steps.push((D)=>(N(D),D)),this}filter(N){return this.steps.push((D)=>N(D)?D:v),this}reduce(N,D){let Q=D;return this.steps.push((k)=>(Q=N(Q,k),Q)),this}latch(N=(D,Q)=>D===Q){let D=!0,Q;return this.steps.push((k)=>{let O=D||!N(k,Q);return D=!1,Q=k,O?k:v}),this}evaluate(N){for(let D of this.steps)if(N=D(N),N===v)break;return N}}function P(N,D,Q=(k)=>k){let k=(...h)=>T.fire(Q(...h)),O=()=>N.on(D,k),R=()=>N.removeListener(D,k),T=new B({onWillAddFirstListener:O,onDidRemoveLastListener:R});return T.event}q.fromNodeEventEmitter=P;function _(N,D,Q=(k)=>k){let k=(...h)=>T.fire(Q(...h)),O=()=>N.addEventListener(D,k),R=()=>N.removeEventListener(D,k),T=new B({onWillAddFirstListener:O,onDidRemoveLastListener:R});return T.event}q.fromDOMEventEmitter=_;function E(N){return new Promise((D)=>H(N)(D))}q.toPromise=E;function F0(N){let D=new B;return N.then((Q)=>{D.fire(Q)},()=>{D.fire(void 0)}).finally(()=>{D.dispose()}),D.event}q.fromPromise=F0;function D0(N,D){return N((Q)=>D.fire(Q))}q.forward=D0;function A0(N,D,Q){return D(Q),N((k)=>D(k))}q.runAndSubscribe=A0;class V1{constructor(N,D){this._observable=N,this._counter=0,this._hasChanged=!1;let Q={onWillAddFirstListener:()=>{N.addObserver(this)},onDidRemoveLastListener:()=>{N.removeObserver(this)}};D||Y(Q),this.emitter=new B(Q),D&&D.add(this.emitter)}beginUpdate(N){this._counter++}handlePossibleChange(N){}handleChange(N,D){this._hasChanged=!0}endUpdate(N){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function g(N,D){return new V1(N,D).emitter.event}q.fromObservable=g;function X2(N){return(D,Q,k)=>{let O=0,R=!1,T={beginUpdate(){O++},endUpdate(){O--,O===0&&(N.reportChanges(),R&&(R=!1,D.call(Q)))},handlePossibleChange(){},handleChange(){R=!0}};N.addObserver(T),N.reportChanges();let h={dispose(){N.removeObserver(T)}};return k instanceof a0?k.add(h):Array.isArray(k)&&k.push(h),h}}q.fromObservableLight=X2})($0||={});var E2=class q{constructor(Y){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${Y}_${q._idPool++}`,q.all.add(this)}start(Y){this._stopWatch=new f5,this.listenerCount=Y}stop(){if(this._stopWatch){let Y=this._stopWatch.elapsed();this.durations.push(Y),this.elapsedOverall+=Y,this.invocationCount+=1,this._stopWatch=void 0}}};E2.all=new Set,E2._idPool=0;var g5=E2,O3=-1,w4=class q{constructor(Y,G,H=(q._idPool++).toString(16).padStart(3,"0")){this._errorHandler=Y,this.threshold=G,this.name=H,this._warnCountdown=0}dispose(){this._stacks?.clear()}check(Y,G){let H=this.threshold;if(H<=0||G<H)return;this._stacks||(this._stacks=new Map);let F=this._stacks.get(Y.value)||0;if(this._stacks.set(Y.value,F+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=H*0.5;let[Z,$]=this.getMostFrequentStack(),V=`[${this.name}] potential listener LEAK detected, having ${G} listeners already. MOST frequent listener (${$}):`;console.warn(V),console.warn(Z);let X=new d5(V,Z);this._errorHandler(X)}return()=>{let Z=this._stacks.get(Y.value)||0;this._stacks.set(Y.value,Z-1)}}getMostFrequentStack(){if(!this._stacks)return;let Y,G=0;for(let[H,F]of this._stacks)(!Y||G<F)&&(Y=[H,F],G=F);return Y}};w4._idPool=1;var h5=w4,b2=class q{constructor(Y){this.value=Y}static create(){let Y=Error();return new q(Y.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},d5=class extends Error{constructor(q,Y){super(q),this.name="ListenerLeakError",this.stack=Y}},u5=class extends Error{constructor(q,Y){super(q),this.name="ListenerRefusalError",this.stack=Y}},c5=0,h1=class{constructor(q){this.value=q,this.id=c5++}},a5=2,l5=(q,Y)=>{if(q instanceof h1)Y(q);else for(let G=0;G<q.length;G++){let H=q[G];H&&Y(H)}},d1;if(p5){let q=[];setInterval(()=>{q.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn(q.join(`
`)),q.length=0)},3000),d1=new FinalizationRegistry((Y)=>{typeof Y=="string"&&q.push(Y)})}var B=class{constructor(q){this._size=0,this._options=q,this._leakageMon=O3>0||this._options?.leakWarningThreshold?new h5(q?.onListenerError??g1,this._options?.leakWarningThreshold??O3):void 0,this._perfMon=this._options?._profName?new g5(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){if(!this._disposed){if(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners){if(P3){let q=this._listeners;queueMicrotask(()=>{l5(q,(Y)=>Y.stack?.print())})}this._listeners=void 0,this._size=0}this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose()}}get event(){return this._event??=(q,Y,G)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let V=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(V);let X=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],J=new u5(`${V}. HINT: Stack shows most frequent listener (${X[1]}-times)`,X[0]);return(this._options?.onListenerError||g1)(J),S.None}if(this._disposed)return S.None;Y&&(q=q.bind(Y));let H=new h1(q),F,Z;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*0.2)&&(H.stack=b2.create(),F=this._leakageMon.check(H.stack,this._size+1)),P3&&(H.stack=Z??b2.create()),this._listeners?this._listeners instanceof h1?(this._deliveryQueue??=new o5,this._listeners=[this._listeners,H]):this._listeners.push(H):(this._options?.onWillAddFirstListener?.(this),this._listeners=H,this._options?.onDidAddFirstListener?.(this)),this._size++;let $=m(()=>{d1?.unregister($),F?.(),this._removeListener(H)});if(G instanceof a0?G.add($):Array.isArray(G)&&G.push($),d1){let V=Error().stack.split(`
`).slice(2,3).join(`
`).trim(),X=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(V);d1.register($,X?.[2]??V,$)}return $},this._event}_removeListener(q){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let Y=this._listeners,G=Y.indexOf(q);if(G===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),Error("Attempted to dispose unknown listener");this._size--,Y[G]=void 0;let H=this._deliveryQueue.current===this;if(this._size*a5<=Y.length){let F=0;for(let Z=0;Z<Y.length;Z++)Y[Z]?Y[F++]=Y[Z]:H&&(this._deliveryQueue.end--,F<this._deliveryQueue.i&&this._deliveryQueue.i--);Y.length=F}}_deliver(q,Y){if(!q)return;let G=this._options?.onListenerError||g1;if(!G){q.value(Y);return}try{q.value(Y)}catch(H){G(H)}}_deliverQueue(q){let Y=q.current._listeners;for(;q.i<q.end;)this._deliver(Y[q.i++],q.value);q.reset()}fire(q){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof h1)this._deliver(this._listeners,q);else{let Y=this._deliveryQueue;Y.enqueue(this,q,this._listeners.length),this._deliverQueue(Y)}this._perfMon?.stop()}hasListeners(){return this._size>0}},o5=class{constructor(){this.i=-1,this.end=0}enqueue(q,Y,G){this.i=0,this.end=G,this.current=q,this.value=Y}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},v2=class{constructor(){this.mapWindowIdToZoomLevel=new Map,this._onDidChangeZoomLevel=new B,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event,this.mapWindowIdToZoomFactor=new Map,this._onDidChangeFullscreen=new B,this.onDidChangeFullscreen=this._onDidChangeFullscreen.event,this.mapWindowIdToFullScreen=new Map}getZoomLevel(Y){return this.mapWindowIdToZoomLevel.get(this.getWindowId(Y))??0}setZoomLevel(Y,G){if(this.getZoomLevel(G)===Y)return;let H=this.getWindowId(G);this.mapWindowIdToZoomLevel.set(H,Y),this._onDidChangeZoomLevel.fire(H)}getZoomFactor(Y){return this.mapWindowIdToZoomFactor.get(this.getWindowId(Y))??1}setZoomFactor(Y,G){this.mapWindowIdToZoomFactor.set(this.getWindowId(G),Y)}setFullscreen(Y,G){if(this.isFullscreen(G)===Y)return;let H=this.getWindowId(G);this.mapWindowIdToFullScreen.set(H,Y),this._onDidChangeFullscreen.fire(H)}isFullscreen(Y){return!!this.mapWindowIdToFullScreen.get(this.getWindowId(Y))}getWindowId(Y){return Y.vscodeWindowId}};v2.INSTANCE=new v2;var Z3=v2;function n5(q,Y,G){typeof Y=="string"&&(Y=q.matchMedia(Y)),Y.addEventListener("change",G)}var q9=Z3.INSTANCE.onDidChangeZoomLevel;function s5(q){return Z3.INSTANCE.getZoomFactor(q)}var Y9=Z3.INSTANCE.onDidChangeFullscreen,$1=typeof navigator=="object"?navigator.userAgent:"",f2=$1.indexOf("Firefox")>=0,u1=$1.indexOf("AppleWebKit")>=0,$3=$1.indexOf("Chrome")>=0,I4=!$3&&$1.indexOf("Safari")>=0,G9=$1.indexOf("Electron/")>=0,H9=$1.indexOf("Android")>=0,c1=!1;if(typeof C0.matchMedia=="function"){let q=C0.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),Y=C0.matchMedia("(display-mode: fullscreen)");c1=q.matches,n5(C0,q,({matches:G})=>{c1&&Y.matches||(c1=G)})}function r5(){return c1}var H1="en",s1=!1,r1=!1,Q1=!1,i5=!1,T4=!1,_4=!1,t5=!1,e5=!1,q6=!1,Y6=!1,b1,a1=H1,x3=H1,G6,w0,T0=globalThis,W0;typeof T0.vscode<"u"&&typeof T0.vscode.process<"u"?W0=T0.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(W0=process);var E4=typeof W0?.versions?.electron=="string",H6=E4&&W0?.type==="renderer";if(typeof W0=="object"){s1=W0.platform==="win32",r1=W0.platform==="darwin",Q1=W0.platform==="linux",i5=Q1&&!!W0.env.SNAP&&!!W0.env.SNAP_REVISION,t5=E4,q6=!!W0.env.CI||!!W0.env.BUILD_ARTIFACTSTAGINGDIRECTORY,b1=H1,a1=H1;let q=W0.env.VSCODE_NLS_CONFIG;if(q)try{let Y=JSON.parse(q);b1=Y.userLocale,x3=Y.osLocale,a1=Y.resolvedLanguage||H1,G6=Y.languagePack?.translationsConfigFile}catch{}T4=!0}else typeof navigator=="object"&&!H6?(w0=navigator.userAgent,s1=w0.indexOf("Windows")>=0,r1=w0.indexOf("Macintosh")>=0,e5=(w0.indexOf("Macintosh")>=0||w0.indexOf("iPad")>=0||w0.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,Q1=w0.indexOf("Linux")>=0,Y6=w0?.indexOf("Mobi")>=0,_4=!0,a1=globalThis._VSCODE_NLS_LANGUAGE||H1,b1=navigator.language.toLowerCase(),x3=b1):console.error("Unable to resolve platform.");var j2=0;r1?j2=1:s1?j2=3:Q1&&(j2=2);var b4=s1,O0=r1,F6=Q1,K2=T4,Z6=_4&&typeof T0.importScripts=="function",F9=Z6?T0.origin:void 0,x0=w0,m0=a1,$6;((q)=>{function Y(){return m0}q.value=Y;function G(){return m0.length===2?m0==="en":m0.length>=3?m0[0]==="e"&&m0[1]==="n"&&m0[2]==="-":!1}q.isDefaultVariant=G;function H(){return m0==="en"}q.isDefault=H})($6||={});var J6=typeof T0.postMessage=="function"&&!T0.importScripts,V6=(()=>{if(J6){let q=[];T0.addEventListener("message",(G)=>{if(G.data&&G.data.vscodeScheduleAsyncWork)for(let H=0,F=q.length;H<F;H++){let Z=q[H];if(Z.id===G.data.vscodeScheduleAsyncWork){q.splice(H,1),Z.callback();return}}});let Y=0;return(G)=>{let H=++Y;q.push({id:H,callback:G}),T0.postMessage({vscodeScheduleAsyncWork:H},"*")}}return(q)=>setTimeout(q)})(),X6=!!(x0&&x0.indexOf("Chrome")>=0),Z9=!!(x0&&x0.indexOf("Firefox")>=0),$9=!!(!X6&&x0&&x0.indexOf("Safari")>=0),J9=!!(x0&&x0.indexOf("Edg/")>=0),V9=!!(x0&&x0.indexOf("Android")>=0),g0=typeof navigator=="object"?navigator:{},X9={clipboard:{writeText:K2||document.queryCommandSupported&&document.queryCommandSupported("copy")||!!(g0&&g0.clipboard&&g0.clipboard.writeText),readText:K2||!!(g0&&g0.clipboard&&g0.clipboard.readText)},keyboard:K2||r5()?0:g0.keyboard||I4?1:2,touch:"ontouchstart"in C0||g0.maxTouchPoints>0,pointerEvents:C0.PointerEvent&&(("ontouchstart"in C0)||navigator.maxTouchPoints>0)},J3=class{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(q,Y){this._keyCodeToStr[q]=Y,this._strToKeyCode[Y.toLowerCase()]=q}keyCodeToStr(q){return this._keyCodeToStr[q]}strToKeyCode(q){return this._strToKeyCode[q.toLowerCase()]||0}},W2=new J3,y3=new J3,S3=new J3,z6=Array(230),v4;((q)=>{function Y(V){return W2.keyCodeToStr(V)}q.toString=Y;function G(V){return W2.strToKeyCode(V)}q.fromString=G;function H(V){return y3.keyCodeToStr(V)}q.toUserSettingsUS=H;function F(V){return S3.keyCodeToStr(V)}q.toUserSettingsGeneral=F;function Z(V){return y3.strToKeyCode(V)||S3.strToKeyCode(V)}q.fromUserSettings=Z;function $(V){if(V>=98&&V<=113)return null;switch(V){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return W2.keyCodeToStr(V)}q.toElectronAccelerator=$})(v4||={});var M6=class q{constructor(Y,G,H,F,Z){this.ctrlKey=Y,this.shiftKey=G,this.altKey=H,this.metaKey=F,this.keyCode=Z}equals(Y){return Y instanceof q&&this.ctrlKey===Y.ctrlKey&&this.shiftKey===Y.shiftKey&&this.altKey===Y.altKey&&this.metaKey===Y.metaKey&&this.keyCode===Y.keyCode}getHashCode(){let Y=this.ctrlKey?"1":"0",G=this.shiftKey?"1":"0",H=this.altKey?"1":"0",F=this.metaKey?"1":"0";return`K${Y}${G}${H}${F}${this.keyCode}`}isModifierKey(){return this.keyCode===0||this.keyCode===5||this.keyCode===57||this.keyCode===6||this.keyCode===4}toKeybinding(){return new j6([this])}isDuplicateModifierCase(){return this.ctrlKey&&this.keyCode===5||this.shiftKey&&this.keyCode===4||this.altKey&&this.keyCode===6||this.metaKey&&this.keyCode===57}},j6=class{constructor(q){if(q.length===0)throw L5("chords");this.chords=q}getHashCode(){let q="";for(let Y=0,G=this.chords.length;Y<G;Y++)Y!==0&&(q+=";"),q+=this.chords[Y].getHashCode();return q}equals(q){if(q===null||this.chords.length!==q.chords.length)return!1;for(let Y=0;Y<this.chords.length;Y++)if(!this.chords[Y].equals(q.chords[Y]))return!1;return!0}};function K6(q){if(q.charCode){let G=String.fromCharCode(q.charCode).toUpperCase();return v4.fromString(G)}let Y=q.keyCode;if(Y===3)return 7;if(f2)switch(Y){case 59:return 85;case 60:if(F6)return 97;break;case 61:return 86;case 107:return 109;case 109:return 111;case 173:return 88;case 224:if(O0)return 57;break}else if(u1){if(O0&&Y===93)return 57;if(!O0&&Y===92)return 57}return z6[Y]||0}var W6=O0?256:2048,C6=512,U6=1024,N6=O0?2048:256,p2=class{constructor(q){this._standardKeyboardEventBrand=!0;let Y=q;this.browserEvent=Y,this.target=Y.target,this.ctrlKey=Y.ctrlKey,this.shiftKey=Y.shiftKey,this.altKey=Y.altKey,this.metaKey=Y.metaKey,this.altGraphKey=Y.getModifierState?.("AltGraph"),this.keyCode=K6(Y),this.code=Y.code,this.ctrlKey=this.ctrlKey||this.keyCode===5,this.altKey=this.altKey||this.keyCode===6,this.shiftKey=this.shiftKey||this.keyCode===4,this.metaKey=this.metaKey||this.keyCode===57,this._asKeybinding=this._computeKeybinding(),this._asKeyCodeChord=this._computeKeyCodeChord()}preventDefault(){this.browserEvent&&this.browserEvent.preventDefault&&this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent&&this.browserEvent.stopPropagation&&this.browserEvent.stopPropagation()}toKeyCodeChord(){return this._asKeyCodeChord}equals(q){return this._asKeybinding===q}_computeKeybinding(){let q=0;this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(q=this.keyCode);let Y=0;return this.ctrlKey&&(Y|=W6),this.altKey&&(Y|=C6),this.shiftKey&&(Y|=U6),this.metaKey&&(Y|=N6),Y|=q,Y}_computeKeyCodeChord(){let q=0;return this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(q=this.keyCode),new M6(this.ctrlKey,this.shiftKey,this.altKey,this.metaKey,q)}},w3=new WeakMap;function B6(q){if(!q.parent||q.parent===q)return null;try{let Y=q.location,G=q.parent.location;if(Y.origin!=="null"&&G.origin!=="null"&&Y.origin!==G.origin)return null}catch{return null}return q.parent}var D6=class{static getSameOriginWindowChain(q){let Y=w3.get(q);if(!Y){Y=[],w3.set(q,Y);let G=q,H;do H=B6(G),H?Y.push({window:new WeakRef(G),iframeElement:G.frameElement||null}):Y.push({window:new WeakRef(G),iframeElement:null}),G=H;while(G)}return Y.slice(0)}static getPositionOfChildWindowRelativeToAncestorWindow(q,Y){if(!Y||q===Y)return{top:0,left:0};let G=0,H=0,F=this.getSameOriginWindowChain(q);for(let Z of F){let $=Z.window.deref();if(G+=$?.scrollY??0,H+=$?.scrollX??0,$===Y||!Z.iframeElement)break;let V=Z.iframeElement.getBoundingClientRect();G+=V.top,H+=V.left}return{top:G,left:H}}},B1=class{constructor(q,Y){this.timestamp=Date.now(),this.browserEvent=Y,this.leftButton=Y.button===0,this.middleButton=Y.button===1,this.rightButton=Y.button===2,this.buttons=Y.buttons,this.target=Y.target,this.detail=Y.detail||1,Y.type==="dblclick"&&(this.detail=2),this.ctrlKey=Y.ctrlKey,this.shiftKey=Y.shiftKey,this.altKey=Y.altKey,this.metaKey=Y.metaKey,typeof Y.pageX=="number"?(this.posx=Y.pageX,this.posy=Y.pageY):(this.posx=Y.clientX+this.target.ownerDocument.body.scrollLeft+this.target.ownerDocument.documentElement.scrollLeft,this.posy=Y.clientY+this.target.ownerDocument.body.scrollTop+this.target.ownerDocument.documentElement.scrollTop);let G=D6.getPositionOfChildWindowRelativeToAncestorWindow(q,Y.view);this.posx-=G.left,this.posy-=G.top}preventDefault(){this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent.stopPropagation()}},I3=class{constructor(q,Y=0,G=0){this.browserEvent=q||null,this.target=q?q.target||q.targetNode||q.srcElement:null,this.deltaY=G,this.deltaX=Y;let H=!1;if($3){let F=navigator.userAgent.match(/Chrome\/(\d+)/);H=(F?parseInt(F[1]):123)<=122}if(q){let F=q,Z=q,$=q.view?.devicePixelRatio||1;if(typeof F.wheelDeltaY<"u")H?this.deltaY=F.wheelDeltaY/(120*$):this.deltaY=F.wheelDeltaY/120;else if(typeof Z.VERTICAL_AXIS<"u"&&Z.axis===Z.VERTICAL_AXIS)this.deltaY=-Z.detail/3;else if(q.type==="wheel"){let V=q;V.deltaMode===V.DOM_DELTA_LINE?f2&&!O0?this.deltaY=-q.deltaY/3:this.deltaY=-q.deltaY:this.deltaY=-q.deltaY/40}if(typeof F.wheelDeltaX<"u")I4&&b4?this.deltaX=-(F.wheelDeltaX/120):H?this.deltaX=F.wheelDeltaX/(120*$):this.deltaX=F.wheelDeltaX/120;else if(typeof Z.HORIZONTAL_AXIS<"u"&&Z.axis===Z.HORIZONTAL_AXIS)this.deltaX=-q.detail/3;else if(q.type==="wheel"){let V=q;V.deltaMode===V.DOM_DELTA_LINE?f2&&!O0?this.deltaX=-q.deltaX/3:this.deltaX=-q.deltaX:this.deltaX=-q.deltaX/40}this.deltaY===0&&this.deltaX===0&&q.wheelDelta&&(H?this.deltaY=q.wheelDelta/(120*$):this.deltaY=q.wheelDelta/120)}}preventDefault(){this.browserEvent?.preventDefault()}stopPropagation(){this.browserEvent?.stopPropagation()}},f4=Object.freeze(function(q,Y){let G=setTimeout(q.bind(Y),0);return{dispose(){clearTimeout(G)}}}),R6;((q)=>{function Y(G){return G===q.None||G===q.Cancelled||G instanceof A6?!0:!G||typeof G!="object"?!1:typeof G.isCancellationRequested=="boolean"&&typeof G.onCancellationRequested=="function"}q.isCancellationToken=Y,q.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:$0.None}),q.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:f4})})(R6||={});var A6=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?f4:(this._emitter||(this._emitter=new B),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},z9=Symbol("MicrotaskDelay"),V3=class{constructor(q,Y){this._isDisposed=!1,this._token=-1,typeof q=="function"&&typeof Y=="number"&&this.setIfNotSet(q,Y)}dispose(){this.cancel(),this._isDisposed=!0}cancel(){this._token!==-1&&(clearTimeout(this._token),this._token=-1)}cancelAndSet(q,Y){if(this._isDisposed)throw new T2("Calling 'cancelAndSet' on a disposed TimeoutTimer");this.cancel(),this._token=setTimeout(()=>{this._token=-1,q()},Y)}setIfNotSet(q,Y){if(this._isDisposed)throw new T2("Calling 'setIfNotSet' on a disposed TimeoutTimer");this._token===-1&&(this._token=setTimeout(()=>{this._token=-1,q()},Y))}},k6=class{constructor(){this.disposable=void 0,this.isDisposed=!1}cancel(){this.disposable?.dispose(),this.disposable=void 0}cancelAndSet(q,Y,G=globalThis){if(this.isDisposed)throw new T2("Calling 'cancelAndSet' on a disposed IntervalTimer");this.cancel();let H=G.setInterval(()=>{q()},Y);this.disposable=m(()=>{G.clearInterval(H),this.disposable=void 0})}dispose(){this.cancel(),this.isDisposed=!0}},L6,C2;(function(){typeof globalThis.requestIdleCallback!="function"||typeof globalThis.cancelIdleCallback!="function"?C2=(q,Y)=>{V6(()=>{if(G)return;let H=Date.now()+15;Y(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,H-Date.now())}}))});let G=!1;return{dispose(){G||(G=!0)}}}:C2=(q,Y,G)=>{let H=q.requestIdleCallback(Y,typeof G=="number"?{timeout:G}:void 0),F=!1;return{dispose(){F||(F=!0,q.cancelIdleCallback(H))}}},L6=(q)=>C2(globalThis,q)})();var Q6;((q)=>{async function Y(H){let F,Z=await Promise.all(H.map(($)=>$.then((V)=>V,(V)=>{F||(F=V)})));if(typeof F<"u")throw F;return Z}q.settled=Y;function G(H){return new Promise(async(F,Z)=>{try{await H(F,Z)}catch($){Z($)}})}q.withAsyncBody=G})(Q6||={});var T3=class q{static fromArray(Y){return new q((G)=>{G.emitMany(Y)})}static fromPromise(Y){return new q(async(G)=>{G.emitMany(await Y)})}static fromPromises(Y){return new q(async(G)=>{await Promise.all(Y.map(async(H)=>G.emitOne(await H)))})}static merge(Y){return new q(async(G)=>{await Promise.all(Y.map(async(H)=>{for await(let F of H)G.emitOne(F)}))})}constructor(Y,G){this._state=0,this._results=[],this._error=null,this._onReturn=G,this._onStateChanged=new B,queueMicrotask(async()=>{let H={emitOne:(F)=>this.emitOne(F),emitMany:(F)=>this.emitMany(F),reject:(F)=>this.reject(F)};try{await Promise.resolve(Y(H)),this.resolve()}catch(F){this.reject(F)}finally{H.emitOne=void 0,H.emitMany=void 0,H.reject=void 0}})}[Symbol.asyncIterator](){let Y=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(Y<this._results.length)return{done:!1,value:this._results[Y++]};if(this._state===1)return{done:!0,value:void 0};await $0.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>(this._onReturn?.(),{done:!0,value:void 0})}}static map(Y,G){return new q(async(H)=>{for await(let F of Y)H.emitOne(G(F))})}map(Y){return q.map(this,Y)}static filter(Y,G){return new q(async(H)=>{for await(let F of Y)G(F)&&H.emitOne(F)})}filter(Y){return q.filter(this,Y)}static coalesce(Y){return q.filter(Y,(G)=>!!G)}coalesce(){return q.coalesce(this)}static async toPromise(Y){let G=[];for await(let H of Y)G.push(H);return G}toPromise(){return q.toPromise(this)}emitOne(Y){this._state===0&&(this._results.push(Y),this._onStateChanged.fire())}emitMany(Y){this._state===0&&(this._results=this._results.concat(Y),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(Y){this._state===0&&(this._state=2,this._error=Y,this._onStateChanged.fire())}};T3.EMPTY=T3.fromArray([]);function P6(q){return 55296<=q&&q<=56319}function _3(q){return 56320<=q&&q<=57343}function O6(q,Y){return(q-55296<<10)+(Y-56320)+65536}function x6(q){return X3(q,0)}function X3(q,Y){switch(typeof q){case"object":return q===null?I0(349,Y):Array.isArray(q)?S6(q,Y):w6(q,Y);case"string":return p4(q,Y);case"boolean":return y6(q,Y);case"number":return I0(q,Y);case"undefined":return I0(937,Y);default:return I0(617,Y)}}function I0(q,Y){return(Y<<5)-Y+q|0}function y6(q,Y){return I0(q?433:863,Y)}function p4(q,Y){Y=I0(149417,Y);for(let G=0,H=q.length;G<H;G++)Y=I0(q.charCodeAt(G),Y);return Y}function S6(q,Y){return Y=I0(104579,Y),q.reduce((G,H)=>X3(H,G),Y)}function w6(q,Y){return Y=I0(181387,Y),Object.keys(q).sort().reduce((G,H)=>(G=p4(H,G),X3(q[H],G)),Y)}function U2(q,Y,G=32){let H=G-Y,F=~((1<<H)-1);return(q<<Y|(F&q)>>>H)>>>0}function E3(q,Y=0,G=q.byteLength,H=0){for(let F=0;F<G;F++)q[Y+F]=H}function I6(q,Y,G="0"){for(;q.length<Y;)q=G+q;return q}function M1(q,Y=32){return q instanceof ArrayBuffer?Array.from(new Uint8Array(q)).map((G)=>G.toString(16).padStart(2,"0")).join(""):I6((q>>>0).toString(16),Y/4)}var T6=class q{constructor(){this._h0=1732584193,this._h1=4023233417,this._h2=2562383102,this._h3=271733878,this._h4=3285377520,this._buff=new Uint8Array(67),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}update(Y){let G=Y.length;if(G===0)return;let H=this._buff,F=this._buffLen,Z=this._leftoverHighSurrogate,$,V;for(Z!==0?($=Z,V=-1,Z=0):($=Y.charCodeAt(0),V=0);;){let X=$;if(P6($))if(V+1<G){let J=Y.charCodeAt(V+1);_3(J)?(V++,X=O6($,J)):X=65533}else{Z=$;break}else _3($)&&(X=65533);if(F=this._push(H,F,X),V++,V<G)$=Y.charCodeAt(V);else break}this._buffLen=F,this._leftoverHighSurrogate=Z}_push(Y,G,H){return H<128?Y[G++]=H:H<2048?(Y[G++]=192|(H&1984)>>>6,Y[G++]=128|(H&63)>>>0):H<65536?(Y[G++]=224|(H&61440)>>>12,Y[G++]=128|(H&4032)>>>6,Y[G++]=128|(H&63)>>>0):(Y[G++]=240|(H&1835008)>>>18,Y[G++]=128|(H&258048)>>>12,Y[G++]=128|(H&4032)>>>6,Y[G++]=128|(H&63)>>>0),G>=64&&(this._step(),G-=64,this._totalLen+=64,Y[0]=Y[64],Y[1]=Y[65],Y[2]=Y[66]),G}digest(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),M1(this._h0)+M1(this._h1)+M1(this._h2)+M1(this._h3)+M1(this._h4)}_wrapUp(){this._buff[this._buffLen++]=128,E3(this._buff,this._buffLen),this._buffLen>56&&(this._step(),E3(this._buff));let Y=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(Y/4294967296),!1),this._buffDV.setUint32(60,Y%4294967296,!1),this._step()}_step(){let Y=q._bigBlock32,G=this._buffDV;for(let z=0;z<64;z+=4)Y.setUint32(z,G.getUint32(z,!1),!1);for(let z=64;z<320;z+=4)Y.setUint32(z,U2(Y.getUint32(z-12,!1)^Y.getUint32(z-32,!1)^Y.getUint32(z-56,!1)^Y.getUint32(z-64,!1),1),!1);let H=this._h0,F=this._h1,Z=this._h2,$=this._h3,V=this._h4,X,J,M;for(let z=0;z<80;z++)z<20?(X=F&Z|~F&$,J=1518500249):z<40?(X=F^Z^$,J=1859775393):z<60?(X=F&Z|F&$|Z&$,J=2400959708):(X=F^Z^$,J=3395469782),M=U2(H,5)+X+V+J+Y.getUint32(z*4,!1)&4294967295,V=$,$=Z,Z=U2(F,30),F=H,H=M;this._h0=this._h0+H&4294967295,this._h1=this._h1+F&4294967295,this._h2=this._h2+Z&4294967295,this._h3=this._h3+$&4294967295,this._h4=this._h4+V&4294967295}};T6._bigBlock32=new DataView(new ArrayBuffer(320));var{registerWindow:M9,getWindow:R0,getDocument:j9,getWindows:K9,getWindowsCount:W9,getWindowId:b3,getWindowById:C9,hasWindow:U9,onDidRegisterWindow:_6,onWillUnregisterWindow:N9,onDidUnregisterWindow:B9}=function(){let q=new Map,Y={window:C0,disposables:new a0};q.set(C0.vscodeWindowId,Y);let G=new B,H=new B,F=new B;function Z($,V){return(typeof $=="number"?q.get($):void 0)??(V?Y:void 0)}return{onDidRegisterWindow:G.event,onWillUnregisterWindow:F.event,onDidUnregisterWindow:H.event,registerWindow($){if(q.has($.vscodeWindowId))return S.None;let V=new a0,X={window:$,disposables:V.add(new a0)};return q.set($.vscodeWindowId,X),V.add(m(()=>{q.delete($.vscodeWindowId),H.fire($)})),V.add(y($,e.BEFORE_UNLOAD,()=>{F.fire($)})),G.fire(X),V},getWindows(){return q.values()},getWindowsCount(){return q.size},getWindowId($){return $.vscodeWindowId},hasWindow($){return q.has($)},getWindowById:Z,getWindow($){let V=$;if(V?.ownerDocument?.defaultView)return V.ownerDocument.defaultView.window;let X=$;return X?.view?X.view.window:C0},getDocument($){return R0($).document}}}(),E6=class{constructor(q,Y,G,H){this._node=q,this._type=Y,this._handler=G,this._options=H||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}};function y(q,Y,G,H){return new E6(q,Y,G,H)}function b6(q,Y){return function(G){return Y(new B1(q,G))}}function v6(q){return function(Y){return q(new p2(Y))}}var v3=function(q,Y,G,H){let F=G;return Y==="click"||Y==="mousedown"||Y==="contextmenu"?F=b6(R0(q),G):(Y==="keydown"||Y==="keypress"||Y==="keyup")&&(F=v6(G)),y(q,Y,F,H)},f6,i1,p6=class extends k6{constructor(q){super(),this.defaultTarget=q&&R0(q)}cancelAndSet(q,Y,G){return super.cancelAndSet(q,Y,G??this.defaultTarget)}},N2=class{constructor(q,Y=0){this._runner=q,this.priority=Y,this._canceled=!1}dispose(){this._canceled=!0}execute(){if(!this._canceled)try{this._runner()}catch(q){g1(q)}}static sort(q,Y){return Y.priority-q.priority}};(function(){let q=new Map,Y=new Map,G=new Map,H=new Map,F=(Z)=>{G.set(Z,!1);let $=q.get(Z)??[];for(Y.set(Z,$),q.set(Z,[]),H.set(Z,!0);$.length>0;)$.sort(N2.sort),$.shift().execute();H.set(Z,!1)};i1=(Z,$,V=0)=>{let X=b3(Z),J=new N2($,V),M=q.get(X);return M||(M=[],q.set(X,M)),M.push(J),G.get(X)||(G.set(X,!0),Z.requestAnimationFrame(()=>F(X))),J},f6=(Z,$,V)=>{let X=b3(Z);if(H.get(X)){let J=new N2($,V),M=Y.get(X);return M||(M=[],Y.set(X,M)),M.push(J),J}else return i1(Z,$,V)}})();var f3=class q{constructor(Y,G){this.width=Y,this.height=G}with(Y=this.width,G=this.height){return Y!==this.width||G!==this.height?new q(Y,G):this}static is(Y){return typeof Y=="object"&&typeof Y.height=="number"&&typeof Y.width=="number"}static lift(Y){return Y instanceof q?Y:new q(Y.width,Y.height)}static equals(Y,G){return Y===G?!0:!Y||!G?!1:Y.width===G.width&&Y.height===G.height}};f3.None=new f3(0,0);function m6(q){let Y=q.getBoundingClientRect(),G=R0(q);return{left:Y.left+G.scrollX,top:Y.top+G.scrollY,width:Y.width,height:Y.height}}var D9=new class{constructor(){this.mutationObservers=new Map}observe(q,Y,G){let H=this.mutationObservers.get(q);H||(H=new Map,this.mutationObservers.set(q,H));let F=x6(G),Z=H.get(F);if(Z)Z.users+=1;else{let $=new B,V=new MutationObserver((J)=>$.fire(J));V.observe(q,G);let X=Z={users:1,observer:V,onDidMutate:$.event};Y.add(m(()=>{X.users-=1,X.users===0&&($.dispose(),V.disconnect(),H?.delete(F),H?.size===0&&this.mutationObservers.delete(q))})),H.set(F,Z)}return Z.onDidMutate}},e={CLICK:"click",AUXCLICK:"auxclick",DBLCLICK:"dblclick",MOUSE_UP:"mouseup",MOUSE_DOWN:"mousedown",MOUSE_OVER:"mouseover",MOUSE_MOVE:"mousemove",MOUSE_OUT:"mouseout",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",POINTER_LEAVE:"pointerleave",CONTEXT_MENU:"contextmenu",WHEEL:"wheel",KEY_DOWN:"keydown",KEY_PRESS:"keypress",KEY_UP:"keyup",LOAD:"load",BEFORE_UNLOAD:"beforeunload",UNLOAD:"unload",PAGE_SHOW:"pageshow",PAGE_HIDE:"pagehide",PASTE:"paste",ABORT:"abort",ERROR:"error",RESIZE:"resize",SCROLL:"scroll",FULLSCREEN_CHANGE:"fullscreenchange",WK_FULLSCREEN_CHANGE:"webkitfullscreenchange",SELECT:"select",CHANGE:"change",SUBMIT:"submit",RESET:"reset",FOCUS:"focus",FOCUS_IN:"focusin",FOCUS_OUT:"focusout",BLUR:"blur",INPUT:"input",STORAGE:"storage",DRAG_START:"dragstart",DRAG:"drag",DRAG_ENTER:"dragenter",DRAG_LEAVE:"dragleave",DRAG_OVER:"dragover",DROP:"drop",DRAG_END:"dragend",ANIMATION_START:u1?"webkitAnimationStart":"animationstart",ANIMATION_END:u1?"webkitAnimationEnd":"animationend",ANIMATION_ITERATION:u1?"webkitAnimationIteration":"animationiteration"},g6=/([\w\-]+)?(#([\w\-]+))?((\.([\w\-]+))*)/;function m4(q,Y,G,...H){let F=g6.exec(Y);if(!F)throw Error("Bad use of emmet");let Z=F[1]||"div",$;return q!=="http://www.w3.org/1999/xhtml"?$=document.createElementNS(q,Z):$=document.createElement(Z),F[3]&&($.id=F[3]),F[4]&&($.className=F[4].replace(/\./g," ").trim()),G&&Object.entries(G).forEach(([V,X])=>{typeof X>"u"||(/^on\w+$/.test(V)?$[V]=X:V==="selected"?X&&$.setAttribute(V,"true"):$.setAttribute(V,X))}),$.append(...H),$}function h6(q,Y,...G){return m4("http://www.w3.org/1999/xhtml",q,Y,...G)}h6.SVG=function(q,Y,...G){return m4("http://www.w3.org/2000/svg",q,Y,...G)};var d6=class{constructor(q){this.domNode=q,this._maxWidth="",this._width="",this._height="",this._top="",this._left="",this._bottom="",this._right="",this._paddingTop="",this._paddingLeft="",this._paddingBottom="",this._paddingRight="",this._fontFamily="",this._fontWeight="",this._fontSize="",this._fontStyle="",this._fontFeatureSettings="",this._fontVariationSettings="",this._textDecoration="",this._lineHeight="",this._letterSpacing="",this._className="",this._display="",this._position="",this._visibility="",this._color="",this._backgroundColor="",this._layerHint=!1,this._contain="none",this._boxShadow=""}setMaxWidth(q){let Y=M0(q);this._maxWidth!==Y&&(this._maxWidth=Y,this.domNode.style.maxWidth=this._maxWidth)}setWidth(q){let Y=M0(q);this._width!==Y&&(this._width=Y,this.domNode.style.width=this._width)}setHeight(q){let Y=M0(q);this._height!==Y&&(this._height=Y,this.domNode.style.height=this._height)}setTop(q){let Y=M0(q);this._top!==Y&&(this._top=Y,this.domNode.style.top=this._top)}setLeft(q){let Y=M0(q);this._left!==Y&&(this._left=Y,this.domNode.style.left=this._left)}setBottom(q){let Y=M0(q);this._bottom!==Y&&(this._bottom=Y,this.domNode.style.bottom=this._bottom)}setRight(q){let Y=M0(q);this._right!==Y&&(this._right=Y,this.domNode.style.right=this._right)}setPaddingTop(q){let Y=M0(q);this._paddingTop!==Y&&(this._paddingTop=Y,this.domNode.style.paddingTop=this._paddingTop)}setPaddingLeft(q){let Y=M0(q);this._paddingLeft!==Y&&(this._paddingLeft=Y,this.domNode.style.paddingLeft=this._paddingLeft)}setPaddingBottom(q){let Y=M0(q);this._paddingBottom!==Y&&(this._paddingBottom=Y,this.domNode.style.paddingBottom=this._paddingBottom)}setPaddingRight(q){let Y=M0(q);this._paddingRight!==Y&&(this._paddingRight=Y,this.domNode.style.paddingRight=this._paddingRight)}setFontFamily(q){this._fontFamily!==q&&(this._fontFamily=q,this.domNode.style.fontFamily=this._fontFamily)}setFontWeight(q){this._fontWeight!==q&&(this._fontWeight=q,this.domNode.style.fontWeight=this._fontWeight)}setFontSize(q){let Y=M0(q);this._fontSize!==Y&&(this._fontSize=Y,this.domNode.style.fontSize=this._fontSize)}setFontStyle(q){this._fontStyle!==q&&(this._fontStyle=q,this.domNode.style.fontStyle=this._fontStyle)}setFontFeatureSettings(q){this._fontFeatureSettings!==q&&(this._fontFeatureSettings=q,this.domNode.style.fontFeatureSettings=this._fontFeatureSettings)}setFontVariationSettings(q){this._fontVariationSettings!==q&&(this._fontVariationSettings=q,this.domNode.style.fontVariationSettings=this._fontVariationSettings)}setTextDecoration(q){this._textDecoration!==q&&(this._textDecoration=q,this.domNode.style.textDecoration=this._textDecoration)}setLineHeight(q){let Y=M0(q);this._lineHeight!==Y&&(this._lineHeight=Y,this.domNode.style.lineHeight=this._lineHeight)}setLetterSpacing(q){let Y=M0(q);this._letterSpacing!==Y&&(this._letterSpacing=Y,this.domNode.style.letterSpacing=this._letterSpacing)}setClassName(q){this._className!==q&&(this._className=q,this.domNode.className=this._className)}toggleClassName(q,Y){this.domNode.classList.toggle(q,Y),this._className=this.domNode.className}setDisplay(q){this._display!==q&&(this._display=q,this.domNode.style.display=this._display)}setPosition(q){this._position!==q&&(this._position=q,this.domNode.style.position=this._position)}setVisibility(q){this._visibility!==q&&(this._visibility=q,this.domNode.style.visibility=this._visibility)}setColor(q){this._color!==q&&(this._color=q,this.domNode.style.color=this._color)}setBackgroundColor(q){this._backgroundColor!==q&&(this._backgroundColor=q,this.domNode.style.backgroundColor=this._backgroundColor)}setLayerHinting(q){this._layerHint!==q&&(this._layerHint=q,this.domNode.style.transform=this._layerHint?"translate3d(0px, 0px, 0px)":"")}setBoxShadow(q){this._boxShadow!==q&&(this._boxShadow=q,this.domNode.style.boxShadow=q)}setContain(q){this._contain!==q&&(this._contain=q,this.domNode.style.contain=this._contain)}setAttribute(q,Y){this.domNode.setAttribute(q,Y)}removeAttribute(q){this.domNode.removeAttribute(q)}appendChild(q){this.domNode.appendChild(q.domNode)}removeChild(q){this.domNode.removeChild(q.domNode)}};function M0(q){return typeof q=="number"?`${q}px`:q}function P1(q){return new d6(q)}var g4=class{constructor(){this._hooks=new a0,this._pointerMoveCallback=null,this._onStopCallback=null}dispose(){this.stopMonitoring(!1),this._hooks.dispose()}stopMonitoring(q,Y){if(!this.isMonitoring())return;this._hooks.clear(),this._pointerMoveCallback=null;let G=this._onStopCallback;this._onStopCallback=null,q&&G&&G(Y)}isMonitoring(){return!!this._pointerMoveCallback}startMonitoring(q,Y,G,H,F){this.isMonitoring()&&this.stopMonitoring(!1),this._pointerMoveCallback=H,this._onStopCallback=F;let Z=q;try{q.setPointerCapture(Y),this._hooks.add(m(()=>{try{q.releasePointerCapture(Y)}catch{}}))}catch{Z=R0(q)}this._hooks.add(y(Z,e.POINTER_MOVE,($)=>{if($.buttons!==G){this.stopMonitoring(!0);return}$.preventDefault(),this._pointerMoveCallback($)})),this._hooks.add(y(Z,e.POINTER_UP,($)=>this.stopMonitoring(!0)))}};function u6(q,Y,G){let H=null,F=null;if(typeof G.value=="function"?(H="value",F=G.value,F.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof G.get=="function"&&(H="get",F=G.get),!F)throw Error("not supported");let Z=`$memoize$${Y}`;G[H]=function(...$){return this.hasOwnProperty(Z)||Object.defineProperty(this,Z,{configurable:!1,enumerable:!1,writable:!1,value:F.apply(this,$)}),this[Z]}}var P0;((q)=>(q.Tap="-xterm-gesturetap",q.Change="-xterm-gesturechange",q.Start="-xterm-gesturestart",q.End="-xterm-gesturesend",q.Contextmenu="-xterm-gesturecontextmenu"))(P0||={});var D1=class q extends S{constructor(){super();this.dispatched=!1,this.targets=new Q3,this.ignoreTargets=new Q3,this.activeTouches={},this.handle=null,this._lastSetTapCountTime=0,this._register($0.runAndSubscribe(_6,({window:Y,disposables:G})=>{G.add(y(Y.document,"touchstart",(H)=>this.onTouchStart(H),{passive:!1})),G.add(y(Y.document,"touchend",(H)=>this.onTouchEnd(Y,H))),G.add(y(Y.document,"touchmove",(H)=>this.onTouchMove(H),{passive:!1}))},{window:C0,disposables:this._store}))}static addTarget(Y){if(!q.isTouchDevice())return S.None;q.INSTANCE||(q.INSTANCE=L3(new q));let G=q.INSTANCE.targets.push(Y);return m(G)}static ignoreTarget(Y){if(!q.isTouchDevice())return S.None;q.INSTANCE||(q.INSTANCE=L3(new q));let G=q.INSTANCE.ignoreTargets.push(Y);return m(G)}static isTouchDevice(){return"ontouchstart"in C0||navigator.maxTouchPoints>0}dispose(){this.handle&&(this.handle.dispose(),this.handle=null),super.dispose()}onTouchStart(Y){let G=Date.now();this.handle&&(this.handle.dispose(),this.handle=null);for(let H=0,F=Y.targetTouches.length;H<F;H++){let Z=Y.targetTouches.item(H);this.activeTouches[Z.identifier]={id:Z.identifier,initialTarget:Z.target,initialTimeStamp:G,initialPageX:Z.pageX,initialPageY:Z.pageY,rollingTimestamps:[G],rollingPageX:[Z.pageX],rollingPageY:[Z.pageY]};let $=this.newGestureEvent(P0.Start,Z.target);$.pageX=Z.pageX,$.pageY=Z.pageY,this.dispatchEvent($)}this.dispatched&&(Y.preventDefault(),Y.stopPropagation(),this.dispatched=!1)}onTouchEnd(Y,G){let H=Date.now(),F=Object.keys(this.activeTouches).length;for(let Z=0,$=G.changedTouches.length;Z<$;Z++){let V=G.changedTouches.item(Z);if(!this.activeTouches.hasOwnProperty(String(V.identifier))){console.warn("move of an UNKNOWN touch",V);continue}let X=this.activeTouches[V.identifier],J=Date.now()-X.initialTimeStamp;if(J<q.HOLD_DELAY&&Math.abs(X.initialPageX-j0(X.rollingPageX))<30&&Math.abs(X.initialPageY-j0(X.rollingPageY))<30){let M=this.newGestureEvent(P0.Tap,X.initialTarget);M.pageX=j0(X.rollingPageX),M.pageY=j0(X.rollingPageY),this.dispatchEvent(M)}else if(J>=q.HOLD_DELAY&&Math.abs(X.initialPageX-j0(X.rollingPageX))<30&&Math.abs(X.initialPageY-j0(X.rollingPageY))<30){let M=this.newGestureEvent(P0.Contextmenu,X.initialTarget);M.pageX=j0(X.rollingPageX),M.pageY=j0(X.rollingPageY),this.dispatchEvent(M)}else if(F===1){let M=j0(X.rollingPageX),z=j0(X.rollingPageY),K=j0(X.rollingTimestamps)-X.rollingTimestamps[0],W=M-X.rollingPageX[0],j=z-X.rollingPageY[0],C=[...this.targets].filter((L)=>X.initialTarget instanceof Node&&L.contains(X.initialTarget));this.inertia(Y,C,H,Math.abs(W)/K,W>0?1:-1,M,Math.abs(j)/K,j>0?1:-1,z)}this.dispatchEvent(this.newGestureEvent(P0.End,X.initialTarget)),delete this.activeTouches[V.identifier]}this.dispatched&&(G.preventDefault(),G.stopPropagation(),this.dispatched=!1)}newGestureEvent(Y,G){let H=document.createEvent("CustomEvent");return H.initEvent(Y,!1,!0),H.initialTarget=G,H.tapCount=0,H}dispatchEvent(Y){if(Y.type===P0.Tap){let G=new Date().getTime(),H=0;G-this._lastSetTapCountTime>q.CLEAR_TAP_COUNT_TIME?H=1:H=2,this._lastSetTapCountTime=G,Y.tapCount=H}else(Y.type===P0.Change||Y.type===P0.Contextmenu)&&(this._lastSetTapCountTime=0);if(Y.initialTarget instanceof Node){for(let H of this.ignoreTargets)if(H.contains(Y.initialTarget))return;let G=[];for(let H of this.targets)if(H.contains(Y.initialTarget)){let F=0,Z=Y.initialTarget;for(;Z&&Z!==H;)F++,Z=Z.parentElement;G.push([F,H])}G.sort((H,F)=>H[0]-F[0]);for(let[H,F]of G)F.dispatchEvent(Y),this.dispatched=!0}}inertia(Y,G,H,F,Z,$,V,X,J){this.handle=i1(Y,()=>{let M=Date.now(),z=M-H,K=0,W=0,j=!0;F+=q.SCROLL_FRICTION*z,V+=q.SCROLL_FRICTION*z,F>0&&(j=!1,K=Z*F*z),V>0&&(j=!1,W=X*V*z);let C=this.newGestureEvent(P0.Change);C.translationX=K,C.translationY=W,G.forEach((L)=>L.dispatchEvent(C)),j||this.inertia(Y,G,M,F,Z,$+K,V,X,J+W)})}onTouchMove(Y){let G=Date.now();for(let H=0,F=Y.changedTouches.length;H<F;H++){let Z=Y.changedTouches.item(H);if(!this.activeTouches.hasOwnProperty(String(Z.identifier))){console.warn("end of an UNKNOWN touch",Z);continue}let $=this.activeTouches[Z.identifier],V=this.newGestureEvent(P0.Change,$.initialTarget);V.translationX=Z.pageX-j0($.rollingPageX),V.translationY=Z.pageY-j0($.rollingPageY),V.pageX=Z.pageX,V.pageY=Z.pageY,this.dispatchEvent(V),$.rollingPageX.length>3&&($.rollingPageX.shift(),$.rollingPageY.shift(),$.rollingTimestamps.shift()),$.rollingPageX.push(Z.pageX),$.rollingPageY.push(Z.pageY),$.rollingTimestamps.push(G)}this.dispatched&&(Y.preventDefault(),Y.stopPropagation(),this.dispatched=!1)}};D1.SCROLL_FRICTION=-0.005,D1.HOLD_DELAY=700,D1.CLEAR_TAP_COUNT_TIME=400,a([u6],D1,"isTouchDevice",1);var c6=D1,z3=class extends S{onclick(q,Y){this._register(y(q,e.CLICK,(G)=>Y(new B1(R0(q),G))))}onmousedown(q,Y){this._register(y(q,e.MOUSE_DOWN,(G)=>Y(new B1(R0(q),G))))}onmouseover(q,Y){this._register(y(q,e.MOUSE_OVER,(G)=>Y(new B1(R0(q),G))))}onmouseleave(q,Y){this._register(y(q,e.MOUSE_LEAVE,(G)=>Y(new B1(R0(q),G))))}onkeydown(q,Y){this._register(y(q,e.KEY_DOWN,(G)=>Y(new p2(G))))}onkeyup(q,Y){this._register(y(q,e.KEY_UP,(G)=>Y(new p2(G))))}oninput(q,Y){this._register(y(q,e.INPUT,Y))}onblur(q,Y){this._register(y(q,e.BLUR,Y))}onfocus(q,Y){this._register(y(q,e.FOCUS,Y))}onchange(q,Y){this._register(y(q,e.CHANGE,Y))}ignoreGesture(q){return c6.ignoreTarget(q)}},p3=11,a6=class extends z3{constructor(q){super(),this._onActivate=q.onActivate,this.bgDomNode=document.createElement("div"),this.bgDomNode.className="arrow-background",this.bgDomNode.style.position="absolute",this.bgDomNode.style.width=q.bgWidth+"px",this.bgDomNode.style.height=q.bgHeight+"px",typeof q.top<"u"&&(this.bgDomNode.style.top="0px"),typeof q.left<"u"&&(this.bgDomNode.style.left="0px"),typeof q.bottom<"u"&&(this.bgDomNode.style.bottom="0px"),typeof q.right<"u"&&(this.bgDomNode.style.right="0px"),this.domNode=document.createElement("div"),this.domNode.className=q.className,this.domNode.style.position="absolute",this.domNode.style.width=p3+"px",this.domNode.style.height=p3+"px",typeof q.top<"u"&&(this.domNode.style.top=q.top+"px"),typeof q.left<"u"&&(this.domNode.style.left=q.left+"px"),typeof q.bottom<"u"&&(this.domNode.style.bottom=q.bottom+"px"),typeof q.right<"u"&&(this.domNode.style.right=q.right+"px"),this._pointerMoveMonitor=this._register(new g4),this._register(v3(this.bgDomNode,e.POINTER_DOWN,(Y)=>this._arrowPointerDown(Y))),this._register(v3(this.domNode,e.POINTER_DOWN,(Y)=>this._arrowPointerDown(Y))),this._pointerdownRepeatTimer=this._register(new p6),this._pointerdownScheduleRepeatTimer=this._register(new V3)}_arrowPointerDown(q){if(!q.target||!(q.target instanceof Element))return;let Y=()=>{this._pointerdownRepeatTimer.cancelAndSet(()=>this._onActivate(),41.666666666666664,R0(q))};this._onActivate(),this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancelAndSet(Y,200),this._pointerMoveMonitor.startMonitoring(q.target,q.pointerId,q.buttons,(G)=>{},()=>{this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancel()}),q.preventDefault()}},l6=class q{constructor(Y,G,H,F,Z,$,V){this._forceIntegerValues=Y,this._scrollStateBrand=void 0,this._forceIntegerValues&&(G=G|0,H=H|0,F=F|0,Z=Z|0,$=$|0,V=V|0),this.rawScrollLeft=F,this.rawScrollTop=V,G<0&&(G=0),F+G>H&&(F=H-G),F<0&&(F=0),Z<0&&(Z=0),V+Z>$&&(V=$-Z),V<0&&(V=0),this.width=G,this.scrollWidth=H,this.scrollLeft=F,this.height=Z,this.scrollHeight=$,this.scrollTop=V}equals(Y){return this.rawScrollLeft===Y.rawScrollLeft&&this.rawScrollTop===Y.rawScrollTop&&this.width===Y.width&&this.scrollWidth===Y.scrollWidth&&this.scrollLeft===Y.scrollLeft&&this.height===Y.height&&this.scrollHeight===Y.scrollHeight&&this.scrollTop===Y.scrollTop}withScrollDimensions(Y,G){return new q(this._forceIntegerValues,typeof Y.width<"u"?Y.width:this.width,typeof Y.scrollWidth<"u"?Y.scrollWidth:this.scrollWidth,G?this.rawScrollLeft:this.scrollLeft,typeof Y.height<"u"?Y.height:this.height,typeof Y.scrollHeight<"u"?Y.scrollHeight:this.scrollHeight,G?this.rawScrollTop:this.scrollTop)}withScrollPosition(Y){return new q(this._forceIntegerValues,this.width,this.scrollWidth,typeof Y.scrollLeft<"u"?Y.scrollLeft:this.rawScrollLeft,this.height,this.scrollHeight,typeof Y.scrollTop<"u"?Y.scrollTop:this.rawScrollTop)}createScrollEvent(Y,G){let H=this.width!==Y.width,F=this.scrollWidth!==Y.scrollWidth,Z=this.scrollLeft!==Y.scrollLeft,$=this.height!==Y.height,V=this.scrollHeight!==Y.scrollHeight,X=this.scrollTop!==Y.scrollTop;return{inSmoothScrolling:G,oldWidth:Y.width,oldScrollWidth:Y.scrollWidth,oldScrollLeft:Y.scrollLeft,width:this.width,scrollWidth:this.scrollWidth,scrollLeft:this.scrollLeft,oldHeight:Y.height,oldScrollHeight:Y.scrollHeight,oldScrollTop:Y.scrollTop,height:this.height,scrollHeight:this.scrollHeight,scrollTop:this.scrollTop,widthChanged:H,scrollWidthChanged:F,scrollLeftChanged:Z,heightChanged:$,scrollHeightChanged:V,scrollTopChanged:X}}},o6=class extends S{constructor(q){super();this._scrollableBrand=void 0,this._onScroll=this._register(new B),this.onScroll=this._onScroll.event,this._smoothScrollDuration=q.smoothScrollDuration,this._scheduleAtNextAnimationFrame=q.scheduleAtNextAnimationFrame,this._state=new l6(q.forceIntegerValues,0,0,0,0,0,0),this._smoothScrolling=null}dispose(){this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),super.dispose()}setSmoothScrollDuration(q){this._smoothScrollDuration=q}validateScrollPosition(q){return this._state.withScrollPosition(q)}getScrollDimensions(){return this._state}setScrollDimensions(q,Y){let G=this._state.withScrollDimensions(q,Y);this._setState(G,!!this._smoothScrolling),this._smoothScrolling?.acceptScrollDimensions(this._state)}getFutureScrollPosition(){return this._smoothScrolling?this._smoothScrolling.to:this._state}getCurrentScrollPosition(){return this._state}setScrollPositionNow(q){let Y=this._state.withScrollPosition(q);this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),this._setState(Y,!1)}setScrollPositionSmooth(q,Y){if(this._smoothScrollDuration===0)return this.setScrollPositionNow(q);if(this._smoothScrolling){q={scrollLeft:typeof q.scrollLeft>"u"?this._smoothScrolling.to.scrollLeft:q.scrollLeft,scrollTop:typeof q.scrollTop>"u"?this._smoothScrolling.to.scrollTop:q.scrollTop};let G=this._state.withScrollPosition(q);if(this._smoothScrolling.to.scrollLeft===G.scrollLeft&&this._smoothScrolling.to.scrollTop===G.scrollTop)return;let H;Y?H=new g3(this._smoothScrolling.from,G,this._smoothScrolling.startTime,this._smoothScrolling.duration):H=this._smoothScrolling.combine(this._state,G,this._smoothScrollDuration),this._smoothScrolling.dispose(),this._smoothScrolling=H}else{let G=this._state.withScrollPosition(q);this._smoothScrolling=g3.start(this._state,G,this._smoothScrollDuration)}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}hasPendingScrollAnimation(){return!!this._smoothScrolling}_performSmoothScrolling(){if(!this._smoothScrolling)return;let q=this._smoothScrolling.tick(),Y=this._state.withScrollPosition(q);if(this._setState(Y,!0),!!this._smoothScrolling){if(q.isDone){this._smoothScrolling.dispose(),this._smoothScrolling=null;return}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}}_setState(q,Y){let G=this._state;G.equals(q)||(this._state=q,this._onScroll.fire(this._state.createScrollEvent(G,Y)))}},m3=class{constructor(q,Y,G){this.scrollLeft=q,this.scrollTop=Y,this.isDone=G}};function B2(q,Y){let G=Y-q;return function(H){return q+G*r6(H)}}function n6(q,Y,G){return function(H){return H<G?q(H/G):Y((H-G)/(1-G))}}var g3=class q{constructor(Y,G,H,F){this.from=Y,this.to=G,this.duration=F,this.startTime=H,this.animationFrameDisposable=null,this._initAnimations()}_initAnimations(){this.scrollLeft=this._initAnimation(this.from.scrollLeft,this.to.scrollLeft,this.to.width),this.scrollTop=this._initAnimation(this.from.scrollTop,this.to.scrollTop,this.to.height)}_initAnimation(Y,G,H){if(Math.abs(Y-G)>2.5*H){let F,Z;return Y<G?(F=Y+0.75*H,Z=G-0.75*H):(F=Y-0.75*H,Z=G+0.75*H),n6(B2(Y,F),B2(Z,G),0.33)}return B2(Y,G)}dispose(){this.animationFrameDisposable!==null&&(this.animationFrameDisposable.dispose(),this.animationFrameDisposable=null)}acceptScrollDimensions(Y){this.to=Y.withScrollPosition(this.to),this._initAnimations()}tick(){return this._tick(Date.now())}_tick(Y){let G=(Y-this.startTime)/this.duration;if(G<1){let H=this.scrollLeft(G),F=this.scrollTop(G);return new m3(H,F,!1)}return new m3(this.to.scrollLeft,this.to.scrollTop,!0)}combine(Y,G,H){return q.start(Y,G,H)}static start(Y,G,H){H=H+10;let F=Date.now()-10;return new q(Y,G,F,H)}};function s6(q){return Math.pow(q,3)}function r6(q){return 1-s6(1-q)}var i6=class extends S{constructor(q,Y,G){super(),this._visibility=q,this._visibleClassName=Y,this._invisibleClassName=G,this._domNode=null,this._isVisible=!1,this._isNeeded=!1,this._rawShouldBeVisible=!1,this._shouldBeVisible=!1,this._revealTimer=this._register(new V3)}setVisibility(q){this._visibility!==q&&(this._visibility=q,this._updateShouldBeVisible())}setShouldBeVisible(q){this._rawShouldBeVisible=q,this._updateShouldBeVisible()}_applyVisibilitySetting(){return this._visibility===2?!1:this._visibility===3?!0:this._rawShouldBeVisible}_updateShouldBeVisible(){let q=this._applyVisibilitySetting();this._shouldBeVisible!==q&&(this._shouldBeVisible=q,this.ensureVisibility())}setIsNeeded(q){this._isNeeded!==q&&(this._isNeeded=q,this.ensureVisibility())}setDomNode(q){this._domNode=q,this._domNode.setClassName(this._invisibleClassName),this.setShouldBeVisible(!1)}ensureVisibility(){if(!this._isNeeded){this._hide(!1);return}this._shouldBeVisible?this._reveal():this._hide(!0)}_reveal(){this._isVisible||(this._isVisible=!0,this._revealTimer.setIfNotSet(()=>{this._domNode?.setClassName(this._visibleClassName)},0))}_hide(q){this._revealTimer.cancel(),this._isVisible&&(this._isVisible=!1,this._domNode?.setClassName(this._invisibleClassName+(q?" fade":"")))}},t6=140,h4=class extends z3{constructor(q){super(),this._lazyRender=q.lazyRender,this._host=q.host,this._scrollable=q.scrollable,this._scrollByPage=q.scrollByPage,this._scrollbarState=q.scrollbarState,this._visibilityController=this._register(new i6(q.visibility,"visible scrollbar "+q.extraScrollbarClassName,"invisible scrollbar "+q.extraScrollbarClassName)),this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._pointerMoveMonitor=this._register(new g4),this._shouldRender=!0,this.domNode=P1(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this._visibilityController.setDomNode(this.domNode),this.domNode.setPosition("absolute"),this._register(y(this.domNode.domNode,e.POINTER_DOWN,(Y)=>this._domNodePointerDown(Y)))}_createArrow(q){let Y=this._register(new a6(q));this.domNode.domNode.appendChild(Y.bgDomNode),this.domNode.domNode.appendChild(Y.domNode)}_createSlider(q,Y,G,H){this.slider=P1(document.createElement("div")),this.slider.setClassName("slider"),this.slider.setPosition("absolute"),this.slider.setTop(q),this.slider.setLeft(Y),typeof G=="number"&&this.slider.setWidth(G),typeof H=="number"&&this.slider.setHeight(H),this.slider.setLayerHinting(!0),this.slider.setContain("strict"),this.domNode.domNode.appendChild(this.slider.domNode),this._register(y(this.slider.domNode,e.POINTER_DOWN,(F)=>{F.button===0&&(F.preventDefault(),this._sliderPointerDown(F))})),this.onclick(this.slider.domNode,(F)=>{F.leftButton&&F.stopPropagation()})}_onElementSize(q){return this._scrollbarState.setVisibleSize(q)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollSize(q){return this._scrollbarState.setScrollSize(q)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollPosition(q){return this._scrollbarState.setScrollPosition(q)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}beginReveal(){this._visibilityController.setShouldBeVisible(!0)}beginHide(){this._visibilityController.setShouldBeVisible(!1)}render(){this._shouldRender&&(this._shouldRender=!1,this._renderDomNode(this._scrollbarState.getRectangleLargeSize(),this._scrollbarState.getRectangleSmallSize()),this._updateSlider(this._scrollbarState.getSliderSize(),this._scrollbarState.getArrowSize()+this._scrollbarState.getSliderPosition()))}_domNodePointerDown(q){q.target===this.domNode.domNode&&this._onPointerDown(q)}delegatePointerDown(q){let Y=this.domNode.domNode.getClientRects()[0].top,G=Y+this._scrollbarState.getSliderPosition(),H=Y+this._scrollbarState.getSliderPosition()+this._scrollbarState.getSliderSize(),F=this._sliderPointerPosition(q);G<=F&&F<=H?q.button===0&&(q.preventDefault(),this._sliderPointerDown(q)):this._onPointerDown(q)}_onPointerDown(q){let Y,G;if(q.target===this.domNode.domNode&&typeof q.offsetX=="number"&&typeof q.offsetY=="number")Y=q.offsetX,G=q.offsetY;else{let F=m6(this.domNode.domNode);Y=q.pageX-F.left,G=q.pageY-F.top}let H=this._pointerDownRelativePosition(Y,G);this._setDesiredScrollPositionNow(this._scrollByPage?this._scrollbarState.getDesiredScrollPositionFromOffsetPaged(H):this._scrollbarState.getDesiredScrollPositionFromOffset(H)),q.button===0&&(q.preventDefault(),this._sliderPointerDown(q))}_sliderPointerDown(q){if(!q.target||!(q.target instanceof Element))return;let Y=this._sliderPointerPosition(q),G=this._sliderOrthogonalPointerPosition(q),H=this._scrollbarState.clone();this.slider.toggleClassName("active",!0),this._pointerMoveMonitor.startMonitoring(q.target,q.pointerId,q.buttons,(F)=>{let Z=this._sliderOrthogonalPointerPosition(F),$=Math.abs(Z-G);if(b4&&$>t6){this._setDesiredScrollPositionNow(H.getScrollPosition());return}let V=this._sliderPointerPosition(F)-Y;this._setDesiredScrollPositionNow(H.getDesiredScrollPositionFromDelta(V))},()=>{this.slider.toggleClassName("active",!1),this._host.onDragEnd()}),this._host.onDragStart()}_setDesiredScrollPositionNow(q){let Y={};this.writeScrollPosition(Y,q),this._scrollable.setScrollPositionNow(Y)}updateScrollbarSize(q){this._updateScrollbarSize(q),this._scrollbarState.setScrollbarSize(q),this._shouldRender=!0,this._lazyRender||this.render()}isNeeded(){return this._scrollbarState.isNeeded()}},d4=class q{constructor(Y,G,H,F,Z,$){this._scrollbarSize=Math.round(G),this._oppositeScrollbarSize=Math.round(H),this._arrowSize=Math.round(Y),this._visibleSize=F,this._scrollSize=Z,this._scrollPosition=$,this._computedAvailableSize=0,this._computedIsNeeded=!1,this._computedSliderSize=0,this._computedSliderRatio=0,this._computedSliderPosition=0,this._refreshComputedValues()}clone(){return new q(this._arrowSize,this._scrollbarSize,this._oppositeScrollbarSize,this._visibleSize,this._scrollSize,this._scrollPosition)}setVisibleSize(Y){let G=Math.round(Y);return this._visibleSize!==G?(this._visibleSize=G,this._refreshComputedValues(),!0):!1}setScrollSize(Y){let G=Math.round(Y);return this._scrollSize!==G?(this._scrollSize=G,this._refreshComputedValues(),!0):!1}setScrollPosition(Y){let G=Math.round(Y);return this._scrollPosition!==G?(this._scrollPosition=G,this._refreshComputedValues(),!0):!1}setScrollbarSize(Y){this._scrollbarSize=Math.round(Y)}setOppositeScrollbarSize(Y){this._oppositeScrollbarSize=Math.round(Y)}static _computeValues(Y,G,H,F,Z){let $=Math.max(0,H-Y),V=Math.max(0,$-2*G),X=F>0&&F>H;if(!X)return{computedAvailableSize:Math.round($),computedIsNeeded:X,computedSliderSize:Math.round(V),computedSliderRatio:0,computedSliderPosition:0};let J=Math.round(Math.max(20,Math.floor(H*V/F))),M=(V-J)/(F-H),z=Z*M;return{computedAvailableSize:Math.round($),computedIsNeeded:X,computedSliderSize:Math.round(J),computedSliderRatio:M,computedSliderPosition:Math.round(z)}}_refreshComputedValues(){let Y=q._computeValues(this._oppositeScrollbarSize,this._arrowSize,this._visibleSize,this._scrollSize,this._scrollPosition);this._computedAvailableSize=Y.computedAvailableSize,this._computedIsNeeded=Y.computedIsNeeded,this._computedSliderSize=Y.computedSliderSize,this._computedSliderRatio=Y.computedSliderRatio,this._computedSliderPosition=Y.computedSliderPosition}getArrowSize(){return this._arrowSize}getScrollPosition(){return this._scrollPosition}getRectangleLargeSize(){return this._computedAvailableSize}getRectangleSmallSize(){return this._scrollbarSize}isNeeded(){return this._computedIsNeeded}getSliderSize(){return this._computedSliderSize}getSliderPosition(){return this._computedSliderPosition}getDesiredScrollPositionFromOffset(Y){if(!this._computedIsNeeded)return 0;let G=Y-this._arrowSize-this._computedSliderSize/2;return Math.round(G/this._computedSliderRatio)}getDesiredScrollPositionFromOffsetPaged(Y){if(!this._computedIsNeeded)return 0;let G=Y-this._arrowSize,H=this._scrollPosition;return G<this._computedSliderPosition?H-=this._visibleSize:H+=this._visibleSize,H}getDesiredScrollPositionFromDelta(Y){if(!this._computedIsNeeded)return 0;let G=this._computedSliderPosition+Y;return Math.round(G/this._computedSliderRatio)}},e6=class extends h4{constructor(q,Y,G){let H=q.getScrollDimensions(),F=q.getCurrentScrollPosition();if(super({lazyRender:Y.lazyRender,host:G,scrollbarState:new d4(Y.horizontalHasArrows?Y.arrowSize:0,Y.horizontal===2?0:Y.horizontalScrollbarSize,Y.vertical===2?0:Y.verticalScrollbarSize,H.width,H.scrollWidth,F.scrollLeft),visibility:Y.horizontal,extraScrollbarClassName:"horizontal",scrollable:q,scrollByPage:Y.scrollByPage}),Y.horizontalHasArrows)throw Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(Math.floor((Y.horizontalScrollbarSize-Y.horizontalSliderSize)/2),0,void 0,Y.horizontalSliderSize)}_updateSlider(q,Y){this.slider.setWidth(q),this.slider.setLeft(Y)}_renderDomNode(q,Y){this.domNode.setWidth(q),this.domNode.setHeight(Y),this.domNode.setLeft(0),this.domNode.setBottom(0)}onDidScroll(q){return this._shouldRender=this._onElementScrollSize(q.scrollWidth)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(q.scrollLeft)||this._shouldRender,this._shouldRender=this._onElementSize(q.width)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(q,Y){return q}_sliderPointerPosition(q){return q.pageX}_sliderOrthogonalPointerPosition(q){return q.pageY}_updateScrollbarSize(q){this.slider.setHeight(q)}writeScrollPosition(q,Y){q.scrollLeft=Y}updateOptions(q){this.updateScrollbarSize(q.horizontal===2?0:q.horizontalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(q.vertical===2?0:q.verticalScrollbarSize),this._visibilityController.setVisibility(q.horizontal),this._scrollByPage=q.scrollByPage}},q7=class extends h4{constructor(q,Y,G){let H=q.getScrollDimensions(),F=q.getCurrentScrollPosition();if(super({lazyRender:Y.lazyRender,host:G,scrollbarState:new d4(Y.verticalHasArrows?Y.arrowSize:0,Y.vertical===2?0:Y.verticalScrollbarSize,0,H.height,H.scrollHeight,F.scrollTop),visibility:Y.vertical,extraScrollbarClassName:"vertical",scrollable:q,scrollByPage:Y.scrollByPage}),Y.verticalHasArrows)throw Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(0,Math.floor((Y.verticalScrollbarSize-Y.verticalSliderSize)/2),Y.verticalSliderSize,void 0)}_updateSlider(q,Y){this.slider.setHeight(q),this.slider.setTop(Y)}_renderDomNode(q,Y){this.domNode.setWidth(Y),this.domNode.setHeight(q),this.domNode.setRight(0),this.domNode.setTop(0)}onDidScroll(q){return this._shouldRender=this._onElementScrollSize(q.scrollHeight)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(q.scrollTop)||this._shouldRender,this._shouldRender=this._onElementSize(q.height)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(q,Y){return Y}_sliderPointerPosition(q){return q.pageY}_sliderOrthogonalPointerPosition(q){return q.pageX}_updateScrollbarSize(q){this.slider.setWidth(q)}writeScrollPosition(q,Y){q.scrollTop=Y}updateOptions(q){this.updateScrollbarSize(q.vertical===2?0:q.verticalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(0),this._visibilityController.setVisibility(q.vertical),this._scrollByPage=q.scrollByPage}},Y7=500,h3=50,d3=!0,G7=class{constructor(q,Y,G){this.timestamp=q,this.deltaX=Y,this.deltaY=G,this.score=0}},m2=class{constructor(){this._capacity=5,this._memory=[],this._front=-1,this._rear=-1}isPhysicalMouseWheel(){if(this._front===-1&&this._rear===-1)return!1;let Y=1,G=0,H=1,F=this._rear;do{let Z=F===this._front?Y:Math.pow(2,-H);if(Y-=Z,G+=this._memory[F].score*Z,F===this._front)break;F=(this._capacity+F-1)%this._capacity,H++}while(!0);return G<=0.5}acceptStandardWheelEvent(Y){if($3){let G=R0(Y.browserEvent),H=s5(G);this.accept(Date.now(),Y.deltaX*H,Y.deltaY*H)}else this.accept(Date.now(),Y.deltaX,Y.deltaY)}accept(Y,G,H){let F=null,Z=new G7(Y,G,H);this._front===-1&&this._rear===-1?(this._memory[0]=Z,this._front=0,this._rear=0):(F=this._memory[this._rear],this._rear=(this._rear+1)%this._capacity,this._rear===this._front&&(this._front=(this._front+1)%this._capacity),this._memory[this._rear]=Z),Z.score=this._computeScore(Z,F)}_computeScore(Y,G){if(Math.abs(Y.deltaX)>0&&Math.abs(Y.deltaY)>0)return 1;let H=0.5;if((!this._isAlmostInt(Y.deltaX)||!this._isAlmostInt(Y.deltaY))&&(H+=0.25),G){let F=Math.abs(Y.deltaX),Z=Math.abs(Y.deltaY),$=Math.abs(G.deltaX),V=Math.abs(G.deltaY),X=Math.max(Math.min(F,$),1),J=Math.max(Math.min(Z,V),1),M=Math.max(F,$),z=Math.max(Z,V);M%X===0&&z%J===0&&(H-=0.5)}return Math.min(Math.max(H,0),1)}_isAlmostInt(Y){return Math.abs(Math.round(Y)-Y)<0.01}};m2.INSTANCE=new m2;var H7=m2,F7=class extends z3{constructor(q,Y,G){super();this._onScroll=this._register(new B),this.onScroll=this._onScroll.event,this._onWillScroll=this._register(new B),this.onWillScroll=this._onWillScroll.event,this._options=$7(Y),this._scrollable=G,this._register(this._scrollable.onScroll((F)=>{this._onWillScroll.fire(F),this._onDidScroll(F),this._onScroll.fire(F)}));let H={onMouseWheel:(F)=>this._onMouseWheel(F),onDragStart:()=>this._onDragStart(),onDragEnd:()=>this._onDragEnd()};this._verticalScrollbar=this._register(new q7(this._scrollable,this._options,H)),this._horizontalScrollbar=this._register(new e6(this._scrollable,this._options,H)),this._domNode=document.createElement("div"),this._domNode.className="xterm-scrollable-element "+this._options.className,this._domNode.setAttribute("role","presentation"),this._domNode.style.position="relative",this._domNode.appendChild(q),this._domNode.appendChild(this._horizontalScrollbar.domNode.domNode),this._domNode.appendChild(this._verticalScrollbar.domNode.domNode),this._options.useShadows?(this._leftShadowDomNode=P1(document.createElement("div")),this._leftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._leftShadowDomNode.domNode),this._topShadowDomNode=P1(document.createElement("div")),this._topShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topShadowDomNode.domNode),this._topLeftShadowDomNode=P1(document.createElement("div")),this._topLeftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topLeftShadowDomNode.domNode)):(this._leftShadowDomNode=null,this._topShadowDomNode=null,this._topLeftShadowDomNode=null),this._listenOnDomNode=this._options.listenOnDomNode||this._domNode,this._mouseWheelToDispose=[],this._setListeningToMouseWheel(this._options.handleMouseWheel),this.onmouseover(this._listenOnDomNode,(F)=>this._onMouseOver(F)),this.onmouseleave(this._listenOnDomNode,(F)=>this._onMouseLeave(F)),this._hideTimeout=this._register(new V3),this._isDragging=!1,this._mouseIsOver=!1,this._shouldRender=!0,this._revealOnScroll=!0}get options(){return this._options}dispose(){this._mouseWheelToDispose=t0(this._mouseWheelToDispose),super.dispose()}getDomNode(){return this._domNode}getOverviewRulerLayoutInfo(){return{parent:this._domNode,insertBefore:this._verticalScrollbar.domNode.domNode}}delegateVerticalScrollbarPointerDown(q){this._verticalScrollbar.delegatePointerDown(q)}getScrollDimensions(){return this._scrollable.getScrollDimensions()}setScrollDimensions(q){this._scrollable.setScrollDimensions(q,!1)}updateClassName(q){this._options.className=q,O0&&(this._options.className+=" mac"),this._domNode.className="xterm-scrollable-element "+this._options.className}updateOptions(q){typeof q.handleMouseWheel<"u"&&(this._options.handleMouseWheel=q.handleMouseWheel,this._setListeningToMouseWheel(this._options.handleMouseWheel)),typeof q.mouseWheelScrollSensitivity<"u"&&(this._options.mouseWheelScrollSensitivity=q.mouseWheelScrollSensitivity),typeof q.fastScrollSensitivity<"u"&&(this._options.fastScrollSensitivity=q.fastScrollSensitivity),typeof q.scrollPredominantAxis<"u"&&(this._options.scrollPredominantAxis=q.scrollPredominantAxis),typeof q.horizontal<"u"&&(this._options.horizontal=q.horizontal),typeof q.vertical<"u"&&(this._options.vertical=q.vertical),typeof q.horizontalScrollbarSize<"u"&&(this._options.horizontalScrollbarSize=q.horizontalScrollbarSize),typeof q.verticalScrollbarSize<"u"&&(this._options.verticalScrollbarSize=q.verticalScrollbarSize),typeof q.scrollByPage<"u"&&(this._options.scrollByPage=q.scrollByPage),this._horizontalScrollbar.updateOptions(this._options),this._verticalScrollbar.updateOptions(this._options),this._options.lazyRender||this._render()}setRevealOnScroll(q){this._revealOnScroll=q}delegateScrollFromMouseWheelEvent(q){this._onMouseWheel(new I3(q))}_setListeningToMouseWheel(q){if(this._mouseWheelToDispose.length>0!==q&&(this._mouseWheelToDispose=t0(this._mouseWheelToDispose),q)){let Y=(G)=>{this._onMouseWheel(new I3(G))};this._mouseWheelToDispose.push(y(this._listenOnDomNode,e.MOUSE_WHEEL,Y,{passive:!1}))}}_onMouseWheel(q){if(q.browserEvent?.defaultPrevented)return;let Y=H7.INSTANCE;d3&&Y.acceptStandardWheelEvent(q);let G=!1;if(q.deltaY||q.deltaX){let F=q.deltaY*this._options.mouseWheelScrollSensitivity,Z=q.deltaX*this._options.mouseWheelScrollSensitivity;this._options.scrollPredominantAxis&&(this._options.scrollYToX&&Z+F===0?Z=F=0:Math.abs(F)>=Math.abs(Z)?Z=0:F=0),this._options.flipAxes&&([F,Z]=[Z,F]);let $=!O0&&q.browserEvent&&q.browserEvent.shiftKey;(this._options.scrollYToX||$)&&!Z&&(Z=F,F=0),q.browserEvent&&q.browserEvent.altKey&&(Z=Z*this._options.fastScrollSensitivity,F=F*this._options.fastScrollSensitivity);let V=this._scrollable.getFutureScrollPosition(),X={};if(F){let J=h3*F,M=V.scrollTop-(J<0?Math.floor(J):Math.ceil(J));this._verticalScrollbar.writeScrollPosition(X,M)}if(Z){let J=h3*Z,M=V.scrollLeft-(J<0?Math.floor(J):Math.ceil(J));this._horizontalScrollbar.writeScrollPosition(X,M)}X=this._scrollable.validateScrollPosition(X),(V.scrollLeft!==X.scrollLeft||V.scrollTop!==X.scrollTop)&&(d3&&this._options.mouseWheelSmoothScroll&&Y.isPhysicalMouseWheel()?this._scrollable.setScrollPositionSmooth(X):this._scrollable.setScrollPositionNow(X),G=!0)}let H=G;!H&&this._options.alwaysConsumeMouseWheel&&(H=!0),!H&&this._options.consumeMouseWheelIfScrollbarIsNeeded&&(this._verticalScrollbar.isNeeded()||this._horizontalScrollbar.isNeeded())&&(H=!0),H&&(q.preventDefault(),q.stopPropagation())}_onDidScroll(q){this._shouldRender=this._horizontalScrollbar.onDidScroll(q)||this._shouldRender,this._shouldRender=this._verticalScrollbar.onDidScroll(q)||this._shouldRender,this._options.useShadows&&(this._shouldRender=!0),this._revealOnScroll&&this._reveal(),this._options.lazyRender||this._render()}renderNow(){if(!this._options.lazyRender)throw Error("Please use `lazyRender` together with `renderNow`!");this._render()}_render(){if(this._shouldRender&&(this._shouldRender=!1,this._horizontalScrollbar.render(),this._verticalScrollbar.render(),this._options.useShadows)){let q=this._scrollable.getCurrentScrollPosition(),Y=q.scrollTop>0,G=q.scrollLeft>0,H=G?" left":"",F=Y?" top":"",Z=G||Y?" top-left-corner":"";this._leftShadowDomNode.setClassName(`shadow${H}`),this._topShadowDomNode.setClassName(`shadow${F}`),this._topLeftShadowDomNode.setClassName(`shadow${Z}${F}${H}`)}}_onDragStart(){this._isDragging=!0,this._reveal()}_onDragEnd(){this._isDragging=!1,this._hide()}_onMouseLeave(q){this._mouseIsOver=!1,this._hide()}_onMouseOver(q){this._mouseIsOver=!0,this._reveal()}_reveal(){this._verticalScrollbar.beginReveal(),this._horizontalScrollbar.beginReveal(),this._scheduleHide()}_hide(){!this._mouseIsOver&&!this._isDragging&&(this._verticalScrollbar.beginHide(),this._horizontalScrollbar.beginHide())}_scheduleHide(){!this._mouseIsOver&&!this._isDragging&&this._hideTimeout.cancelAndSet(()=>this._hide(),Y7)}},Z7=class extends F7{constructor(q,Y,G){super(q,Y,G)}setScrollPosition(q){q.reuseAnimation?this._scrollable.setScrollPositionSmooth(q,q.reuseAnimation):this._scrollable.setScrollPositionNow(q)}getScrollPosition(){return this._scrollable.getCurrentScrollPosition()}};function $7(q){let Y={lazyRender:typeof q.lazyRender<"u"?q.lazyRender:!1,className:typeof q.className<"u"?q.className:"",useShadows:typeof q.useShadows<"u"?q.useShadows:!0,handleMouseWheel:typeof q.handleMouseWheel<"u"?q.handleMouseWheel:!0,flipAxes:typeof q.flipAxes<"u"?q.flipAxes:!1,consumeMouseWheelIfScrollbarIsNeeded:typeof q.consumeMouseWheelIfScrollbarIsNeeded<"u"?q.consumeMouseWheelIfScrollbarIsNeeded:!1,alwaysConsumeMouseWheel:typeof q.alwaysConsumeMouseWheel<"u"?q.alwaysConsumeMouseWheel:!1,scrollYToX:typeof q.scrollYToX<"u"?q.scrollYToX:!1,mouseWheelScrollSensitivity:typeof q.mouseWheelScrollSensitivity<"u"?q.mouseWheelScrollSensitivity:1,fastScrollSensitivity:typeof q.fastScrollSensitivity<"u"?q.fastScrollSensitivity:5,scrollPredominantAxis:typeof q.scrollPredominantAxis<"u"?q.scrollPredominantAxis:!0,mouseWheelSmoothScroll:typeof q.mouseWheelSmoothScroll<"u"?q.mouseWheelSmoothScroll:!0,arrowSize:typeof q.arrowSize<"u"?q.arrowSize:11,listenOnDomNode:typeof q.listenOnDomNode<"u"?q.listenOnDomNode:null,horizontal:typeof q.horizontal<"u"?q.horizontal:1,horizontalScrollbarSize:typeof q.horizontalScrollbarSize<"u"?q.horizontalScrollbarSize:10,horizontalSliderSize:typeof q.horizontalSliderSize<"u"?q.horizontalSliderSize:0,horizontalHasArrows:typeof q.horizontalHasArrows<"u"?q.horizontalHasArrows:!1,vertical:typeof q.vertical<"u"?q.vertical:1,verticalScrollbarSize:typeof q.verticalScrollbarSize<"u"?q.verticalScrollbarSize:10,verticalHasArrows:typeof q.verticalHasArrows<"u"?q.verticalHasArrows:!1,verticalSliderSize:typeof q.verticalSliderSize<"u"?q.verticalSliderSize:0,scrollByPage:typeof q.scrollByPage<"u"?q.scrollByPage:!1};return Y.horizontalSliderSize=typeof q.horizontalSliderSize<"u"?q.horizontalSliderSize:Y.horizontalScrollbarSize,Y.verticalSliderSize=typeof q.verticalSliderSize<"u"?q.verticalSliderSize:Y.verticalScrollbarSize,O0&&(Y.className+=" mac"),Y}var g2=class extends S{constructor(q,Y,G,H,F,Z,$,V){super();this._bufferService=G,this._optionsService=$,this._renderService=V,this._onRequestScrollLines=this._register(new B),this.onRequestScrollLines=this._onRequestScrollLines.event,this._isSyncing=!1,this._isHandlingScroll=!1,this._suppressOnScrollHandler=!1;let X=this._register(new o6({forceIntegerValues:!1,smoothScrollDuration:this._optionsService.rawOptions.smoothScrollDuration,scheduleAtNextAnimationFrame:(J)=>i1(H.window,J)}));this._register(this._optionsService.onSpecificOptionChange("smoothScrollDuration",()=>{X.setSmoothScrollDuration(this._optionsService.rawOptions.smoothScrollDuration)})),this._scrollableElement=this._register(new Z7(Y,{vertical:1,horizontal:2,useShadows:!1,mouseWheelSmoothScroll:!0,...this._getChangeOptions()},X)),this._register(this._optionsService.onMultipleOptionChange(["scrollSensitivity","fastScrollSensitivity","overviewRuler"],()=>this._scrollableElement.updateOptions(this._getChangeOptions()))),this._register(F.onProtocolChange((J)=>{this._scrollableElement.updateOptions({handleMouseWheel:!(J&16)})})),this._scrollableElement.setScrollDimensions({height:0,scrollHeight:0}),this._register($0.runAndSubscribe(Z.onChangeColors,()=>{this._scrollableElement.getDomNode().style.backgroundColor=Z.colors.background.css})),q.appendChild(this._scrollableElement.getDomNode()),this._register(m(()=>this._scrollableElement.getDomNode().remove())),this._styleElement=H.mainDocument.createElement("style"),Y.appendChild(this._styleElement),this._register(m(()=>this._styleElement.remove())),this._register($0.runAndSubscribe(Z.onChangeColors,()=>{this._styleElement.textContent=[".xterm .xterm-scrollable-element > .scrollbar > .slider {",`  background: ${Z.colors.scrollbarSliderBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider:hover {",`  background: ${Z.colors.scrollbarSliderHoverBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider.active {",`  background: ${Z.colors.scrollbarSliderActiveBackground.css};`,"}"].join(`
`)})),this._register(this._bufferService.onResize(()=>this.queueSync())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._latestYDisp=void 0,this.queueSync()})),this._register(this._bufferService.onScroll(()=>this._sync())),this._register(this._scrollableElement.onScroll((J)=>this._handleScroll(J)))}scrollLines(q){let Y=this._scrollableElement.getScrollPosition();this._scrollableElement.setScrollPosition({reuseAnimation:!0,scrollTop:Y.scrollTop+q*this._renderService.dimensions.css.cell.height})}scrollToLine(q,Y){Y&&(this._latestYDisp=q),this._scrollableElement.setScrollPosition({reuseAnimation:!Y,scrollTop:q*this._renderService.dimensions.css.cell.height})}_getChangeOptions(){return{mouseWheelScrollSensitivity:this._optionsService.rawOptions.scrollSensitivity,fastScrollSensitivity:this._optionsService.rawOptions.fastScrollSensitivity,verticalScrollbarSize:this._optionsService.rawOptions.overviewRuler?.width||14}}queueSync(q){q!==void 0&&(this._latestYDisp=q),this._queuedAnimationFrame===void 0&&(this._queuedAnimationFrame=this._renderService.addRefreshCallback(()=>{this._queuedAnimationFrame=void 0,this._sync(this._latestYDisp)}))}_sync(q=this._bufferService.buffer.ydisp){!this._renderService||this._isSyncing||(this._isSyncing=!0,this._suppressOnScrollHandler=!0,this._scrollableElement.setScrollDimensions({height:this._renderService.dimensions.css.canvas.height,scrollHeight:this._renderService.dimensions.css.cell.height*this._bufferService.buffer.lines.length}),this._suppressOnScrollHandler=!1,q!==this._latestYDisp&&this._scrollableElement.setScrollPosition({scrollTop:q*this._renderService.dimensions.css.cell.height}),this._isSyncing=!1)}_handleScroll(q){if(!this._renderService||this._isHandlingScroll||this._suppressOnScrollHandler)return;this._isHandlingScroll=!0;let Y=Math.round(q.scrollTop/this._renderService.dimensions.css.cell.height),G=Y-this._bufferService.buffer.ydisp;G!==0&&(this._latestYDisp=Y,this._onRequestScrollLines.fire(G)),this._isHandlingScroll=!1}};g2=a([A(2,X0),A(3,_0),A(4,k4),A(5,Z1),A(6,z0),A(7,E0)],g2);var h2=class extends S{constructor(q,Y,G,H,F){super();this._screenElement=q,this._bufferService=Y,this._coreBrowserService=G,this._decorationService=H,this._renderService=F,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this._register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this._register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this._register(this._decorationService.onDecorationRemoved((Z)=>this._removeDecoration(Z))),this._register(m(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let q of this._decorationService.decorations)this._renderDecoration(q);this._dimensionsChanged=!1}_renderDecoration(q){this._refreshStyle(q),this._dimensionsChanged&&this._refreshXPosition(q)}_createElement(q){let Y=this._coreBrowserService.mainDocument.createElement("div");Y.classList.add("xterm-decoration"),Y.classList.toggle("xterm-decoration-top-layer",q?.options?.layer==="top"),Y.style.width=`${Math.round((q.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,Y.style.height=`${(q.options.height||1)*this._renderService.dimensions.css.cell.height}px`,Y.style.top=`${(q.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height}px`,Y.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;let G=q.options.x??0;return G&&G>this._bufferService.cols&&(Y.style.display="none"),this._refreshXPosition(q,Y),Y}_refreshStyle(q){let Y=q.marker.line-this._bufferService.buffers.active.ydisp;if(Y<0||Y>=this._bufferService.rows)q.element&&(q.element.style.display="none",q.onRenderEmitter.fire(q.element));else{let G=this._decorationElements.get(q);G||(G=this._createElement(q),q.element=G,this._decorationElements.set(q,G),this._container.appendChild(G),q.onDispose(()=>{this._decorationElements.delete(q),G.remove()})),G.style.display=this._altBufferIsActive?"none":"block",this._altBufferIsActive||(G.style.width=`${Math.round((q.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,G.style.height=`${(q.options.height||1)*this._renderService.dimensions.css.cell.height}px`,G.style.top=`${Y*this._renderService.dimensions.css.cell.height}px`,G.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`),q.onRenderEmitter.fire(G)}}_refreshXPosition(q,Y=q.element){if(!Y)return;let G=q.options.x??0;(q.options.anchor||"left")==="right"?Y.style.right=G?`${G*this._renderService.dimensions.css.cell.width}px`:"":Y.style.left=G?`${G*this._renderService.dimensions.css.cell.width}px`:""}_removeDecoration(q){this._decorationElements.get(q)?.remove(),this._decorationElements.delete(q),q.dispose()}};h2=a([A(1,X0),A(2,_0),A(3,I1),A(4,E0)],h2);var J7=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(q){if(q.options.overviewRulerOptions){for(let Y of this._zones)if(Y.color===q.options.overviewRulerOptions.color&&Y.position===q.options.overviewRulerOptions.position){if(this._lineIntersectsZone(Y,q.marker.line))return;if(this._lineAdjacentToZone(Y,q.marker.line,q.options.overviewRulerOptions.position)){this._addLineToZone(Y,q.marker.line);return}}if(this._zonePoolIndex<this._zonePool.length){this._zonePool[this._zonePoolIndex].color=q.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=q.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=q.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=q.marker.line,this._zones.push(this._zonePool[this._zonePoolIndex++]);return}this._zones.push({color:q.options.overviewRulerOptions.color,position:q.options.overviewRulerOptions.position,startBufferLine:q.marker.line,endBufferLine:q.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(q){this._linePadding=q}_lineIntersectsZone(q,Y){return Y>=q.startBufferLine&&Y<=q.endBufferLine}_lineAdjacentToZone(q,Y,G){return Y>=q.startBufferLine-this._linePadding[G||"full"]&&Y<=q.endBufferLine+this._linePadding[G||"full"]}_addLineToZone(q,Y){q.startBufferLine=Math.min(q.startBufferLine,Y),q.endBufferLine=Math.max(q.endBufferLine,Y)}},L0={full:0,left:0,center:0,right:0},h0={full:0,left:0,center:0,right:0},j1={full:0,left:0,center:0,right:0},t1=class extends S{constructor(q,Y,G,H,F,Z,$,V){super();this._viewportElement=q,this._screenElement=Y,this._bufferService=G,this._decorationService=H,this._renderService=F,this._optionsService=Z,this._themeService=$,this._coreBrowserService=V,this._colorZoneStore=new J7,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),this._viewportElement.parentElement?.insertBefore(this._canvas,this._viewportElement),this._register(m(()=>this._canvas?.remove()));let X=this._canvas.getContext("2d");if(X)this._ctx=X;else throw Error("Ctx cannot be null");this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this._register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0))),this._register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this._register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})),this._register(this._renderService.onRender(()=>{(!this._containerHeight||this._containerHeight!==this._screenElement.clientHeight)&&(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh(!0))),this._register(this._optionsService.onSpecificOptionChange("overviewRuler",()=>this._queueRefresh(!0))),this._register(this._themeService.onChangeColors(()=>this._queueRefresh())),this._queueRefresh(!0)}get _width(){return this._optionsService.options.overviewRuler?.width||0}_refreshDrawConstants(){let q=Math.floor((this._canvas.width-1)/3),Y=Math.ceil((this._canvas.width-1)/3);h0.full=this._canvas.width,h0.left=q,h0.center=Y,h0.right=q,this._refreshDrawHeightConstants(),j1.full=1,j1.left=1,j1.center=1+h0.left,j1.right=1+h0.left+h0.center}_refreshDrawHeightConstants(){L0.full=Math.round(2*this._coreBrowserService.dpr);let q=this._canvas.height/this._bufferService.buffer.lines.length,Y=Math.round(Math.max(Math.min(q,12),6)*this._coreBrowserService.dpr);L0.left=Y,L0.center=Y,L0.right=Y}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*L0.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*L0.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*L0.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*L0.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(let Y of this._decorationService.decorations)this._colorZoneStore.addDecoration(Y);this._ctx.lineWidth=1,this._renderRulerOutline();let q=this._colorZoneStore.zones;for(let Y of q)Y.position!=="full"&&this._renderColorZone(Y);for(let Y of q)Y.position==="full"&&this._renderColorZone(Y);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderRulerOutline(){this._ctx.fillStyle=this._themeService.colors.overviewRulerBorder.css,this._ctx.fillRect(0,0,1,this._canvas.height),this._optionsService.rawOptions.overviewRuler.showTopBorder&&this._ctx.fillRect(1,0,this._canvas.width-1,1),this._optionsService.rawOptions.overviewRuler.showBottomBorder&&this._ctx.fillRect(1,this._canvas.height-1,this._canvas.width-1,this._canvas.height)}_renderColorZone(q){this._ctx.fillStyle=q.color,this._ctx.fillRect(j1[q.position||"full"],Math.round((this._canvas.height-1)*(q.startBufferLine/this._bufferService.buffers.active.lines.length)-L0[q.position||"full"]/2),h0[q.position||"full"],Math.round((this._canvas.height-1)*((q.endBufferLine-q.startBufferLine)/this._bufferService.buffers.active.lines.length)+L0[q.position||"full"]))}_queueRefresh(q,Y){this._shouldUpdateDimensions=q||this._shouldUpdateDimensions,this._shouldUpdateAnchor=Y||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};t1=a([A(2,X0),A(3,I1),A(4,E0),A(5,z0),A(6,Z1),A(7,_0)],t1);var U;((q)=>(q.NUL="\x00",q.SOH="\x01",q.STX="\x02",q.ETX="\x03",q.EOT="\x04",q.ENQ="\x05",q.ACK="\x06",q.BEL="\x07",q.BS="\b",q.HT="\t",q.LF=`
`,q.VT="\v",q.FF="\f",q.CR="\r",q.SO="\x0E",q.SI="\x0F",q.DLE="\x10",q.DC1="\x11",q.DC2="\x12",q.DC3="\x13",q.DC4="\x14",q.NAK="\x15",q.SYN="\x16",q.ETB="\x17",q.CAN="\x18",q.EM="\x19",q.SUB="\x1A",q.ESC="\x1B",q.FS="\x1C",q.GS="\x1D",q.RS="\x1E",q.US="\x1F",q.SP=" ",q.DEL=""))(U||={});var l1;((q)=>(q.PAD="",q.HOP="",q.BPH="",q.NBH="",q.IND="",q.NEL="",q.SSA="",q.ESA="",q.HTS="",q.HTJ="",q.VTS="",q.PLD="",q.PLU="",q.RI="",q.SS2="",q.SS3="",q.DCS="",q.PU1="",q.PU2="",q.STS="",q.CCH="",q.MW="",q.SPA="",q.EPA="",q.SOS="",q.SGCI="",q.SCI="",q.CSI="",q.ST="",q.OSC="",q.PM="",q.APC=""))(l1||={});var u4;((q)=>q.ST=`${U.ESC}\\`)(u4||={});var d2=class{constructor(q,Y,G,H,F,Z){this._textarea=q,this._compositionView=Y,this._bufferService=G,this._optionsService=H,this._coreService=F,this._renderService=Z,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}get isComposing(){return this._isComposing}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(q){this._compositionView.textContent=q.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(q){if(this._isComposing||this._isSendingComposition){if(q.keyCode===20||q.keyCode===229||q.keyCode===16||q.keyCode===17||q.keyCode===18)return!1;this._finalizeComposition(!1)}return q.keyCode===229?(this._handleAnyTextareaChanges(),!1):!0}_finalizeComposition(q){if(this._compositionView.classList.remove("active"),this._isComposing=!1,q){let Y={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){this._isSendingComposition=!1;let G;Y.start+=this._dataAlreadySent.length,this._isComposing?G=this._textarea.value.substring(Y.start,this._compositionPosition.start):G=this._textarea.value.substring(Y.start),G.length>0&&this._coreService.triggerDataEvent(G,!0)}},0)}else{this._isSendingComposition=!1;let Y=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(Y,!0)}}_handleAnyTextareaChanges(){let q=this._textarea.value;setTimeout(()=>{if(!this._isComposing){let Y=this._textarea.value,G=Y.replace(q,"");this._dataAlreadySent=G,Y.length>q.length?this._coreService.triggerDataEvent(G,!0):Y.length<q.length?this._coreService.triggerDataEvent(`${U.DEL}`,!0):Y.length===q.length&&Y!==q&&this._coreService.triggerDataEvent(Y,!0)}},0)}updateCompositionElements(q){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){let Y=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),G=this._renderService.dimensions.css.cell.height,H=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,F=Y*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=F+"px",this._compositionView.style.top=H+"px",this._compositionView.style.height=G+"px",this._compositionView.style.lineHeight=G+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";let Z=this._compositionView.getBoundingClientRect();this._textarea.style.left=F+"px",this._textarea.style.top=H+"px",this._textarea.style.width=Math.max(Z.width,1)+"px",this._textarea.style.height=Math.max(Z.height,1)+"px",this._textarea.style.lineHeight=Z.height+"px"}q||setTimeout(()=>this.updateCompositionElements(!0),0)}}};d2=a([A(2,X0),A(3,z0),A(4,q1),A(5,E0)],d2);var q0=0,Y0=0,G0=0,c=0,u3={css:"#00000000",rgba:0},n;((q)=>{function Y(F,Z,$,V){return V!==void 0?`#${o0(F)}${o0(Z)}${o0($)}${o0(V)}`:`#${o0(F)}${o0(Z)}${o0($)}`}q.toCss=Y;function G(F,Z,$,V=255){return(F<<24|Z<<16|$<<8|V)>>>0}q.toRgba=G;function H(F,Z,$,V){return{css:q.toCss(F,Z,$,V),rgba:q.toRgba(F,Z,$,V)}}q.toColor=H})(n||={});var p;((q)=>{function Y(X,J){if(c=(J.rgba&255)/255,c===1)return{css:J.css,rgba:J.rgba};let M=J.rgba>>24&255,z=J.rgba>>16&255,K=J.rgba>>8&255,W=X.rgba>>24&255,j=X.rgba>>16&255,C=X.rgba>>8&255;q0=W+Math.round((M-W)*c),Y0=j+Math.round((z-j)*c),G0=C+Math.round((K-C)*c);let L=n.toCss(q0,Y0,G0),x=n.toRgba(q0,Y0,G0);return{css:L,rgba:x}}q.blend=Y;function G(X){return(X.rgba&255)===255}q.isOpaque=G;function H(X,J,M){let z=o1.ensureContrastRatio(X.rgba,J.rgba,M);if(z)return n.toColor(z>>24&255,z>>16&255,z>>8&255)}q.ensureContrastRatio=H;function F(X){let J=(X.rgba|255)>>>0;return[q0,Y0,G0]=o1.toChannels(J),{css:n.toCss(q0,Y0,G0),rgba:J}}q.opaque=F;function Z(X,J){return c=Math.round(J*255),[q0,Y0,G0]=o1.toChannels(X.rgba),{css:n.toCss(q0,Y0,G0,c),rgba:n.toRgba(q0,Y0,G0,c)}}q.opacity=Z;function $(X,J){return c=X.rgba&255,Z(X,c*J/255)}q.multiplyOpacity=$;function V(X){return[X.rgba>>24&255,X.rgba>>16&255,X.rgba>>8&255]}q.toColorRGB=V})(p||={});var u;((q)=>{let Y,G;try{let F=document.createElement("canvas");F.width=1,F.height=1;let Z=F.getContext("2d",{willReadFrequently:!0});Z&&(Y=Z,Y.globalCompositeOperation="copy",G=Y.createLinearGradient(0,0,1,1))}catch{}function H(F){if(F.match(/#[\da-f]{3,8}/i))switch(F.length){case 4:return q0=parseInt(F.slice(1,2).repeat(2),16),Y0=parseInt(F.slice(2,3).repeat(2),16),G0=parseInt(F.slice(3,4).repeat(2),16),n.toColor(q0,Y0,G0);case 5:return q0=parseInt(F.slice(1,2).repeat(2),16),Y0=parseInt(F.slice(2,3).repeat(2),16),G0=parseInt(F.slice(3,4).repeat(2),16),c=parseInt(F.slice(4,5).repeat(2),16),n.toColor(q0,Y0,G0,c);case 7:return{css:F,rgba:(parseInt(F.slice(1),16)<<8|255)>>>0};case 9:return{css:F,rgba:parseInt(F.slice(1),16)>>>0}}let Z=F.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(Z)return q0=parseInt(Z[1]),Y0=parseInt(Z[2]),G0=parseInt(Z[3]),c=Math.round((Z[5]===void 0?1:parseFloat(Z[5]))*255),n.toColor(q0,Y0,G0,c);if(!Y||!G)throw Error("css.toColor: Unsupported css format");if(Y.fillStyle=G,Y.fillStyle=F,typeof Y.fillStyle!="string")throw Error("css.toColor: Unsupported css format");if(Y.fillRect(0,0,1,1),[q0,Y0,G0,c]=Y.getImageData(0,0,1,1).data,c!==255)throw Error("css.toColor: Unsupported css format");return{rgba:n.toRgba(q0,Y0,G0,c),css:F}}q.toColor=H})(u||={});var V0;((q)=>{function Y(H){return G(H>>16&255,H>>8&255,H&255)}q.relativeLuminance=Y;function G(H,F,Z){let $=H/255,V=F/255,X=Z/255,J=$<=0.03928?$/12.92:Math.pow(($+0.055)/1.055,2.4),M=V<=0.03928?V/12.92:Math.pow((V+0.055)/1.055,2.4),z=X<=0.03928?X/12.92:Math.pow((X+0.055)/1.055,2.4);return J*0.2126+M*0.7152+z*0.0722}q.relativeLuminance2=G})(V0||={});var o1;((q)=>{function Y($,V){if(c=(V&255)/255,c===1)return V;let X=V>>24&255,J=V>>16&255,M=V>>8&255,z=$>>24&255,K=$>>16&255,W=$>>8&255;return q0=z+Math.round((X-z)*c),Y0=K+Math.round((J-K)*c),G0=W+Math.round((M-W)*c),n.toRgba(q0,Y0,G0)}q.blend=Y;function G($,V,X){let J=V0.relativeLuminance($>>8),M=V0.relativeLuminance(V>>8);if(S0(J,M)<X){if(M<J){let W=H($,V,X),j=S0(J,V0.relativeLuminance(W>>8));if(j<X){let C=F($,V,X),L=S0(J,V0.relativeLuminance(C>>8));return j>L?W:C}return W}let z=F($,V,X),K=S0(J,V0.relativeLuminance(z>>8));if(K<X){let W=H($,V,X),j=S0(J,V0.relativeLuminance(W>>8));return K>j?z:W}return z}}q.ensureContrastRatio=G;function H($,V,X){let J=$>>24&255,M=$>>16&255,z=$>>8&255,K=V>>24&255,W=V>>16&255,j=V>>8&255,C=S0(V0.relativeLuminance2(K,W,j),V0.relativeLuminance2(J,M,z));for(;C<X&&(K>0||W>0||j>0);)K-=Math.max(0,Math.ceil(K*0.1)),W-=Math.max(0,Math.ceil(W*0.1)),j-=Math.max(0,Math.ceil(j*0.1)),C=S0(V0.relativeLuminance2(K,W,j),V0.relativeLuminance2(J,M,z));return(K<<24|W<<16|j<<8|255)>>>0}q.reduceLuminance=H;function F($,V,X){let J=$>>24&255,M=$>>16&255,z=$>>8&255,K=V>>24&255,W=V>>16&255,j=V>>8&255,C=S0(V0.relativeLuminance2(K,W,j),V0.relativeLuminance2(J,M,z));for(;C<X&&(K<255||W<255||j<255);)K=Math.min(255,K+Math.ceil((255-K)*0.1)),W=Math.min(255,W+Math.ceil((255-W)*0.1)),j=Math.min(255,j+Math.ceil((255-j)*0.1)),C=S0(V0.relativeLuminance2(K,W,j),V0.relativeLuminance2(J,M,z));return(K<<24|W<<16|j<<8|255)>>>0}q.increaseLuminance=F;function Z($){return[$>>24&255,$>>16&255,$>>8&255,$&255]}q.toChannels=Z})(o1||={});function o0(q){let Y=q.toString(16);return Y.length<2?"0"+Y:Y}function S0(q,Y){return q<Y?(Y+0.05)/(q+0.05):(q+0.05)/(Y+0.05)}var V7=class extends w1{constructor(q,Y,G){super();this.content=0,this.combinedData="",this.fg=q.fg,this.bg=q.bg,this.combinedData=Y,this._width=G}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(q){throw Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},e1=class{constructor(q){this._bufferService=q,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new B0}register(q){let Y={id:this._nextCharacterJoinerId++,handler:q};return this._characterJoiners.push(Y),Y.id}deregister(q){for(let Y=0;Y<this._characterJoiners.length;Y++)if(this._characterJoiners[Y].id===q)return this._characterJoiners.splice(Y,1),!0;return!1}getJoinedCharacters(q){if(this._characterJoiners.length===0)return[];let Y=this._bufferService.buffer.lines.get(q);if(!Y||Y.length===0)return[];let G=[],H=Y.translateToString(!0),F=0,Z=0,$=0,V=Y.getFg(0),X=Y.getBg(0);for(let J=0;J<Y.getTrimmedLength();J++)if(Y.loadCell(J,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==V||this._workCell.bg!==X){if(J-F>1){let M=this._getJoinedRanges(H,$,Z,Y,F);for(let z=0;z<M.length;z++)G.push(M[z])}F=J,$=Z,V=this._workCell.fg,X=this._workCell.bg}Z+=this._workCell.getChars().length||c0.length}if(this._bufferService.cols-F>1){let J=this._getJoinedRanges(H,$,Z,Y,F);for(let M=0;M<J.length;M++)G.push(J[M])}return G}_getJoinedRanges(q,Y,G,H,F){let Z=q.substring(Y,G),$=[];try{$=this._characterJoiners[0].handler(Z)}catch(V){console.error(V)}for(let V=1;V<this._characterJoiners.length;V++)try{let X=this._characterJoiners[V].handler(Z);for(let J=0;J<X.length;J++)e1._mergeRanges($,X[J])}catch(X){console.error(X)}return this._stringRangesToCellRanges($,H,F),$}_stringRangesToCellRanges(q,Y,G){let H=0,F=!1,Z=0,$=q[H];if($){for(let V=G;V<this._bufferService.cols;V++){let X=Y.getWidth(V),J=Y.getString(V).length||c0.length;if(X!==0){if(!F&&$[0]<=Z&&($[0]=V,F=!0),$[1]<=Z){if($[1]=V,$=q[++H],!$)break;$[0]<=Z?($[0]=V,F=!0):F=!1}Z+=J}}$&&($[1]=this._bufferService.cols)}}static _mergeRanges(q,Y){let G=!1;for(let H=0;H<q.length;H++){let F=q[H];if(G){if(Y[1]<=F[0])return q[H-1][1]=Y[1],q;if(Y[1]<=F[1])return q[H-1][1]=Math.max(Y[1],F[1]),q.splice(H,1),q;q.splice(H,1),H--}else{if(Y[1]<=F[0])return q.splice(H,0,Y),q;if(Y[1]<=F[1])return F[0]=Math.min(Y[0],F[0]),q;Y[0]<F[1]&&(F[0]=Math.min(Y[0],F[0]),G=!0);continue}}return G?q[q.length-1][1]=Y[1]:q.push(Y),q}};e1=a([A(0,X0)],e1);function X7(q){return 57508<=q&&q<=57558}function z7(q){return 9472<=q&&q<=9631}function M7(q){return X7(q)||z7(q)}function j7(){return{css:{canvas:v1(),cell:v1()},device:{canvas:v1(),cell:v1(),char:{width:0,height:0,left:0,top:0}}}}function v1(){return{width:0,height:0}}var u2=class{constructor(q,Y,G,H,F,Z,$){this._document=q,this._characterJoinerService=Y,this._optionsService=G,this._coreBrowserService=H,this._coreService=F,this._decorationService=Z,this._themeService=$,this._workCell=new B0,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(q,Y,G){this._selectionStart=q,this._selectionEnd=Y,this._columnSelectMode=G}createRow(q,Y,G,H,F,Z,$,V,X,J,M){let z=[],K=this._characterJoinerService.getJoinedCharacters(Y),W=this._themeService.colors,j=q.getNoBgTrimmedLength();G&&j<Z+1&&(j=Z+1);let C,L=0,x="",v=0,I=0,P=0,_=0,E=!1,F0=0,D0=!1,A0=0,V1=0,g=[],X2=J!==-1&&M!==-1;for(let N=0;N<j;N++){q.loadCell(N,this._workCell);let D=this._workCell.getWidth();if(D===0)continue;let Q=!1,k=N>=V1,O=N,R=this._workCell;if(K.length>0&&N===K[0][0]&&k){let b=K.shift(),z2=this._isCellInSelection(b[0],Y);for(v=b[0]+1;v<b[1];v++)k&&=z2===this._isCellInSelection(v,Y);k&&=!G||Z<b[0]||Z>=b[1],k?(Q=!0,R=new V7(this._workCell,q.translateToString(!0,b[0],b[1]),b[1]-b[0]),O=b[1]-1,D=R.getWidth()):V1=b[1]}let T=this._isCellInSelection(N,Y),h=G&&N===Z,Z0=X2&&N>=J&&N<=M,k0=!1;this._decorationService.forEachDecorationAtCell(N,Y,void 0,(b)=>{k0=!0});let y0=R.getChars()||c0;if(y0===" "&&(R.isUnderline()||R.isOverline())&&(y0=""),A0=D*V-X.get(y0,R.isBold(),R.isItalic()),!C)C=this._document.createElement("span");else if(L&&(T&&D0||!T&&!D0&&R.bg===I)&&(T&&D0&&W.selectionForeground||R.fg===P)&&R.extended.ext===_&&Z0===E&&A0===F0&&!h&&!Q&&!k0&&k){R.isInvisible()?x+=c0:x+=y0,L++;continue}else L&&(C.textContent=x),C=this._document.createElement("span"),L=0,x="";if(I=R.bg,P=R.fg,_=R.extended.ext,E=Z0,F0=A0,D0=T,Q&&Z>=N&&Z<=O&&(Z=N),!this._coreService.isCursorHidden&&h&&this._coreService.isCursorInitialized){if(g.push("xterm-cursor"),this._coreBrowserService.isFocused)$&&g.push("xterm-cursor-blink"),g.push(H==="bar"?"xterm-cursor-bar":H==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(F)switch(F){case"outline":g.push("xterm-cursor-outline");break;case"block":g.push("xterm-cursor-block");break;case"bar":g.push("xterm-cursor-bar");break;case"underline":g.push("xterm-cursor-underline");break;default:break}}if(R.isBold()&&g.push("xterm-bold"),R.isItalic()&&g.push("xterm-italic"),R.isDim()&&g.push("xterm-dim"),R.isInvisible()?x=c0:x=R.getChars()||c0,R.isUnderline()&&(g.push(`xterm-underline-${R.extended.underlineStyle}`),x===" "&&(x=""),!R.isUnderlineColorDefault()))if(R.isUnderlineColorRGB())C.style.textDecorationColor=`rgb(${w1.toColorRGB(R.getUnderlineColor()).join(",")})`;else{let b=R.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&R.isBold()&&b<8&&(b+=8),C.style.textDecorationColor=W.ansi[b].css}R.isOverline()&&(g.push("xterm-overline"),x===" "&&(x="")),R.isStrikethrough()&&g.push("xterm-strikethrough"),Z0&&(C.style.textDecoration="underline");let t=R.getFgColor(),v0=R.getFgColorMode(),J0=R.getBgColor(),l0=R.getBgColorMode(),X1=!!R.isInverse();if(X1){let b=t;t=J0,J0=b;let z2=v0;v0=l0,l0=z2}let f0,E1,z1=!1;this._decorationService.forEachDecorationAtCell(N,Y,void 0,(b)=>{b.options.layer!=="top"&&z1||(b.backgroundColorRGB&&(l0=50331648,J0=b.backgroundColorRGB.rgba>>8&16777215,f0=b.backgroundColorRGB),b.foregroundColorRGB&&(v0=50331648,t=b.foregroundColorRGB.rgba>>8&16777215,E1=b.foregroundColorRGB),z1=b.options.layer==="top")}),!z1&&T&&(f0=this._coreBrowserService.isFocused?W.selectionBackgroundOpaque:W.selectionInactiveBackgroundOpaque,J0=f0.rgba>>8&16777215,l0=50331648,z1=!0,W.selectionForeground&&(v0=50331648,t=W.selectionForeground.rgba>>8&16777215,E1=W.selectionForeground)),z1&&g.push("xterm-decoration-top");let p0;switch(l0){case 16777216:case 33554432:p0=W.ansi[J0],g.push(`xterm-bg-${J0}`);break;case 50331648:p0=n.toColor(J0>>16,J0>>8&255,J0&255),this._addStyle(C,`background-color:#${c3((J0>>>0).toString(16),"0",6)}`);break;case 0:default:X1?(p0=W.foreground,g.push("xterm-bg-257")):p0=W.background}switch(f0||R.isDim()&&(f0=p.multiplyOpacity(p0,0.5)),v0){case 16777216:case 33554432:R.isBold()&&t<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(t+=8),this._applyMinimumContrast(C,p0,W.ansi[t],R,f0,void 0)||g.push(`xterm-fg-${t}`);break;case 50331648:let b=n.toColor(t>>16&255,t>>8&255,t&255);this._applyMinimumContrast(C,p0,b,R,f0,E1)||this._addStyle(C,`color:#${c3(t.toString(16),"0",6)}`);break;case 0:default:this._applyMinimumContrast(C,p0,W.foreground,R,f0,E1)||X1&&g.push("xterm-fg-257")}g.length&&(C.className=g.join(" "),g.length=0),!h&&!Q&&!k0&&k?L++:C.textContent=x,A0!==this.defaultSpacing&&(C.style.letterSpacing=`${A0}px`),z.push(C),N=O}return C&&L&&(C.textContent=x),z}_applyMinimumContrast(q,Y,G,H,F,Z){if(this._optionsService.rawOptions.minimumContrastRatio===1||M7(H.getCode()))return!1;let $=this._getContrastCache(H),V;if(!F&&!Z&&(V=$.getColor(Y.rgba,G.rgba)),V===void 0){let X=this._optionsService.rawOptions.minimumContrastRatio/(H.isDim()?2:1);V=p.ensureContrastRatio(F||Y,Z||G,X),$.setColor((F||Y).rgba,(Z||G).rgba,V??null)}return V?(this._addStyle(q,`color:${V.css}`),!0):!1}_getContrastCache(q){return q.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(q,Y){q.setAttribute("style",`${q.getAttribute("style")||""}${Y};`)}_isCellInSelection(q,Y){let G=this._selectionStart,H=this._selectionEnd;return!G||!H?!1:this._columnSelectMode?G[0]<=H[0]?q>=G[0]&&Y>=G[1]&&q<H[0]&&Y<=H[1]:q<G[0]&&Y>=G[1]&&q>=H[0]&&Y<=H[1]:Y>G[1]&&Y<H[1]||G[1]===H[1]&&Y===G[1]&&q>=G[0]&&q<H[0]||G[1]<H[1]&&Y===H[1]&&q<H[0]||G[1]<H[1]&&Y===G[1]&&q>=G[0]}};u2=a([A(1,P4),A(2,z0),A(3,_0),A(4,q1),A(5,I1),A(6,Z1)],u2);function c3(q,Y,G){for(;q.length<G;)q=Y+q;return q}var K7=class{constructor(q,Y){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=q.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";let G=q.createElement("span");G.classList.add("xterm-char-measure-element");let H=q.createElement("span");H.classList.add("xterm-char-measure-element"),H.style.fontWeight="bold";let F=q.createElement("span");F.classList.add("xterm-char-measure-element"),F.style.fontStyle="italic";let Z=q.createElement("span");Z.classList.add("xterm-char-measure-element"),Z.style.fontWeight="bold",Z.style.fontStyle="italic",this._measureElements=[G,H,F,Z],this._container.appendChild(G),this._container.appendChild(H),this._container.appendChild(F),this._container.appendChild(Z),Y.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(q,Y,G,H){q===this._font&&Y===this._fontSize&&G===this._weight&&H===this._weightBold||(this._font=q,this._fontSize=Y,this._weight=G,this._weightBold=H,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${G}`,this._measureElements[1].style.fontWeight=`${H}`,this._measureElements[2].style.fontWeight=`${G}`,this._measureElements[3].style.fontWeight=`${H}`,this.clear())}get(q,Y,G){let H=0;if(!Y&&!G&&q.length===1&&(H=q.charCodeAt(0))<256){if(this._flat[H]!==-9999)return this._flat[H];let $=this._measure(q,0);return $>0&&(this._flat[H]=$),$}let F=q;Y&&(F+="B"),G&&(F+="I");let Z=this._holey.get(F);if(Z===void 0){let $=0;Y&&($|=1),G&&($|=2),Z=this._measure(q,$),Z>0&&this._holey.set(F,Z)}return Z}_measure(q,Y){let G=this._measureElements[Y];return G.textContent=q.repeat(32),G.offsetWidth/32}},W7=class{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(q,Y,G,H=!1){if(this.selectionStart=Y,this.selectionEnd=G,!Y||!G||Y[0]===G[0]&&Y[1]===G[1]){this.clear();return}let F=q.buffers.active.ydisp,Z=Y[1]-F,$=G[1]-F,V=Math.max(Z,0),X=Math.min($,q.rows-1);if(V>=q.rows||X<0){this.clear();return}this.hasSelection=!0,this.columnSelectMode=H,this.viewportStartRow=Z,this.viewportEndRow=$,this.viewportCappedStartRow=V,this.viewportCappedEndRow=X,this.startCol=Y[0],this.endCol=G[0]}isCellSelected(q,Y,G){return this.hasSelection?(G-=q.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?Y>=this.startCol&&G>=this.viewportCappedStartRow&&Y<this.endCol&&G<=this.viewportCappedEndRow:Y<this.startCol&&G>=this.viewportCappedStartRow&&Y>=this.endCol&&G<=this.viewportCappedEndRow:G>this.viewportStartRow&&G<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&G===this.viewportStartRow&&Y>=this.startCol&&Y<this.endCol||this.viewportStartRow<this.viewportEndRow&&G===this.viewportEndRow&&Y<this.endCol||this.viewportStartRow<this.viewportEndRow&&G===this.viewportStartRow&&Y>=this.startCol):!1}};function C7(){return new W7}var D2="xterm-dom-renderer-owner-",U0="xterm-rows",f1="xterm-fg-",a3="xterm-bg-",K1="xterm-focus",p1="xterm-selection",U7=1,c2=class extends S{constructor(q,Y,G,H,F,Z,$,V,X,J,M,z,K,W){super();this._terminal=q,this._document=Y,this._element=G,this._screenElement=H,this._viewportElement=F,this._helperContainer=Z,this._linkifier2=$,this._charSizeService=X,this._optionsService=J,this._bufferService=M,this._coreService=z,this._coreBrowserService=K,this._themeService=W,this._terminalClass=U7++,this._rowElements=[],this._selectionRenderModel=C7(),this.onRequestRedraw=this._register(new B).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(U0),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(p1),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=j7(),this._updateDimensions(),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._themeService.onChangeColors((j)=>this._injectCss(j))),this._injectCss(this._themeService.colors),this._rowFactory=V.createInstance(u2,document),this._element.classList.add(D2+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this._register(this._linkifier2.onShowLinkUnderline((j)=>this._handleLinkHover(j))),this._register(this._linkifier2.onHideLinkUnderline((j)=>this._handleLinkLeave(j))),this._register(m(()=>{this._element.classList.remove(D2+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new K7(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){let q=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*q,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*q),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/q),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/q),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(let G of this._rowElements)G.style.width=`${this.dimensions.css.canvas.width}px`,G.style.height=`${this.dimensions.css.cell.height}px`,G.style.lineHeight=`${this.dimensions.css.cell.height}px`,G.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));let Y=`${this._terminalSelector} .${U0} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=Y,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(q){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let Y=`${this._terminalSelector} .${U0} { pointer-events: none; color: ${q.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;Y+=`${this._terminalSelector} .${U0} .xterm-dim { color: ${p.multiplyOpacity(q.foreground,0.5).css};}`,Y+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;let G=`blink_underline_${this._terminalClass}`,H=`blink_bar_${this._terminalClass}`,F=`blink_block_${this._terminalClass}`;Y+=`@keyframes ${G} { 50% {  border-bottom-style: hidden; }}`,Y+=`@keyframes ${H} { 50% {  box-shadow: none; }}`,Y+=`@keyframes ${F} { 0% {  background-color: ${q.cursor.css};  color: ${q.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${q.cursor.css}; }}`,Y+=`${this._terminalSelector} .${U0}.${K1} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${G} 1s step-end infinite;}${this._terminalSelector} .${U0}.${K1} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${H} 1s step-end infinite;}${this._terminalSelector} .${U0}.${K1} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${F} 1s step-end infinite;}${this._terminalSelector} .${U0} .xterm-cursor.xterm-cursor-block { background-color: ${q.cursor.css}; color: ${q.cursorAccent.css};}${this._terminalSelector} .${U0} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${q.cursor.css} !important; color: ${q.cursorAccent.css} !important;}${this._terminalSelector} .${U0} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${q.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${U0} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${q.cursor.css} inset;}${this._terminalSelector} .${U0} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${q.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,Y+=`${this._terminalSelector} .${p1} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${p1} div { position: absolute; background-color: ${q.selectionBackgroundOpaque.css};}${this._terminalSelector} .${p1} div { position: absolute; background-color: ${q.selectionInactiveBackgroundOpaque.css};}`;for(let[Z,$]of q.ansi.entries())Y+=`${this._terminalSelector} .${f1}${Z} { color: ${$.css}; }${this._terminalSelector} .${f1}${Z}.xterm-dim { color: ${p.multiplyOpacity($,0.5).css}; }${this._terminalSelector} .${a3}${Z} { background-color: ${$.css}; }`;Y+=`${this._terminalSelector} .${f1}257 { color: ${p.opaque(q.background).css}; }${this._terminalSelector} .${f1}257.xterm-dim { color: ${p.multiplyOpacity(p.opaque(q.background),0.5).css}; }${this._terminalSelector} .${a3}257 { background-color: ${q.foreground.css}; }`,this._themeStyleElement.textContent=Y}_setDefaultSpacing(){let q=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${q}px`,this._rowFactory.defaultSpacing=q}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(q,Y){for(let G=this._rowElements.length;G<=Y;G++){let H=this._document.createElement("div");this._rowContainer.appendChild(H),this._rowElements.push(H)}for(;this._rowElements.length>Y;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(q,Y){this._refreshRowElements(q,Y),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(K1),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(K1),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(q,Y,G){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(q,Y,G),this.renderRows(0,this._bufferService.rows-1),!q||!Y||(this._selectionRenderModel.update(this._terminal,q,Y,G),!this._selectionRenderModel.hasSelection))return;let H=this._selectionRenderModel.viewportStartRow,F=this._selectionRenderModel.viewportEndRow,Z=this._selectionRenderModel.viewportCappedStartRow,$=this._selectionRenderModel.viewportCappedEndRow,V=this._document.createDocumentFragment();if(G){let X=q[0]>Y[0];V.appendChild(this._createSelectionElement(Z,X?Y[0]:q[0],X?q[0]:Y[0],$-Z+1))}else{let X=H===Z?q[0]:0,J=Z===F?Y[0]:this._bufferService.cols;V.appendChild(this._createSelectionElement(Z,X,J));let M=$-Z-1;if(V.appendChild(this._createSelectionElement(Z+1,0,this._bufferService.cols,M)),Z!==$){let z=F===$?Y[0]:this._bufferService.cols;V.appendChild(this._createSelectionElement($,0,z))}}this._selectionContainer.appendChild(V)}_createSelectionElement(q,Y,G,H=1){let F=this._document.createElement("div"),Z=Y*this.dimensions.css.cell.width,$=this.dimensions.css.cell.width*(G-Y);return Z+$>this.dimensions.css.canvas.width&&($=this.dimensions.css.canvas.width-Z),F.style.height=`${H*this.dimensions.css.cell.height}px`,F.style.top=`${q*this.dimensions.css.cell.height}px`,F.style.left=`${Z}px`,F.style.width=`${$}px`,F}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(let q of this._rowElements)q.replaceChildren()}renderRows(q,Y){let G=this._bufferService.buffer,H=G.ybase+G.y,F=Math.min(G.x,this._bufferService.cols-1),Z=this._coreService.decPrivateModes.cursorBlink??this._optionsService.rawOptions.cursorBlink,$=this._coreService.decPrivateModes.cursorStyle??this._optionsService.rawOptions.cursorStyle,V=this._optionsService.rawOptions.cursorInactiveStyle;for(let X=q;X<=Y;X++){let J=X+G.ydisp,M=this._rowElements[X],z=G.lines.get(J);if(!M||!z)break;M.replaceChildren(...this._rowFactory.createRow(z,J,J===H,$,V,F,Z,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${D2}${this._terminalClass}`}_handleLinkHover(q){this._setCellUnderline(q.x1,q.x2,q.y1,q.y2,q.cols,!0)}_handleLinkLeave(q){this._setCellUnderline(q.x1,q.x2,q.y1,q.y2,q.cols,!1)}_setCellUnderline(q,Y,G,H,F,Z){G<0&&(q=0),H<0&&(Y=0);let $=this._bufferService.rows-1;G=Math.max(Math.min(G,$),0),H=Math.max(Math.min(H,$),0),F=Math.min(F,this._bufferService.cols);let V=this._bufferService.buffer,X=V.ybase+V.y,J=Math.min(V.x,F-1),M=this._optionsService.rawOptions.cursorBlink,z=this._optionsService.rawOptions.cursorStyle,K=this._optionsService.rawOptions.cursorInactiveStyle;for(let W=G;W<=H;++W){let j=W+V.ydisp,C=this._rowElements[W],L=V.lines.get(j);if(!C||!L)break;C.replaceChildren(...this._rowFactory.createRow(L,j,j===X,z,K,J,M,this.dimensions.css.cell.width,this._widthCache,Z?W===G?q:0:-1,Z?(W===H?Y:F)-1:-1))}}};c2=a([A(7,H3),A(8,F2),A(9,z0),A(10,X0),A(11,q1),A(12,_0),A(13,Z1)],c2);var a2=class extends S{constructor(q,Y,G){super();this._optionsService=G,this.width=0,this.height=0,this._onCharSizeChange=this._register(new B),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this._register(new B7(this._optionsService))}catch{this._measureStrategy=this._register(new N7(q,Y,this._optionsService))}this._register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}get hasValidSize(){return this.width>0&&this.height>0}measure(){let q=this._measureStrategy.measure();(q.width!==this.width||q.height!==this.height)&&(this.width=q.width,this.height=q.height,this._onCharSizeChange.fire())}};a2=a([A(2,z0)],a2);var c4=class extends S{constructor(){super(...arguments);this._result={width:0,height:0}}_validateAndSet(q,Y){q!==void 0&&q>0&&Y!==void 0&&Y>0&&(this._result.width=q,this._result.height=Y)}},N7=class extends c4{constructor(q,Y,G){super();this._document=q,this._parentElement=Y,this._optionsService=G,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}},B7=class extends c4{constructor(q){super();this._optionsService=q,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");let Y=this._ctx.measureText("W");if(!(("width"in Y)&&("fontBoundingBoxAscent"in Y)&&("fontBoundingBoxDescent"in Y)))throw Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;let q=this._ctx.measureText("W");return this._validateAndSet(q.width,q.fontBoundingBoxAscent+q.fontBoundingBoxDescent),this._result}},D7=class extends S{constructor(q,Y,G){super();this._textarea=q,this._window=Y,this.mainDocument=G,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=this._register(new R7(this._window)),this._onDprChange=this._register(new B),this.onDprChange=this._onDprChange.event,this._onWindowChange=this._register(new B),this.onWindowChange=this._onWindowChange.event,this._register(this.onWindowChange((H)=>this._screenDprMonitor.setWindow(H))),this._register($0.forward(this._screenDprMonitor.onDprChange,this._onDprChange)),this._register(y(this._textarea,"focus",()=>this._isFocused=!0)),this._register(y(this._textarea,"blur",()=>this._isFocused=!1))}get window(){return this._window}set window(q){this._window!==q&&(this._window=q,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}},R7=class extends S{constructor(q){super();this._parentWindow=q,this._windowResizeListener=this._register(new F1),this._onDprChange=this._register(new B),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this._register(m(()=>this.clearListener()))}setWindow(q){this._parentWindow=q,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=y(this._parentWindow,"resize",()=>this._setDprAndFireIfDiffers())}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){this._outerListener&&(this._resolutionMediaMatchList?.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){!this._resolutionMediaMatchList||!this._outerListener||(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}},A7=class extends S{constructor(){super();this.linkProviders=[],this._register(m(()=>this.linkProviders.length=0))}registerLinkProvider(q){return this.linkProviders.push(q),{dispose:()=>{let Y=this.linkProviders.indexOf(q);Y!==-1&&this.linkProviders.splice(Y,1)}}}};function M3(q,Y,G){let H=G.getBoundingClientRect(),F=q.getComputedStyle(G),Z=parseInt(F.getPropertyValue("padding-left")),$=parseInt(F.getPropertyValue("padding-top"));return[Y.clientX-H.left-Z,Y.clientY-H.top-$]}function k7(q,Y,G,H,F,Z,$,V,X){if(!Z)return;let J=M3(q,Y,G);if(J)return J[0]=Math.ceil((J[0]+(X?$/2:0))/$),J[1]=Math.ceil(J[1]/V),J[0]=Math.min(Math.max(J[0],1),H+(X?1:0)),J[1]=Math.min(Math.max(J[1],1),F),J}var l2=class{constructor(q,Y){this._renderService=q,this._charSizeService=Y}getCoords(q,Y,G,H,F){return k7(window,q,Y,G,H,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,F)}getMouseReportCoords(q,Y){let G=M3(window,q,Y);if(this._charSizeService.hasValidSize)return G[0]=Math.min(Math.max(G[0],0),this._renderService.dimensions.css.canvas.width-1),G[1]=Math.min(Math.max(G[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(G[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(G[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(G[0]),y:Math.floor(G[1])}}};l2=a([A(0,E0),A(1,F2)],l2);var L7=class{constructor(q,Y){this._renderCallback=q,this._coreBrowserService=Y,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(q){return this._refreshCallbacks.push(q),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(q,Y,G){this._rowCount=G,q=q!==void 0?q:0,Y=Y!==void 0?Y:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,q):q,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,Y):Y,!this._animationFrame&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0){this._runRefreshCallbacks();return}let q=Math.max(this._rowStart,0),Y=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(q,Y),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let q of this._refreshCallbacks)q(0);this._refreshCallbacks=[]}},a4={};$5(a4,{getSafariVersion:()=>P7,isChromeOS:()=>s4,isFirefox:()=>l4,isIpad:()=>O7,isIphone:()=>x7,isLegacyEdge:()=>Q7,isLinux:()=>j3,isMac:()=>q2,isNode:()=>J2,isSafari:()=>o4,isWindows:()=>n4});var J2=typeof process<"u"&&"title"in process,T1=J2?"node":navigator.userAgent,_1=J2?"node":navigator.platform,l4=T1.includes("Firefox"),Q7=T1.includes("Edge"),o4=/^((?!chrome|android).)*safari/i.test(T1);function P7(){if(!o4)return 0;let q=T1.match(/Version\/(\d+)/);return q===null||q.length<2?0:parseInt(q[1])}var q2=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(_1),O7=_1==="iPad",x7=_1==="iPhone",n4=["Windows","Win16","Win32","WinCE"].includes(_1),j3=_1.indexOf("Linux")>=0,s4=/\bCrOS\b/.test(T1),r4=class{constructor(){this._tasks=[],this._i=0}enqueue(q){this._tasks.push(q),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(q){this._idleCallback=void 0;let Y=0,G=0,H=q.timeRemaining(),F=0;for(;this._i<this._tasks.length;){if(Y=performance.now(),this._tasks[this._i]()||this._i++,Y=Math.max(1,performance.now()-Y),G=Math.max(Y,G),F=q.timeRemaining(),G*1.5>F){H-Y<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(H-Y))}ms`),this._start();return}H=F}this.clear()}},y7=class extends r4{_requestCallback(q){return setTimeout(()=>q(this._createDeadline(16)))}_cancelCallback(q){clearTimeout(q)}_createDeadline(q){let Y=performance.now()+q;return{timeRemaining:()=>Math.max(0,Y-performance.now())}}},S7=class extends r4{_requestCallback(q){return requestIdleCallback(q)}_cancelCallback(q){cancelIdleCallback(q)}},Y2=!J2&&"requestIdleCallback"in window?S7:y7,w7=class{constructor(){this._queue=new Y2}set(q){this._queue.clear(),this._queue.enqueue(q)}flush(){this._queue.flush()}},o2=class extends S{constructor(q,Y,G,H,F,Z,$,V,X){super();this._rowCount=q,this._optionsService=G,this._charSizeService=H,this._coreService=F,this._coreBrowserService=V,this._renderer=this._register(new F1),this._pausedResizeTask=new w7,this._observerDisposable=this._register(new F1),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this._register(new B),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this._register(new B),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this._register(new B),this.onRender=this._onRender.event,this._onRefreshRequest=this._register(new B),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new L7((J,M)=>this._renderRows(J,M),this._coreBrowserService),this._register(this._renderDebouncer),this._syncOutputHandler=new I7(this._coreBrowserService,this._coreService,()=>this._fullRefresh()),this._register(m(()=>this._syncOutputHandler.dispose())),this._register(this._coreBrowserService.onDprChange(()=>this.handleDevicePixelRatioChange())),this._register($.onResize(()=>this._fullRefresh())),this._register($.buffers.onBufferActivate(()=>this._renderer.value?.clear())),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this._register(Z.onDecorationRegistered(()=>this._fullRefresh())),this._register(Z.onDecorationRemoved(()=>this._fullRefresh())),this._register(this._optionsService.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],()=>{this.clear(),this.handleResize($.cols,$.rows),this._fullRefresh()})),this._register(this._optionsService.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows($.buffer.y,$.buffer.y,!0))),this._register(X.onChangeColors(()=>this._fullRefresh())),this._registerIntersectionObserver(this._coreBrowserService.window,Y),this._register(this._coreBrowserService.onWindowChange((J)=>this._registerIntersectionObserver(J,Y)))}get dimensions(){return this._renderer.value.dimensions}_registerIntersectionObserver(q,Y){if("IntersectionObserver"in q){let G=new q.IntersectionObserver((H)=>this._handleIntersectionChange(H[H.length-1]),{threshold:0});G.observe(Y),this._observerDisposable.value=m(()=>G.disconnect())}}_handleIntersectionChange(q){this._isPaused=q.isIntersecting===void 0?q.intersectionRatio===0:!q.isIntersecting,!this._isPaused&&!this._charSizeService.hasValidSize&&this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(q,Y,G=!1){if(this._isPaused){this._needsFullRefresh=!0;return}if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows(q,Y);return}let H=this._syncOutputHandler.flush();H&&(q=Math.min(q,H.start),Y=Math.max(Y,H.end)),G||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(q,Y,this._rowCount)}_renderRows(q,Y){if(this._renderer.value){if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows(q,Y);return}q=Math.min(q,this._rowCount-1),Y=Math.min(Y,this._rowCount-1),this._renderer.value.renderRows(q,Y),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:q,end:Y}),this._onRender.fire({start:q,end:Y}),this._isNextRenderRedrawOnly=!0}}resize(q,Y){this._rowCount=Y,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(q){this._renderer.value=q,this._renderer.value&&(this._renderer.value.onRequestRedraw((Y)=>this.refreshRows(Y.start,Y.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(q){return this._renderDebouncer.addRefreshCallback(q)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){this._renderer.value&&(this._renderer.value.clearTextureAtlas?.(),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(q,Y){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.value?.handleResize(q,Y)):this._renderer.value.handleResize(q,Y),this._fullRefresh())}handleCharSizeChanged(){this._renderer.value?.handleCharSizeChanged()}handleBlur(){this._renderer.value?.handleBlur()}handleFocus(){this._renderer.value?.handleFocus()}handleSelectionChanged(q,Y,G){this._selectionState.start=q,this._selectionState.end=Y,this._selectionState.columnSelectMode=G,this._renderer.value?.handleSelectionChanged(q,Y,G)}handleCursorMove(){this._renderer.value?.handleCursorMove()}clear(){this._renderer.value?.clear()}};o2=a([A(2,z0),A(3,F2),A(4,q1),A(5,I1),A(6,X0),A(7,_0),A(8,Z1)],o2);var I7=class{constructor(q,Y,G){this._coreBrowserService=q,this._coreService=Y,this._onTimeout=G,this._start=0,this._end=0,this._isBuffering=!1}bufferRows(q,Y){this._isBuffering?(this._start=Math.min(this._start,q),this._end=Math.max(this._end,Y)):(this._start=q,this._end=Y,this._isBuffering=!0),this._timeout===void 0&&(this._timeout=this._coreBrowserService.window.setTimeout(()=>{this._timeout=void 0,this._coreService.decPrivateModes.synchronizedOutput=!1,this._onTimeout()},1000))}flush(){if(this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0),!this._isBuffering)return;let q={start:this._start,end:this._end};return this._isBuffering=!1,q}dispose(){this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0)}};function T7(q,Y,G,H){let F=G.buffer.x,Z=G.buffer.y;if(!G.buffer.hasScrollback)return b7(F,Z,q,Y,G,H)+V2(Z,Y,G,H)+v7(F,Z,q,Y,G,H);let $;if(Z===Y)return $=F>q?"D":"C",y1(Math.abs(F-q),x1($,H));$=Z>Y?"D":"C";let V=Math.abs(Z-Y),X=E7(Z>Y?q:F,G)+(V-1)*G.cols+1+_7(Z>Y?F:q,G);return y1(X,x1($,H))}function _7(q,Y){return q-1}function E7(q,Y){return Y.cols-q}function b7(q,Y,G,H,F,Z){return V2(Y,H,F,Z).length===0?"":y1(t4(q,Y,q,Y-e0(Y,F),!1,F).length,x1("D",Z))}function V2(q,Y,G,H){let F=q-e0(q,G),Z=Y-e0(Y,G),$=Math.abs(F-Z)-f7(q,Y,G);return y1($,x1(i4(q,Y),H))}function v7(q,Y,G,H,F,Z){let $;V2(Y,H,F,Z).length>0?$=H-e0(H,F):$=Y;let V=H,X=p7(q,Y,G,H,F,Z);return y1(t4(q,$,G,V,X==="C",F).length,x1(X,Z))}function f7(q,Y,G){let H=0,F=q-e0(q,G),Z=Y-e0(Y,G);for(let $=0;$<Math.abs(F-Z);$++){let V=i4(q,Y)==="A"?-1:1;G.buffer.lines.get(F+V*$)?.isWrapped&&H++}return H}function e0(q,Y){let G=0,H=Y.buffer.lines.get(q),F=H?.isWrapped;for(;F&&q>=0&&q<Y.rows;)G++,H=Y.buffer.lines.get(--q),F=H?.isWrapped;return G}function p7(q,Y,G,H,F,Z){let $;return V2(G,H,F,Z).length>0?$=H-e0(H,F):$=Y,q<G&&$<=H||q>=G&&$<H?"C":"D"}function i4(q,Y){return q>Y?"A":"B"}function t4(q,Y,G,H,F,Z){let $=q,V=Y,X="";for(;($!==G||V!==H)&&V>=0&&V<Z.buffer.lines.length;)$+=F?1:-1,F&&$>Z.cols-1?(X+=Z.buffer.translateBufferLineToString(V,!1,q,$),$=0,q=0,V++):!F&&$<0&&(X+=Z.buffer.translateBufferLineToString(V,!1,0,q+1),$=Z.cols-1,q=$,V--);return X+Z.buffer.translateBufferLineToString(V,!1,q,$)}function x1(q,Y){let G=Y?"O":"[";return U.ESC+G+q}function y1(q,Y){q=Math.floor(q);let G="";for(let H=0;H<q;H++)G+=Y;return G}var m7=class{constructor(q){this._bufferService=q,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:!this.selectionEnd||!this.selectionStart?this.selectionStart:this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){let q=this.selectionStart[0]+this.selectionStartLength;return q>this._bufferService.cols?q%this._bufferService.cols===0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(q/this._bufferService.cols)-1]:[q%this._bufferService.cols,this.selectionStart[1]+Math.floor(q/this._bufferService.cols)]:[q,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){let q=this.selectionStart[0]+this.selectionStartLength;return q>this._bufferService.cols?[q%this._bufferService.cols,this.selectionStart[1]+Math.floor(q/this._bufferService.cols)]:[Math.max(q,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){let q=this.selectionStart,Y=this.selectionEnd;return!q||!Y?!1:q[1]>Y[1]||q[1]===Y[1]&&q[0]>Y[0]}handleTrim(q){return this.selectionStart&&(this.selectionStart[1]-=q),this.selectionEnd&&(this.selectionEnd[1]-=q),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}};function l3(q,Y){if(q.start.y>q.end.y)throw Error(`Buffer range end (${q.end.x}, ${q.end.y}) cannot be before start (${q.start.x}, ${q.start.y})`);return Y*(q.end.y-q.start.y)+(q.end.x-q.start.x+1)}var R2=50,g7=15,h7=50,d7=500,u7="",c7=new RegExp(u7,"g"),n2=class extends S{constructor(q,Y,G,H,F,Z,$,V,X){super();this._element=q,this._screenElement=Y,this._linkifier=G,this._bufferService=H,this._coreService=F,this._mouseService=Z,this._optionsService=$,this._renderService=V,this._coreBrowserService=X,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new B0,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this._register(new B),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this._register(new B),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this._register(new B),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this._register(new B),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=(J)=>this._handleMouseMove(J),this._mouseUpListener=(J)=>this._handleMouseUp(J),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim((J)=>this._handleTrim(J)),this._register(this._bufferService.buffers.onBufferActivate((J)=>this._handleBufferActivate(J))),this.enable(),this._model=new m7(this._bufferService),this._activeSelectionMode=0,this._register(m(()=>{this._removeMouseDownListeners()})),this._register(this._bufferService.onResize((J)=>{J.rowsChanged&&this.clearSelection()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){let q=this._model.finalSelectionStart,Y=this._model.finalSelectionEnd;return!q||!Y?!1:q[0]!==Y[0]||q[1]!==Y[1]}get selectionText(){let q=this._model.finalSelectionStart,Y=this._model.finalSelectionEnd;if(!q||!Y)return"";let G=this._bufferService.buffer,H=[];if(this._activeSelectionMode===3){if(q[0]===Y[0])return"";let F=q[0]<Y[0]?q[0]:Y[0],Z=q[0]<Y[0]?Y[0]:q[0];for(let $=q[1];$<=Y[1];$++){let V=G.translateBufferLineToString($,!0,F,Z);H.push(V)}}else{let F=q[1]===Y[1]?Y[0]:void 0;H.push(G.translateBufferLineToString(q[1],!0,q[0],F));for(let Z=q[1]+1;Z<=Y[1]-1;Z++){let $=G.lines.get(Z),V=G.translateBufferLineToString(Z,!0);$?.isWrapped?H[H.length-1]+=V:H.push(V)}if(q[1]!==Y[1]){let Z=G.lines.get(Y[1]),$=G.translateBufferLineToString(Y[1],!0,0,Y[0]);Z&&Z.isWrapped?H[H.length-1]+=$:H.push($)}}return H.map((F)=>F.replace(c7," ")).join(n4?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(q){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),j3&&q&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(q){let Y=this._getMouseBufferCoords(q),G=this._model.finalSelectionStart,H=this._model.finalSelectionEnd;return!G||!H||!Y?!1:this._areCoordsInSelection(Y,G,H)}isCellInSelection(q,Y){let G=this._model.finalSelectionStart,H=this._model.finalSelectionEnd;return!G||!H?!1:this._areCoordsInSelection([q,Y],G,H)}_areCoordsInSelection(q,Y,G){return q[1]>Y[1]&&q[1]<G[1]||Y[1]===G[1]&&q[1]===Y[1]&&q[0]>=Y[0]&&q[0]<G[0]||Y[1]<G[1]&&q[1]===G[1]&&q[0]<G[0]||Y[1]<G[1]&&q[1]===Y[1]&&q[0]>=Y[0]}_selectWordAtCursor(q,Y){let G=this._linkifier.currentLink?.link?.range;if(G)return this._model.selectionStart=[G.start.x-1,G.start.y-1],this._model.selectionStartLength=l3(G,this._bufferService.cols),this._model.selectionEnd=void 0,!0;let H=this._getMouseBufferCoords(q);return H?(this._selectWordAt(H,Y),this._model.selectionEnd=void 0,!0):!1}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(q,Y){this._model.clearSelection(),q=Math.max(q,0),Y=Math.min(Y,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,q],this._model.selectionEnd=[this._bufferService.cols,Y],this.refresh(),this._onSelectionChange.fire()}_handleTrim(q){this._model.handleTrim(q)&&this.refresh()}_getMouseBufferCoords(q){let Y=this._mouseService.getCoords(q,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(Y)return Y[0]--,Y[1]--,Y[1]+=this._bufferService.buffer.ydisp,Y}_getMouseEventScrollAmount(q){let Y=M3(this._coreBrowserService.window,q,this._screenElement)[1],G=this._renderService.dimensions.css.canvas.height;return Y>=0&&Y<=G?0:(Y>G&&(Y-=G),Y=Math.min(Math.max(Y,-R2),R2),Y/=R2,Y/Math.abs(Y)+Math.round(Y*(g7-1)))}shouldForceSelection(q){return q2?q.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:q.shiftKey}handleMouseDown(q){if(this._mouseDownTimeStamp=q.timeStamp,!(q.button===2&&this.hasSelection)&&q.button===0){if(!this._enabled){if(!this.shouldForceSelection(q))return;q.stopPropagation()}q.preventDefault(),this._dragScrollAmount=0,this._enabled&&q.shiftKey?this._handleIncrementalClick(q):q.detail===1?this._handleSingleClick(q):q.detail===2?this._handleDoubleClick(q):q.detail===3&&this._handleTripleClick(q),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),h7)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(q){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(q))}_handleSingleClick(q){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(q)?3:0,this._model.selectionStart=this._getMouseBufferCoords(q),!this._model.selectionStart)return;this._model.selectionEnd=void 0;let Y=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);Y&&Y.length!==this._model.selectionStart[0]&&Y.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(q){this._selectWordAtCursor(q,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(q){let Y=this._getMouseBufferCoords(q);Y&&(this._activeSelectionMode=2,this._selectLineAt(Y[1]))}shouldColumnSelect(q){return q.altKey&&!(q2&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(q){if(q.stopImmediatePropagation(),!this._model.selectionStart)return;let Y=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(q),!this._model.selectionEnd){this.refresh(!0);return}this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(q),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));let G=this._bufferService.buffer;if(this._model.selectionEnd[1]<G.lines.length){let H=G.lines.get(this._model.selectionEnd[1]);H&&H.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}(!Y||Y[0]!==this._model.selectionEnd[0]||Y[1]!==this._model.selectionEnd[1])&&this.refresh(!0)}_dragScroll(){if(!(!this._model.selectionEnd||!this._model.selectionStart)&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});let q=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(q.ydisp+this._bufferService.rows,q.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=q.ydisp),this.refresh()}}_handleMouseUp(q){let Y=q.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&Y<d7&&q.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){let G=this._mouseService.getCoords(q,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(G&&G[0]!==void 0&&G[1]!==void 0){let H=T7(G[0]-1,G[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(H,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){let q=this._model.finalSelectionStart,Y=this._model.finalSelectionEnd,G=!!q&&!!Y&&(q[0]!==Y[0]||q[1]!==Y[1]);if(!G){this._oldHasSelection&&this._fireOnSelectionChange(q,Y,G);return}!q||!Y||(!this._oldSelectionStart||!this._oldSelectionEnd||q[0]!==this._oldSelectionStart[0]||q[1]!==this._oldSelectionStart[1]||Y[0]!==this._oldSelectionEnd[0]||Y[1]!==this._oldSelectionEnd[1])&&this._fireOnSelectionChange(q,Y,G)}_fireOnSelectionChange(q,Y,G){this._oldSelectionStart=q,this._oldSelectionEnd=Y,this._oldHasSelection=G,this._onSelectionChange.fire()}_handleBufferActivate(q){this.clearSelection(),this._trimListener.dispose(),this._trimListener=q.activeBuffer.lines.onTrim((Y)=>this._handleTrim(Y))}_convertViewportColToCharacterIndex(q,Y){let G=Y;for(let H=0;Y>=H;H++){let F=q.loadCell(H,this._workCell).getChars().length;this._workCell.getWidth()===0?G--:F>1&&Y!==H&&(G+=F-1)}return G}setSelection(q,Y,G){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[q,Y],this._model.selectionStartLength=G,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(q){this._isClickInSelection(q)||(this._selectWordAtCursor(q,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(q,Y,G=!0,H=!0){if(q[0]>=this._bufferService.cols)return;let F=this._bufferService.buffer,Z=F.lines.get(q[1]);if(!Z)return;let $=F.translateBufferLineToString(q[1],!1),V=this._convertViewportColToCharacterIndex(Z,q[0]),X=V,J=q[0]-V,M=0,z=0,K=0,W=0;if($.charAt(V)===" "){for(;V>0&&$.charAt(V-1)===" ";)V--;for(;X<$.length&&$.charAt(X+1)===" ";)X++}else{let L=q[0],x=q[0];Z.getWidth(L)===0&&(M++,L--),Z.getWidth(x)===2&&(z++,x++);let v=Z.getString(x).length;for(v>1&&(W+=v-1,X+=v-1);L>0&&V>0&&!this._isCharWordSeparator(Z.loadCell(L-1,this._workCell));){Z.loadCell(L-1,this._workCell);let I=this._workCell.getChars().length;this._workCell.getWidth()===0?(M++,L--):I>1&&(K+=I-1,V-=I-1),V--,L--}for(;x<Z.length&&X+1<$.length&&!this._isCharWordSeparator(Z.loadCell(x+1,this._workCell));){Z.loadCell(x+1,this._workCell);let I=this._workCell.getChars().length;this._workCell.getWidth()===2?(z++,x++):I>1&&(W+=I-1,X+=I-1),X++,x++}}X++;let j=V+J-M+K,C=Math.min(this._bufferService.cols,X-V+M+z-K-W);if(!(!Y&&$.slice(V,X).trim()==="")){if(G&&j===0&&Z.getCodePoint(0)!==32){let L=F.lines.get(q[1]-1);if(L&&Z.isWrapped&&L.getCodePoint(this._bufferService.cols-1)!==32){let x=this._getWordAt([this._bufferService.cols-1,q[1]-1],!1,!0,!1);if(x){let v=this._bufferService.cols-x.start;j-=v,C+=v}}}if(H&&j+C===this._bufferService.cols&&Z.getCodePoint(this._bufferService.cols-1)!==32){let L=F.lines.get(q[1]+1);if(L?.isWrapped&&L.getCodePoint(0)!==32){let x=this._getWordAt([0,q[1]+1],!1,!1,!0);x&&(C+=x.length)}}return{start:j,length:C}}}_selectWordAt(q,Y){let G=this._getWordAt(q,Y);if(G){for(;G.start<0;)G.start+=this._bufferService.cols,q[1]--;this._model.selectionStart=[G.start,q[1]],this._model.selectionStartLength=G.length}}_selectToWordAt(q){let Y=this._getWordAt(q,!0);if(Y){let G=q[1];for(;Y.start<0;)Y.start+=this._bufferService.cols,G--;if(!this._model.areSelectionValuesReversed())for(;Y.start+Y.length>this._bufferService.cols;)Y.length-=this._bufferService.cols,G++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?Y.start:Y.start+Y.length,G]}}_isCharWordSeparator(q){return q.getWidth()===0?!1:this._optionsService.rawOptions.wordSeparator.indexOf(q.getChars())>=0}_selectLineAt(q){let Y=this._bufferService.buffer.getWrappedRangeForLine(q),G={start:{x:0,y:Y.first},end:{x:this._bufferService.cols-1,y:Y.last}};this._model.selectionStart=[0,Y.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=l3(G,this._bufferService.cols)}};n2=a([A(3,X0),A(4,q1),A(5,F3),A(6,z0),A(7,E0),A(8,_0)],n2);var o3=class{constructor(){this._data={}}set(q,Y,G){this._data[q]||(this._data[q]={}),this._data[q][Y]=G}get(q,Y){return this._data[q]?this._data[q][Y]:void 0}clear(){this._data={}}},n3=class{constructor(){this._color=new o3,this._css=new o3}setCss(q,Y,G){this._css.set(q,Y,G)}getCss(q,Y){return this._css.get(q,Y)}setColor(q,Y,G){this._color.set(q,Y,G)}getColor(q,Y){return this._color.get(q,Y)}clear(){this._color.clear(),this._css.clear()}},s=Object.freeze((()=>{let q=[u.toColor("#2e3436"),u.toColor("#cc0000"),u.toColor("#4e9a06"),u.toColor("#c4a000"),u.toColor("#3465a4"),u.toColor("#75507b"),u.toColor("#06989a"),u.toColor("#d3d7cf"),u.toColor("#555753"),u.toColor("#ef2929"),u.toColor("#8ae234"),u.toColor("#fce94f"),u.toColor("#729fcf"),u.toColor("#ad7fa8"),u.toColor("#34e2e2"),u.toColor("#eeeeec")],Y=[0,95,135,175,215,255];for(let G=0;G<216;G++){let H=Y[G/36%6|0],F=Y[G/6%6|0],Z=Y[G%6];q.push({css:n.toCss(H,F,Z),rgba:n.toRgba(H,F,Z)})}for(let G=0;G<24;G++){let H=8+G*10;q.push({css:n.toCss(H,H,H),rgba:n.toRgba(H,H,H)})}return q})()),n0=u.toColor("#ffffff"),R1=u.toColor("#000000"),s3=u.toColor("#ffffff"),r3=R1,W1={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117},a7=n0,s2=class extends S{constructor(q){super();this._optionsService=q,this._contrastCache=new n3,this._halfContrastCache=new n3,this._onChangeColors=this._register(new B),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:n0,background:R1,cursor:s3,cursorAccent:r3,selectionForeground:void 0,selectionBackgroundTransparent:W1,selectionBackgroundOpaque:p.blend(R1,W1),selectionInactiveBackgroundTransparent:W1,selectionInactiveBackgroundOpaque:p.blend(R1,W1),scrollbarSliderBackground:p.opacity(n0,0.2),scrollbarSliderHoverBackground:p.opacity(n0,0.4),scrollbarSliderActiveBackground:p.opacity(n0,0.5),overviewRulerBorder:n0,ansi:s.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this._register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this._register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}get colors(){return this._colors}_setTheme(q={}){let Y=this._colors;if(Y.foreground=f(q.foreground,n0),Y.background=f(q.background,R1),Y.cursor=p.blend(Y.background,f(q.cursor,s3)),Y.cursorAccent=p.blend(Y.background,f(q.cursorAccent,r3)),Y.selectionBackgroundTransparent=f(q.selectionBackground,W1),Y.selectionBackgroundOpaque=p.blend(Y.background,Y.selectionBackgroundTransparent),Y.selectionInactiveBackgroundTransparent=f(q.selectionInactiveBackground,Y.selectionBackgroundTransparent),Y.selectionInactiveBackgroundOpaque=p.blend(Y.background,Y.selectionInactiveBackgroundTransparent),Y.selectionForeground=q.selectionForeground?f(q.selectionForeground,u3):void 0,Y.selectionForeground===u3&&(Y.selectionForeground=void 0),p.isOpaque(Y.selectionBackgroundTransparent)&&(Y.selectionBackgroundTransparent=p.opacity(Y.selectionBackgroundTransparent,0.3)),p.isOpaque(Y.selectionInactiveBackgroundTransparent)&&(Y.selectionInactiveBackgroundTransparent=p.opacity(Y.selectionInactiveBackgroundTransparent,0.3)),Y.scrollbarSliderBackground=f(q.scrollbarSliderBackground,p.opacity(Y.foreground,0.2)),Y.scrollbarSliderHoverBackground=f(q.scrollbarSliderHoverBackground,p.opacity(Y.foreground,0.4)),Y.scrollbarSliderActiveBackground=f(q.scrollbarSliderActiveBackground,p.opacity(Y.foreground,0.5)),Y.overviewRulerBorder=f(q.overviewRulerBorder,a7),Y.ansi=s.slice(),Y.ansi[0]=f(q.black,s[0]),Y.ansi[1]=f(q.red,s[1]),Y.ansi[2]=f(q.green,s[2]),Y.ansi[3]=f(q.yellow,s[3]),Y.ansi[4]=f(q.blue,s[4]),Y.ansi[5]=f(q.magenta,s[5]),Y.ansi[6]=f(q.cyan,s[6]),Y.ansi[7]=f(q.white,s[7]),Y.ansi[8]=f(q.brightBlack,s[8]),Y.ansi[9]=f(q.brightRed,s[9]),Y.ansi[10]=f(q.brightGreen,s[10]),Y.ansi[11]=f(q.brightYellow,s[11]),Y.ansi[12]=f(q.brightBlue,s[12]),Y.ansi[13]=f(q.brightMagenta,s[13]),Y.ansi[14]=f(q.brightCyan,s[14]),Y.ansi[15]=f(q.brightWhite,s[15]),q.extendedAnsi){let G=Math.min(Y.ansi.length-16,q.extendedAnsi.length);for(let H=0;H<G;H++)Y.ansi[H+16]=f(q.extendedAnsi[H],s[H+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(q){this._restoreColor(q),this._onChangeColors.fire(this.colors)}_restoreColor(q){if(q===void 0){for(let Y=0;Y<this._restoreColors.ansi.length;++Y)this._colors.ansi[Y]=this._restoreColors.ansi[Y];return}switch(q){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[q]=this._restoreColors.ansi[q]}}modifyColors(q){q(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};s2=a([A(0,z0)],s2);function f(q,Y){if(q!==void 0)try{return u.toColor(q)}catch{}return Y}var l7=class{constructor(...q){this._entries=new Map;for(let[Y,G]of q)this.set(Y,G)}set(q,Y){let G=this._entries.get(q);return this._entries.set(q,Y),G}forEach(q){for(let[Y,G]of this._entries.entries())q(Y,G)}has(q){return this._entries.has(q)}get(q){return this._entries.get(q)}},o7=class{constructor(){this._services=new l7,this._services.set(H3,this)}setService(q,Y){this._services.set(q,Y)}getService(q){return this._services.get(q)}createInstance(q,...Y){let G=K5(q).sort((Z,$)=>Z.index-$.index),H=[];for(let Z of G){let $=this._services.get(Z.id);if(!$)throw Error(`[createInstance] ${q.name} depends on UNKNOWN service ${Z.id._id}.`);H.push($)}let F=G.length>0?G[0].index:Y.length;if(Y.length!==F)throw Error(`[createInstance] First service dependency of ${q.name} at position ${F+1} conflicts with ${Y.length} static arguments`);return new q(...Y,...H)}},n7={trace:0,debug:1,info:2,warn:3,error:4,off:5},s7="xterm.js: ",r2=class extends S{constructor(q){super();this._optionsService=q,this._logLevel=5,this._updateLogLevel(),this._register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),r7=this}get logLevel(){return this._logLevel}_updateLogLevel(){this._logLevel=n7[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(q){for(let Y=0;Y<q.length;Y++)typeof q[Y]=="function"&&(q[Y]=q[Y]())}_log(q,Y,G){this._evalLazyOptionalParams(G),q.call(console,(this._optionsService.options.logger?"":s7)+Y,...G)}trace(q,...Y){this._logLevel<=0&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,q,Y)}debug(q,...Y){this._logLevel<=1&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,q,Y)}info(q,...Y){this._logLevel<=2&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,q,Y)}warn(q,...Y){this._logLevel<=3&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,q,Y)}error(q,...Y){this._logLevel<=4&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,q,Y)}};r2=a([A(0,z0)],r2);var r7,i3=class extends S{constructor(q){super();this._maxLength=q,this.onDeleteEmitter=this._register(new B),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this._register(new B),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this._register(new B),this.onTrim=this.onTrimEmitter.event,this._array=Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(q){if(this._maxLength===q)return;let Y=Array(q);for(let G=0;G<Math.min(q,this.length);G++)Y[G]=this._array[this._getCyclicIndex(G)];this._array=Y,this._maxLength=q,this._startIndex=0}get length(){return this._length}set length(q){if(q>this._length)for(let Y=this._length;Y<q;Y++)this._array[Y]=void 0;this._length=q}get(q){return this._array[this._getCyclicIndex(q)]}set(q,Y){this._array[this._getCyclicIndex(q)]=Y}push(q){this._array[this._getCyclicIndex(this._length)]=q,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(q,Y,...G){if(Y){for(let H=q;H<this._length-Y;H++)this._array[this._getCyclicIndex(H)]=this._array[this._getCyclicIndex(H+Y)];this._length-=Y,this.onDeleteEmitter.fire({index:q,amount:Y})}for(let H=this._length-1;H>=q;H--)this._array[this._getCyclicIndex(H+G.length)]=this._array[this._getCyclicIndex(H)];for(let H=0;H<G.length;H++)this._array[this._getCyclicIndex(q+H)]=G[H];if(G.length&&this.onInsertEmitter.fire({index:q,amount:G.length}),this._length+G.length>this._maxLength){let H=this._length+G.length-this._maxLength;this._startIndex+=H,this._length=this._maxLength,this.onTrimEmitter.fire(H)}else this._length+=G.length}trimStart(q){q>this._length&&(q=this._length),this._startIndex+=q,this._length-=q,this.onTrimEmitter.fire(q)}shiftElements(q,Y,G){if(!(Y<=0)){if(q<0||q>=this._length)throw Error("start argument out of range");if(q+G<0)throw Error("Cannot shift elements in list beyond index 0");if(G>0){for(let F=Y-1;F>=0;F--)this.set(q+F+G,this.get(q+F));let H=q+Y+G-this._length;if(H>0)for(this._length+=H;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let H=0;H<Y;H++)this.set(q+H+G,this.get(q+H))}}_getCyclicIndex(q){return(this._startIndex+q)%this._maxLength}},w=3,o=Object.freeze(new w1),m1=0,A2=2,A1=class q{constructor(Y,G,H=!1){this.isWrapped=H,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(Y*w);let F=G||B0.fromCharData([0,A4,1,0]);for(let Z=0;Z<Y;++Z)this.setCell(Z,F);this.length=Y}get(Y){let G=this._data[Y*w+0],H=G&2097151;return[this._data[Y*w+1],G&2097152?this._combined[Y]:H?u0(H):"",G>>22,G&2097152?this._combined[Y].charCodeAt(this._combined[Y].length-1):H]}set(Y,G){this._data[Y*w+1]=G[0],G[1].length>1?(this._combined[Y]=G[1],this._data[Y*w+0]=Y|2097152|G[2]<<22):this._data[Y*w+0]=G[1].charCodeAt(0)|G[2]<<22}getWidth(Y){return this._data[Y*w+0]>>22}hasWidth(Y){return this._data[Y*w+0]&12582912}getFg(Y){return this._data[Y*w+1]}getBg(Y){return this._data[Y*w+2]}hasContent(Y){return this._data[Y*w+0]&4194303}getCodePoint(Y){let G=this._data[Y*w+0];return G&2097152?this._combined[Y].charCodeAt(this._combined[Y].length-1):G&2097151}isCombined(Y){return this._data[Y*w+0]&2097152}getString(Y){let G=this._data[Y*w+0];return G&2097152?this._combined[Y]:G&2097151?u0(G&2097151):""}isProtected(Y){return this._data[Y*w+2]&536870912}loadCell(Y,G){return m1=Y*w,G.content=this._data[m1+0],G.fg=this._data[m1+1],G.bg=this._data[m1+2],G.content&2097152&&(G.combinedData=this._combined[Y]),G.bg&268435456&&(G.extended=this._extendedAttrs[Y]),G}setCell(Y,G){G.content&2097152&&(this._combined[Y]=G.combinedData),G.bg&268435456&&(this._extendedAttrs[Y]=G.extended),this._data[Y*w+0]=G.content,this._data[Y*w+1]=G.fg,this._data[Y*w+2]=G.bg}setCellFromCodepoint(Y,G,H,F){F.bg&268435456&&(this._extendedAttrs[Y]=F.extended),this._data[Y*w+0]=G|H<<22,this._data[Y*w+1]=F.fg,this._data[Y*w+2]=F.bg}addCodepointToCell(Y,G,H){let F=this._data[Y*w+0];F&2097152?this._combined[Y]+=u0(G):F&2097151?(this._combined[Y]=u0(F&2097151)+u0(G),F&=-2097152,F|=2097152):F=G|4194304,H&&(F&=-12582913,F|=H<<22),this._data[Y*w+0]=F}insertCells(Y,G,H){if(Y%=this.length,Y&&this.getWidth(Y-1)===2&&this.setCellFromCodepoint(Y-1,0,1,H),G<this.length-Y){let F=new B0;for(let Z=this.length-Y-G-1;Z>=0;--Z)this.setCell(Y+G+Z,this.loadCell(Y+Z,F));for(let Z=0;Z<G;++Z)this.setCell(Y+Z,H)}else for(let F=Y;F<this.length;++F)this.setCell(F,H);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,H)}deleteCells(Y,G,H){if(Y%=this.length,G<this.length-Y){let F=new B0;for(let Z=0;Z<this.length-Y-G;++Z)this.setCell(Y+Z,this.loadCell(Y+G+Z,F));for(let Z=this.length-G;Z<this.length;++Z)this.setCell(Z,H)}else for(let F=Y;F<this.length;++F)this.setCell(F,H);Y&&this.getWidth(Y-1)===2&&this.setCellFromCodepoint(Y-1,0,1,H),this.getWidth(Y)===0&&!this.hasContent(Y)&&this.setCellFromCodepoint(Y,0,1,H)}replaceCells(Y,G,H,F=!1){if(F){for(Y&&this.getWidth(Y-1)===2&&!this.isProtected(Y-1)&&this.setCellFromCodepoint(Y-1,0,1,H),G<this.length&&this.getWidth(G-1)===2&&!this.isProtected(G)&&this.setCellFromCodepoint(G,0,1,H);Y<G&&Y<this.length;)this.isProtected(Y)||this.setCell(Y,H),Y++;return}for(Y&&this.getWidth(Y-1)===2&&this.setCellFromCodepoint(Y-1,0,1,H),G<this.length&&this.getWidth(G-1)===2&&this.setCellFromCodepoint(G,0,1,H);Y<G&&Y<this.length;)this.setCell(Y++,H)}resize(Y,G){if(Y===this.length)return this._data.length*4*A2<this._data.buffer.byteLength;let H=Y*w;if(Y>this.length){if(this._data.buffer.byteLength>=H*4)this._data=new Uint32Array(this._data.buffer,0,H);else{let F=new Uint32Array(H);F.set(this._data),this._data=F}for(let F=this.length;F<Y;++F)this.setCell(F,G)}else{this._data=this._data.subarray(0,H);let F=Object.keys(this._combined);for(let $=0;$<F.length;$++){let V=parseInt(F[$],10);V>=Y&&delete this._combined[V]}let Z=Object.keys(this._extendedAttrs);for(let $=0;$<Z.length;$++){let V=parseInt(Z[$],10);V>=Y&&delete this._extendedAttrs[V]}}return this.length=Y,H*4*A2<this._data.buffer.byteLength}cleanupMemory(){if(this._data.length*4*A2<this._data.buffer.byteLength){let Y=new Uint32Array(this._data.length);return Y.set(this._data),this._data=Y,1}return 0}fill(Y,G=!1){if(G){for(let H=0;H<this.length;++H)this.isProtected(H)||this.setCell(H,Y);return}this._combined={},this._extendedAttrs={};for(let H=0;H<this.length;++H)this.setCell(H,Y)}copyFrom(Y){this.length!==Y.length?this._data=new Uint32Array(Y._data):this._data.set(Y._data),this.length=Y.length,this._combined={};for(let G in Y._combined)this._combined[G]=Y._combined[G];this._extendedAttrs={};for(let G in Y._extendedAttrs)this._extendedAttrs[G]=Y._extendedAttrs[G];this.isWrapped=Y.isWrapped}clone(){let Y=new q(0);Y._data=new Uint32Array(this._data),Y.length=this.length;for(let G in this._combined)Y._combined[G]=this._combined[G];for(let G in this._extendedAttrs)Y._extendedAttrs[G]=this._extendedAttrs[G];return Y.isWrapped=this.isWrapped,Y}getTrimmedLength(){for(let Y=this.length-1;Y>=0;--Y)if(this._data[Y*w+0]&4194303)return Y+(this._data[Y*w+0]>>22);return 0}getNoBgTrimmedLength(){for(let Y=this.length-1;Y>=0;--Y)if(this._data[Y*w+0]&4194303||this._data[Y*w+2]&50331648)return Y+(this._data[Y*w+0]>>22);return 0}copyCellsFrom(Y,G,H,F,Z){let $=Y._data;if(Z)for(let X=F-1;X>=0;X--){for(let J=0;J<w;J++)this._data[(H+X)*w+J]=$[(G+X)*w+J];$[(G+X)*w+2]&268435456&&(this._extendedAttrs[H+X]=Y._extendedAttrs[G+X])}else for(let X=0;X<F;X++){for(let J=0;J<w;J++)this._data[(H+X)*w+J]=$[(G+X)*w+J];$[(G+X)*w+2]&268435456&&(this._extendedAttrs[H+X]=Y._extendedAttrs[G+X])}let V=Object.keys(Y._combined);for(let X=0;X<V.length;X++){let J=parseInt(V[X],10);J>=G&&(this._combined[J-G+H]=Y._combined[J])}}translateToString(Y,G,H,F){G=G??0,H=H??this.length,Y&&(H=Math.min(H,this.getTrimmedLength())),F&&(F.length=0);let Z="";for(;G<H;){let $=this._data[G*w+0],V=$&2097151,X=$&2097152?this._combined[G]:V?u0(V):c0;if(Z+=X,F)for(let J=0;J<X.length;++J)F.push(G);G+=$>>22||1}return F&&F.push(G),Z}};function i7(q,Y,G,H,F,Z){let $=[];for(let V=0;V<q.length-1;V++){let X=V,J=q.get(++X);if(!J.isWrapped)continue;let M=[q.get(V)];for(;X<q.length&&J.isWrapped;)M.push(J),J=q.get(++X);if(!Z&&H>=V&&H<X){V+=M.length-1;continue}let z=0,K=S1(M,z,Y),W=1,j=0;for(;W<M.length;){let L=S1(M,W,Y),x=L-j,v=G-K,I=Math.min(x,v);M[z].copyCellsFrom(M[W],j,K,I,!1),K+=I,K===G&&(z++,K=0),j+=I,j===L&&(W++,j=0),K===0&&z!==0&&M[z-1].getWidth(G-1)===2&&(M[z].copyCellsFrom(M[z-1],G-1,K++,1,!1),M[z-1].setCell(G-1,F))}M[z].replaceCells(K,G,F);let C=0;for(let L=M.length-1;L>0&&(L>z||M[L].getTrimmedLength()===0);L--)C++;C>0&&($.push(V+M.length-C),$.push(C)),V+=M.length-1}return $}function t7(q,Y){let G=[],H=0,F=Y[H],Z=0;for(let $=0;$<q.length;$++)if(F===$){let V=Y[++H];q.onDeleteEmitter.fire({index:$-Z,amount:V}),$+=V-1,Z+=V,F=Y[++H]}else G.push($);return{layout:G,countRemoved:Z}}function e7(q,Y){let G=[];for(let H=0;H<Y.length;H++)G.push(q.get(Y[H]));for(let H=0;H<G.length;H++)q.set(H,G[H]);q.length=Y.length}function q8(q,Y,G){let H=[],F=q.map((X,J)=>S1(q,J,Y)).reduce((X,J)=>X+J),Z=0,$=0,V=0;for(;V<F;){if(F-V<G){H.push(F-V);break}Z+=G;let X=S1(q,$,Y);Z>X&&(Z-=X,$++);let J=q[$].getWidth(Z-1)===2;J&&Z--;let M=J?G-1:G;H.push(M),V+=M}return H}function S1(q,Y,G){if(Y===q.length-1)return q[Y].getTrimmedLength();let H=!q[Y].hasContent(G-1)&&q[Y].getWidth(G-1)===1,F=q[Y+1].getWidth(0)===2;return H&&F?G-1:G}var e4=class q{constructor(Y){this.line=Y,this.isDisposed=!1,this._disposables=[],this._id=q._nextId++,this._onDispose=this.register(new B),this.onDispose=this._onDispose.event}get id(){return this._id}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),t0(this._disposables),this._disposables.length=0)}register(Y){return this._disposables.push(Y),Y}};e4._nextId=1;var Y8=e4,i={},s0=i.B;i[0]={"`":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:"","{":"","|":"","}":"","~":""};i.A={"#":""};i.B=void 0;i[4]={"#":"","@":"","[":"ij","\\":"","]":"|","{":"","|":"f","}":"","~":""};i.C=i[5]={"[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};i.R={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""};i.Q={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};i.K={"@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""};i.Y={"#":"","@":"","[":"","\\":"","]":"","`":"","{":"","|":"","}":"","~":""};i.E=i[6]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};i.Z={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":""};i.H=i[7]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};i["="]={"#":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":""};var t3=4294967295,e3=class{constructor(q,Y,G){this._hasScrollback=q,this._optionsService=Y,this._bufferService=G,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=o.clone(),this.savedCharset=s0,this.markers=[],this._nullCell=B0.fromCharData([0,A4,1,0]),this._whitespaceCell=B0.fromCharData([0,c0,1,32]),this._isClearing=!1,this._memoryCleanupQueue=new Y2,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new i3(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(q){return q?(this._nullCell.fg=q.fg,this._nullCell.bg=q.bg,this._nullCell.extended=q.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new n1),this._nullCell}getWhitespaceCell(q){return q?(this._whitespaceCell.fg=q.fg,this._whitespaceCell.bg=q.bg,this._whitespaceCell.extended=q.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new n1),this._whitespaceCell}getBlankLine(q,Y){return new A1(this._bufferService.cols,this.getNullCell(q),Y)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let q=this.ybase+this.y-this.ydisp;return q>=0&&q<this._rows}_getCorrectBufferLength(q){if(!this._hasScrollback)return q;let Y=q+this._optionsService.rawOptions.scrollback;return Y>t3?t3:Y}fillViewportRows(q){if(this.lines.length===0){q===void 0&&(q=o);let Y=this._rows;for(;Y--;)this.lines.push(this.getBlankLine(q))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new i3(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(q,Y){let G=this.getNullCell(o),H=0,F=this._getCorrectBufferLength(Y);if(F>this.lines.maxLength&&(this.lines.maxLength=F),this.lines.length>0){if(this._cols<q)for(let $=0;$<this.lines.length;$++)H+=+this.lines.get($).resize(q,G);let Z=0;if(this._rows<Y)for(let $=this._rows;$<Y;$++)this.lines.length<Y+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new A1(q,G)):this.ybase>0&&this.lines.length<=this.ybase+this.y+Z+1?(this.ybase--,Z++,this.ydisp>0&&this.ydisp--):this.lines.push(new A1(q,G)));else for(let $=this._rows;$>Y;$--)this.lines.length>Y+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(F<this.lines.maxLength){let $=this.lines.length-F;$>0&&(this.lines.trimStart($),this.ybase=Math.max(this.ybase-$,0),this.ydisp=Math.max(this.ydisp-$,0),this.savedY=Math.max(this.savedY-$,0)),this.lines.maxLength=F}this.x=Math.min(this.x,q-1),this.y=Math.min(this.y,Y-1),Z&&(this.y+=Z),this.savedX=Math.min(this.savedX,q-1),this.scrollTop=0}if(this.scrollBottom=Y-1,this._isReflowEnabled&&(this._reflow(q,Y),this._cols>q))for(let Z=0;Z<this.lines.length;Z++)H+=+this.lines.get(Z).resize(q,G);this._cols=q,this._rows=Y,this._memoryCleanupQueue.clear(),H>0.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let q=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,q=!1);let Y=0;for(;this._memoryCleanupPosition<this.lines.length;)if(Y+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),Y>100)return!0;return q}get _isReflowEnabled(){let q=this._optionsService.rawOptions.windowsPty;return q&&q.buildNumber?this._hasScrollback&&q.backend==="conpty"&&q.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(q,Y){this._cols!==q&&(q>this._cols?this._reflowLarger(q,Y):this._reflowSmaller(q,Y))}_reflowLarger(q,Y){let G=this._optionsService.rawOptions.reflowCursorLine,H=i7(this.lines,this._cols,q,this.ybase+this.y,this.getNullCell(o),G);if(H.length>0){let F=t7(this.lines,H);e7(this.lines,F.layout),this._reflowLargerAdjustViewport(q,Y,F.countRemoved)}}_reflowLargerAdjustViewport(q,Y,G){let H=this.getNullCell(o),F=G;for(;F-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<Y&&this.lines.push(new A1(q,H))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-G,0)}_reflowSmaller(q,Y){let G=this._optionsService.rawOptions.reflowCursorLine,H=this.getNullCell(o),F=[],Z=0;for(let $=this.lines.length-1;$>=0;$--){let V=this.lines.get($);if(!V||!V.isWrapped&&V.getTrimmedLength()<=q)continue;let X=[V];for(;V.isWrapped&&$>0;)V=this.lines.get(--$),X.unshift(V);if(!G){let I=this.ybase+this.y;if(I>=$&&I<$+X.length)continue}let J=X[X.length-1].getTrimmedLength(),M=q8(X,this._cols,q),z=M.length-X.length,K;this.ybase===0&&this.y!==this.lines.length-1?K=Math.max(0,this.y-this.lines.maxLength+z):K=Math.max(0,this.lines.length-this.lines.maxLength+z);let W=[];for(let I=0;I<z;I++){let P=this.getBlankLine(o,!0);W.push(P)}W.length>0&&(F.push({start:$+X.length+Z,newLines:W}),Z+=W.length),X.push(...W);let j=M.length-1,C=M[j];C===0&&(j--,C=M[j]);let L=X.length-z-1,x=J;for(;L>=0;){let I=Math.min(x,C);if(X[j]===void 0)break;if(X[j].copyCellsFrom(X[L],x-I,C-I,I,!0),C-=I,C===0&&(j--,C=M[j]),x-=I,x===0){L--;let P=Math.max(L,0);x=S1(X,P,this._cols)}}for(let I=0;I<X.length;I++)M[I]<q&&X[I].setCell(M[I],H);let v=z-K;for(;v-- >0;)this.ybase===0?this.y<Y-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+Z)-Y&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+z,this.ybase+Y-1)}if(F.length>0){let $=[],V=[];for(let C=0;C<this.lines.length;C++)V.push(this.lines.get(C));let X=this.lines.length,J=X-1,M=0,z=F[M];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+Z);let K=0;for(let C=Math.min(this.lines.maxLength-1,X+Z-1);C>=0;C--)if(z&&z.start>J+K){for(let L=z.newLines.length-1;L>=0;L--)this.lines.set(C--,z.newLines[L]);C++,$.push({index:J+1,amount:z.newLines.length}),K+=z.newLines.length,z=F[++M]}else this.lines.set(C,V[J--]);let W=0;for(let C=$.length-1;C>=0;C--)$[C].index+=W,this.lines.onInsertEmitter.fire($[C]),W+=$[C].amount;let j=Math.max(0,X+Z-this.lines.maxLength);j>0&&this.lines.onTrimEmitter.fire(j)}}translateBufferLineToString(q,Y,G=0,H){let F=this.lines.get(q);return F?F.translateToString(Y,G,H):""}getWrappedRangeForLine(q){let Y=q,G=q;for(;Y>0&&this.lines.get(Y).isWrapped;)Y--;for(;G+1<this.lines.length&&this.lines.get(G+1).isWrapped;)G++;return{first:Y,last:G}}setupTabStops(q){for(q!=null?this.tabs[q]||(q=this.prevStop(q)):(this.tabs={},q=0);q<this._cols;q+=this._optionsService.rawOptions.tabStopWidth)this.tabs[q]=!0}prevStop(q){for(q==null&&(q=this.x);!this.tabs[--q]&&q>0;);return q>=this._cols?this._cols-1:q<0?0:q}nextStop(q){for(q==null&&(q=this.x);!this.tabs[++q]&&q<this._cols;);return q>=this._cols?this._cols-1:q<0?0:q}clearMarkers(q){this._isClearing=!0;for(let Y=0;Y<this.markers.length;Y++)this.markers[Y].line===q&&(this.markers[Y].dispose(),this.markers.splice(Y--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let q=0;q<this.markers.length;q++)this.markers[q].dispose();this.markers.length=0,this._isClearing=!1}addMarker(q){let Y=new Y8(q);return this.markers.push(Y),Y.register(this.lines.onTrim((G)=>{Y.line-=G,Y.line<0&&Y.dispose()})),Y.register(this.lines.onInsert((G)=>{Y.line>=G.index&&(Y.line+=G.amount)})),Y.register(this.lines.onDelete((G)=>{Y.line>=G.index&&Y.line<G.index+G.amount&&Y.dispose(),Y.line>G.index&&(Y.line-=G.amount)})),Y.register(Y.onDispose(()=>this._removeMarker(Y))),Y}_removeMarker(q){this._isClearing||this.markers.splice(this.markers.indexOf(q),1)}},G8=class extends S{constructor(q,Y){super();this._optionsService=q,this._bufferService=Y,this._onBufferActivate=this._register(new B),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this._register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this._register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new e3(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new e3(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(q){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(q),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(q,Y){this._normal.resize(q,Y),this._alt.resize(q,Y),this.setupTabStops(q)}setupTabStops(q){this._normal.setupTabStops(q),this._alt.setupTabStops(q)}},q5=2,Y5=1,i2=class extends S{constructor(q){super();this.isUserScrolling=!1,this._onResize=this._register(new B),this.onResize=this._onResize.event,this._onScroll=this._register(new B),this.onScroll=this._onScroll.event,this.cols=Math.max(q.rawOptions.cols||0,q5),this.rows=Math.max(q.rawOptions.rows||0,Y5),this.buffers=this._register(new G8(q,this)),this._register(this.buffers.onBufferActivate((Y)=>{this._onScroll.fire(Y.activeBuffer.ydisp)}))}get buffer(){return this.buffers.active}resize(q,Y){let G=this.cols!==q,H=this.rows!==Y;this.cols=q,this.rows=Y,this.buffers.resize(q,Y),this._onResize.fire({cols:q,rows:Y,colsChanged:G,rowsChanged:H})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(q,Y=!1){let G=this.buffer,H;H=this._cachedBlankLine,(!H||H.length!==this.cols||H.getFg(0)!==q.fg||H.getBg(0)!==q.bg)&&(H=G.getBlankLine(q,Y),this._cachedBlankLine=H),H.isWrapped=Y;let F=G.ybase+G.scrollTop,Z=G.ybase+G.scrollBottom;if(G.scrollTop===0){let $=G.lines.isFull;Z===G.lines.length-1?$?G.lines.recycle().copyFrom(H):G.lines.push(H.clone()):G.lines.splice(Z+1,0,H.clone()),$?this.isUserScrolling&&(G.ydisp=Math.max(G.ydisp-1,0)):(G.ybase++,this.isUserScrolling||G.ydisp++)}else{let $=Z-F+1;G.lines.shiftElements(F+1,$-1,-1),G.lines.set(Z,H.clone())}this.isUserScrolling||(G.ydisp=G.ybase),this._onScroll.fire(G.ydisp)}scrollLines(q,Y){let G=this.buffer;if(q<0){if(G.ydisp===0)return;this.isUserScrolling=!0}else q+G.ydisp>=G.ybase&&(this.isUserScrolling=!1);let H=G.ydisp;G.ydisp=Math.max(Math.min(G.ydisp+q,G.ybase),0),H!==G.ydisp&&(Y||this._onScroll.fire(G.ydisp))}};i2=a([A(0,z0)],i2);var G1={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1000,scrollOnEraseInDisplay:!1,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},reflowCursorLine:!1,rescaleOverlappingGlyphs:!1,rightClickSelectsWord:q2,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRuler:{}},H8=["normal","bold","100","200","300","400","500","600","700","800","900"],F8=class extends S{constructor(q){super();this._onOptionChange=this._register(new B),this.onOptionChange=this._onOptionChange.event;let Y={...G1};for(let G in q)if(G in Y)try{let H=q[G];Y[G]=this._sanitizeAndValidateOption(G,H)}catch(H){console.error(H)}this.rawOptions=Y,this.options={...Y},this._setupOptions(),this._register(m(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange(q,Y){return this.onOptionChange((G)=>{G===q&&Y(this.rawOptions[q])})}onMultipleOptionChange(q,Y){return this.onOptionChange((G)=>{q.indexOf(G)!==-1&&Y()})}_setupOptions(){let q=(G)=>{if(!(G in G1))throw Error(`No option with key "${G}"`);return this.rawOptions[G]},Y=(G,H)=>{if(!(G in G1))throw Error(`No option with key "${G}"`);H=this._sanitizeAndValidateOption(G,H),this.rawOptions[G]!==H&&(this.rawOptions[G]=H,this._onOptionChange.fire(G))};for(let G in this.rawOptions){let H={get:q.bind(this,G),set:Y.bind(this,G)};Object.defineProperty(this.options,G,H)}}_sanitizeAndValidateOption(q,Y){switch(q){case"cursorStyle":if(Y||(Y=G1[q]),!Z8(Y))throw Error(`"${Y}" is not a valid value for ${q}`);break;case"wordSeparator":Y||(Y=G1[q]);break;case"fontWeight":case"fontWeightBold":if(typeof Y=="number"&&1<=Y&&Y<=1000)break;Y=H8.includes(Y)?Y:G1[q];break;case"cursorWidth":Y=Math.floor(Y);case"lineHeight":case"tabStopWidth":if(Y<1)throw Error(`${q} cannot be less than 1, value: ${Y}`);break;case"minimumContrastRatio":Y=Math.max(1,Math.min(21,Math.round(Y*10)/10));break;case"scrollback":if(Y=Math.min(Y,4294967295),Y<0)throw Error(`${q} cannot be less than 0, value: ${Y}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(Y<=0)throw Error(`${q} cannot be less than or equal to 0, value: ${Y}`);break;case"rows":case"cols":if(!Y&&Y!==0)throw Error(`${q} must be numeric, value: ${Y}`);break;case"windowsPty":Y=Y??{};break}return Y}};function Z8(q){return q==="block"||q==="underline"||q==="bar"}function k1(q,Y=5){if(typeof q!="object")return q;let G=Array.isArray(q)?[]:{};for(let H in q)G[H]=Y<=1?q[H]:q[H]&&k1(q[H],Y-1);return G}var q4=Object.freeze({insertMode:!1}),Y4=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,cursorBlink:void 0,cursorStyle:void 0,origin:!1,reverseWraparound:!1,sendFocus:!1,synchronizedOutput:!1,wraparound:!0}),t2=class extends S{constructor(q,Y,G){super();this._bufferService=q,this._logService=Y,this._optionsService=G,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this._register(new B),this.onData=this._onData.event,this._onUserInput=this._register(new B),this.onUserInput=this._onUserInput.event,this._onBinary=this._register(new B),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this._register(new B),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=k1(q4),this.decPrivateModes=k1(Y4)}reset(){this.modes=k1(q4),this.decPrivateModes=k1(Y4)}triggerDataEvent(q,Y=!1){if(this._optionsService.rawOptions.disableStdin)return;let G=this._bufferService.buffer;Y&&this._optionsService.rawOptions.scrollOnUserInput&&G.ybase!==G.ydisp&&this._onRequestScrollToBottom.fire(),Y&&this._onUserInput.fire(),this._logService.debug(`sending data "${q}"`),this._logService.trace("sending data (codes)",()=>q.split("").map((H)=>H.charCodeAt(0))),this._onData.fire(q)}triggerBinaryEvent(q){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${q}"`),this._logService.trace("sending binary (codes)",()=>q.split("").map((Y)=>Y.charCodeAt(0))),this._onBinary.fire(q))}};t2=a([A(0,X0),A(1,L4),A(2,z0)],t2);var G4={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:(q)=>q.button===4||q.action!==1?!1:(q.ctrl=!1,q.alt=!1,q.shift=!1,!0)},VT200:{events:19,restrict:(q)=>q.action!==32},DRAG:{events:23,restrict:(q)=>!(q.action===32&&q.button===3)},ANY:{events:31,restrict:(q)=>!0}};function k2(q,Y){let G=(q.ctrl?16:0)|(q.shift?4:0)|(q.alt?8:0);return q.button===4?(G|=64,G|=q.action):(G|=q.button&3,q.button&4&&(G|=64),q.button&8&&(G|=128),q.action===32?G|=32:q.action===0&&!Y&&(G|=3)),G}var L2=String.fromCharCode,H4={DEFAULT:(q)=>{let Y=[k2(q,!1)+32,q.col+32,q.row+32];return Y[0]>255||Y[1]>255||Y[2]>255?"":`\x1B[M${L2(Y[0])}${L2(Y[1])}${L2(Y[2])}`},SGR:(q)=>{let Y=q.action===0&&q.button!==4?"m":"M";return`\x1B[<${k2(q,!0)};${q.col};${q.row}${Y}`},SGR_PIXELS:(q)=>{let Y=q.action===0&&q.button!==4?"m":"M";return`\x1B[<${k2(q,!0)};${q.x};${q.y}${Y}`}},e2=class extends S{constructor(q,Y,G){super();this._bufferService=q,this._coreService=Y,this._optionsService=G,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._wheelPartialScroll=0,this._onProtocolChange=this._register(new B),this.onProtocolChange=this._onProtocolChange.event;for(let H of Object.keys(G4))this.addProtocol(H,G4[H]);for(let H of Object.keys(H4))this.addEncoding(H,H4[H]);this.reset()}addProtocol(q,Y){this._protocols[q]=Y}addEncoding(q,Y){this._encodings[q]=Y}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(q){if(!this._protocols[q])throw Error(`unknown protocol "${q}"`);this._activeProtocol=q,this._onProtocolChange.fire(this._protocols[q].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(q){if(!this._encodings[q])throw Error(`unknown encoding "${q}"`);this._activeEncoding=q}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null,this._wheelPartialScroll=0}consumeWheelEvent(q,Y,G){if(q.deltaY===0||q.shiftKey||Y===void 0||G===void 0)return 0;let H=Y/G,F=this._applyScrollModifier(q.deltaY,q);return q.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(F/=H+0,Math.abs(q.deltaY)<50&&(F*=0.3),this._wheelPartialScroll+=F,F=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):q.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(F*=this._bufferService.rows),F}_applyScrollModifier(q,Y){return Y.altKey||Y.ctrlKey||Y.shiftKey?q*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:q*this._optionsService.rawOptions.scrollSensitivity}triggerMouseEvent(q){if(q.col<0||q.col>=this._bufferService.cols||q.row<0||q.row>=this._bufferService.rows||q.button===4&&q.action===32||q.button===3&&q.action!==32||q.button!==4&&(q.action===2||q.action===3)||(q.col++,q.row++,q.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,q,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(q))return!1;let Y=this._encodings[this._activeEncoding](q);return Y&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(Y):this._coreService.triggerDataEvent(Y,!0)),this._lastEvent=q,!0}explainEvents(q){return{down:!!(q&1),up:!!(q&2),drag:!!(q&4),move:!!(q&8),wheel:!!(q&16)}}_equalEvents(q,Y,G){if(G){if(q.x!==Y.x||q.y!==Y.y)return!1}else if(q.col!==Y.col||q.row!==Y.row)return!1;return!(q.button!==Y.button||q.action!==Y.action||q.ctrl!==Y.ctrl||q.alt!==Y.alt||q.shift!==Y.shift)}};e2=a([A(0,X0),A(1,q1),A(2,z0)],e2);var Q2=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],$8=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],r;function J8(q,Y){let G=0,H=Y.length-1,F;if(q<Y[0][0]||q>Y[H][1])return!1;for(;H>=G;)if(F=G+H>>1,q>Y[F][1])G=F+1;else if(q<Y[F][0])H=F-1;else return!0;return!1}var V8=class{constructor(){if(this.version="6",!r){r=new Uint8Array(65536),r.fill(1),r[0]=0,r.fill(0,1,32),r.fill(0,127,160),r.fill(2,4352,4448),r[9001]=2,r[9002]=2,r.fill(2,11904,42192),r[12351]=1,r.fill(2,44032,55204),r.fill(2,63744,64256),r.fill(2,65040,65050),r.fill(2,65072,65136),r.fill(2,65280,65377),r.fill(2,65504,65511);for(let q=0;q<Q2.length;++q)r.fill(0,Q2[q][0],Q2[q][1]+1)}}wcwidth(q){return q<32?0:q<127?1:q<65536?r[q]:J8(q,$8)?0:q>=131072&&q<=196605||q>=196608&&q<=262141?2:1}charProperties(q,Y){let G=this.wcwidth(q),H=G===0&&Y!==0;if(H){let F=r0.extractWidth(Y);F===0?H=!1:F>G&&(G=F)}return r0.createPropertyValue(0,G,H)}},r0=class q{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new B,this.onChange=this._onChange.event;let Y=new V8;this.register(Y),this._active=Y.version,this._activeProvider=Y}static extractShouldJoin(Y){return(Y&1)!==0}static extractWidth(Y){return Y>>1&3}static extractCharKind(Y){return Y>>3}static createPropertyValue(Y,G,H=!1){return(Y&16777215)<<3|(G&3)<<1|(H?1:0)}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(Y){if(!this._providers[Y])throw Error(`unknown Unicode version "${Y}"`);this._active=Y,this._activeProvider=this._providers[Y],this._onChange.fire(Y)}register(Y){this._providers[Y.version]=Y}wcwidth(Y){return this._activeProvider.wcwidth(Y)}getStringCellWidth(Y){let G=0,H=0,F=Y.length;for(let Z=0;Z<F;++Z){let $=Y.charCodeAt(Z);if(55296<=$&&$<=56319){if(++Z>=F)return G+this.wcwidth($);let J=Y.charCodeAt(Z);56320<=J&&J<=57343?$=($-55296)*1024+J-56320+65536:G+=this.wcwidth(J)}let V=this.charProperties($,H),X=q.extractWidth(V);q.extractShouldJoin(V)&&(X-=q.extractWidth(H)),G+=X,H=V}return G}charProperties(Y,G){return this._activeProvider.charProperties(Y,G)}},X8=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(q){this.glevel=q,this.charset=this._charsets[q]}setgCharset(q,Y){this._charsets[q]=Y,this.glevel===q&&(this.charset=Y)}};function F4(q){let Y=q.buffer.lines.get(q.buffer.ybase+q.buffer.y-1)?.get(q.cols-1),G=q.buffer.lines.get(q.buffer.ybase+q.buffer.y);G&&Y&&(G.isWrapped=Y[3]!==0&&Y[3]!==32)}var C1=2147483647,z8=256,G5=class q{constructor(Y=32,G=32){if(this.maxLength=Y,this.maxSubParamsLength=G,G>z8)throw Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(Y),this.length=0,this._subParams=new Int32Array(G),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(Y),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}static fromArray(Y){let G=new q;if(!Y.length)return G;for(let H=Array.isArray(Y[0])?1:0;H<Y.length;++H){let F=Y[H];if(Array.isArray(F))for(let Z=0;Z<F.length;++Z)G.addSubParam(F[Z]);else G.addParam(F)}return G}clone(){let Y=new q(this.maxLength,this.maxSubParamsLength);return Y.params.set(this.params),Y.length=this.length,Y._subParams.set(this._subParams),Y._subParamsLength=this._subParamsLength,Y._subParamsIdx.set(this._subParamsIdx),Y._rejectDigits=this._rejectDigits,Y._rejectSubDigits=this._rejectSubDigits,Y._digitIsSub=this._digitIsSub,Y}toArray(){let Y=[];for(let G=0;G<this.length;++G){Y.push(this.params[G]);let H=this._subParamsIdx[G]>>8,F=this._subParamsIdx[G]&255;F-H>0&&Y.push(Array.prototype.slice.call(this._subParams,H,F))}return Y}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(Y){if(this._digitIsSub=!1,this.length>=this.maxLength){this._rejectDigits=!0;return}if(Y<-1)throw Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=Y>C1?C1:Y}addSubParam(Y){if(this._digitIsSub=!0,!!this.length){if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength){this._rejectSubDigits=!0;return}if(Y<-1)throw Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=Y>C1?C1:Y,this._subParamsIdx[this.length-1]++}}hasSubParams(Y){return(this._subParamsIdx[Y]&255)-(this._subParamsIdx[Y]>>8)>0}getSubParams(Y){let G=this._subParamsIdx[Y]>>8,H=this._subParamsIdx[Y]&255;return H-G>0?this._subParams.subarray(G,H):null}getSubParamsAll(){let Y={};for(let G=0;G<this.length;++G){let H=this._subParamsIdx[G]>>8,F=this._subParamsIdx[G]&255;F-H>0&&(Y[G]=this._subParams.slice(H,F))}return Y}addDigit(Y){let G;if(this._rejectDigits||!(G=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let H=this._digitIsSub?this._subParams:this.params,F=H[G-1];H[G-1]=~F?Math.min(F*10+Y,C1):Y}},U1=[],M8=class{constructor(){this._state=0,this._active=U1,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(q,Y){this._handlers[q]===void 0&&(this._handlers[q]=[]);let G=this._handlers[q];return G.push(Y),{dispose:()=>{let H=G.indexOf(Y);H!==-1&&G.splice(H,1)}}}clearHandler(q){this._handlers[q]&&delete this._handlers[q]}setHandlerFallback(q){this._handlerFb=q}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=U1}reset(){if(this._state===2)for(let q=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;q>=0;--q)this._active[q].end(!1);this._stack.paused=!1,this._active=U1,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||U1,!this._active.length)this._handlerFb(this._id,"START");else for(let q=this._active.length-1;q>=0;q--)this._active[q].start()}_put(q,Y,G){if(!this._active.length)this._handlerFb(this._id,"PUT",H2(q,Y,G));else for(let H=this._active.length-1;H>=0;H--)this._active[H].put(q,Y,G)}start(){this.reset(),this._state=1}put(q,Y,G){if(this._state!==3){if(this._state===1)for(;Y<G;){let H=q[Y++];if(H===59){this._state=2,this._start();break}if(H<48||57<H){this._state=3;return}this._id===-1&&(this._id=0),this._id=this._id*10+H-48}this._state===2&&G-Y>0&&this._put(q,Y,G)}}end(q,Y=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),!this._active.length)this._handlerFb(this._id,"END",q);else{let G=!1,H=this._active.length-1,F=!1;if(this._stack.paused&&(H=this._stack.loopPosition-1,G=Y,F=this._stack.fallThrough,this._stack.paused=!1),!F&&G===!1){for(;H>=0&&(G=this._active[H].end(q),G!==!0);H--)if(G instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=H,this._stack.fallThrough=!1,G;H--}for(;H>=0;H--)if(G=this._active[H].end(!1),G instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=H,this._stack.fallThrough=!0,G}this._active=U1,this._id=-1,this._state=0}}},K0=class{constructor(q){this._handler=q,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(q,Y,G){this._hitLimit||(this._data+=H2(q,Y,G),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}end(q){let Y=!1;if(this._hitLimit)Y=!1;else if(q&&(Y=this._handler(this._data),Y instanceof Promise))return Y.then((G)=>(this._data="",this._hitLimit=!1,G));return this._data="",this._hitLimit=!1,Y}},N1=[],j8=class{constructor(){this._handlers=Object.create(null),this._active=N1,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=N1}registerHandler(q,Y){this._handlers[q]===void 0&&(this._handlers[q]=[]);let G=this._handlers[q];return G.push(Y),{dispose:()=>{let H=G.indexOf(Y);H!==-1&&G.splice(H,1)}}}clearHandler(q){this._handlers[q]&&delete this._handlers[q]}setHandlerFallback(q){this._handlerFb=q}reset(){if(this._active.length)for(let q=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;q>=0;--q)this._active[q].unhook(!1);this._stack.paused=!1,this._active=N1,this._ident=0}hook(q,Y){if(this.reset(),this._ident=q,this._active=this._handlers[q]||N1,!this._active.length)this._handlerFb(this._ident,"HOOK",Y);else for(let G=this._active.length-1;G>=0;G--)this._active[G].hook(Y)}put(q,Y,G){if(!this._active.length)this._handlerFb(this._ident,"PUT",H2(q,Y,G));else for(let H=this._active.length-1;H>=0;H--)this._active[H].put(q,Y,G)}unhook(q,Y=!0){if(!this._active.length)this._handlerFb(this._ident,"UNHOOK",q);else{let G=!1,H=this._active.length-1,F=!1;if(this._stack.paused&&(H=this._stack.loopPosition-1,G=Y,F=this._stack.fallThrough,this._stack.paused=!1),!F&&G===!1){for(;H>=0&&(G=this._active[H].unhook(q),G!==!0);H--)if(G instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=H,this._stack.fallThrough=!1,G;H--}for(;H>=0;H--)if(G=this._active[H].unhook(!1),G instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=H,this._stack.fallThrough=!0,G}this._active=N1,this._ident=0}},L1=new G5;L1.addParam(0);var Z4=class{constructor(q){this._handler=q,this._data="",this._params=L1,this._hitLimit=!1}hook(q){this._params=q.length>1||q.params[0]?q.clone():L1,this._data="",this._hitLimit=!1}put(q,Y,G){this._hitLimit||(this._data+=H2(q,Y,G),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}unhook(q){let Y=!1;if(this._hitLimit)Y=!1;else if(q&&(Y=this._handler(this._data,this._params),Y instanceof Promise))return Y.then((G)=>(this._params=L1,this._data="",this._hitLimit=!1,G));return this._params=L1,this._data="",this._hitLimit=!1,Y}},K8=class{constructor(q){this.table=new Uint8Array(q)}setDefault(q,Y){this.table.fill(q<<4|Y)}add(q,Y,G,H){this.table[Y<<8|q]=G<<4|H}addMany(q,Y,G,H){for(let F=0;F<q.length;F++)this.table[Y<<8|q[F]]=G<<4|H}},N0=160,W8=function(){let q=new K8(4095),Y=Array.apply(null,Array(256)).map((V,X)=>X),G=(V,X)=>Y.slice(V,X),H=G(32,127),F=G(0,24);F.push(25),F.push.apply(F,G(28,32));let Z=G(0,14),$;q.setDefault(1,0),q.addMany(H,0,2,0);for($ in Z)q.addMany([24,26,153,154],$,3,0),q.addMany(G(128,144),$,3,0),q.addMany(G(144,152),$,3,0),q.add(156,$,0,0),q.add(27,$,11,1),q.add(157,$,4,8),q.addMany([152,158,159],$,0,7),q.add(155,$,11,3),q.add(144,$,11,9);return q.addMany(F,0,3,0),q.addMany(F,1,3,1),q.add(127,1,0,1),q.addMany(F,8,0,8),q.addMany(F,3,3,3),q.add(127,3,0,3),q.addMany(F,4,3,4),q.add(127,4,0,4),q.addMany(F,6,3,6),q.addMany(F,5,3,5),q.add(127,5,0,5),q.addMany(F,2,3,2),q.add(127,2,0,2),q.add(93,1,4,8),q.addMany(H,8,5,8),q.add(127,8,5,8),q.addMany([156,27,24,26,7],8,6,0),q.addMany(G(28,32),8,0,8),q.addMany([88,94,95],1,0,7),q.addMany(H,7,0,7),q.addMany(F,7,0,7),q.add(156,7,0,0),q.add(127,7,0,7),q.add(91,1,11,3),q.addMany(G(64,127),3,7,0),q.addMany(G(48,60),3,8,4),q.addMany([60,61,62,63],3,9,4),q.addMany(G(48,60),4,8,4),q.addMany(G(64,127),4,7,0),q.addMany([60,61,62,63],4,0,6),q.addMany(G(32,64),6,0,6),q.add(127,6,0,6),q.addMany(G(64,127),6,0,0),q.addMany(G(32,48),3,9,5),q.addMany(G(32,48),5,9,5),q.addMany(G(48,64),5,0,6),q.addMany(G(64,127),5,7,0),q.addMany(G(32,48),4,9,5),q.addMany(G(32,48),1,9,2),q.addMany(G(32,48),2,9,2),q.addMany(G(48,127),2,10,0),q.addMany(G(48,80),1,10,0),q.addMany(G(81,88),1,10,0),q.addMany([89,90,92],1,10,0),q.addMany(G(96,127),1,10,0),q.add(80,1,11,9),q.addMany(F,9,0,9),q.add(127,9,0,9),q.addMany(G(28,32),9,0,9),q.addMany(G(32,48),9,9,12),q.addMany(G(48,60),9,8,10),q.addMany([60,61,62,63],9,9,10),q.addMany(F,11,0,11),q.addMany(G(32,128),11,0,11),q.addMany(G(28,32),11,0,11),q.addMany(F,10,0,10),q.add(127,10,0,10),q.addMany(G(28,32),10,0,10),q.addMany(G(48,60),10,8,10),q.addMany([60,61,62,63],10,0,11),q.addMany(G(32,48),10,9,12),q.addMany(F,12,0,12),q.add(127,12,0,12),q.addMany(G(28,32),12,0,12),q.addMany(G(32,48),12,9,12),q.addMany(G(48,64),12,0,11),q.addMany(G(64,127),12,12,13),q.addMany(G(64,127),10,12,13),q.addMany(G(64,127),9,12,13),q.addMany(F,13,13,13),q.addMany(H,13,13,13),q.add(127,13,0,13),q.addMany([27,156,24,26],13,14,0),q.add(N0,0,2,0),q.add(N0,8,5,8),q.add(N0,6,0,6),q.add(N0,11,0,11),q.add(N0,13,13,13),q}(),C8=class extends S{constructor(q=W8){super();this._transitions=q,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new G5,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(Y,G,H)=>{},this._executeHandlerFb=(Y)=>{},this._csiHandlerFb=(Y,G)=>{},this._escHandlerFb=(Y)=>{},this._errorHandlerFb=(Y)=>Y,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this._register(m(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this._register(new M8),this._dcsParser=this._register(new j8),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(q,Y=[64,126]){let G=0;if(q.prefix){if(q.prefix.length>1)throw Error("only one byte as prefix supported");if(G=q.prefix.charCodeAt(0),G&&60>G||G>63)throw Error("prefix must be in range 0x3c .. 0x3f")}if(q.intermediates){if(q.intermediates.length>2)throw Error("only two bytes as intermediates are supported");for(let F=0;F<q.intermediates.length;++F){let Z=q.intermediates.charCodeAt(F);if(32>Z||Z>47)throw Error("intermediate must be in range 0x20 .. 0x2f");G<<=8,G|=Z}}if(q.final.length!==1)throw Error("final must be a single byte");let H=q.final.charCodeAt(0);if(Y[0]>H||H>Y[1])throw Error(`final must be in range ${Y[0]} .. ${Y[1]}`);return G<<=8,G|=H,G}identToString(q){let Y=[];for(;q;)Y.push(String.fromCharCode(q&255)),q>>=8;return Y.reverse().join("")}setPrintHandler(q){this._printHandler=q}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(q,Y){let G=this._identifier(q,[48,126]);this._escHandlers[G]===void 0&&(this._escHandlers[G]=[]);let H=this._escHandlers[G];return H.push(Y),{dispose:()=>{let F=H.indexOf(Y);F!==-1&&H.splice(F,1)}}}clearEscHandler(q){this._escHandlers[this._identifier(q,[48,126])]&&delete this._escHandlers[this._identifier(q,[48,126])]}setEscHandlerFallback(q){this._escHandlerFb=q}setExecuteHandler(q,Y){this._executeHandlers[q.charCodeAt(0)]=Y}clearExecuteHandler(q){this._executeHandlers[q.charCodeAt(0)]&&delete this._executeHandlers[q.charCodeAt(0)]}setExecuteHandlerFallback(q){this._executeHandlerFb=q}registerCsiHandler(q,Y){let G=this._identifier(q);this._csiHandlers[G]===void 0&&(this._csiHandlers[G]=[]);let H=this._csiHandlers[G];return H.push(Y),{dispose:()=>{let F=H.indexOf(Y);F!==-1&&H.splice(F,1)}}}clearCsiHandler(q){this._csiHandlers[this._identifier(q)]&&delete this._csiHandlers[this._identifier(q)]}setCsiHandlerFallback(q){this._csiHandlerFb=q}registerDcsHandler(q,Y){return this._dcsParser.registerHandler(this._identifier(q),Y)}clearDcsHandler(q){this._dcsParser.clearHandler(this._identifier(q))}setDcsHandlerFallback(q){this._dcsParser.setHandlerFallback(q)}registerOscHandler(q,Y){return this._oscParser.registerHandler(q,Y)}clearOscHandler(q){this._oscParser.clearHandler(q)}setOscHandlerFallback(q){this._oscParser.setHandlerFallback(q)}setErrorHandler(q){this._errorHandler=q}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(q,Y,G,H,F){this._parseStack.state=q,this._parseStack.handlers=Y,this._parseStack.handlerPos=G,this._parseStack.transition=H,this._parseStack.chunkPos=F}parse(q,Y,G){let H=0,F=0,Z=0,$;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,Z=this._parseStack.chunkPos+1;else{if(G===void 0||this._parseStack.state===1)throw this._parseStack.state=1,Error("improper continuation due to previous async handler, giving up parsing");let V=this._parseStack.handlers,X=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(G===!1&&X>-1){for(;X>=0&&($=V[X](this._params),$!==!0);X--)if($ instanceof Promise)return this._parseStack.handlerPos=X,$}this._parseStack.handlers=[];break;case 4:if(G===!1&&X>-1){for(;X>=0&&($=V[X](),$!==!0);X--)if($ instanceof Promise)return this._parseStack.handlerPos=X,$}this._parseStack.handlers=[];break;case 6:if(H=q[this._parseStack.chunkPos],$=this._dcsParser.unhook(H!==24&&H!==26,G),$)return $;H===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(H=q[this._parseStack.chunkPos],$=this._oscParser.end(H!==24&&H!==26,G),$)return $;H===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break}this._parseStack.state=0,Z=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=this._parseStack.transition&15}for(let V=Z;V<Y;++V){switch(H=q[V],F=this._transitions.table[this.currentState<<8|(H<160?H:N0)],F>>4){case 2:for(let K=V+1;;++K){if(K>=Y||(H=q[K])<32||H>126&&H<N0){this._printHandler(q,V,K),V=K-1;break}if(++K>=Y||(H=q[K])<32||H>126&&H<N0){this._printHandler(q,V,K),V=K-1;break}if(++K>=Y||(H=q[K])<32||H>126&&H<N0){this._printHandler(q,V,K),V=K-1;break}if(++K>=Y||(H=q[K])<32||H>126&&H<N0){this._printHandler(q,V,K),V=K-1;break}}break;case 3:this._executeHandlers[H]?this._executeHandlers[H]():this._executeHandlerFb(H),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:V,code:H,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let X=this._csiHandlers[this._collect<<8|H],J=X?X.length-1:-1;for(;J>=0&&($=X[J](this._params),$!==!0);J--)if($ instanceof Promise)return this._preserveStack(3,X,J,F,V),$;J<0&&this._csiHandlerFb(this._collect<<8|H,this._params),this.precedingJoinState=0;break;case 8:do switch(H){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(H-48)}while(++V<Y&&(H=q[V])>47&&H<60);V--;break;case 9:this._collect<<=8,this._collect|=H;break;case 10:let M=this._escHandlers[this._collect<<8|H],z=M?M.length-1:-1;for(;z>=0&&($=M[z](),$!==!0);z--)if($ instanceof Promise)return this._preserveStack(4,M,z,F,V),$;z<0&&this._escHandlerFb(this._collect<<8|H),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|H,this._params);break;case 13:for(let K=V+1;;++K)if(K>=Y||(H=q[K])===24||H===26||H===27||H>127&&H<N0){this._dcsParser.put(q,V,K),V=K-1;break}break;case 14:if($=this._dcsParser.unhook(H!==24&&H!==26),$)return this._preserveStack(6,[],0,F,V),$;H===27&&(F|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let K=V+1;;K++)if(K>=Y||(H=q[K])<32||H>127&&H<N0){this._oscParser.put(q,V,K),V=K-1;break}break;case 6:if($=this._oscParser.end(H!==24&&H!==26),$)return this._preserveStack(5,[],0,F,V),$;H===27&&(F|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break}this.currentState=F&15}}},U8=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,N8=/^[\da-f]+$/;function $4(q){if(!q)return;let Y=q.toLowerCase();if(Y.indexOf("rgb:")===0){Y=Y.slice(4);let G=U8.exec(Y);if(G){let H=G[1]?15:G[4]?255:G[7]?4095:65535;return[Math.round(parseInt(G[1]||G[4]||G[7]||G[10],16)/H*255),Math.round(parseInt(G[2]||G[5]||G[8]||G[11],16)/H*255),Math.round(parseInt(G[3]||G[6]||G[9]||G[12],16)/H*255)]}}else if(Y.indexOf("#")===0&&(Y=Y.slice(1),N8.exec(Y)&&[3,6,9,12].includes(Y.length))){let G=Y.length/3,H=[0,0,0];for(let F=0;F<3;++F){let Z=parseInt(Y.slice(G*F,G*F+G),16);H[F]=G===1?Z<<4:G===2?Z:G===3?Z>>4:Z>>8}return H}}function P2(q,Y){let G=q.toString(16),H=G.length<2?"0"+G:G;switch(Y){case 4:return G[0];case 8:return H;case 12:return(H+H).slice(0,3);default:return H+H}}function B8(q,Y=16){let[G,H,F]=q;return`rgb:${P2(G,Y)}/${P2(H,Y)}/${P2(F,Y)}`}var D8={"(":0,")":1,"*":2,"+":3,"-":1,".":2},d0=131072,J4=10;function V4(q,Y){if(q>24)return Y.setWinLines||!1;switch(q){case 1:return!!Y.restoreWin;case 2:return!!Y.minimizeWin;case 3:return!!Y.setWinPosition;case 4:return!!Y.setWinSizePixels;case 5:return!!Y.raiseWin;case 6:return!!Y.lowerWin;case 7:return!!Y.refreshWin;case 8:return!!Y.setWinSizeChars;case 9:return!!Y.maximizeWin;case 10:return!!Y.fullscreenWin;case 11:return!!Y.getWinState;case 13:return!!Y.getWinPosition;case 14:return!!Y.getWinSizePixels;case 15:return!!Y.getScreenSizePixels;case 16:return!!Y.getCellSizePixels;case 18:return!!Y.getWinSizeChars;case 19:return!!Y.getScreenSizeChars;case 20:return!!Y.getIconTitle;case 21:return!!Y.getWinTitle;case 22:return!!Y.pushTitle;case 23:return!!Y.popTitle;case 24:return!!Y.setWinLines}return!1}var X4=5000,z4=0,R8=class extends S{constructor(q,Y,G,H,F,Z,$,V,X=new C8){super();this._bufferService=q,this._charsetService=Y,this._coreService=G,this._logService=H,this._optionsService=F,this._oscLinkService=Z,this._coreMouseService=$,this._unicodeService=V,this._parser=X,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new M5,this._utf8Decoder=new j5,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=o.clone(),this._eraseAttrDataInternal=o.clone(),this._onRequestBell=this._register(new B),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this._register(new B),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this._register(new B),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this._register(new B),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this._register(new B),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this._register(new B),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this._register(new B),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this._register(new B),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this._register(new B),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this._register(new B),this.onLineFeed=this._onLineFeed.event,this._onScroll=this._register(new B),this.onScroll=this._onScroll.event,this._onTitleChange=this._register(new B),this.onTitleChange=this._onTitleChange.event,this._onColor=this._register(new B),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this._register(this._parser),this._dirtyRowTracker=new q3(this._bufferService),this._activeBuffer=this._bufferService.buffer,this._register(this._bufferService.buffers.onBufferActivate((J)=>this._activeBuffer=J.activeBuffer)),this._parser.setCsiHandlerFallback((J,M)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(J),params:M.toArray()})}),this._parser.setEscHandlerFallback((J)=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(J)})}),this._parser.setExecuteHandlerFallback((J)=>{this._logService.debug("Unknown EXECUTE code: ",{code:J})}),this._parser.setOscHandlerFallback((J,M,z)=>{this._logService.debug("Unknown OSC code: ",{identifier:J,action:M,data:z})}),this._parser.setDcsHandlerFallback((J,M,z)=>{M==="HOOK"&&(z=z.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(J),action:M,payload:z})}),this._parser.setPrintHandler((J,M,z)=>this.print(J,M,z)),this._parser.registerCsiHandler({final:"@"},(J)=>this.insertChars(J)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},(J)=>this.scrollLeft(J)),this._parser.registerCsiHandler({final:"A"},(J)=>this.cursorUp(J)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},(J)=>this.scrollRight(J)),this._parser.registerCsiHandler({final:"B"},(J)=>this.cursorDown(J)),this._parser.registerCsiHandler({final:"C"},(J)=>this.cursorForward(J)),this._parser.registerCsiHandler({final:"D"},(J)=>this.cursorBackward(J)),this._parser.registerCsiHandler({final:"E"},(J)=>this.cursorNextLine(J)),this._parser.registerCsiHandler({final:"F"},(J)=>this.cursorPrecedingLine(J)),this._parser.registerCsiHandler({final:"G"},(J)=>this.cursorCharAbsolute(J)),this._parser.registerCsiHandler({final:"H"},(J)=>this.cursorPosition(J)),this._parser.registerCsiHandler({final:"I"},(J)=>this.cursorForwardTab(J)),this._parser.registerCsiHandler({final:"J"},(J)=>this.eraseInDisplay(J,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},(J)=>this.eraseInDisplay(J,!0)),this._parser.registerCsiHandler({final:"K"},(J)=>this.eraseInLine(J,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},(J)=>this.eraseInLine(J,!0)),this._parser.registerCsiHandler({final:"L"},(J)=>this.insertLines(J)),this._parser.registerCsiHandler({final:"M"},(J)=>this.deleteLines(J)),this._parser.registerCsiHandler({final:"P"},(J)=>this.deleteChars(J)),this._parser.registerCsiHandler({final:"S"},(J)=>this.scrollUp(J)),this._parser.registerCsiHandler({final:"T"},(J)=>this.scrollDown(J)),this._parser.registerCsiHandler({final:"X"},(J)=>this.eraseChars(J)),this._parser.registerCsiHandler({final:"Z"},(J)=>this.cursorBackwardTab(J)),this._parser.registerCsiHandler({final:"`"},(J)=>this.charPosAbsolute(J)),this._parser.registerCsiHandler({final:"a"},(J)=>this.hPositionRelative(J)),this._parser.registerCsiHandler({final:"b"},(J)=>this.repeatPrecedingCharacter(J)),this._parser.registerCsiHandler({final:"c"},(J)=>this.sendDeviceAttributesPrimary(J)),this._parser.registerCsiHandler({prefix:">",final:"c"},(J)=>this.sendDeviceAttributesSecondary(J)),this._parser.registerCsiHandler({final:"d"},(J)=>this.linePosAbsolute(J)),this._parser.registerCsiHandler({final:"e"},(J)=>this.vPositionRelative(J)),this._parser.registerCsiHandler({final:"f"},(J)=>this.hVPosition(J)),this._parser.registerCsiHandler({final:"g"},(J)=>this.tabClear(J)),this._parser.registerCsiHandler({final:"h"},(J)=>this.setMode(J)),this._parser.registerCsiHandler({prefix:"?",final:"h"},(J)=>this.setModePrivate(J)),this._parser.registerCsiHandler({final:"l"},(J)=>this.resetMode(J)),this._parser.registerCsiHandler({prefix:"?",final:"l"},(J)=>this.resetModePrivate(J)),this._parser.registerCsiHandler({final:"m"},(J)=>this.charAttributes(J)),this._parser.registerCsiHandler({final:"n"},(J)=>this.deviceStatus(J)),this._parser.registerCsiHandler({prefix:"?",final:"n"},(J)=>this.deviceStatusPrivate(J)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},(J)=>this.softReset(J)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},(J)=>this.setCursorStyle(J)),this._parser.registerCsiHandler({final:"r"},(J)=>this.setScrollRegion(J)),this._parser.registerCsiHandler({final:"s"},(J)=>this.saveCursor(J)),this._parser.registerCsiHandler({final:"t"},(J)=>this.windowOptions(J)),this._parser.registerCsiHandler({final:"u"},(J)=>this.restoreCursor(J)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},(J)=>this.insertColumns(J)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},(J)=>this.deleteColumns(J)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},(J)=>this.selectProtected(J)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},(J)=>this.requestMode(J,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},(J)=>this.requestMode(J,!1)),this._parser.setExecuteHandler(U.BEL,()=>this.bell()),this._parser.setExecuteHandler(U.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(U.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(U.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(U.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(U.BS,()=>this.backspace()),this._parser.setExecuteHandler(U.HT,()=>this.tab()),this._parser.setExecuteHandler(U.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(U.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(l1.IND,()=>this.index()),this._parser.setExecuteHandler(l1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(l1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new K0((J)=>(this.setTitle(J),this.setIconName(J),!0))),this._parser.registerOscHandler(1,new K0((J)=>this.setIconName(J))),this._parser.registerOscHandler(2,new K0((J)=>this.setTitle(J))),this._parser.registerOscHandler(4,new K0((J)=>this.setOrReportIndexedColor(J))),this._parser.registerOscHandler(8,new K0((J)=>this.setHyperlink(J))),this._parser.registerOscHandler(10,new K0((J)=>this.setOrReportFgColor(J))),this._parser.registerOscHandler(11,new K0((J)=>this.setOrReportBgColor(J))),this._parser.registerOscHandler(12,new K0((J)=>this.setOrReportCursorColor(J))),this._parser.registerOscHandler(104,new K0((J)=>this.restoreIndexedColor(J))),this._parser.registerOscHandler(110,new K0((J)=>this.restoreFgColor(J))),this._parser.registerOscHandler(111,new K0((J)=>this.restoreBgColor(J))),this._parser.registerOscHandler(112,new K0((J)=>this.restoreCursorColor(J))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let J in i)this._parser.registerEscHandler({intermediates:"(",final:J},()=>this.selectCharset("("+J)),this._parser.registerEscHandler({intermediates:")",final:J},()=>this.selectCharset(")"+J)),this._parser.registerEscHandler({intermediates:"*",final:J},()=>this.selectCharset("*"+J)),this._parser.registerEscHandler({intermediates:"+",final:J},()=>this.selectCharset("+"+J)),this._parser.registerEscHandler({intermediates:"-",final:J},()=>this.selectCharset("-"+J)),this._parser.registerEscHandler({intermediates:".",final:J},()=>this.selectCharset("."+J)),this._parser.registerEscHandler({intermediates:"/",final:J},()=>this.selectCharset("/"+J));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler((J)=>(this._logService.error("Parsing error: ",J),J)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new Z4((J,M)=>this.requestStatusString(J,M)))}getAttrData(){return this._curAttrData}_preserveStack(q,Y,G,H){this._parseStack.paused=!0,this._parseStack.cursorStartX=q,this._parseStack.cursorStartY=Y,this._parseStack.decodedLength=G,this._parseStack.position=H}_logSlowResolvingAsync(q){this._logService.logLevel<=3&&Promise.race([q,new Promise((Y,G)=>setTimeout(()=>G("#SLOW_TIMEOUT"),X4))]).catch((Y)=>{if(Y!=="#SLOW_TIMEOUT")throw Y;console.warn(`async parser handler taking longer than ${X4} ms`)})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(q,Y){let G,H=this._activeBuffer.x,F=this._activeBuffer.y,Z=0,$=this._parseStack.paused;if($){if(G=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,Y))return this._logSlowResolvingAsync(G),G;H=this._parseStack.cursorStartX,F=this._parseStack.cursorStartY,this._parseStack.paused=!1,q.length>d0&&(Z=this._parseStack.position+d0)}if(this._logService.logLevel<=1&&this._logService.debug(`parsing data ${typeof q=="string"?` "${q}"`:` "${Array.prototype.map.call(q,(J)=>String.fromCharCode(J)).join("")}"`}`),this._logService.logLevel===0&&this._logService.trace("parsing data (codes)",typeof q=="string"?q.split("").map((J)=>J.charCodeAt(0)):q),this._parseBuffer.length<q.length&&this._parseBuffer.length<d0&&(this._parseBuffer=new Uint32Array(Math.min(q.length,d0))),$||this._dirtyRowTracker.clearRange(),q.length>d0)for(let J=Z;J<q.length;J+=d0){let M=J+d0<q.length?J+d0:q.length,z=typeof q=="string"?this._stringDecoder.decode(q.substring(J,M),this._parseBuffer):this._utf8Decoder.decode(q.subarray(J,M),this._parseBuffer);if(G=this._parser.parse(this._parseBuffer,z))return this._preserveStack(H,F,z,J),this._logSlowResolvingAsync(G),G}else if(!$){let J=typeof q=="string"?this._stringDecoder.decode(q,this._parseBuffer):this._utf8Decoder.decode(q,this._parseBuffer);if(G=this._parser.parse(this._parseBuffer,J))return this._preserveStack(H,F,J,0),this._logSlowResolvingAsync(G),G}(this._activeBuffer.x!==H||this._activeBuffer.y!==F)&&this._onCursorMove.fire();let V=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),X=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);X<this._bufferService.rows&&this._onRequestRefreshRows.fire({start:Math.min(X,this._bufferService.rows-1),end:Math.min(V,this._bufferService.rows-1)})}print(q,Y,G){let H,F,Z=this._charsetService.charset,$=this._optionsService.rawOptions.screenReaderMode,V=this._bufferService.cols,X=this._coreService.decPrivateModes.wraparound,J=this._coreService.modes.insertMode,M=this._curAttrData,z=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&G-Y>0&&z.getWidth(this._activeBuffer.x-1)===2&&z.setCellFromCodepoint(this._activeBuffer.x-1,0,1,M);let K=this._parser.precedingJoinState;for(let W=Y;W<G;++W){if(H=q[W],H<127&&Z){let x=Z[String.fromCharCode(H)];x&&(H=x.charCodeAt(0))}let j=this._unicodeService.charProperties(H,K);F=r0.extractWidth(j);let C=r0.extractShouldJoin(j),L=C?r0.extractWidth(K):0;if(K=j,$&&this._onA11yChar.fire(u0(H)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+F-L>V){if(X){let x=z,v=this._activeBuffer.x-L;for(this._activeBuffer.x=L,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),z=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),L>0&&z instanceof A1&&z.copyCellsFrom(x,v,0,L,!1);v<V;)x.setCellFromCodepoint(v++,0,1,M)}else if(this._activeBuffer.x=V-1,F===2)continue}if(C&&this._activeBuffer.x){let x=z.getWidth(this._activeBuffer.x-1)?1:2;z.addCodepointToCell(this._activeBuffer.x-x,H,F);for(let v=F-L;--v>=0;)z.setCellFromCodepoint(this._activeBuffer.x++,0,0,M);continue}if(J&&(z.insertCells(this._activeBuffer.x,F-L,this._activeBuffer.getNullCell(M)),z.getWidth(V-1)===2&&z.setCellFromCodepoint(V-1,0,1,M)),z.setCellFromCodepoint(this._activeBuffer.x++,H,F,M),F>0)for(;--F;)z.setCellFromCodepoint(this._activeBuffer.x++,0,0,M)}this._parser.precedingJoinState=K,this._activeBuffer.x<V&&G-Y>0&&z.getWidth(this._activeBuffer.x)===0&&!z.hasContent(this._activeBuffer.x)&&z.setCellFromCodepoint(this._activeBuffer.x,0,1,M),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(q,Y){return q.final==="t"&&!q.prefix&&!q.intermediates?this._parser.registerCsiHandler(q,(G)=>V4(G.params[0],this._optionsService.rawOptions.windowOptions)?Y(G):!0):this._parser.registerCsiHandler(q,Y)}registerDcsHandler(q,Y){return this._parser.registerDcsHandler(q,new Z4(Y))}registerEscHandler(q,Y){return this._parser.registerEscHandler(q,Y)}registerOscHandler(q,Y){return this._parser.registerOscHandler(q,new K0(Y))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let q=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);q.hasWidth(this._activeBuffer.x)&&!q.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let q=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-q),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(q=this._bufferService.cols-1){this._activeBuffer.x=Math.min(q,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(q,Y){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=q,this._activeBuffer.y=this._activeBuffer.scrollTop+Y):(this._activeBuffer.x=q,this._activeBuffer.y=Y),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(q,Y){this._restrictCursor(),this._setCursor(this._activeBuffer.x+q,this._activeBuffer.y+Y)}cursorUp(q){let Y=this._activeBuffer.y-this._activeBuffer.scrollTop;return Y>=0?this._moveCursor(0,-Math.min(Y,q.params[0]||1)):this._moveCursor(0,-(q.params[0]||1)),!0}cursorDown(q){let Y=this._activeBuffer.scrollBottom-this._activeBuffer.y;return Y>=0?this._moveCursor(0,Math.min(Y,q.params[0]||1)):this._moveCursor(0,q.params[0]||1),!0}cursorForward(q){return this._moveCursor(q.params[0]||1,0),!0}cursorBackward(q){return this._moveCursor(-(q.params[0]||1),0),!0}cursorNextLine(q){return this.cursorDown(q),this._activeBuffer.x=0,!0}cursorPrecedingLine(q){return this.cursorUp(q),this._activeBuffer.x=0,!0}cursorCharAbsolute(q){return this._setCursor((q.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(q){return this._setCursor(q.length>=2?(q.params[1]||1)-1:0,(q.params[0]||1)-1),!0}charPosAbsolute(q){return this._setCursor((q.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(q){return this._moveCursor(q.params[0]||1,0),!0}linePosAbsolute(q){return this._setCursor(this._activeBuffer.x,(q.params[0]||1)-1),!0}vPositionRelative(q){return this._moveCursor(0,q.params[0]||1),!0}hVPosition(q){return this.cursorPosition(q),!0}tabClear(q){let Y=q.params[0];return Y===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:Y===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(q){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let Y=q.params[0]||1;for(;Y--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(q){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let Y=q.params[0]||1;for(;Y--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(q){let Y=q.params[0];return Y===1&&(this._curAttrData.bg|=536870912),(Y===2||Y===0)&&(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(q,Y,G,H=!1,F=!1){let Z=this._activeBuffer.lines.get(this._activeBuffer.ybase+q);Z.replaceCells(Y,G,this._activeBuffer.getNullCell(this._eraseAttrData()),F),H&&(Z.isWrapped=!1)}_resetBufferLine(q,Y=!1){let G=this._activeBuffer.lines.get(this._activeBuffer.ybase+q);G&&(G.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),Y),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+q),G.isWrapped=!1)}eraseInDisplay(q,Y=!1){this._restrictCursor(this._bufferService.cols);let G;switch(q.params[0]){case 0:for(G=this._activeBuffer.y,this._dirtyRowTracker.markDirty(G),this._eraseInBufferLine(G++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,Y);G<this._bufferService.rows;G++)this._resetBufferLine(G,Y);this._dirtyRowTracker.markDirty(G);break;case 1:for(G=this._activeBuffer.y,this._dirtyRowTracker.markDirty(G),this._eraseInBufferLine(G,0,this._activeBuffer.x+1,!0,Y),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(G+1).isWrapped=!1);G--;)this._resetBufferLine(G,Y);this._dirtyRowTracker.markDirty(0);break;case 2:if(this._optionsService.rawOptions.scrollOnEraseInDisplay){for(G=this._bufferService.rows,this._dirtyRowTracker.markRangeDirty(0,G-1);G--&&!this._activeBuffer.lines.get(this._activeBuffer.ybase+G)?.getTrimmedLength(););for(;G>=0;G--)this._bufferService.scroll(this._eraseAttrData())}else{for(G=this._bufferService.rows,this._dirtyRowTracker.markDirty(G-1);G--;)this._resetBufferLine(G,Y);this._dirtyRowTracker.markDirty(0)}break;case 3:let H=this._activeBuffer.lines.length-this._bufferService.rows;H>0&&(this._activeBuffer.lines.trimStart(H),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-H,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-H,0),this._onScroll.fire(0));break}return!0}eraseInLine(q,Y=!1){switch(this._restrictCursor(this._bufferService.cols),q.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,Y);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,Y);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,Y);break}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(q){this._restrictCursor();let Y=q.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let G=this._activeBuffer.ybase+this._activeBuffer.y,H=this._bufferService.rows-1-this._activeBuffer.scrollBottom,F=this._bufferService.rows-1+this._activeBuffer.ybase-H+1;for(;Y--;)this._activeBuffer.lines.splice(F-1,1),this._activeBuffer.lines.splice(G,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(q){this._restrictCursor();let Y=q.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let G=this._activeBuffer.ybase+this._activeBuffer.y,H;for(H=this._bufferService.rows-1-this._activeBuffer.scrollBottom,H=this._bufferService.rows-1+this._activeBuffer.ybase-H;Y--;)this._activeBuffer.lines.splice(G,1),this._activeBuffer.lines.splice(H,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(q){this._restrictCursor();let Y=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return Y&&(Y.insertCells(this._activeBuffer.x,q.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(q){this._restrictCursor();let Y=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return Y&&(Y.deleteCells(this._activeBuffer.x,q.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(q){let Y=q.params[0]||1;for(;Y--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(q){let Y=q.params[0]||1;for(;Y--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(o));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(q){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let Y=q.params[0]||1;for(let G=this._activeBuffer.scrollTop;G<=this._activeBuffer.scrollBottom;++G){let H=this._activeBuffer.lines.get(this._activeBuffer.ybase+G);H.deleteCells(0,Y,this._activeBuffer.getNullCell(this._eraseAttrData())),H.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(q){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let Y=q.params[0]||1;for(let G=this._activeBuffer.scrollTop;G<=this._activeBuffer.scrollBottom;++G){let H=this._activeBuffer.lines.get(this._activeBuffer.ybase+G);H.insertCells(0,Y,this._activeBuffer.getNullCell(this._eraseAttrData())),H.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(q){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let Y=q.params[0]||1;for(let G=this._activeBuffer.scrollTop;G<=this._activeBuffer.scrollBottom;++G){let H=this._activeBuffer.lines.get(this._activeBuffer.ybase+G);H.insertCells(this._activeBuffer.x,Y,this._activeBuffer.getNullCell(this._eraseAttrData())),H.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(q){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let Y=q.params[0]||1;for(let G=this._activeBuffer.scrollTop;G<=this._activeBuffer.scrollBottom;++G){let H=this._activeBuffer.lines.get(this._activeBuffer.ybase+G);H.deleteCells(this._activeBuffer.x,Y,this._activeBuffer.getNullCell(this._eraseAttrData())),H.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(q){this._restrictCursor();let Y=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return Y&&(Y.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(q.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(q){let Y=this._parser.precedingJoinState;if(!Y)return!0;let G=q.params[0]||1,H=r0.extractWidth(Y),F=this._activeBuffer.x-H,Z=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(F),$=new Uint32Array(Z.length*G),V=0;for(let J=0;J<Z.length;){let M=Z.codePointAt(J)||0;$[V++]=M,J+=M>65535?2:1}let X=V;for(let J=1;J<G;++J)$.copyWithin(X,0,V),X+=V;return this.print($,0,X),!0}sendDeviceAttributesPrimary(q){return q.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(U.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(U.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(q){return q.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(U.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(U.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(q.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(U.ESC+"[>83;40003;0c")),!0}_is(q){return(this._optionsService.rawOptions.termName+"").indexOf(q)===0}setMode(q){for(let Y=0;Y<q.length;Y++)switch(q.params[Y]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0;break}return!0}setModePrivate(q){for(let Y=0;Y<q.length;Y++)switch(q.params[Y]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,s0),this._charsetService.setgCharset(1,s0),this._charsetService.setgCharset(2,s0),this._charsetService.setgCharset(3,s0);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1000:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!0;break}return!0}resetMode(q){for(let Y=0;Y<q.length;Y++)switch(q.params[Y]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1;break}return!0}resetModePrivate(q){for(let Y=0;Y<q.length;Y++)switch(q.params[Y]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1000:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),q.params[Y]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!1,this._onRequestRefreshRows.fire(void 0);break}return!0}requestMode(q,Y){let G;((C)=>(C[C.NOT_RECOGNIZED=0]="NOT_RECOGNIZED",C[C.SET=1]="SET",C[C.RESET=2]="RESET",C[C.PERMANENTLY_SET=3]="PERMANENTLY_SET",C[C.PERMANENTLY_RESET=4]="PERMANENTLY_RESET"))(G||={});let H=this._coreService.decPrivateModes,{activeProtocol:F,activeEncoding:Z}=this._coreMouseService,$=this._coreService,{buffers:V,cols:X}=this._bufferService,{active:J,alt:M}=V,z=this._optionsService.rawOptions,K=(C,L)=>($.triggerDataEvent(`${U.ESC}[${Y?"":"?"}${C};${L}$y`),!0),W=(C)=>C?1:2,j=q.params[0];return Y?j===2?K(j,4):j===4?K(j,W($.modes.insertMode)):j===12?K(j,3):j===20?K(j,W(z.convertEol)):K(j,0):j===1?K(j,W(H.applicationCursorKeys)):j===3?K(j,z.windowOptions.setWinLines?X===80?2:X===132?1:0:0):j===6?K(j,W(H.origin)):j===7?K(j,W(H.wraparound)):j===8?K(j,3):j===9?K(j,W(F==="X10")):j===12?K(j,W(z.cursorBlink)):j===25?K(j,W(!$.isCursorHidden)):j===45?K(j,W(H.reverseWraparound)):j===66?K(j,W(H.applicationKeypad)):j===67?K(j,4):j===1000?K(j,W(F==="VT200")):j===1002?K(j,W(F==="DRAG")):j===1003?K(j,W(F==="ANY")):j===1004?K(j,W(H.sendFocus)):j===1005?K(j,4):j===1006?K(j,W(Z==="SGR")):j===1015?K(j,4):j===1016?K(j,W(Z==="SGR_PIXELS")):j===1048?K(j,1):j===47||j===1047||j===1049?K(j,W(J===M)):j===2004?K(j,W(H.bracketedPasteMode)):j===2026?K(j,W(H.synchronizedOutput)):K(j,0)}_updateAttrColor(q,Y,G,H,F){return Y===2?(q|=50331648,q&=-16777216,q|=w1.fromColorRGB([G,H,F])):Y===5&&(q&=-50331904,q|=33554432|G&255),q}_extractColor(q,Y,G){let H=[0,0,-1,0,0,0],F=0,Z=0;do{if(H[Z+F]=q.params[Y+Z],q.hasSubParams(Y+Z)){let $=q.getSubParams(Y+Z),V=0;do H[1]===5&&(F=1),H[Z+V+1+F]=$[V];while(++V<$.length&&V+Z+1+F<H.length);break}if(H[1]===5&&Z+F>=2||H[1]===2&&Z+F>=5)break;H[1]&&(F=1)}while(++Z+Y<q.length&&Z+F<H.length);for(let $=2;$<H.length;++$)H[$]===-1&&(H[$]=0);switch(H[0]){case 38:G.fg=this._updateAttrColor(G.fg,H[1],H[3],H[4],H[5]);break;case 48:G.bg=this._updateAttrColor(G.bg,H[1],H[3],H[4],H[5]);break;case 58:G.extended=G.extended.clone(),G.extended.underlineColor=this._updateAttrColor(G.extended.underlineColor,H[1],H[3],H[4],H[5])}return Z}_processUnderline(q,Y){Y.extended=Y.extended.clone(),(!~q||q>5)&&(q=1),Y.extended.underlineStyle=q,Y.fg|=268435456,q===0&&(Y.fg&=-268435457),Y.updateExtended()}_processSGR0(q){q.fg=o.fg,q.bg=o.bg,q.extended=q.extended.clone(),q.extended.underlineStyle=0,q.extended.underlineColor&=-67108864,q.updateExtended()}charAttributes(q){if(q.length===1&&q.params[0]===0)return this._processSGR0(this._curAttrData),!0;let Y=q.length,G,H=this._curAttrData;for(let F=0;F<Y;F++)G=q.params[F],G>=30&&G<=37?(H.fg&=-50331904,H.fg|=16777216|G-30):G>=40&&G<=47?(H.bg&=-50331904,H.bg|=16777216|G-40):G>=90&&G<=97?(H.fg&=-50331904,H.fg|=16777216|G-90|8):G>=100&&G<=107?(H.bg&=-50331904,H.bg|=16777216|G-100|8):G===0?this._processSGR0(H):G===1?H.fg|=134217728:G===3?H.bg|=67108864:G===4?(H.fg|=268435456,this._processUnderline(q.hasSubParams(F)?q.getSubParams(F)[0]:1,H)):G===5?H.fg|=536870912:G===7?H.fg|=67108864:G===8?H.fg|=1073741824:G===9?H.fg|=2147483648:G===2?H.bg|=134217728:G===21?this._processUnderline(2,H):G===22?(H.fg&=-134217729,H.bg&=-134217729):G===23?H.bg&=-67108865:G===24?(H.fg&=-268435457,this._processUnderline(0,H)):G===25?H.fg&=-536870913:G===27?H.fg&=-67108865:G===28?H.fg&=-1073741825:G===29?H.fg&=2147483647:G===39?(H.fg&=-67108864,H.fg|=o.fg&16777215):G===49?(H.bg&=-67108864,H.bg|=o.bg&16777215):G===38||G===48||G===58?F+=this._extractColor(q,F,H):G===53?H.bg|=1073741824:G===55?H.bg&=-1073741825:G===59?(H.extended=H.extended.clone(),H.extended.underlineColor=-1,H.updateExtended()):G===100?(H.fg&=-67108864,H.fg|=o.fg&16777215,H.bg&=-67108864,H.bg|=o.bg&16777215):this._logService.debug("Unknown SGR attribute: %d.",G);return!0}deviceStatus(q){switch(q.params[0]){case 5:this._coreService.triggerDataEvent(`${U.ESC}[0n`);break;case 6:let Y=this._activeBuffer.y+1,G=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${U.ESC}[${Y};${G}R`);break}return!0}deviceStatusPrivate(q){switch(q.params[0]){case 6:let Y=this._activeBuffer.y+1,G=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${U.ESC}[?${Y};${G}R`);break;case 15:break;case 25:break;case 26:break;case 53:break}return!0}softReset(q){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=o.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(q){let Y=q.length===0?1:q.params[0];if(Y===0)this._coreService.decPrivateModes.cursorStyle=void 0,this._coreService.decPrivateModes.cursorBlink=void 0;else{switch(Y){case 1:case 2:this._coreService.decPrivateModes.cursorStyle="block";break;case 3:case 4:this._coreService.decPrivateModes.cursorStyle="underline";break;case 5:case 6:this._coreService.decPrivateModes.cursorStyle="bar";break}let G=Y%2===1;this._coreService.decPrivateModes.cursorBlink=G}return!0}setScrollRegion(q){let Y=q.params[0]||1,G;return(q.length<2||(G=q.params[1])>this._bufferService.rows||G===0)&&(G=this._bufferService.rows),G>Y&&(this._activeBuffer.scrollTop=Y-1,this._activeBuffer.scrollBottom=G-1,this._setCursor(0,0)),!0}windowOptions(q){if(!V4(q.params[0],this._optionsService.rawOptions.windowOptions))return!0;let Y=q.length>1?q.params[1]:0;switch(q.params[0]){case 14:Y!==2&&this._onRequestWindowsOptionsReport.fire(0);break;case 16:this._onRequestWindowsOptionsReport.fire(1);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${U.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:(Y===0||Y===2)&&(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>J4&&this._windowTitleStack.shift()),(Y===0||Y===1)&&(this._iconNameStack.push(this._iconName),this._iconNameStack.length>J4&&this._iconNameStack.shift());break;case 23:(Y===0||Y===2)&&this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),(Y===0||Y===1)&&this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop());break}return!0}saveCursor(q){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(q){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(q){return this._windowTitle=q,this._onTitleChange.fire(q),!0}setIconName(q){return this._iconName=q,!0}setOrReportIndexedColor(q){let Y=[],G=q.split(";");for(;G.length>1;){let H=G.shift(),F=G.shift();if(/^\d+$/.exec(H)){let Z=parseInt(H);if(M4(Z))if(F==="?")Y.push({type:0,index:Z});else{let $=$4(F);$&&Y.push({type:1,index:Z,color:$})}}}return Y.length&&this._onColor.fire(Y),!0}setHyperlink(q){let Y=q.indexOf(";");if(Y===-1)return!0;let G=q.slice(0,Y).trim(),H=q.slice(Y+1);return H?this._createHyperlink(G,H):G.trim()?!1:this._finishHyperlink()}_createHyperlink(q,Y){this._getCurrentLinkId()&&this._finishHyperlink();let G=q.split(":"),H,F=G.findIndex((Z)=>Z.startsWith("id="));return F!==-1&&(H=G[F].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:H,uri:Y}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(q,Y){let G=q.split(";");for(let H=0;H<G.length&&!(Y>=this._specialColors.length);++H,++Y)if(G[H]==="?")this._onColor.fire([{type:0,index:this._specialColors[Y]}]);else{let F=$4(G[H]);F&&this._onColor.fire([{type:1,index:this._specialColors[Y],color:F}])}return!0}setOrReportFgColor(q){return this._setOrReportSpecialColor(q,0)}setOrReportBgColor(q){return this._setOrReportSpecialColor(q,1)}setOrReportCursorColor(q){return this._setOrReportSpecialColor(q,2)}restoreIndexedColor(q){if(!q)return this._onColor.fire([{type:2}]),!0;let Y=[],G=q.split(";");for(let H=0;H<G.length;++H)if(/^\d+$/.exec(G[H])){let F=parseInt(G[H]);M4(F)&&Y.push({type:2,index:F})}return Y.length&&this._onColor.fire(Y),!0}restoreFgColor(q){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(q){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(q){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,s0),!0}selectCharset(q){return q.length!==2?(this.selectDefaultCharset(),!0):(q[0]==="/"||this._charsetService.setgCharset(D8[q[0]],i[q[1]]||s0),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let q=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,q,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=o.clone(),this._eraseAttrDataInternal=o.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=this._curAttrData.bg&67108863,this._eraseAttrDataInternal}setgLevel(q){return this._charsetService.setgLevel(q),!0}screenAlignmentPattern(){let q=new B0;q.content=4194373,q.fg=this._curAttrData.fg,q.bg=this._curAttrData.bg,this._setCursor(0,0);for(let Y=0;Y<this._bufferService.rows;++Y){let G=this._activeBuffer.ybase+this._activeBuffer.y+Y,H=this._activeBuffer.lines.get(G);H&&(H.fill(q),H.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(q,Y){let G=($)=>(this._coreService.triggerDataEvent(`${U.ESC}${$}${U.ESC}\\`),!0),H=this._bufferService.buffer,F=this._optionsService.rawOptions;return G(q==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:q==='"p'?'P1$r61;1"p':q==="r"?`P1$r${H.scrollTop+1};${H.scrollBottom+1}r`:q==="m"?"P1$r0m":q===" q"?`P1$r${{block:2,underline:4,bar:6}[F.cursorStyle]-(F.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(q,Y){this._dirtyRowTracker.markRangeDirty(q,Y)}},q3=class{constructor(q){this._bufferService=q,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(q){q<this.start?this.start=q:q>this.end&&(this.end=q)}markRangeDirty(q,Y){q>Y&&(z4=q,q=Y,Y=z4),q<this.start&&(this.start=q),Y>this.end&&(this.end=Y)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};q3=a([A(0,X0)],q3);function M4(q){return 0<=q&&q<256}var A8=50000000,j4=12,k8=50,L8=class extends S{constructor(q){super();this._action=q,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this._register(new B),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(q,Y){if(Y!==void 0&&this._syncCalls>Y){this._syncCalls=0;return}if(this._pendingData+=q.length,this._writeBuffer.push(q),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;this._isSyncWriting=!0;let G;for(;G=this._writeBuffer.shift();){this._action(G);let H=this._callbacks.shift();H&&H()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(q,Y){if(this._pendingData>A8)throw Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput){this._didUserInput=!1,this._pendingData+=q.length,this._writeBuffer.push(q),this._callbacks.push(Y),this._innerWrite();return}setTimeout(()=>this._innerWrite())}this._pendingData+=q.length,this._writeBuffer.push(q),this._callbacks.push(Y)}_innerWrite(q=0,Y=!0){let G=q||performance.now();for(;this._writeBuffer.length>this._bufferOffset;){let H=this._writeBuffer[this._bufferOffset],F=this._action(H,Y);if(F){let $=(V)=>performance.now()-G>=j4?setTimeout(()=>this._innerWrite(0,V)):this._innerWrite(G,V);F.catch((V)=>(queueMicrotask(()=>{throw V}),Promise.resolve(!1))).then($);return}let Z=this._callbacks[this._bufferOffset];if(Z&&Z(),this._bufferOffset++,this._pendingData-=H.length,performance.now()-G>=j4)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>k8&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}},Y3=class{constructor(q){this._bufferService=q,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(q){let Y=this._bufferService.buffer;if(q.id===void 0){let V=Y.addMarker(Y.ybase+Y.y),X={data:q,id:this._nextId++,lines:[V]};return V.onDispose(()=>this._removeMarkerFromLink(X,V)),this._dataByLinkId.set(X.id,X),X.id}let G=q,H=this._getEntryIdKey(G),F=this._entriesWithId.get(H);if(F)return this.addLineToLink(F.id,Y.ybase+Y.y),F.id;let Z=Y.addMarker(Y.ybase+Y.y),$={id:this._nextId++,key:this._getEntryIdKey(G),data:G,lines:[Z]};return Z.onDispose(()=>this._removeMarkerFromLink($,Z)),this._entriesWithId.set($.key,$),this._dataByLinkId.set($.id,$),$.id}addLineToLink(q,Y){let G=this._dataByLinkId.get(q);if(G&&G.lines.every((H)=>H.line!==Y)){let H=this._bufferService.buffer.addMarker(Y);G.lines.push(H),H.onDispose(()=>this._removeMarkerFromLink(G,H))}}getLinkData(q){return this._dataByLinkId.get(q)?.data}_getEntryIdKey(q){return`${q.id};;${q.uri}`}_removeMarkerFromLink(q,Y){let G=q.lines.indexOf(Y);G!==-1&&(q.lines.splice(G,1),q.lines.length===0&&(q.data.id!==void 0&&this._entriesWithId.delete(q.key),this._dataByLinkId.delete(q.id)))}};Y3=a([A(0,X0)],Y3);var K4=!1,Q8=class extends S{constructor(q){super();this._windowsWrappingHeuristics=this._register(new F1),this._onBinary=this._register(new B),this.onBinary=this._onBinary.event,this._onData=this._register(new B),this.onData=this._onData.event,this._onLineFeed=this._register(new B),this.onLineFeed=this._onLineFeed.event,this._onResize=this._register(new B),this.onResize=this._onResize.event,this._onWriteParsed=this._register(new B),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this._register(new B),this._instantiationService=new o7,this.optionsService=this._register(new F8(q)),this._instantiationService.setService(z0,this.optionsService),this._bufferService=this._register(this._instantiationService.createInstance(i2)),this._instantiationService.setService(X0,this._bufferService),this._logService=this._register(this._instantiationService.createInstance(r2)),this._instantiationService.setService(L4,this._logService),this.coreService=this._register(this._instantiationService.createInstance(t2)),this._instantiationService.setService(q1,this.coreService),this.coreMouseService=this._register(this._instantiationService.createInstance(e2)),this._instantiationService.setService(k4,this.coreMouseService),this.unicodeService=this._register(this._instantiationService.createInstance(r0)),this._instantiationService.setService(U5,this.unicodeService),this._charsetService=this._instantiationService.createInstance(X8),this._instantiationService.setService(C5,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(Y3),this._instantiationService.setService(Q4,this._oscLinkService),this._inputHandler=this._register(new R8(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this._register($0.forward(this._inputHandler.onLineFeed,this._onLineFeed)),this._register(this._inputHandler),this._register($0.forward(this._bufferService.onResize,this._onResize)),this._register($0.forward(this.coreService.onData,this._onData)),this._register($0.forward(this.coreService.onBinary,this._onBinary)),this._register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom(!0))),this._register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this._register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this._register(this._bufferService.onScroll(()=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this._register(new L8((Y,G)=>this._inputHandler.parse(Y,G))),this._register($0.forward(this._writeBuffer.onWriteParsed,this._onWriteParsed))}get onScroll(){return this._onScrollApi||(this._onScrollApi=this._register(new B),this._onScroll.event((q)=>{this._onScrollApi?.fire(q.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(q){for(let Y in q)this.optionsService.options[Y]=q[Y]}write(q,Y){this._writeBuffer.write(q,Y)}writeSync(q,Y){this._logService.logLevel<=3&&!K4&&(this._logService.warn("writeSync is unreliable and will be removed soon."),K4=!0),this._writeBuffer.writeSync(q,Y)}input(q,Y=!0){this.coreService.triggerDataEvent(q,Y)}resize(q,Y){isNaN(q)||isNaN(Y)||(q=Math.max(q,q5),Y=Math.max(Y,Y5),this._bufferService.resize(q,Y))}scroll(q,Y=!1){this._bufferService.scroll(q,Y)}scrollLines(q,Y){this._bufferService.scrollLines(q,Y)}scrollPages(q){this.scrollLines(q*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(q){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(q){let Y=q-this._bufferService.buffer.ydisp;Y!==0&&this.scrollLines(Y)}registerEscHandler(q,Y){return this._inputHandler.registerEscHandler(q,Y)}registerDcsHandler(q,Y){return this._inputHandler.registerDcsHandler(q,Y)}registerCsiHandler(q,Y){return this._inputHandler.registerCsiHandler(q,Y)}registerOscHandler(q,Y){return this._inputHandler.registerOscHandler(q,Y)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let q=!1,Y=this.optionsService.rawOptions.windowsPty;Y&&Y.buildNumber!==void 0&&Y.buildNumber!==void 0?q=Y.backend==="conpty"&&Y.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(q=!0),q?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let q=[];q.push(this.onLineFeed(F4.bind(null,this._bufferService))),q.push(this.registerCsiHandler({final:"H"},()=>(F4(this._bufferService),!1))),this._windowsWrappingHeuristics.value=m(()=>{for(let Y of q)Y.dispose()})}}},P8={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};function O8(q,Y,G,H){let F={type:0,cancel:!1,key:void 0},Z=(q.shiftKey?1:0)|(q.altKey?2:0)|(q.ctrlKey?4:0)|(q.metaKey?8:0);switch(q.keyCode){case 0:q.key==="UIKeyInputUpArrow"?Y?F.key=U.ESC+"OA":F.key=U.ESC+"[A":q.key==="UIKeyInputLeftArrow"?Y?F.key=U.ESC+"OD":F.key=U.ESC+"[D":q.key==="UIKeyInputRightArrow"?Y?F.key=U.ESC+"OC":F.key=U.ESC+"[C":q.key==="UIKeyInputDownArrow"&&(Y?F.key=U.ESC+"OB":F.key=U.ESC+"[B");break;case 8:F.key=q.ctrlKey?"\b":U.DEL,q.altKey&&(F.key=U.ESC+F.key);break;case 9:if(q.shiftKey){F.key=U.ESC+"[Z";break}F.key=U.HT,F.cancel=!0;break;case 13:F.key=q.altKey?U.ESC+U.CR:U.CR,F.cancel=!0;break;case 27:F.key=U.ESC,q.altKey&&(F.key=U.ESC+U.ESC),F.cancel=!0;break;case 37:if(q.metaKey)break;Z?F.key=U.ESC+"[1;"+(Z+1)+"D":Y?F.key=U.ESC+"OD":F.key=U.ESC+"[D";break;case 39:if(q.metaKey)break;Z?F.key=U.ESC+"[1;"+(Z+1)+"C":Y?F.key=U.ESC+"OC":F.key=U.ESC+"[C";break;case 38:if(q.metaKey)break;Z?F.key=U.ESC+"[1;"+(Z+1)+"A":Y?F.key=U.ESC+"OA":F.key=U.ESC+"[A";break;case 40:if(q.metaKey)break;Z?F.key=U.ESC+"[1;"+(Z+1)+"B":Y?F.key=U.ESC+"OB":F.key=U.ESC+"[B";break;case 45:!q.shiftKey&&!q.ctrlKey&&(F.key=U.ESC+"[2~");break;case 46:Z?F.key=U.ESC+"[3;"+(Z+1)+"~":F.key=U.ESC+"[3~";break;case 36:Z?F.key=U.ESC+"[1;"+(Z+1)+"H":Y?F.key=U.ESC+"OH":F.key=U.ESC+"[H";break;case 35:Z?F.key=U.ESC+"[1;"+(Z+1)+"F":Y?F.key=U.ESC+"OF":F.key=U.ESC+"[F";break;case 33:q.shiftKey?F.type=2:q.ctrlKey?F.key=U.ESC+"[5;"+(Z+1)+"~":F.key=U.ESC+"[5~";break;case 34:q.shiftKey?F.type=3:q.ctrlKey?F.key=U.ESC+"[6;"+(Z+1)+"~":F.key=U.ESC+"[6~";break;case 112:Z?F.key=U.ESC+"[1;"+(Z+1)+"P":F.key=U.ESC+"OP";break;case 113:Z?F.key=U.ESC+"[1;"+(Z+1)+"Q":F.key=U.ESC+"OQ";break;case 114:Z?F.key=U.ESC+"[1;"+(Z+1)+"R":F.key=U.ESC+"OR";break;case 115:Z?F.key=U.ESC+"[1;"+(Z+1)+"S":F.key=U.ESC+"OS";break;case 116:Z?F.key=U.ESC+"[15;"+(Z+1)+"~":F.key=U.ESC+"[15~";break;case 117:Z?F.key=U.ESC+"[17;"+(Z+1)+"~":F.key=U.ESC+"[17~";break;case 118:Z?F.key=U.ESC+"[18;"+(Z+1)+"~":F.key=U.ESC+"[18~";break;case 119:Z?F.key=U.ESC+"[19;"+(Z+1)+"~":F.key=U.ESC+"[19~";break;case 120:Z?F.key=U.ESC+"[20;"+(Z+1)+"~":F.key=U.ESC+"[20~";break;case 121:Z?F.key=U.ESC+"[21;"+(Z+1)+"~":F.key=U.ESC+"[21~";break;case 122:Z?F.key=U.ESC+"[23;"+(Z+1)+"~":F.key=U.ESC+"[23~";break;case 123:Z?F.key=U.ESC+"[24;"+(Z+1)+"~":F.key=U.ESC+"[24~";break;default:if(q.ctrlKey&&!q.shiftKey&&!q.altKey&&!q.metaKey)q.keyCode>=65&&q.keyCode<=90?F.key=String.fromCharCode(q.keyCode-64):q.keyCode===32?F.key=U.NUL:q.keyCode>=51&&q.keyCode<=55?F.key=String.fromCharCode(q.keyCode-51+27):q.keyCode===56?F.key=U.DEL:q.keyCode===219?F.key=U.ESC:q.keyCode===220?F.key=U.FS:q.keyCode===221&&(F.key=U.GS);else if((!G||H)&&q.altKey&&!q.metaKey){let $=P8[q.keyCode]?.[q.shiftKey?1:0];if($)F.key=U.ESC+$;else if(q.keyCode>=65&&q.keyCode<=90){let V=q.ctrlKey?q.keyCode-64:q.keyCode+32,X=String.fromCharCode(V);q.shiftKey&&(X=X.toUpperCase()),F.key=U.ESC+X}else if(q.keyCode===32)F.key=U.ESC+(q.ctrlKey?U.NUL:" ");else if(q.key==="Dead"&&q.code.startsWith("Key")){let V=q.code.slice(3,4);q.shiftKey||(V=V.toLowerCase()),F.key=U.ESC+V,F.cancel=!0}}else G&&!q.altKey&&!q.ctrlKey&&!q.shiftKey&&q.metaKey?q.keyCode===65&&(F.type=1):q.key&&!q.ctrlKey&&!q.altKey&&!q.metaKey&&q.keyCode>=48&&q.key.length===1?F.key=q.key:q.key&&q.ctrlKey&&(q.key==="_"&&(F.key=U.US),q.key==="@"&&(F.key=U.NUL));break}return F}var l=0,x8=class{constructor(q){this._getKey=q,this._array=[],this._insertedValues=[],this._flushInsertedTask=new Y2,this._isFlushingInserted=!1,this._deletedIndices=[],this._flushDeletedTask=new Y2,this._isFlushingDeleted=!1}clear(){this._array.length=0,this._insertedValues.length=0,this._flushInsertedTask.clear(),this._isFlushingInserted=!1,this._deletedIndices.length=0,this._flushDeletedTask.clear(),this._isFlushingDeleted=!1}insert(q){this._flushCleanupDeleted(),this._insertedValues.length===0&&this._flushInsertedTask.enqueue(()=>this._flushInserted()),this._insertedValues.push(q)}_flushInserted(){let q=this._insertedValues.sort((F,Z)=>this._getKey(F)-this._getKey(Z)),Y=0,G=0,H=Array(this._array.length+this._insertedValues.length);for(let F=0;F<H.length;F++)G>=this._array.length||this._getKey(q[Y])<=this._getKey(this._array[G])?(H[F]=q[Y],Y++):H[F]=this._array[G++];this._array=H,this._insertedValues.length=0}_flushCleanupInserted(){!this._isFlushingInserted&&this._insertedValues.length>0&&this._flushInsertedTask.flush()}delete(q){if(this._flushCleanupInserted(),this._array.length===0)return!1;let Y=this._getKey(q);if(Y===void 0||(l=this._search(Y),l===-1)||this._getKey(this._array[l])!==Y)return!1;do if(this._array[l]===q)return this._deletedIndices.length===0&&this._flushDeletedTask.enqueue(()=>this._flushDeleted()),this._deletedIndices.push(l),!0;while(++l<this._array.length&&this._getKey(this._array[l])===Y);return!1}_flushDeleted(){this._isFlushingDeleted=!0;let q=this._deletedIndices.sort((F,Z)=>F-Z),Y=0,G=Array(this._array.length-q.length),H=0;for(let F=0;F<this._array.length;F++)q[Y]===F?Y++:G[H++]=this._array[F];this._array=G,this._deletedIndices.length=0,this._isFlushingDeleted=!1}_flushCleanupDeleted(){!this._isFlushingDeleted&&this._deletedIndices.length>0&&this._flushDeletedTask.flush()}*getKeyIterator(q){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(l=this._search(q),!(l<0||l>=this._array.length)&&this._getKey(this._array[l])===q))do yield this._array[l];while(++l<this._array.length&&this._getKey(this._array[l])===q)}forEachByKey(q,Y){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(l=this._search(q),!(l<0||l>=this._array.length)&&this._getKey(this._array[l])===q))do Y(this._array[l]);while(++l<this._array.length&&this._getKey(this._array[l])===q)}values(){return this._flushCleanupInserted(),this._flushCleanupDeleted(),[...this._array].values()}_search(q){let Y=0,G=this._array.length-1;for(;G>=Y;){let H=Y+G>>1,F=this._getKey(this._array[H]);if(F>q)G=H-1;else if(F<q)Y=H+1;else{for(;H>0&&this._getKey(this._array[H-1])===q;)H--;return H}}return Y}},O2=0,W4=0,y8=class extends S{constructor(){super();this._decorations=new x8((q)=>q?.marker.line),this._onDecorationRegistered=this._register(new B),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this._register(new B),this.onDecorationRemoved=this._onDecorationRemoved.event,this._register(m(()=>this.reset()))}get decorations(){return this._decorations.values()}registerDecoration(q){if(q.marker.isDisposed)return;let Y=new S8(q);if(Y){let G=Y.marker.onDispose(()=>Y.dispose()),H=Y.onDispose(()=>{H.dispose(),Y&&(this._decorations.delete(Y)&&this._onDecorationRemoved.fire(Y),G.dispose())});this._decorations.insert(Y),this._onDecorationRegistered.fire(Y)}return Y}reset(){for(let q of this._decorations.values())q.dispose();this._decorations.clear()}*getDecorationsAtCell(q,Y,G){let H=0,F=0;for(let Z of this._decorations.getKeyIterator(Y))H=Z.options.x??0,F=H+(Z.options.width??1),q>=H&&q<F&&(!G||(Z.options.layer??"bottom")===G)&&(yield Z)}forEachDecorationAtCell(q,Y,G,H){this._decorations.forEachByKey(Y,(F)=>{O2=F.options.x??0,W4=O2+(F.options.width??1),q>=O2&&q<W4&&(!G||(F.options.layer??"bottom")===G)&&H(F)})}},S8=class extends a0{constructor(q){super();this.options=q,this.onRenderEmitter=this.add(new B),this.onRender=this.onRenderEmitter.event,this._onDispose=this.add(new B),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=q.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=u.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=u.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}dispose(){this._onDispose.fire(),super.dispose()}},w8=1000,I8=class{constructor(q,Y=w8){this._renderCallback=q,this._debounceThresholdMS=Y,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(q,Y,G){this._rowCount=G,q=q!==void 0?q:0,Y=Y!==void 0?Y:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,q):q,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,Y):Y;let H=performance.now();if(H-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=H,this._innerRefresh();else if(!this._additionalRefreshRequested){let F=H-this._lastRefreshMs,Z=this._debounceThresholdMS-F;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=performance.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},Z)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;let q=Math.max(this._rowStart,0),Y=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(q,Y)}},C4=20,U4=!1,G2=class extends S{constructor(q,Y,G,H){super();this._terminal=q,this._coreBrowserService=G,this._renderService=H,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="";let F=this._coreBrowserService.mainDocument;this._accessibilityContainer=F.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=F.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let Z=0;Z<this._terminal.rows;Z++)this._rowElements[Z]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[Z]);if(this._topBoundaryFocusListener=(Z)=>this._handleBoundaryFocus(Z,0),this._bottomBoundaryFocusListener=(Z)=>this._handleBoundaryFocus(Z,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=F.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this._register(new I8(this._renderRows.bind(this))),!this._terminal.element)throw Error("Cannot enable accessibility before Terminal.open");U4?(this._accessibilityContainer.classList.add("debug"),this._rowContainer.classList.add("debug"),this._debugRootContainer=F.createElement("div"),this._debugRootContainer.classList.add("xterm"),this._debugRootContainer.appendChild(F.createTextNode("------start a11y------")),this._debugRootContainer.appendChild(this._accessibilityContainer),this._debugRootContainer.appendChild(F.createTextNode("------end a11y------")),this._terminal.element.insertAdjacentElement("afterend",this._debugRootContainer)):this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this._register(this._terminal.onResize((Z)=>this._handleResize(Z.rows))),this._register(this._terminal.onRender((Z)=>this._refreshRows(Z.start,Z.end))),this._register(this._terminal.onScroll(()=>this._refreshRows())),this._register(this._terminal.onA11yChar((Z)=>this._handleChar(Z))),this._register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this._register(this._terminal.onA11yTab((Z)=>this._handleTab(Z))),this._register(this._terminal.onKey((Z)=>this._handleKey(Z.key))),this._register(this._terminal.onBlur(()=>this._clearLiveRegion())),this._register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._register(y(F,"selectionchange",()=>this._handleSelectionChange())),this._register(this._coreBrowserService.onDprChange(()=>this._refreshRowsDimensions())),this._refreshRowsDimensions(),this._refreshRows(),this._register(m(()=>{U4?this._debugRootContainer.remove():this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(q){for(let Y=0;Y<q;Y++)this._handleChar(" ")}_handleChar(q){this._liveRegionLineCount<C4+1&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==q&&(this._charsToAnnounce+=q):this._charsToAnnounce+=q,q===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===C4+1&&(this._liveRegion.textContent+=y2.get())))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(q){this._clearLiveRegion(),/\p{Control}/u.test(q)||this._charsToConsume.push(q)}_refreshRows(q,Y){this._liveRegionDebouncer.refresh(q,Y,this._terminal.rows)}_renderRows(q,Y){let G=this._terminal.buffer,H=G.lines.length.toString();for(let F=q;F<=Y;F++){let Z=G.lines.get(G.ydisp+F),$=[],V=Z?.translateToString(!0,void 0,void 0,$)||"",X=(G.ydisp+F+1).toString(),J=this._rowElements[F];J&&(V.length===0?(J.textContent="",this._rowColumns.set(J,[0,1])):(J.textContent=V,this._rowColumns.set(J,$)),J.setAttribute("aria-posinset",X),J.setAttribute("aria-setsize",H),this._alignRowWidth(J))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(q,Y){let G=q.target,H=this._rowElements[Y===0?1:this._rowElements.length-2],F=G.getAttribute("aria-posinset"),Z=Y===0?"1":`${this._terminal.buffer.lines.length}`;if(F===Z||q.relatedTarget!==H)return;let $,V;if(Y===0?($=G,V=this._rowElements.pop(),this._rowContainer.removeChild(V)):($=this._rowElements.shift(),V=G,this._rowContainer.removeChild($)),$.removeEventListener("focus",this._topBoundaryFocusListener),V.removeEventListener("focus",this._bottomBoundaryFocusListener),Y===0){let X=this._createAccessibilityTreeNode();this._rowElements.unshift(X),this._rowContainer.insertAdjacentElement("afterbegin",X)}else{let X=this._createAccessibilityTreeNode();this._rowElements.push(X),this._rowContainer.appendChild(X)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(Y===0?-1:1),this._rowElements[Y===0?1:this._rowElements.length-2].focus(),q.preventDefault(),q.stopImmediatePropagation()}_handleSelectionChange(){if(this._rowElements.length===0)return;let q=this._coreBrowserService.mainDocument.getSelection();if(!q)return;if(q.isCollapsed){this._rowContainer.contains(q.anchorNode)&&this._terminal.clearSelection();return}if(!q.anchorNode||!q.focusNode){console.error("anchorNode and/or focusNode are null");return}let Y={node:q.anchorNode,offset:q.anchorOffset},G={node:q.focusNode,offset:q.focusOffset};if((Y.node.compareDocumentPosition(G.node)&Node.DOCUMENT_POSITION_PRECEDING||Y.node===G.node&&Y.offset>G.offset)&&([Y,G]=[G,Y]),Y.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(Y={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(Y.node))return;let H=this._rowElements.slice(-1)[0];if(G.node.compareDocumentPosition(H)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(G={node:H,offset:H.textContent?.length??0}),!this._rowContainer.contains(G.node))return;let F=({node:V,offset:X})=>{let J=V instanceof Text?V.parentNode:V,M=parseInt(J?.getAttribute("aria-posinset"),10)-1;if(isNaN(M))return console.warn("row is invalid. Race condition?"),null;let z=this._rowColumns.get(J);if(!z)return console.warn("columns is null. Race condition?"),null;let K=X<z.length?z[X]:z.slice(-1)[0]+1;return K>=this._terminal.cols&&(++M,K=0),{row:M,column:K}},Z=F(Y),$=F(G);if(!(!Z||!$)){if(Z.row>$.row||Z.row===$.row&&Z.column>=$.column)throw Error("invalid range");this._terminal.select(Z.column,Z.row,($.row-Z.row)*this._terminal.cols-Z.column+$.column)}}_handleResize(q){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let Y=this._rowContainer.children.length;Y<this._terminal.rows;Y++)this._rowElements[Y]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[Y]);for(;this._rowElements.length>q;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){let q=this._coreBrowserService.mainDocument.createElement("div");return q.setAttribute("role","listitem"),q.tabIndex=-1,this._refreshRowDimensions(q),q}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){Object.assign(this._accessibilityContainer.style,{width:`${this._renderService.dimensions.css.canvas.width}px`,fontSize:`${this._terminal.options.fontSize}px`}),this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let q=0;q<this._terminal.rows;q++)this._refreshRowDimensions(this._rowElements[q]),this._alignRowWidth(this._rowElements[q])}}_refreshRowDimensions(q){q.style.height=`${this._renderService.dimensions.css.cell.height}px`}_alignRowWidth(q){q.style.transform="";let Y=q.getBoundingClientRect().width,G=this._rowColumns.get(q)?.slice(-1)?.[0];if(!G)return;let H=G*this._renderService.dimensions.css.cell.width;q.style.transform=`scaleX(${H/Y})`}};G2=a([A(1,H3),A(2,_0),A(3,E0)],G2);var G3=class extends S{constructor(q,Y,G,H,F){super();this._element=q,this._mouseService=Y,this._renderService=G,this._bufferService=H,this._linkProviderService=F,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this._register(new B),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this._register(new B),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this._register(m(()=>{t0(this._linkCacheDisposables),this._linkCacheDisposables.length=0,this._lastMouseEvent=void 0,this._activeProviderReplies?.clear()})),this._register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0})),this._register(y(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this._register(y(this._element,"mousemove",this._handleMouseMove.bind(this))),this._register(y(this._element,"mousedown",this._handleMouseDown.bind(this))),this._register(y(this._element,"mouseup",this._handleMouseUp.bind(this)))}get currentLink(){return this._currentLink}_handleMouseMove(q){this._lastMouseEvent=q;let Y=this._positionFromMouseEvent(q,this._element,this._mouseService);if(!Y)return;this._isMouseOut=!1;let G=q.composedPath();for(let H=0;H<G.length;H++){let F=G[H];if(F.classList.contains("xterm"))break;if(F.classList.contains("xterm-hover"))return}(!this._lastBufferCell||Y.x!==this._lastBufferCell.x||Y.y!==this._lastBufferCell.y)&&(this._handleHover(Y),this._lastBufferCell=Y)}_handleHover(q){if(this._activeLine!==q.y||this._wasResized){this._clearCurrentLink(),this._askForLink(q,!1),this._wasResized=!1;return}this._currentLink&&this._linkAtPosition(this._currentLink.link,q)||(this._clearCurrentLink(),this._askForLink(q,!0))}_askForLink(q,Y){(!this._activeProviderReplies||!Y)&&(this._activeProviderReplies?.forEach((H)=>{H?.forEach((F)=>{F.link.dispose&&F.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=q.y);let G=!1;for(let[H,F]of this._linkProviderService.linkProviders.entries())Y?this._activeProviderReplies?.get(H)&&(G=this._checkLinkProviderResult(H,q,G)):F.provideLinks(q.y,(Z)=>{if(this._isMouseOut)return;let $=Z?.map((V)=>({link:V}));this._activeProviderReplies?.set(H,$),G=this._checkLinkProviderResult(H,q,G),this._activeProviderReplies?.size===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(q.y,this._activeProviderReplies)})}_removeIntersectingLinks(q,Y){let G=new Set;for(let H=0;H<Y.size;H++){let F=Y.get(H);if(F)for(let Z=0;Z<F.length;Z++){let $=F[Z],V=$.link.range.start.y<q?0:$.link.range.start.x,X=$.link.range.end.y>q?this._bufferService.cols:$.link.range.end.x;for(let J=V;J<=X;J++){if(G.has(J)){F.splice(Z--,1);break}G.add(J)}}}}_checkLinkProviderResult(q,Y,G){if(!this._activeProviderReplies)return G;let H=this._activeProviderReplies.get(q),F=!1;for(let Z=0;Z<q;Z++)(!this._activeProviderReplies.has(Z)||this._activeProviderReplies.get(Z))&&(F=!0);if(!F&&H){let Z=H.find(($)=>this._linkAtPosition($.link,Y));Z&&(G=!0,this._handleNewLink(Z))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!G)for(let Z=0;Z<this._activeProviderReplies.size;Z++){let $=this._activeProviderReplies.get(Z)?.find((V)=>this._linkAtPosition(V.link,Y));if($){G=!0,this._handleNewLink($);break}}return G}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(q){if(!this._currentLink)return;let Y=this._positionFromMouseEvent(q,this._element,this._mouseService);Y&&this._mouseDownLink&&T8(this._mouseDownLink.link,this._currentLink.link)&&this._linkAtPosition(this._currentLink.link,Y)&&this._currentLink.link.activate(q,this._currentLink.link.text)}_clearCurrentLink(q,Y){!this._currentLink||!this._lastMouseEvent||(!q||!Y||this._currentLink.link.range.start.y>=q&&this._currentLink.link.range.end.y<=Y)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,t0(this._linkCacheDisposables),this._linkCacheDisposables.length=0)}_handleNewLink(q){if(!this._lastMouseEvent)return;let Y=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);Y&&this._linkAtPosition(q.link,Y)&&(this._currentLink=q,this._currentLink.state={decorations:{underline:q.link.decorations===void 0?!0:q.link.decorations.underline,pointerCursor:q.link.decorations===void 0?!0:q.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,q.link,this._lastMouseEvent),q.link.decorations={},Object.defineProperties(q.link.decorations,{pointerCursor:{get:()=>this._currentLink?.state?.decorations.pointerCursor,set:(G)=>{this._currentLink?.state&&this._currentLink.state.decorations.pointerCursor!==G&&(this._currentLink.state.decorations.pointerCursor=G,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",G))}},underline:{get:()=>this._currentLink?.state?.decorations.underline,set:(G)=>{this._currentLink?.state&&this._currentLink?.state?.decorations.underline!==G&&(this._currentLink.state.decorations.underline=G,this._currentLink.state.isHovered&&this._fireUnderlineEvent(q.link,G))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange((G)=>{if(!this._currentLink)return;let H=G.start===0?0:G.start+1+this._bufferService.buffer.ydisp,F=this._bufferService.buffer.ydisp+1+G.end;if(this._currentLink.link.range.start.y>=H&&this._currentLink.link.range.end.y<=F&&(this._clearCurrentLink(H,F),this._lastMouseEvent)){let Z=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);Z&&this._askForLink(Z,!1)}})))}_linkHover(q,Y,G){this._currentLink?.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(Y,!0),this._currentLink.state.decorations.pointerCursor&&q.classList.add("xterm-cursor-pointer")),Y.hover&&Y.hover(G,Y.text)}_fireUnderlineEvent(q,Y){let G=q.range,H=this._bufferService.buffer.ydisp,F=this._createLinkUnderlineEvent(G.start.x-1,G.start.y-H-1,G.end.x,G.end.y-H-1,void 0);(Y?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(F)}_linkLeave(q,Y,G){this._currentLink?.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(Y,!1),this._currentLink.state.decorations.pointerCursor&&q.classList.remove("xterm-cursor-pointer")),Y.leave&&Y.leave(G,Y.text)}_linkAtPosition(q,Y){let G=q.range.start.y*this._bufferService.cols+q.range.start.x,H=q.range.end.y*this._bufferService.cols+q.range.end.x,F=Y.y*this._bufferService.cols+Y.x;return G<=F&&F<=H}_positionFromMouseEvent(q,Y,G){let H=G.getCoords(q,Y,this._bufferService.cols,this._bufferService.rows);if(H)return{x:H[0],y:H[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(q,Y,G,H,F){return{x1:q,y1:Y,x2:G,y2:H,cols:this._bufferService.cols,fg:F}}};G3=a([A(1,F3),A(2,E0),A(3,X0),A(4,O4)],G3);function T8(q,Y){return q.text===Y.text&&q.range.start.x===Y.range.start.x&&q.range.start.y===Y.range.start.y&&q.range.end.x===Y.range.end.x&&q.range.end.y===Y.range.end.y}var _8=class extends Q8{constructor(q={}){super(q);this._linkifier=this._register(new F1),this.browser=a4,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this._register(new F1),this._onCursorMove=this._register(new B),this.onCursorMove=this._onCursorMove.event,this._onKey=this._register(new B),this.onKey=this._onKey.event,this._onRender=this._register(new B),this.onRender=this._onRender.event,this._onSelectionChange=this._register(new B),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this._register(new B),this.onTitleChange=this._onTitleChange.event,this._onBell=this._register(new B),this.onBell=this._onBell.event,this._onFocus=this._register(new B),this._onBlur=this._register(new B),this._onA11yCharEmitter=this._register(new B),this._onA11yTabEmitter=this._register(new B),this._onWillOpen=this._register(new B),this._setup(),this._decorationService=this._instantiationService.createInstance(y8),this._instantiationService.setService(I1,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(A7),this._instantiationService.setService(O4,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(w2)),this._register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this._register(this._inputHandler.onRequestRefreshRows((Y)=>this.refresh(Y?.start??0,Y?.end??this.rows-1))),this._register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this._register(this._inputHandler.onRequestReset(()=>this.reset())),this._register(this._inputHandler.onRequestWindowsOptionsReport((Y)=>this._reportWindowsOptions(Y))),this._register(this._inputHandler.onColor((Y)=>this._handleColorEvent(Y))),this._register($0.forward(this._inputHandler.onCursorMove,this._onCursorMove)),this._register($0.forward(this._inputHandler.onTitleChange,this._onTitleChange)),this._register($0.forward(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this._register($0.forward(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this._register(this._bufferService.onResize((Y)=>this._afterResize(Y.cols,Y.rows))),this._register(m(()=>{this._customKeyEventHandler=void 0,this.element?.parentNode?.removeChild(this.element)}))}get linkifier(){return this._linkifier.value}get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}_handleColorEvent(q){if(this._themeService)for(let Y of q){let G,H="";switch(Y.index){case 256:G="foreground",H="10";break;case 257:G="background",H="11";break;case 258:G="cursor",H="12";break;default:G="ansi",H="4;"+Y.index}switch(Y.type){case 0:let F=p.toColorRGB(G==="ansi"?this._themeService.colors.ansi[Y.index]:this._themeService.colors[G]);this.coreService.triggerDataEvent(`${U.ESC}]${H};${B8(F)}${u4.ST}`);break;case 1:if(G==="ansi")this._themeService.modifyColors((Z)=>Z.ansi[Y.index]=n.toColor(...Y.color));else{let Z=G;this._themeService.modifyColors(($)=>$[Z]=n.toColor(...Y.color))}break;case 2:this._themeService.restoreColor(Y.index);break}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(q){q?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(G2,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(q){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(U.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){return this.textarea?.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(U.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;let q=this.buffer.ybase+this.buffer.y,Y=this.buffer.lines.get(q);if(!Y)return;let G=Math.min(this.buffer.x,this.cols-1),H=this._renderService.dimensions.css.cell.height,F=Y.getWidth(G),Z=this._renderService.dimensions.css.cell.width*F,$=this.buffer.y*this._renderService.dimensions.css.cell.height,V=G*this._renderService.dimensions.css.cell.width;this.textarea.style.left=V+"px",this.textarea.style.top=$+"px",this.textarea.style.width=Z+"px",this.textarea.style.height=H+"px",this.textarea.style.lineHeight=H+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this._register(y(this.element,"copy",(Y)=>{this.hasSelection()&&X5(Y,this._selectionService)}));let q=(Y)=>z5(Y,this.textarea,this.coreService,this.optionsService);this._register(y(this.textarea,"paste",q)),this._register(y(this.element,"paste",q)),l4?this._register(y(this.element,"mousedown",(Y)=>{Y.button===2&&N3(Y,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this._register(y(this.element,"contextmenu",(Y)=>{N3(Y,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),j3&&this._register(y(this.element,"auxclick",(Y)=>{Y.button===1&&R4(Y,this.textarea,this.screenElement)}))}_bindKeys(){this._register(y(this.textarea,"keyup",(q)=>this._keyUp(q),!0)),this._register(y(this.textarea,"keydown",(q)=>this._keyDown(q),!0)),this._register(y(this.textarea,"keypress",(q)=>this._keyPress(q),!0)),this._register(y(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this._register(y(this.textarea,"compositionupdate",(q)=>this._compositionHelper.compositionupdate(q))),this._register(y(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this._register(y(this.textarea,"input",(q)=>this._inputEvent(q),!0)),this._register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(q){if(!q)throw Error("Terminal requires a parent element.");if(q.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this.element?.ownerDocument.defaultView&&this._coreBrowserService){this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView);return}this._document=q.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),q.appendChild(this.element);let Y=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),Y.appendChild(this._viewportElement),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._register(y(this.screenElement,"mousemove",(F)=>this.updateCursorStyle(F))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),Y.appendChild(this.screenElement);let G=this.textarea=this._document.createElement("textarea");this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",x2.get()),s4||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._register(this.optionsService.onSpecificOptionChange("disableStdin",()=>G.readOnly=this.optionsService.rawOptions.disableStdin)),this.textarea.readOnly=this.optionsService.rawOptions.disableStdin,this._coreBrowserService=this._register(this._instantiationService.createInstance(D7,this.textarea,q.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(_0,this._coreBrowserService),this._register(y(this.textarea,"focus",(F)=>this._handleTextAreaFocus(F))),this._register(y(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(a2,this._document,this._helperContainer),this._instantiationService.setService(F2,this._charSizeService),this._themeService=this._instantiationService.createInstance(s2),this._instantiationService.setService(Z1,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(e1),this._instantiationService.setService(P4,this._characterJoinerService),this._renderService=this._register(this._instantiationService.createInstance(o2,this.rows,this.screenElement)),this._instantiationService.setService(E0,this._renderService),this._register(this._renderService.onRenderedViewportChange((F)=>this._onRender.fire(F))),this.onResize((F)=>this._renderService.resize(F.cols,F.rows)),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(d2,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(l2),this._instantiationService.setService(F3,this._mouseService);let H=this._linkifier.value=this._register(this._instantiationService.createInstance(G3,this.screenElement));this.element.appendChild(Y);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this._register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this._register(this.onBlur(()=>this._renderService.handleBlur())),this._register(this.onFocus(()=>this._renderService.handleFocus())),this._viewport=this._register(this._instantiationService.createInstance(g2,this.element,this.screenElement)),this._register(this._viewport.onRequestScrollLines((F)=>{super.scrollLines(F,!1),this.refresh(0,this.rows-1)})),this._selectionService=this._register(this._instantiationService.createInstance(n2,this.element,this.screenElement,H)),this._instantiationService.setService(B5,this._selectionService),this._register(this._selectionService.onRequestScrollLines((F)=>this.scrollLines(F.amount,F.suppressScrollEvent))),this._register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this._register(this._selectionService.onRequestRedraw((F)=>this._renderService.handleSelectionChanged(F.start,F.end,F.columnSelectMode))),this._register(this._selectionService.onLinuxMouseSelection((F)=>{this.textarea.value=F,this.textarea.focus(),this.textarea.select()})),this._register($0.any(this._onScroll.event,this._inputHandler.onScroll)(()=>{this._selectionService.refresh(),this._viewport?.queueSync()})),this._register(this._instantiationService.createInstance(h2,this.screenElement)),this._register(y(this.element,"mousedown",(F)=>this._selectionService.handleMouseDown(F))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(G2,this)),this._register(this.optionsService.onSpecificOptionChange("screenReaderMode",(F)=>this._handleScreenReaderModeOptionChange(F))),this.options.overviewRuler.width&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(t1,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRuler",(F)=>{!this._overviewRulerRenderer&&F&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(t1,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(c2,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){let q=this,Y=this.element;function G(Z){let $=q._mouseService.getMouseReportCoords(Z,q.screenElement);if(!$)return!1;let V,X;switch(Z.overrideType||Z.type){case"mousemove":X=32,Z.buttons===void 0?(V=3,Z.button!==void 0&&(V=Z.button<3?Z.button:3)):V=Z.buttons&1?0:Z.buttons&4?1:Z.buttons&2?2:3;break;case"mouseup":X=0,V=Z.button<3?Z.button:3;break;case"mousedown":X=1,V=Z.button<3?Z.button:3;break;case"wheel":if(q._customWheelEventHandler&&q._customWheelEventHandler(Z)===!1)return!1;let J=Z.deltaY;if(J===0||q.coreMouseService.consumeWheelEvent(Z,q._renderService?.dimensions?.device?.cell?.height,q._coreBrowserService?.dpr)===0)return!1;X=J<0?0:1,V=4;break;default:return!1}return X===void 0||V===void 0||V>4?!1:q.coreMouseService.triggerMouseEvent({col:$.col,row:$.row,x:$.x,y:$.y,button:V,action:X,ctrl:Z.ctrlKey,alt:Z.altKey,shift:Z.shiftKey})}let H={mouseup:null,wheel:null,mousedrag:null,mousemove:null},F={mouseup:(Z)=>(G(Z),Z.buttons||(this._document.removeEventListener("mouseup",H.mouseup),H.mousedrag&&this._document.removeEventListener("mousemove",H.mousedrag)),this.cancel(Z)),wheel:(Z)=>(G(Z),this.cancel(Z,!0)),mousedrag:(Z)=>{Z.buttons&&G(Z)},mousemove:(Z)=>{Z.buttons||G(Z)}};this._register(this.coreMouseService.onProtocolChange((Z)=>{Z?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(Z)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),Z&8?H.mousemove||(Y.addEventListener("mousemove",F.mousemove),H.mousemove=F.mousemove):(Y.removeEventListener("mousemove",H.mousemove),H.mousemove=null),Z&16?H.wheel||(Y.addEventListener("wheel",F.wheel,{passive:!1}),H.wheel=F.wheel):(Y.removeEventListener("wheel",H.wheel),H.wheel=null),Z&2?H.mouseup||(H.mouseup=F.mouseup):(this._document.removeEventListener("mouseup",H.mouseup),H.mouseup=null),Z&4?H.mousedrag||(H.mousedrag=F.mousedrag):(this._document.removeEventListener("mousemove",H.mousedrag),H.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this._register(y(Y,"mousedown",(Z)=>{if(Z.preventDefault(),this.focus(),!(!this.coreMouseService.areMouseEventsActive||this._selectionService.shouldForceSelection(Z)))return G(Z),H.mouseup&&this._document.addEventListener("mouseup",H.mouseup),H.mousedrag&&this._document.addEventListener("mousemove",H.mousedrag),this.cancel(Z)})),this._register(y(Y,"wheel",(Z)=>{if(!H.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(Z)===!1)return!1;if(!this.buffer.hasScrollback){if(Z.deltaY===0)return!1;if(q.coreMouseService.consumeWheelEvent(Z,q._renderService?.dimensions?.device?.cell?.height,q._coreBrowserService?.dpr)===0)return this.cancel(Z,!0);let $=U.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(Z.deltaY<0?"A":"B");return this.coreService.triggerDataEvent($,!0),this.cancel(Z,!0)}}},{passive:!1}))}refresh(q,Y){this._renderService?.refreshRows(q,Y)}updateCursorStyle(q){this._selectionService?.shouldColumnSelect(q)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(q,Y){this._viewport?this._viewport.scrollLines(q):super.scrollLines(q,Y),this.refresh(0,this.rows-1)}scrollPages(q){this.scrollLines(q*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(q){q&&this._viewport?this._viewport.scrollToLine(this.buffer.ybase,!0):this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(q){let Y=q-this._bufferService.buffer.ydisp;Y!==0&&this.scrollLines(Y)}paste(q){D4(q,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(q){this._customKeyEventHandler=q}attachCustomWheelEventHandler(q){this._customWheelEventHandler=q}registerLinkProvider(q){return this._linkProviderService.registerLinkProvider(q)}registerCharacterJoiner(q){if(!this._characterJoinerService)throw Error("Terminal must be opened first");let Y=this._characterJoinerService.register(q);return this.refresh(0,this.rows-1),Y}deregisterCharacterJoiner(q){if(!this._characterJoinerService)throw Error("Terminal must be opened first");this._characterJoinerService.deregister(q)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(q){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+q)}registerDecoration(q){return this._decorationService.registerDecoration(q)}hasSelection(){return this._selectionService?this._selectionService.hasSelection:!1}select(q,Y,G){this._selectionService.setSelection(q,Y,G)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(!(!this._selectionService||!this._selectionService.hasSelection))return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){this._selectionService?.clearSelection()}selectAll(){this._selectionService?.selectAll()}selectLines(q,Y){this._selectionService?.selectLines(q,Y)}_keyDown(q){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(q)===!1)return!1;let Y=this.browser.isMac&&this.options.macOptionIsMeta&&q.altKey;if(!Y&&!this._compositionHelper.keydown(q))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(!0),!1;!Y&&(q.key==="Dead"||q.key==="AltGraph")&&(this._unprocessedDeadKey=!0);let G=O8(q,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(q),G.type===3||G.type===2){let H=this.rows-1;return this.scrollLines(G.type===2?-H:H),this.cancel(q,!0)}if(G.type===1&&this.selectAll(),this._isThirdLevelShift(this.browser,q)||(G.cancel&&this.cancel(q,!0),!G.key)||q.key&&!q.ctrlKey&&!q.altKey&&!q.metaKey&&q.key.length===1&&q.key.charCodeAt(0)>=65&&q.key.charCodeAt(0)<=90)return!0;if(this._unprocessedDeadKey)return this._unprocessedDeadKey=!1,!0;if((G.key===U.ETX||G.key===U.CR)&&(this.textarea.value=""),this._onKey.fire({key:G.key,domEvent:q}),this._showCursor(),this.coreService.triggerDataEvent(G.key,!0),!this.optionsService.rawOptions.screenReaderMode||q.altKey||q.ctrlKey)return this.cancel(q,!0);this._keyDownHandled=!0}_isThirdLevelShift(q,Y){let G=q.isMac&&!this.options.macOptionIsMeta&&Y.altKey&&!Y.ctrlKey&&!Y.metaKey||q.isWindows&&Y.altKey&&Y.ctrlKey&&!Y.metaKey||q.isWindows&&Y.getModifierState("AltGraph");return Y.type==="keypress"?G:G&&(!Y.keyCode||Y.keyCode>47)}_keyUp(q){this._keyDownSeen=!1,!(this._customKeyEventHandler&&this._customKeyEventHandler(q)===!1)&&(E8(q)||this.focus(),this.updateCursorStyle(q),this._keyPressHandled=!1)}_keyPress(q){let Y;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(q)===!1)return!1;if(this.cancel(q),q.charCode)Y=q.charCode;else if(q.which===null||q.which===void 0)Y=q.keyCode;else if(q.which!==0&&q.charCode!==0)Y=q.which;else return!1;return!Y||(q.altKey||q.ctrlKey||q.metaKey)&&!this._isThirdLevelShift(this.browser,q)?!1:(Y=String.fromCharCode(Y),this._onKey.fire({key:Y,domEvent:q}),this._showCursor(),this.coreService.triggerDataEvent(Y,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,!0)}_inputEvent(q){if(q.data&&q.inputType==="insertText"&&(!q.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;let Y=q.data;return this.coreService.triggerDataEvent(Y,!0),this.cancel(q),!0}return!1}resize(q,Y){if(q===this.cols&&Y===this.rows){this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure();return}super.resize(q,Y)}_afterResize(q,Y){this._charSizeService?.measure()}clear(){if(!(this.buffer.ybase===0&&this.buffer.y===0)){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let q=1;q<this.rows;q++)this.buffer.lines.push(this.buffer.getBlankLine(o));this._onScroll.fire({position:this.buffer.ydisp}),this.refresh(0,this.rows-1)}}reset(){this.options.rows=this.rows,this.options.cols=this.cols;let q=this._customKeyEventHandler;this._setup(),super.reset(),this._selectionService?.reset(),this._decorationService.reset(),this._customKeyEventHandler=q,this.refresh(0,this.rows-1)}clearTextureAtlas(){this._renderService?.clearTextureAtlas()}_reportFocus(){this.element?.classList.contains("focus")?this.coreService.triggerDataEvent(U.ESC+"[I"):this.coreService.triggerDataEvent(U.ESC+"[O")}_reportWindowsOptions(q){if(this._renderService)switch(q){case 0:let Y=this._renderService.dimensions.css.canvas.width.toFixed(0),G=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${U.ESC}[4;${G};${Y}t`);break;case 1:let H=this._renderService.dimensions.css.cell.width.toFixed(0),F=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${U.ESC}[6;${F};${H}t`);break}}cancel(q,Y){if(!(!this.options.cancelEvents&&!Y))return q.preventDefault(),q.stopPropagation(),!1}};function E8(q){return q.keyCode===16||q.keyCode===17||q.keyCode===18}var b8=class{constructor(){this._addons=[]}dispose(){for(let q=this._addons.length-1;q>=0;q--)this._addons[q].instance.dispose()}loadAddon(q,Y){let G={instance:Y,dispose:Y.dispose,isDisposed:!1};this._addons.push(G),Y.dispose=()=>this._wrappedAddonDispose(G),Y.activate(q)}_wrappedAddonDispose(q){if(q.isDisposed)return;let Y=-1;for(let G=0;G<this._addons.length;G++)if(this._addons[G]===q){Y=G;break}if(Y===-1)throw Error("Could not dispose an addon that has not been loaded");q.isDisposed=!0,q.dispose.apply(q.instance),this._addons.splice(Y,1)}},v8=class{constructor(q){this._line=q}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(q,Y){if(!(q<0||q>=this._line.length))return Y?(this._line.loadCell(q,Y),Y):this._line.loadCell(q,new B0)}translateToString(q,Y,G){return this._line.translateToString(q,Y,G)}},N4=class{constructor(q,Y){this._buffer=q,this.type=Y}init(q){return this._buffer=q,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(q){let Y=this._buffer.lines.get(q);if(Y)return new v8(Y)}getNullCell(){return new B0}},f8=class extends S{constructor(q){super();this._core=q,this._onBufferChange=this._register(new B),this.onBufferChange=this._onBufferChange.event,this._normal=new N4(this._core.buffers.normal,"normal"),this._alternate=new N4(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}},p8=class{constructor(q){this._core=q}registerCsiHandler(q,Y){return this._core.registerCsiHandler(q,(G)=>Y(G.toArray()))}addCsiHandler(q,Y){return this.registerCsiHandler(q,Y)}registerDcsHandler(q,Y){return this._core.registerDcsHandler(q,(G,H)=>Y(G,H.toArray()))}addDcsHandler(q,Y){return this.registerDcsHandler(q,Y)}registerEscHandler(q,Y){return this._core.registerEscHandler(q,Y)}addEscHandler(q,Y){return this.registerEscHandler(q,Y)}registerOscHandler(q,Y){return this._core.registerOscHandler(q,Y)}addOscHandler(q,Y){return this.registerOscHandler(q,Y)}},m8=class{constructor(q){this._core=q}register(q){this._core.unicodeService.register(q)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(q){this._core.unicodeService.activeVersion=q}},g8=["cols","rows"],Q0=0,H5=class extends S{constructor(q){super(),this._core=this._register(new _8(q)),this._addonManager=this._register(new b8),this._publicOptions={...this._core.options};let Y=(H)=>this._core.options[H],G=(H,F)=>{this._checkReadonlyOptions(H),this._core.options[H]=F};for(let H in this._core.options){let F={get:Y.bind(this,H),set:G.bind(this,H)};Object.defineProperty(this._publicOptions,H,F)}}_checkReadonlyOptions(q){if(g8.includes(q))throw Error(`Option "${q}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new p8(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new m8(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this._register(new f8(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let q=this._core.coreService.decPrivateModes,Y="none";switch(this._core.coreMouseService.activeProtocol){case"X10":Y="x10";break;case"VT200":Y="vt200";break;case"DRAG":Y="drag";break;case"ANY":Y="any";break}return{applicationCursorKeysMode:q.applicationCursorKeys,applicationKeypadMode:q.applicationKeypad,bracketedPasteMode:q.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:Y,originMode:q.origin,reverseWraparoundMode:q.reverseWraparound,sendFocusMode:q.sendFocus,synchronizedOutputMode:q.synchronizedOutput,wraparoundMode:q.wraparound}}get options(){return this._publicOptions}set options(q){for(let Y in q)this._publicOptions[Y]=q[Y]}blur(){this._core.blur()}focus(){this._core.focus()}input(q,Y=!0){this._core.input(q,Y)}resize(q,Y){this._verifyIntegers(q,Y),this._core.resize(q,Y)}open(q){this._core.open(q)}attachCustomKeyEventHandler(q){this._core.attachCustomKeyEventHandler(q)}attachCustomWheelEventHandler(q){this._core.attachCustomWheelEventHandler(q)}registerLinkProvider(q){return this._core.registerLinkProvider(q)}registerCharacterJoiner(q){return this._checkProposedApi(),this._core.registerCharacterJoiner(q)}deregisterCharacterJoiner(q){this._checkProposedApi(),this._core.deregisterCharacterJoiner(q)}registerMarker(q=0){return this._verifyIntegers(q),this._core.registerMarker(q)}registerDecoration(q){return this._checkProposedApi(),this._verifyPositiveIntegers(q.x??0,q.width??0,q.height??0),this._core.registerDecoration(q)}hasSelection(){return this._core.hasSelection()}select(q,Y,G){this._verifyIntegers(q,Y,G),this._core.select(q,Y,G)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(q,Y){this._verifyIntegers(q,Y),this._core.selectLines(q,Y)}dispose(){super.dispose()}scrollLines(q){this._verifyIntegers(q),this._core.scrollLines(q)}scrollPages(q){this._verifyIntegers(q),this._core.scrollPages(q)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(q){this._verifyIntegers(q),this._core.scrollToLine(q)}clear(){this._core.clear()}write(q,Y){this._core.write(q,Y)}writeln(q,Y){this._core.write(q),this._core.write(`\r
`,Y)}paste(q){this._core.paste(q)}refresh(q,Y){this._verifyIntegers(q,Y),this._core.refresh(q,Y)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(q){this._addonManager.loadAddon(this,q)}static get strings(){return{get promptLabel(){return x2.get()},set promptLabel(q){x2.set(q)},get tooMuchOutput(){return y2.get()},set tooMuchOutput(q){y2.set(q)}}}_verifyIntegers(...q){for(Q0 of q)if(Q0===1/0||isNaN(Q0)||Q0%1!==0)throw Error("This API only accepts integers")}_verifyPositiveIntegers(...q){for(Q0 of q)if(Q0&&(Q0===1/0||isNaN(Q0)||Q0%1!==0||Q0<0))throw Error("This API only accepts positive integers")}};var h8=2,d8=1,F5=class{activate(q){this._terminal=q}dispose(){}fit(){let q=this.proposeDimensions();if(!q||!this._terminal||isNaN(q.cols)||isNaN(q.rows))return;let Y=this._terminal._core;(this._terminal.rows!==q.rows||this._terminal.cols!==q.cols)&&(Y._renderService.clear(),this._terminal.resize(q.cols,q.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let q=this._terminal._core._renderService.dimensions;if(q.css.cell.width===0||q.css.cell.height===0)return;let Y=this._terminal.options.scrollback===0?0:this._terminal.options.overviewRuler?.width||14,G=window.getComputedStyle(this._terminal.element.parentElement),H=parseInt(G.getPropertyValue("height")),F=Math.max(0,parseInt(G.getPropertyValue("width"))),Z=window.getComputedStyle(this._terminal.element),$={top:parseInt(Z.getPropertyValue("padding-top")),bottom:parseInt(Z.getPropertyValue("padding-bottom")),right:parseInt(Z.getPropertyValue("padding-right")),left:parseInt(Z.getPropertyValue("padding-left"))},V=$.top+$.bottom,X=$.right+$.left,J=H-V,M=F-X-Y;return{cols:Math.max(h8,Math.floor(M/q.css.cell.width)),rows:Math.max(d8,Math.floor(J/q.css.cell.height))}}};var Y1,K3,J1=null;function u8(){Y1=new H5({cursorBlink:!0,fontFamily:"CaskaydiaCoveNF, monospace",fontSize:16,theme:{background:"#241f31",foreground:"#deddda"}}),K3=new F5,Y1.loadAddon(K3),Y1.open(document.getElementById("consoleBox")),K3.fit(),document.getElementById("consoleRun").addEventListener("click",()=>{let q=document.getElementById("consoleInput").value;c8(q)})}function c8(q){if(J1)J1.close();Y1.clear(),J1=new EventSource(`../../api/api.php?action=console&cmd=${encodeURIComponent(q)}`),J1.onmessage=(Y)=>{let G=JSON.parse(Y.data);Y1.write(G.output)},J1.onerror=()=>{Y1.write(`\r
[Connection closed]\r
`),J1?.close()}}document.fonts.load("1em CaskaydiaCoveNF").then(()=>{Y1.options.fontFamily="CaskaydiaCoveNF, monospace"});function a8(){document.querySelectorAll(".page, #page-main").forEach((q)=>{q.style.display="none"})}function b0(q){a8();let Y=document.getElementById(q);if(Y)Y.style.display="block";else{let G=document.getElementById("page-main");if(G)G.style.display="block"}}function l8(){document.querySelectorAll(".card").forEach((q)=>{q.addEventListener("click",()=>{let Y=q.dataset.view;if(!Y)return;switch(Y){case"scan-network":b0("page-scan-start");break;case"ping-device":b0("page-ping-device");break;case"security-audit":b0("page-security-audit");break;case"saved-profiles":b0("page-profiles-list");break;case"mac-addresses":b0("page-mac-addresses");break;case"saved-devices":b0("page-saved-devices");break;case"user-command":b0("page-user-command");break;case"export-report":break}})})}function o8(){let q=document.querySelector(".settings-btn"),Y=document.getElementById("settings");if(!q||!Y)return;q.addEventListener("click",()=>{Y.style.display="flex"}),Y.addEventListener("click",(G)=>{if(G.target===Y)Y.style.display="none"})}function n8(){document.querySelectorAll("[data-back]").forEach((q)=>{q.addEventListener("click",()=>{b0("page-main")})})}function W3(q){let Y=document.getElementById("pingOutput");if(Y)Y.textContent=q}function s8(){let q=document.getElementById("pingGoBtn");if(!q)return;q.addEventListener("click",async()=>{let Y=document.getElementById("pingAddress");if(!Y)return;W3(`Pinging ${Y.value}...`);let G=await r8("ping",{ip:Y.value});if(G.error){W3("Error: "+G.error);return}W3(G.alive?"Device is online":"Device is offline")})}async function r8(q,Y={}){let G=new URLSearchParams({action:q,...Y});return(await fetch("../../api.php?"+G.toString())).json()}function i8(){let q=document.getElementById("settings-switch");if(!q)return;if(q.addEventListener("click",()=>{document.body.classList.toggle("dark"),localStorage.setItem("theme",document.body.classList.contains("dark")?"dark":"light")}),localStorage.getItem("theme")==="dark")document.body.classList.add("dark")}function t8(){l8(),o8(),n8(),s8(),i8(),u8(),b0("page-main")}document.addEventListener("DOMContentLoaded",t8);
