var{defineProperty:V6,getOwnPropertyDescriptor:m3}=Object,R3=(x,H)=>{for(var F in H)V6(x,F,{get:H[F],enumerable:!0})},a=(x,H,F,Y)=>{for(var G=Y>1?void 0:Y?m3(H,F):H,q=x.length-1,m;q>=0;q--)(m=x[q])&&(G=(Y?m(H,F,G):m(G))||G);return Y&&G&&V6(H,F,G),G},K=(x,H)=>(F,Y)=>H(F,Y,x),$9="Terminal input",L1={get:()=>$9,set:(x)=>$9=x},A9="Too much output to announce, navigate to rows manually to read",b1={get:()=>A9,set:(x)=>A9=x};function z3(x){return x.replace(/\r?\n/g,"\r")}function C3(x,H){return H?"\x1B[200~"+x+"\x1B[201~":x}function N3(x,H){x.clipboardData&&x.clipboardData.setData("text/plain",H.selectionText),x.preventDefault()}function M3(x,H,F,Y){if(x.stopPropagation(),x.clipboardData){let G=x.clipboardData.getData("text/plain");W6(G,H,F,Y)}}function W6(x,H,F,Y){x=z3(x),x=C3(x,F.decPrivateModes.bracketedPasteMode&&Y.rawOptions.ignoreBracketedPasteMode!==!0),F.triggerDataEvent(x,!0),H.value=""}function X6(x,H,F){let Y=F.getBoundingClientRect(),G=x.clientX-Y.left-10,q=x.clientY-Y.top-10;H.style.width="20px",H.style.height="20px",H.style.left=`${G}px`,H.style.top=`${q}px`,H.style.zIndex="1000",H.focus()}function J9(x,H,F,Y,G){X6(x,H,F),G&&Y.rightClickSelect(x),H.value=Y.selectionText,H.select()}function u0(x){return x>65535?(x-=65536,String.fromCharCode((x>>10)+55296)+String.fromCharCode(x%1024+56320)):String.fromCharCode(x)}function Y1(x,H=0,F=x.length){let Y="";for(let G=H;G<F;++G){let q=x[G];q>65535?(q-=65536,Y+=String.fromCharCode((q>>10)+55296)+String.fromCharCode(q%1024+56320)):Y+=String.fromCharCode(q)}return Y}var j3=class{constructor(){this._interim=0}clear(){this._interim=0}decode(x,H){let F=x.length;if(!F)return 0;let Y=0,G=0;if(this._interim){let q=x.charCodeAt(G++);56320<=q&&q<=57343?H[Y++]=(this._interim-55296)*1024+q-56320+65536:(H[Y++]=this._interim,H[Y++]=q),this._interim=0}for(let q=G;q<F;++q){let m=x.charCodeAt(q);if(55296<=m&&m<=56319){if(++q>=F)return this._interim=m,Y;let z=x.charCodeAt(q);56320<=z&&z<=57343?H[Y++]=(m-55296)*1024+z-56320+65536:(H[Y++]=m,H[Y++]=z);continue}m!==65279&&(H[Y++]=m)}return Y}},Z3=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(x,H){let F=x.length;if(!F)return 0;let Y=0,G,q,m,z,C=0,R=0;if(this.interim[0]){let Z=!1,$=this.interim[0];$&=($&224)===192?31:($&240)===224?15:7;let j=0,A;for(;(A=this.interim[++j]&63)&&j<4;)$<<=6,$|=A;let O=(this.interim[0]&224)===192?2:(this.interim[0]&240)===224?3:4,L=O-j;for(;R<L;){if(R>=F)return 0;if(A=x[R++],(A&192)!==128){R--,Z=!0;break}else this.interim[j++]=A,$<<=6,$|=A&63}Z||(O===2?$<128?R--:H[Y++]=$:O===3?$<2048||$>=55296&&$<=57343||$===65279||(H[Y++]=$):$<65536||$>1114111||(H[Y++]=$)),this.interim.fill(0)}let M=F-4,N=R;for(;N<F;){for(;N<M&&!((G=x[N])&128)&&!((q=x[N+1])&128)&&!((m=x[N+2])&128)&&!((z=x[N+3])&128);)H[Y++]=G,H[Y++]=q,H[Y++]=m,H[Y++]=z,N+=4;if(G=x[N++],G<128)H[Y++]=G;else if((G&224)===192){if(N>=F)return this.interim[0]=G,Y;if(q=x[N++],(q&192)!==128){N--;continue}if(C=(G&31)<<6|q&63,C<128){N--;continue}H[Y++]=C}else if((G&240)===224){if(N>=F)return this.interim[0]=G,Y;if(q=x[N++],(q&192)!==128){N--;continue}if(N>=F)return this.interim[0]=G,this.interim[1]=q,Y;if(m=x[N++],(m&192)!==128){N--;continue}if(C=(G&15)<<12|(q&63)<<6|m&63,C<2048||C>=55296&&C<=57343||C===65279)continue;H[Y++]=C}else if((G&248)===240){if(N>=F)return this.interim[0]=G,Y;if(q=x[N++],(q&192)!==128){N--;continue}if(N>=F)return this.interim[0]=G,this.interim[1]=q,Y;if(m=x[N++],(m&192)!==128){N--;continue}if(N>=F)return this.interim[0]=G,this.interim[1]=q,this.interim[2]=m,Y;if(z=x[N++],(z&192)!==128){N--;continue}if(C=(G&7)<<18|(q&63)<<12|(m&63)<<6|z&63,C<65536||C>1114111)continue;H[Y++]=C}}return Y}},U6="",c0=" ",wx=class x{constructor(){this.fg=0,this.bg=0,this.extended=new nx}static toColorRGB(H){return[H>>>16&255,H>>>8&255,H&255]}static fromColorRGB(H){return(H[0]&255)<<16|(H[1]&255)<<8|H[2]&255}clone(){let H=new x;return H.fg=this.fg,H.bg=this.bg,H.extended=this.extended.clone(),H}isInverse(){return this.fg&67108864}isBold(){return this.fg&134217728}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:this.fg&268435456}isBlink(){return this.fg&536870912}isInvisible(){return this.fg&1073741824}isItalic(){return this.bg&67108864}isDim(){return this.bg&134217728}isStrikethrough(){return this.fg&2147483648}isProtected(){return this.bg&536870912}isOverline(){return this.bg&1073741824}getFgColorMode(){return this.fg&50331648}getBgColorMode(){return this.bg&50331648}isFgRGB(){return(this.fg&50331648)===50331648}isBgRGB(){return(this.bg&50331648)===50331648}isFgPalette(){return(this.fg&50331648)===16777216||(this.fg&50331648)===33554432}isBgPalette(){return(this.bg&50331648)===16777216||(this.bg&50331648)===33554432}isFgDefault(){return(this.fg&50331648)===0}isBgDefault(){return(this.bg&50331648)===0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(this.fg&50331648){case 16777216:case 33554432:return this.fg&255;case 50331648:return this.fg&16777215;default:return-1}}getBgColor(){switch(this.bg&50331648){case 16777216:case 33554432:return this.bg&255;case 50331648:return this.bg&16777215;default:return-1}}hasExtendedAttrs(){return this.bg&268435456}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(this.bg&268435456&&~this.extended.underlineColor)switch(this.extended.underlineColor&50331648){case 16777216:case 33554432:return this.extended.underlineColor&255;case 50331648:return this.extended.underlineColor&16777215;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return this.bg&268435456&&~this.extended.underlineColor?this.extended.underlineColor&50331648:this.getFgColorMode()}isUnderlineColorRGB(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===50331648:this.isFgRGB()}isUnderlineColorPalette(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===16777216||(this.extended.underlineColor&50331648)===33554432:this.isFgPalette()}isUnderlineColorDefault(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===0:this.isFgDefault()}getUnderlineStyle(){return this.fg&268435456?this.bg&268435456?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}},nx=class x{constructor(H=0,F=0){this._ext=0,this._urlId=0,this._ext=H,this._urlId=F}get ext(){return this._urlId?this._ext&-469762049|this.underlineStyle<<26:this._ext}set ext(H){this._ext=H}get underlineStyle(){return this._urlId?5:(this._ext&469762048)>>26}set underlineStyle(H){this._ext&=-469762049,this._ext|=H<<26&469762048}get underlineColor(){return this._ext&67108863}set underlineColor(H){this._ext&=-67108864,this._ext|=H&67108863}get urlId(){return this._urlId}set urlId(H){this._urlId=H}get underlineVariantOffset(){let H=(this._ext&3758096384)>>29;return H<0?H^4294967288:H}set underlineVariantOffset(H){this._ext&=536870911,this._ext|=H<<29&3758096384}clone(){return new x(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}},W0=class x extends wx{constructor(){super(...arguments);this.content=0,this.fg=0,this.bg=0,this.extended=new nx,this.combinedData=""}static fromCharData(H){let F=new x;return F.setFromCharData(H),F}isCombined(){return this.content&2097152}getWidth(){return this.content>>22}getChars(){return this.content&2097152?this.combinedData:this.content&2097151?u0(this.content&2097151):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):this.content&2097151}setFromCharData(H){this.fg=H[0],this.bg=0;let F=!1;if(H[1].length>2)F=!0;else if(H[1].length===2){let Y=H[1].charCodeAt(0);if(55296<=Y&&Y<=56319){let G=H[1].charCodeAt(1);56320<=G&&G<=57343?this.content=(Y-55296)*1024+G-56320+65536|H[2]<<22:F=!0}else F=!0}else this.content=H[1].charCodeAt(0)|H[2]<<22;F&&(this.combinedData=H[1],this.content=2097152|H[2]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},V9="di$target",y1="di$dependencies",M1=new Map;function $3(x){return x[y1]||[]}function Y0(x){if(M1.has(x))return M1.get(x);let H=function(F,Y,G){if(arguments.length!==3)throw Error("@IServiceName-decorator can only be used to decorate a parameter");A3(H,F,G)};return H._id=x,M1.set(x,H),H}function A3(x,H,F){H[V9]===H?H[y1].push({id:x,index:F}):(H[y1]=[{id:x,index:F}],H[V9]=H)}var C0=Y0("BufferService"),K6=Y0("CoreMouseService"),xx=Y0("CoreService"),J3=Y0("CharsetService"),Y9=Y0("InstantiationService"),B6=Y0("LogService"),N0=Y0("OptionsService"),O6=Y0("OscLinkService"),V3=Y0("UnicodeService"),Tx=Y0("DecorationService"),w1=class{constructor(x,H,F){this._bufferService=x,this._optionsService=H,this._oscLinkService=F}provideLinks(x,H){let F=this._bufferService.buffer.lines.get(x-1);if(!F){H(void 0);return}let Y=[],G=this._optionsService.rawOptions.linkHandler,q=new W0,m=F.getTrimmedLength(),z=-1,C=-1,R=!1;for(let M=0;M<m;M++)if(!(C===-1&&!F.hasContent(M))){if(F.loadCell(M,q),q.hasExtendedAttrs()&&q.extended.urlId)if(C===-1){C=M,z=q.extended.urlId;continue}else R=q.extended.urlId!==z;else C!==-1&&(R=!0);if(R||C!==-1&&M===m-1){let N=this._oscLinkService.getLinkData(z)?.uri;if(N){let Z={start:{x:C+1,y:x},end:{x:M+(!R&&M===m-1?1:0),y:x}},$=!1;if(!G?.allowNonHttpProtocols)try{let j=new URL(N);["http:","https:"].includes(j.protocol)||($=!0)}catch{$=!0}$||Y.push({text:N,range:Z,activate:(j,A)=>G?G.activate(j,A,Z):W3(j,A),hover:(j,A)=>G?.hover?.(j,A,Z),leave:(j,A)=>G?.leave?.(j,A,Z)})}R=!1,q.hasExtendedAttrs()&&q.extended.urlId?(C=M,z=q.extended.urlId):(C=-1,z=-1)}}H(Y)}};w1=a([K(0,C0),K(1,N0),K(2,O6)],w1);function W3(x,H){if(confirm(`Do you want to navigate to ${H}?

WARNING: This link could potentially be dangerous`)){let F=window.open();if(F){try{F.opener=null}catch{}F.location.href=H}else console.warn("Opening link blocked as opener could not be cleared")}}var G1=Y0("CharSizeService"),I0=Y0("CoreBrowserService"),G9=Y0("MouseService"),S0=Y0("RenderService"),X3=Y0("SelectionService"),D6=Y0("CharacterJoinerService"),Gx=Y0("ThemeService"),k6=Y0("LinkProviderService"),U3=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(x){setTimeout(()=>{throw x.stack?W9.isErrorNoTelemetry(x)?new W9(x.message+`

`+x.stack):Error(x.message+`

`+x.stack):x},0)}}addListener(x){return this.listeners.push(x),()=>{this._removeListener(x)}}emit(x){this.listeners.forEach((H)=>{H(x)})}_removeListener(x){this.listeners.splice(this.listeners.indexOf(x),1)}setUnexpectedErrorHandler(x){this.unexpectedErrorHandler=x}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(x){this.unexpectedErrorHandler(x),this.emit(x)}onUnexpectedExternalError(x){this.unexpectedErrorHandler(x)}},K3=new U3;function _x(x){B3(x)||K3.onUnexpectedError(x)}var T1="Canceled";function B3(x){return x instanceof O3?!0:x instanceof Error&&x.name===T1&&x.message===T1}var O3=class extends Error{constructor(){super(T1),this.name=this.message}};function D3(x){return x?Error(`Illegal argument: ${x}`):Error("Illegal argument")}var W9=class x extends Error{constructor(H){super(H),this.name="CodeExpectedError"}static fromError(H){if(H instanceof x)return H;let F=new x;return F.message=H.message,F.stack=H.stack,F}static isErrorNoTelemetry(H){return H.name==="CodeExpectedError"}},P1=class x extends Error{constructor(H){super(H||"An unexpected bug occurred."),Object.setPrototypeOf(this,x.prototype)}};function k3(x,H,F=0,Y=x.length){let G=F,q=Y;for(;G<q;){let m=Math.floor((G+q)/2);H(x[m])?G=m+1:q=m}return G-1}var p3=class x{constructor(H){this._array=H,this._findLastMonotonousLastIdx=0}findLastMonotonous(H){if(x.assertInvariants){if(this._prevFindLastPredicate){for(let Y of this._array)if(this._prevFindLastPredicate(Y)&&!H(Y))throw Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=H}let F=k3(this._array,H,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=F+1,F===-1?void 0:this._array[F]}};p3.assertInvariants=!1;function j0(x,H=0){return x[x.length-(1+H)]}var p6;((x)=>{function H(q){return q<0}x.isLessThan=H;function F(q){return q<=0}x.isLessThanOrEqual=F;function Y(q){return q>0}x.isGreaterThan=Y;function G(q){return q===0}x.isNeitherLessOrGreaterThan=G,x.greaterThan=1,x.lessThan=-1,x.neitherLessOrGreaterThan=0})(p6||={});function L3(x,H){return(F,Y)=>H(x(F),x(Y))}var b3=(x,H)=>x-H,X9=class x{constructor(H){this.iterate=H}forEach(H){this.iterate((F)=>(H(F),!0))}toArray(){let H=[];return this.iterate((F)=>(H.push(F),!0)),H}filter(H){return new x((F)=>this.iterate((Y)=>H(Y)?F(Y):!0))}map(H){return new x((F)=>this.iterate((Y)=>F(H(Y))))}some(H){let F=!1;return this.iterate((Y)=>(F=H(Y),!F)),F}findFirst(H){let F;return this.iterate((Y)=>H(Y)?(F=Y,!1):!0),F}findLast(H){let F;return this.iterate((Y)=>(H(Y)&&(F=Y),!0)),F}findLastMaxBy(H){let F,Y=!0;return this.iterate((G)=>((Y||p6.isGreaterThan(H(G,F)))&&(Y=!1,F=G),!0)),F}};X9.empty=new X9((x)=>{});function y3(x,H){let F=Object.create(null);for(let Y of x){let G=H(Y),q=F[G];q||(q=F[G]=[]),q.push(Y)}return F}var U9,K9,i4=class{constructor(x,H){this.toKey=H,this._map=new Map,this[U9]="SetWithKey";for(let F of x)this.add(F)}get size(){return this._map.size}add(x){let H=this.toKey(x);return this._map.set(H,x),this}delete(x){return this._map.delete(this.toKey(x))}has(x){return this._map.has(this.toKey(x))}*entries(){for(let x of this._map.values())yield[x,x]}keys(){return this.values()}*values(){for(let x of this._map.values())yield x}clear(){this._map.clear()}forEach(x,H){this._map.forEach((F)=>x.call(H,F,F,this))}[(K9=Symbol.iterator,U9=Symbol.toStringTag,K9)](){return this.values()}},w3=class{constructor(){this.map=new Map}add(x,H){let F=this.map.get(x);F||(F=new Set,this.map.set(x,F)),F.add(H)}delete(x,H){let F=this.map.get(x);F&&(F.delete(H),F.size===0&&this.map.delete(x))}forEach(x,H){let F=this.map.get(x);F&&F.forEach(H)}get(x){return this.map.get(x)||new Set}};function T3(x,H){let F=this,Y=!1,G;return function(){if(Y)return G;if(Y=!0,H)try{G=x.apply(F,arguments)}finally{H()}else G=x.apply(F,arguments);return G}}var L6;((x)=>{function H(k){return k&&typeof k=="object"&&typeof k[Symbol.iterator]=="function"}x.is=H;let F=Object.freeze([]);function Y(){return F}x.empty=Y;function*G(k){yield k}x.single=G;function q(k){return H(k)?k:G(k)}x.wrap=q;function m(k){return k||F}x.from=m;function*z(k){for(let I=k.length-1;I>=0;I--)yield k[I]}x.reverse=z;function C(k){return!k||k[Symbol.iterator]().next().done===!0}x.isEmpty=C;function R(k){return k[Symbol.iterator]().next().value}x.first=R;function M(k,I){let S=0;for(let G0 of k)if(I(G0,S++))return!0;return!1}x.some=M;function N(k,I){for(let S of k)if(I(S))return S}x.find=N;function*Z(k,I){for(let S of k)I(S)&&(yield S)}x.filter=Z;function*$(k,I){let S=0;for(let G0 of k)yield I(G0,S++)}x.map=$;function*j(k,I){let S=0;for(let G0 of k)yield*I(G0,S++)}x.flatMap=j;function*A(...k){for(let I of k)yield*I}x.concat=A;function O(k,I,S){let G0=S;for(let X0 of k)G0=I(G0,X0);return G0}x.reduce=O;function*L(k,I,S=k.length){for(I<0&&(I+=k.length),S<0?S+=k.length:S>k.length&&(S=k.length);I<S;I++)yield k[I]}x.slice=L;function E(k,I=Number.POSITIVE_INFINITY){let S=[];if(I===0)return[S,k];let G0=k[Symbol.iterator]();for(let X0=0;X0<I;X0++){let K0=G0.next();if(K0.done)return[S,x.empty()];S.push(K0.value)}return[S,{[Symbol.iterator](){return G0}}]}x.consume=E;async function T(k){let I=[];for await(let S of k)I.push(S);return Promise.resolve(I)}x.asyncToArray=T})(L6||={});var P3=!1,i0=null,I3=class x{constructor(){this.livingDisposables=new Map}getDisposableData(H){let F=this.livingDisposables.get(H);return F||(F={parent:null,source:null,isSingleton:!1,value:H,idx:x.idx++},this.livingDisposables.set(H,F)),F}trackDisposable(H){let F=this.getDisposableData(H);F.source||(F.source=Error().stack)}setParent(H,F){let Y=this.getDisposableData(H);Y.parent=F}markAsDisposed(H){this.livingDisposables.delete(H)}markAsSingleton(H){this.getDisposableData(H).isSingleton=!0}getRootParent(H,F){let Y=F.get(H);if(Y)return Y;let G=H.parent?this.getRootParent(this.getDisposableData(H.parent),F):H;return F.set(H,G),G}getTrackedDisposables(){let H=new Map;return[...this.livingDisposables.entries()].filter(([,F])=>F.source!==null&&!this.getRootParent(F,H).isSingleton).flatMap(([F])=>F)}computeLeakingDisposables(H=10,F){let Y;if(F)Y=F;else{let C=new Map,R=[...this.livingDisposables.values()].filter((N)=>N.source!==null&&!this.getRootParent(N,C).isSingleton);if(R.length===0)return;let M=new Set(R.map((N)=>N.value));if(Y=R.filter((N)=>!(N.parent&&M.has(N.parent))),Y.length===0)throw Error("There are cyclic diposable chains!")}if(!Y)return;function G(C){function R(N,Z){for(;N.length>0&&Z.some(($)=>typeof $=="string"?$===N[0]:N[0].match($));)N.shift()}let M=C.source.split(`
`).map((N)=>N.trim().replace("at ","")).filter((N)=>N!=="");return R(M,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),M.reverse()}let q=new w3;for(let C of Y){let R=G(C);for(let M=0;M<=R.length;M++)q.add(R.slice(0,M).join(`
`),C)}Y.sort(L3((C)=>C.idx,b3));let m="",z=0;for(let C of Y.slice(0,H)){z++;let R=G(C),M=[];for(let N=0;N<R.length;N++){let Z=R[N];Z=`(shared with ${q.get(R.slice(0,N+1).join(`
`)).size}/${Y.length} leaks) at ${Z}`;let $=q.get(R.slice(0,N).join(`
`)),j=y3([...$].map((A)=>G(A)[N]),(A)=>A);delete j[R[N]];for(let[A,O]of Object.entries(j))M.unshift(`    - stacktraces of ${O.length} other leaks continue with ${A}`);M.unshift(Z)}m+=`


==================== Leaking disposable ${z}/${Y.length}: ${C.value.constructor.name} ====================
${M.join(`
`)}
============================================================

`}return Y.length>H&&(m+=`


... and ${Y.length-H} more leaking disposables

`),{leaks:Y,details:m}}};I3.idx=0;function S3(x){i0=x}if(P3){let x="__is_disposable_tracked__";S3(new class{trackDisposable(H){let F=Error("Potentially leaked disposable").stack;setTimeout(()=>{H[x]||console.log(F)},3000)}setParent(H,F){if(H&&H!==y.None)try{H[x]=!0}catch{}}markAsDisposed(H){if(H&&H!==y.None)try{H[x]=!0}catch{}}markAsSingleton(H){}})}function q1(x){return i0?.trackDisposable(x),x}function m1(x){i0?.markAsDisposed(x)}function px(x,H){i0?.setParent(x,H)}function Q3(x,H){if(i0)for(let F of x)i0.setParent(F,H)}function B9(x){return i0?.markAsSingleton(x),x}function t0(x){if(L6.is(x)){let H=[];for(let F of x)if(F)try{F.dispose()}catch(Y){H.push(Y)}if(H.length===1)throw H[0];if(H.length>1)throw AggregateError(H,"Encountered errors while disposing of store");return Array.isArray(x)?[]:x}else if(x)return x.dispose(),x}function E3(...x){let H=f(()=>t0(x));return Q3(x,H),H}function f(x){let H=q1({dispose:T3(()=>{m1(H),x()})});return H}var b6=class x{constructor(){this._toDispose=new Set,this._isDisposed=!1,q1(this)}dispose(){this._isDisposed||(m1(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{t0(this._toDispose)}finally{this._toDispose.clear()}}add(H){if(!H)return H;if(H===this)throw Error("Cannot register a disposable on itself!");return px(H,this),this._isDisposed?x.DISABLE_DISPOSED_WARNING||console.warn(Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(H),H}delete(H){if(H){if(H===this)throw Error("Cannot dispose a disposable on itself!");this._toDispose.delete(H),H.dispose()}}deleteAndLeak(H){H&&this._toDispose.has(H)&&(this._toDispose.delete(H),px(H,null))}};b6.DISABLE_DISPOSED_WARNING=!1;var a0=b6,y=class{constructor(){this._store=new a0,q1(this),px(this._store,this)}dispose(){m1(this),this._store.dispose()}_register(x){if(x===this)throw Error("Cannot register a disposable on itself!");return this._store.add(x)}};y.None=Object.freeze({dispose(){}});var Yx=class{constructor(){this._isDisposed=!1,q1(this)}get value(){return this._isDisposed?void 0:this._value}set value(x){this._isDisposed||x===this._value||(this._value?.dispose(),x&&px(x,this),this._value=x)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,m1(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){let x=this._value;return this._value=void 0,x&&px(x,null),x}},A0=typeof window=="object"?window:globalThis,I1=class x{constructor(H){this.element=H,this.next=x.Undefined,this.prev=x.Undefined}};I1.Undefined=new I1(void 0);var g=I1,O9=class{constructor(){this._first=g.Undefined,this._last=g.Undefined,this._size=0}get size(){return this._size}isEmpty(){return this._first===g.Undefined}clear(){let x=this._first;for(;x!==g.Undefined;){let H=x.next;x.prev=g.Undefined,x.next=g.Undefined,x=H}this._first=g.Undefined,this._last=g.Undefined,this._size=0}unshift(x){return this._insert(x,!1)}push(x){return this._insert(x,!0)}_insert(x,H){let F=new g(x);if(this._first===g.Undefined)this._first=F,this._last=F;else if(H){let G=this._last;this._last=F,F.prev=G,G.next=F}else{let G=this._first;this._first=F,F.next=G,G.prev=F}this._size+=1;let Y=!1;return()=>{Y||(Y=!0,this._remove(F))}}shift(){if(this._first!==g.Undefined){let x=this._first.element;return this._remove(this._first),x}}pop(){if(this._last!==g.Undefined){let x=this._last.element;return this._remove(this._last),x}}_remove(x){if(x.prev!==g.Undefined&&x.next!==g.Undefined){let H=x.prev;H.next=x.next,x.next.prev=H}else x.prev===g.Undefined&&x.next===g.Undefined?(this._first=g.Undefined,this._last=g.Undefined):x.next===g.Undefined?(this._last=this._last.prev,this._last.next=g.Undefined):x.prev===g.Undefined&&(this._first=this._first.next,this._first.prev=g.Undefined);this._size-=1}*[Symbol.iterator](){let x=this._first;for(;x!==g.Undefined;)yield x.element,x=x.next}},h3=globalThis.performance&&typeof globalThis.performance.now=="function",d3=class x{static create(H){return new x(H)}constructor(H){this._now=h3&&H===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}},f3=!1,D9=!1,_3=!1,m0;((x)=>{x.None=()=>y.None;function H(V){if(_3){let{onDidAddListener:X}=V,D=Q1.create(),B=0;V.onDidAddListener=()=>{++B===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),D.print()),X?.()}}}function F(V,X){return Z(V,()=>{},0,void 0,!0,void 0,X)}x.defer=F;function Y(V){return(X,D=null,B)=>{let p=!1,U;return U=V((P)=>{if(!p)return U?U.dispose():p=!0,X.call(D,P)},null,B),p&&U.dispose(),U}}x.once=Y;function G(V,X,D){return M((B,p=null,U)=>V((P)=>B.call(p,X(P)),null,U),D)}x.map=G;function q(V,X,D){return M((B,p=null,U)=>V((P)=>{X(P),B.call(p,P)},null,U),D)}x.forEach=q;function m(V,X,D){return M((B,p=null,U)=>V((P)=>X(P)&&B.call(p,P),null,U),D)}x.filter=m;function z(V){return V}x.signal=z;function C(...V){return(X,D=null,B)=>{let p=E3(...V.map((U)=>U((P)=>X.call(D,P))));return N(p,B)}}x.any=C;function R(V,X,D,B){let p=D;return G(V,(U)=>(p=X(p,U),p),B)}x.reduce=R;function M(V,X){let D,B={onWillAddFirstListener(){D=V(p.fire,p)},onDidRemoveLastListener(){D?.dispose()}};X||H(B);let p=new W(B);return X?.add(p),p.event}function N(V,X){return X instanceof Array?X.push(V):X&&X.add(V),V}function Z(V,X,D=100,B=!1,p=!1,U,P){let v,q0,B0,b0=0,t,E0={leakWarningThreshold:U,onWillAddFirstListener(){v=V((o0)=>{b0++,q0=X(q0,o0),B&&!B0&&(R0.fire(q0),q0=void 0),t=()=>{let Cx=q0;q0=void 0,B0=void 0,(!B||b0>1)&&R0.fire(Cx),b0=0},typeof D=="number"?(clearTimeout(B0),B0=setTimeout(t,D)):B0===void 0&&(B0=0,queueMicrotask(t))})},onWillRemoveListener(){p&&b0>0&&t?.()},onDidRemoveLastListener(){t=void 0,v.dispose()}};P||H(E0);let R0=new W(E0);return P?.add(R0),R0.event}x.debounce=Z;function $(V,X=0,D){return x.debounce(V,(B,p)=>B?(B.push(p),B):[p],X,void 0,!0,void 0,D)}x.accumulate=$;function j(V,X=(B,p)=>B===p,D){let B=!0,p;return m(V,(U)=>{let P=B||!X(U,p);return B=!1,p=U,P},D)}x.latch=j;function A(V,X,D){return[x.filter(V,X,D),x.filter(V,(B)=>!X(B),D)]}x.split=A;function O(V,X=!1,D=[],B){let p=D.slice(),U=V((q0)=>{p?p.push(q0):v.fire(q0)});B&&B.add(U);let P=()=>{p?.forEach((q0)=>v.fire(q0)),p=null},v=new W({onWillAddFirstListener(){U||(U=V((q0)=>v.fire(q0)),B&&B.add(U))},onDidAddFirstListener(){p&&(X?setTimeout(P):P())},onDidRemoveLastListener(){U&&U.dispose(),U=null}});return B&&B.add(v),v.event}x.buffer=O;function L(V,X){return(D,B,p)=>{let U=X(new T);return V(function(P){let v=U.evaluate(P);v!==E&&D.call(B,v)},void 0,p)}}x.chain=L;let E=Symbol("HaltChainable");class T{constructor(){this.steps=[]}map(V){return this.steps.push(V),this}forEach(V){return this.steps.push((X)=>(V(X),X)),this}filter(V){return this.steps.push((X)=>V(X)?X:E),this}reduce(V,X){let D=X;return this.steps.push((B)=>(D=V(D,B),D)),this}latch(V=(X,D)=>X===D){let X=!0,D;return this.steps.push((B)=>{let p=X||!V(B,D);return X=!1,D=B,p?B:E}),this}evaluate(V){for(let X of this.steps)if(V=X(V),V===E)break;return V}}function k(V,X,D=(B)=>B){let B=(...v)=>P.fire(D(...v)),p=()=>V.on(X,B),U=()=>V.removeListener(X,B),P=new W({onWillAddFirstListener:p,onDidRemoveLastListener:U});return P.event}x.fromNodeEventEmitter=k;function I(V,X,D=(B)=>B){let B=(...v)=>P.fire(D(...v)),p=()=>V.addEventListener(X,B),U=()=>V.removeEventListener(X,B),P=new W({onWillAddFirstListener:p,onDidRemoveLastListener:U});return P.event}x.fromDOMEventEmitter=I;function S(V){return new Promise((X)=>Y(V)(X))}x.toPromise=S;function G0(V){let X=new W;return V.then((D)=>{X.fire(D)},()=>{X.fire(void 0)}).finally(()=>{X.dispose()}),X.event}x.fromPromise=G0;function X0(V,X){return V((D)=>X.fire(D))}x.forward=X0;function K0(V,X,D){return X(D),V((B)=>X(B))}x.runAndSubscribe=K0;class zx{constructor(V,X){this._observable=V,this._counter=0,this._hasChanged=!1;let D={onWillAddFirstListener:()=>{V.addObserver(this)},onDidRemoveLastListener:()=>{V.removeObserver(this)}};X||H(D),this.emitter=new W(D),X&&X.add(this.emitter)}beginUpdate(V){this._counter++}handlePossibleChange(V){}handleChange(V,X){this._hasChanged=!0}endUpdate(V){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function _(V,X){return new zx(V,X).emitter.event}x.fromObservable=_;function C1(V){return(X,D,B)=>{let p=0,U=!1,P={beginUpdate(){p++},endUpdate(){p--,p===0&&(V.reportChanges(),U&&(U=!1,X.call(D)))},handlePossibleChange(){},handleChange(){U=!0}};V.addObserver(P),V.reportChanges();let v={dispose(){V.removeObserver(P)}};return B instanceof a0?B.add(v):Array.isArray(B)&&B.push(v),v}}x.fromObservableLight=C1})(m0||={});var S1=class x{constructor(H){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${H}_${x._idPool++}`,x.all.add(this)}start(H){this._stopWatch=new d3,this.listenerCount=H}stop(){if(this._stopWatch){let H=this._stopWatch.elapsed();this.durations.push(H),this.elapsedOverall+=H,this.invocationCount+=1,this._stopWatch=void 0}}};S1.all=new Set,S1._idPool=0;var v3=S1,k9=-1,y6=class x{constructor(H,F,Y=(x._idPool++).toString(16).padStart(3,"0")){this._errorHandler=H,this.threshold=F,this.name=Y,this._warnCountdown=0}dispose(){this._stacks?.clear()}check(H,F){let Y=this.threshold;if(Y<=0||F<Y)return;this._stacks||(this._stacks=new Map);let G=this._stacks.get(H.value)||0;if(this._stacks.set(H.value,G+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=Y*0.5;let[q,m]=this.getMostFrequentStack(),z=`[${this.name}] potential listener LEAK detected, having ${F} listeners already. MOST frequent listener (${m}):`;console.warn(z),console.warn(q);let C=new u3(z,q);this._errorHandler(C)}return()=>{let q=this._stacks.get(H.value)||0;this._stacks.set(H.value,q-1)}}getMostFrequentStack(){if(!this._stacks)return;let H,F=0;for(let[Y,G]of this._stacks)(!H||F<G)&&(H=[Y,G],F=G);return H}};y6._idPool=1;var g3=y6,Q1=class x{constructor(H){this.value=H}static create(){let H=Error();return new x(H.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},u3=class extends Error{constructor(x,H){super(x),this.name="ListenerLeakError",this.stack=H}},c3=class extends Error{constructor(x,H){super(x),this.name="ListenerRefusalError",this.stack=H}},a3=0,vx=class{constructor(x){this.value=x,this.id=a3++}},o3=2,l3=(x,H)=>{if(x instanceof vx)H(x);else for(let F=0;F<x.length;F++){let Y=x[F];Y&&H(Y)}},gx;if(f3){let x=[];setInterval(()=>{x.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn(x.join(`
`)),x.length=0)},3000),gx=new FinalizationRegistry((H)=>{typeof H=="string"&&x.push(H)})}var W=class{constructor(x){this._size=0,this._options=x,this._leakageMon=k9>0||this._options?.leakWarningThreshold?new g3(x?.onListenerError??_x,this._options?.leakWarningThreshold??k9):void 0,this._perfMon=this._options?._profName?new v3(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){if(!this._disposed){if(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners){if(D9){let x=this._listeners;queueMicrotask(()=>{l3(x,(H)=>H.stack?.print())})}this._listeners=void 0,this._size=0}this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose()}}get event(){return this._event??=(x,H,F)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let z=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(z);let C=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],R=new c3(`${z}. HINT: Stack shows most frequent listener (${C[1]}-times)`,C[0]);return(this._options?.onListenerError||_x)(R),y.None}if(this._disposed)return y.None;H&&(x=x.bind(H));let Y=new vx(x),G,q;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*0.2)&&(Y.stack=Q1.create(),G=this._leakageMon.check(Y.stack,this._size+1)),D9&&(Y.stack=q??Q1.create()),this._listeners?this._listeners instanceof vx?(this._deliveryQueue??=new n3,this._listeners=[this._listeners,Y]):this._listeners.push(Y):(this._options?.onWillAddFirstListener?.(this),this._listeners=Y,this._options?.onDidAddFirstListener?.(this)),this._size++;let m=f(()=>{gx?.unregister(m),G?.(),this._removeListener(Y)});if(F instanceof a0?F.add(m):Array.isArray(F)&&F.push(m),gx){let z=Error().stack.split(`
`).slice(2,3).join(`
`).trim(),C=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(z);gx.register(m,C?.[2]??z,m)}return m},this._event}_removeListener(x){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let H=this._listeners,F=H.indexOf(x);if(F===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),Error("Attempted to dispose unknown listener");this._size--,H[F]=void 0;let Y=this._deliveryQueue.current===this;if(this._size*o3<=H.length){let G=0;for(let q=0;q<H.length;q++)H[q]?H[G++]=H[q]:Y&&(this._deliveryQueue.end--,G<this._deliveryQueue.i&&this._deliveryQueue.i--);H.length=G}}_deliver(x,H){if(!x)return;let F=this._options?.onListenerError||_x;if(!F){x.value(H);return}try{x.value(H)}catch(Y){F(Y)}}_deliverQueue(x){let H=x.current._listeners;for(;x.i<x.end;)this._deliver(H[x.i++],x.value);x.reset()}fire(x){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof vx)this._deliver(this._listeners,x);else{let H=this._deliveryQueue;H.enqueue(this,x,this._listeners.length),this._deliverQueue(H)}this._perfMon?.stop()}hasListeners(){return this._size>0}},n3=class{constructor(){this.i=-1,this.end=0}enqueue(x,H,F){this.i=0,this.end=F,this.current=x,this.value=H}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},E1=class{constructor(){this.mapWindowIdToZoomLevel=new Map,this._onDidChangeZoomLevel=new W,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event,this.mapWindowIdToZoomFactor=new Map,this._onDidChangeFullscreen=new W,this.onDidChangeFullscreen=this._onDidChangeFullscreen.event,this.mapWindowIdToFullScreen=new Map}getZoomLevel(H){return this.mapWindowIdToZoomLevel.get(this.getWindowId(H))??0}setZoomLevel(H,F){if(this.getZoomLevel(F)===H)return;let Y=this.getWindowId(F);this.mapWindowIdToZoomLevel.set(Y,H),this._onDidChangeZoomLevel.fire(Y)}getZoomFactor(H){return this.mapWindowIdToZoomFactor.get(this.getWindowId(H))??1}setZoomFactor(H,F){this.mapWindowIdToZoomFactor.set(this.getWindowId(F),H)}setFullscreen(H,F){if(this.isFullscreen(F)===H)return;let Y=this.getWindowId(F);this.mapWindowIdToFullScreen.set(Y,H),this._onDidChangeFullscreen.fire(Y)}isFullscreen(H){return!!this.mapWindowIdToFullScreen.get(this.getWindowId(H))}getWindowId(H){return H.vscodeWindowId}};E1.INSTANCE=new E1;var q9=E1;function s3(x,H,F){typeof H=="string"&&(H=x.matchMedia(H)),H.addEventListener("change",F)}var t4=q9.INSTANCE.onDidChangeZoomLevel;function r3(x){return q9.INSTANCE.getZoomFactor(x)}var e4=q9.INSTANCE.onDidChangeFullscreen,qx=typeof navigator=="object"?navigator.userAgent:"",h1=qx.indexOf("Firefox")>=0,ux=qx.indexOf("AppleWebKit")>=0,m9=qx.indexOf("Chrome")>=0,w6=!m9&&qx.indexOf("Safari")>=0,x8=qx.indexOf("Electron/")>=0,H8=qx.indexOf("Android")>=0,cx=!1;if(typeof A0.matchMedia=="function"){let x=A0.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),H=A0.matchMedia("(display-mode: fullscreen)");cx=x.matches,s3(A0,x,({matches:F})=>{cx&&H.matches||(cx=F)})}function i3(){return cx}var Fx="en",sx=!1,rx=!1,Dx=!1,t3=!1,T6=!1,P6=!1,e3=!1,x2=!1,H2=!1,F2=!1,Qx,ax=Fx,p9=Fx,Y2,w0,P0=globalThis,$0;typeof P0.vscode<"u"&&typeof P0.vscode.process<"u"?$0=P0.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&($0=process);var I6=typeof $0?.versions?.electron=="string",G2=I6&&$0?.type==="renderer";if(typeof $0=="object"){sx=$0.platform==="win32",rx=$0.platform==="darwin",Dx=$0.platform==="linux",t3=Dx&&!!$0.env.SNAP&&!!$0.env.SNAP_REVISION,e3=I6,H2=!!$0.env.CI||!!$0.env.BUILD_ARTIFACTSTAGINGDIRECTORY,Qx=Fx,ax=Fx;let x=$0.env.VSCODE_NLS_CONFIG;if(x)try{let H=JSON.parse(x);Qx=H.userLocale,p9=H.osLocale,ax=H.resolvedLanguage||Fx,Y2=H.languagePack?.translationsConfigFile}catch{}T6=!0}else typeof navigator=="object"&&!G2?(w0=navigator.userAgent,sx=w0.indexOf("Windows")>=0,rx=w0.indexOf("Macintosh")>=0,x2=(w0.indexOf("Macintosh")>=0||w0.indexOf("iPad")>=0||w0.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,Dx=w0.indexOf("Linux")>=0,F2=w0?.indexOf("Mobi")>=0,P6=!0,ax=globalThis._VSCODE_NLS_LANGUAGE||Fx,Qx=navigator.language.toLowerCase(),p9=Qx):console.error("Unable to resolve platform.");var j1=0;rx?j1=1:sx?j1=3:Dx&&(j1=2);var S6=sx,p0=rx,q2=Dx,Z1=T6,m2=P6&&typeof P0.importScripts=="function",F8=m2?P0.origin:void 0,L0=w0,f0=ax,R2;((x)=>{function H(){return f0}x.value=H;function F(){return f0.length===2?f0==="en":f0.length>=3?f0[0]==="e"&&f0[1]==="n"&&f0[2]==="-":!1}x.isDefaultVariant=F;function Y(){return f0==="en"}x.isDefault=Y})(R2||={});var z2=typeof P0.postMessage=="function"&&!P0.importScripts,C2=(()=>{if(z2){let x=[];P0.addEventListener("message",(F)=>{if(F.data&&F.data.vscodeScheduleAsyncWork)for(let Y=0,G=x.length;Y<G;Y++){let q=x[Y];if(q.id===F.data.vscodeScheduleAsyncWork){x.splice(Y,1),q.callback();return}}});let H=0;return(F)=>{let Y=++H;x.push({id:Y,callback:F}),P0.postMessage({vscodeScheduleAsyncWork:Y},"*")}}return(x)=>setTimeout(x)})(),N2=!!(L0&&L0.indexOf("Chrome")>=0),Y8=!!(L0&&L0.indexOf("Firefox")>=0),G8=!!(!N2&&L0&&L0.indexOf("Safari")>=0),q8=!!(L0&&L0.indexOf("Edg/")>=0),m8=!!(L0&&L0.indexOf("Android")>=0),_0=typeof navigator=="object"?navigator:{},R8={clipboard:{writeText:Z1||document.queryCommandSupported&&document.queryCommandSupported("copy")||!!(_0&&_0.clipboard&&_0.clipboard.writeText),readText:Z1||!!(_0&&_0.clipboard&&_0.clipboard.readText)},keyboard:Z1||i3()?0:_0.keyboard||w6?1:2,touch:"ontouchstart"in A0||_0.maxTouchPoints>0,pointerEvents:A0.PointerEvent&&(("ontouchstart"in A0)||navigator.maxTouchPoints>0)},R9=class{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(x,H){this._keyCodeToStr[x]=H,this._strToKeyCode[H.toLowerCase()]=x}keyCodeToStr(x){return this._keyCodeToStr[x]}strToKeyCode(x){return this._strToKeyCode[x.toLowerCase()]||0}},$1=new R9,L9=new R9,b9=new R9,M2=Array(230),Q6;((x)=>{function H(z){return $1.keyCodeToStr(z)}x.toString=H;function F(z){return $1.strToKeyCode(z)}x.fromString=F;function Y(z){return L9.keyCodeToStr(z)}x.toUserSettingsUS=Y;function G(z){return b9.keyCodeToStr(z)}x.toUserSettingsGeneral=G;function q(z){return L9.strToKeyCode(z)||b9.strToKeyCode(z)}x.fromUserSettings=q;function m(z){if(z>=98&&z<=113)return null;switch(z){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return $1.keyCodeToStr(z)}x.toElectronAccelerator=m})(Q6||={});var j2=class x{constructor(H,F,Y,G,q){this.ctrlKey=H,this.shiftKey=F,this.altKey=Y,this.metaKey=G,this.keyCode=q}equals(H){return H instanceof x&&this.ctrlKey===H.ctrlKey&&this.shiftKey===H.shiftKey&&this.altKey===H.altKey&&this.metaKey===H.metaKey&&this.keyCode===H.keyCode}getHashCode(){let H=this.ctrlKey?"1":"0",F=this.shiftKey?"1":"0",Y=this.altKey?"1":"0",G=this.metaKey?"1":"0";return`K${H}${F}${Y}${G}${this.keyCode}`}isModifierKey(){return this.keyCode===0||this.keyCode===5||this.keyCode===57||this.keyCode===6||this.keyCode===4}toKeybinding(){return new Z2([this])}isDuplicateModifierCase(){return this.ctrlKey&&this.keyCode===5||this.shiftKey&&this.keyCode===4||this.altKey&&this.keyCode===6||this.metaKey&&this.keyCode===57}},Z2=class{constructor(x){if(x.length===0)throw D3("chords");this.chords=x}getHashCode(){let x="";for(let H=0,F=this.chords.length;H<F;H++)H!==0&&(x+=";"),x+=this.chords[H].getHashCode();return x}equals(x){if(x===null||this.chords.length!==x.chords.length)return!1;for(let H=0;H<this.chords.length;H++)if(!this.chords[H].equals(x.chords[H]))return!1;return!0}};function $2(x){if(x.charCode){let F=String.fromCharCode(x.charCode).toUpperCase();return Q6.fromString(F)}let H=x.keyCode;if(H===3)return 7;if(h1)switch(H){case 59:return 85;case 60:if(q2)return 97;break;case 61:return 86;case 107:return 109;case 109:return 111;case 173:return 88;case 224:if(p0)return 57;break}else if(ux){if(p0&&H===93)return 57;if(!p0&&H===92)return 57}return M2[H]||0}var A2=p0?256:2048,J2=512,V2=1024,W2=p0?2048:256,d1=class{constructor(x){this._standardKeyboardEventBrand=!0;let H=x;this.browserEvent=H,this.target=H.target,this.ctrlKey=H.ctrlKey,this.shiftKey=H.shiftKey,this.altKey=H.altKey,this.metaKey=H.metaKey,this.altGraphKey=H.getModifierState?.("AltGraph"),this.keyCode=$2(H),this.code=H.code,this.ctrlKey=this.ctrlKey||this.keyCode===5,this.altKey=this.altKey||this.keyCode===6,this.shiftKey=this.shiftKey||this.keyCode===4,this.metaKey=this.metaKey||this.keyCode===57,this._asKeybinding=this._computeKeybinding(),this._asKeyCodeChord=this._computeKeyCodeChord()}preventDefault(){this.browserEvent&&this.browserEvent.preventDefault&&this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent&&this.browserEvent.stopPropagation&&this.browserEvent.stopPropagation()}toKeyCodeChord(){return this._asKeyCodeChord}equals(x){return this._asKeybinding===x}_computeKeybinding(){let x=0;this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(x=this.keyCode);let H=0;return this.ctrlKey&&(H|=A2),this.altKey&&(H|=J2),this.shiftKey&&(H|=V2),this.metaKey&&(H|=W2),H|=x,H}_computeKeyCodeChord(){let x=0;return this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(x=this.keyCode),new j2(this.ctrlKey,this.shiftKey,this.altKey,this.metaKey,x)}},y9=new WeakMap;function X2(x){if(!x.parent||x.parent===x)return null;try{let H=x.location,F=x.parent.location;if(H.origin!=="null"&&F.origin!=="null"&&H.origin!==F.origin)return null}catch{return null}return x.parent}var U2=class{static getSameOriginWindowChain(x){let H=y9.get(x);if(!H){H=[],y9.set(x,H);let F=x,Y;do Y=X2(F),Y?H.push({window:new WeakRef(F),iframeElement:F.frameElement||null}):H.push({window:new WeakRef(F),iframeElement:null}),F=Y;while(F)}return H.slice(0)}static getPositionOfChildWindowRelativeToAncestorWindow(x,H){if(!H||x===H)return{top:0,left:0};let F=0,Y=0,G=this.getSameOriginWindowChain(x);for(let q of G){let m=q.window.deref();if(F+=m?.scrollY??0,Y+=m?.scrollX??0,m===H||!q.iframeElement)break;let z=q.iframeElement.getBoundingClientRect();F+=z.top,Y+=z.left}return{top:F,left:Y}}},Wx=class{constructor(x,H){this.timestamp=Date.now(),this.browserEvent=H,this.leftButton=H.button===0,this.middleButton=H.button===1,this.rightButton=H.button===2,this.buttons=H.buttons,this.target=H.target,this.detail=H.detail||1,H.type==="dblclick"&&(this.detail=2),this.ctrlKey=H.ctrlKey,this.shiftKey=H.shiftKey,this.altKey=H.altKey,this.metaKey=H.metaKey,typeof H.pageX=="number"?(this.posx=H.pageX,this.posy=H.pageY):(this.posx=H.clientX+this.target.ownerDocument.body.scrollLeft+this.target.ownerDocument.documentElement.scrollLeft,this.posy=H.clientY+this.target.ownerDocument.body.scrollTop+this.target.ownerDocument.documentElement.scrollTop);let F=U2.getPositionOfChildWindowRelativeToAncestorWindow(x,H.view);this.posx-=F.left,this.posy-=F.top}preventDefault(){this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent.stopPropagation()}},w9=class{constructor(x,H=0,F=0){this.browserEvent=x||null,this.target=x?x.target||x.targetNode||x.srcElement:null,this.deltaY=F,this.deltaX=H;let Y=!1;if(m9){let G=navigator.userAgent.match(/Chrome\/(\d+)/);Y=(G?parseInt(G[1]):123)<=122}if(x){let G=x,q=x,m=x.view?.devicePixelRatio||1;if(typeof G.wheelDeltaY<"u")Y?this.deltaY=G.wheelDeltaY/(120*m):this.deltaY=G.wheelDeltaY/120;else if(typeof q.VERTICAL_AXIS<"u"&&q.axis===q.VERTICAL_AXIS)this.deltaY=-q.detail/3;else if(x.type==="wheel"){let z=x;z.deltaMode===z.DOM_DELTA_LINE?h1&&!p0?this.deltaY=-x.deltaY/3:this.deltaY=-x.deltaY:this.deltaY=-x.deltaY/40}if(typeof G.wheelDeltaX<"u")w6&&S6?this.deltaX=-(G.wheelDeltaX/120):Y?this.deltaX=G.wheelDeltaX/(120*m):this.deltaX=G.wheelDeltaX/120;else if(typeof q.HORIZONTAL_AXIS<"u"&&q.axis===q.HORIZONTAL_AXIS)this.deltaX=-x.detail/3;else if(x.type==="wheel"){let z=x;z.deltaMode===z.DOM_DELTA_LINE?h1&&!p0?this.deltaX=-x.deltaX/3:this.deltaX=-x.deltaX:this.deltaX=-x.deltaX/40}this.deltaY===0&&this.deltaX===0&&x.wheelDelta&&(Y?this.deltaY=x.wheelDelta/(120*m):this.deltaY=x.wheelDelta/120)}}preventDefault(){this.browserEvent?.preventDefault()}stopPropagation(){this.browserEvent?.stopPropagation()}},E6=Object.freeze(function(x,H){let F=setTimeout(x.bind(H),0);return{dispose(){clearTimeout(F)}}}),K2;((x)=>{function H(F){return F===x.None||F===x.Cancelled||F instanceof B2?!0:!F||typeof F!="object"?!1:typeof F.isCancellationRequested=="boolean"&&typeof F.onCancellationRequested=="function"}x.isCancellationToken=H,x.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:m0.None}),x.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:E6})})(K2||={});var B2=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?E6:(this._emitter||(this._emitter=new W),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},z8=Symbol("MicrotaskDelay"),z9=class{constructor(x,H){this._isDisposed=!1,this._token=-1,typeof x=="function"&&typeof H=="number"&&this.setIfNotSet(x,H)}dispose(){this.cancel(),this._isDisposed=!0}cancel(){this._token!==-1&&(clearTimeout(this._token),this._token=-1)}cancelAndSet(x,H){if(this._isDisposed)throw new P1("Calling 'cancelAndSet' on a disposed TimeoutTimer");this.cancel(),this._token=setTimeout(()=>{this._token=-1,x()},H)}setIfNotSet(x,H){if(this._isDisposed)throw new P1("Calling 'setIfNotSet' on a disposed TimeoutTimer");this._token===-1&&(this._token=setTimeout(()=>{this._token=-1,x()},H))}},O2=class{constructor(){this.disposable=void 0,this.isDisposed=!1}cancel(){this.disposable?.dispose(),this.disposable=void 0}cancelAndSet(x,H,F=globalThis){if(this.isDisposed)throw new P1("Calling 'cancelAndSet' on a disposed IntervalTimer");this.cancel();let Y=F.setInterval(()=>{x()},H);this.disposable=f(()=>{F.clearInterval(Y),this.disposable=void 0})}dispose(){this.cancel(),this.isDisposed=!0}},D2,A1;(function(){typeof globalThis.requestIdleCallback!="function"||typeof globalThis.cancelIdleCallback!="function"?A1=(x,H)=>{C2(()=>{if(F)return;let Y=Date.now()+15;H(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,Y-Date.now())}}))});let F=!1;return{dispose(){F||(F=!0)}}}:A1=(x,H,F)=>{let Y=x.requestIdleCallback(H,typeof F=="number"?{timeout:F}:void 0),G=!1;return{dispose(){G||(G=!0,x.cancelIdleCallback(Y))}}},D2=(x)=>A1(globalThis,x)})();var k2;((x)=>{async function H(Y){let G,q=await Promise.all(Y.map((m)=>m.then((z)=>z,(z)=>{G||(G=z)})));if(typeof G<"u")throw G;return q}x.settled=H;function F(Y){return new Promise(async(G,q)=>{try{await Y(G,q)}catch(m){q(m)}})}x.withAsyncBody=F})(k2||={});var T9=class x{static fromArray(H){return new x((F)=>{F.emitMany(H)})}static fromPromise(H){return new x(async(F)=>{F.emitMany(await H)})}static fromPromises(H){return new x(async(F)=>{await Promise.all(H.map(async(Y)=>F.emitOne(await Y)))})}static merge(H){return new x(async(F)=>{await Promise.all(H.map(async(Y)=>{for await(let G of Y)F.emitOne(G)}))})}constructor(H,F){this._state=0,this._results=[],this._error=null,this._onReturn=F,this._onStateChanged=new W,queueMicrotask(async()=>{let Y={emitOne:(G)=>this.emitOne(G),emitMany:(G)=>this.emitMany(G),reject:(G)=>this.reject(G)};try{await Promise.resolve(H(Y)),this.resolve()}catch(G){this.reject(G)}finally{Y.emitOne=void 0,Y.emitMany=void 0,Y.reject=void 0}})}[Symbol.asyncIterator](){let H=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(H<this._results.length)return{done:!1,value:this._results[H++]};if(this._state===1)return{done:!0,value:void 0};await m0.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>(this._onReturn?.(),{done:!0,value:void 0})}}static map(H,F){return new x(async(Y)=>{for await(let G of H)Y.emitOne(F(G))})}map(H){return x.map(this,H)}static filter(H,F){return new x(async(Y)=>{for await(let G of H)F(G)&&Y.emitOne(G)})}filter(H){return x.filter(this,H)}static coalesce(H){return x.filter(H,(F)=>!!F)}coalesce(){return x.coalesce(this)}static async toPromise(H){let F=[];for await(let Y of H)F.push(Y);return F}toPromise(){return x.toPromise(this)}emitOne(H){this._state===0&&(this._results.push(H),this._onStateChanged.fire())}emitMany(H){this._state===0&&(this._results=this._results.concat(H),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(H){this._state===0&&(this._state=2,this._error=H,this._onStateChanged.fire())}};T9.EMPTY=T9.fromArray([]);function p2(x){return 55296<=x&&x<=56319}function P9(x){return 56320<=x&&x<=57343}function L2(x,H){return(x-55296<<10)+(H-56320)+65536}function b2(x){return C9(x,0)}function C9(x,H){switch(typeof x){case"object":return x===null?T0(349,H):Array.isArray(x)?w2(x,H):T2(x,H);case"string":return h6(x,H);case"boolean":return y2(x,H);case"number":return T0(x,H);case"undefined":return T0(937,H);default:return T0(617,H)}}function T0(x,H){return(H<<5)-H+x|0}function y2(x,H){return T0(x?433:863,H)}function h6(x,H){H=T0(149417,H);for(let F=0,Y=x.length;F<Y;F++)H=T0(x.charCodeAt(F),H);return H}function w2(x,H){return H=T0(104579,H),x.reduce((F,Y)=>C9(Y,F),H)}function T2(x,H){return H=T0(181387,H),Object.keys(x).sort().reduce((F,Y)=>(F=h6(Y,F),C9(x[Y],F)),H)}function J1(x,H,F=32){let Y=F-H,G=~((1<<Y)-1);return(x<<H|(G&x)>>>Y)>>>0}function I9(x,H=0,F=x.byteLength,Y=0){for(let G=0;G<F;G++)x[H+G]=Y}function P2(x,H,F="0"){for(;x.length<H;)x=F+x;return x}function Mx(x,H=32){return x instanceof ArrayBuffer?Array.from(new Uint8Array(x)).map((F)=>F.toString(16).padStart(2,"0")).join(""):P2((x>>>0).toString(16),H/4)}var I2=class x{constructor(){this._h0=1732584193,this._h1=4023233417,this._h2=2562383102,this._h3=271733878,this._h4=3285377520,this._buff=new Uint8Array(67),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}update(H){let F=H.length;if(F===0)return;let Y=this._buff,G=this._buffLen,q=this._leftoverHighSurrogate,m,z;for(q!==0?(m=q,z=-1,q=0):(m=H.charCodeAt(0),z=0);;){let C=m;if(p2(m))if(z+1<F){let R=H.charCodeAt(z+1);P9(R)?(z++,C=L2(m,R)):C=65533}else{q=m;break}else P9(m)&&(C=65533);if(G=this._push(Y,G,C),z++,z<F)m=H.charCodeAt(z);else break}this._buffLen=G,this._leftoverHighSurrogate=q}_push(H,F,Y){return Y<128?H[F++]=Y:Y<2048?(H[F++]=192|(Y&1984)>>>6,H[F++]=128|(Y&63)>>>0):Y<65536?(H[F++]=224|(Y&61440)>>>12,H[F++]=128|(Y&4032)>>>6,H[F++]=128|(Y&63)>>>0):(H[F++]=240|(Y&1835008)>>>18,H[F++]=128|(Y&258048)>>>12,H[F++]=128|(Y&4032)>>>6,H[F++]=128|(Y&63)>>>0),F>=64&&(this._step(),F-=64,this._totalLen+=64,H[0]=H[64],H[1]=H[65],H[2]=H[66]),F}digest(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),Mx(this._h0)+Mx(this._h1)+Mx(this._h2)+Mx(this._h3)+Mx(this._h4)}_wrapUp(){this._buff[this._buffLen++]=128,I9(this._buff,this._buffLen),this._buffLen>56&&(this._step(),I9(this._buff));let H=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(H/4294967296),!1),this._buffDV.setUint32(60,H%4294967296,!1),this._step()}_step(){let H=x._bigBlock32,F=this._buffDV;for(let N=0;N<64;N+=4)H.setUint32(N,F.getUint32(N,!1),!1);for(let N=64;N<320;N+=4)H.setUint32(N,J1(H.getUint32(N-12,!1)^H.getUint32(N-32,!1)^H.getUint32(N-56,!1)^H.getUint32(N-64,!1),1),!1);let Y=this._h0,G=this._h1,q=this._h2,m=this._h3,z=this._h4,C,R,M;for(let N=0;N<80;N++)N<20?(C=G&q|~G&m,R=1518500249):N<40?(C=G^q^m,R=1859775393):N<60?(C=G&q|G&m|q&m,R=2400959708):(C=G^q^m,R=3395469782),M=J1(Y,5)+C+z+R+H.getUint32(N*4,!1)&4294967295,z=m,m=q,q=J1(G,30),G=Y,Y=M;this._h0=this._h0+Y&4294967295,this._h1=this._h1+G&4294967295,this._h2=this._h2+q&4294967295,this._h3=this._h3+m&4294967295,this._h4=this._h4+z&4294967295}};I2._bigBlock32=new DataView(new ArrayBuffer(320));var{registerWindow:C8,getWindow:U0,getDocument:N8,getWindows:M8,getWindowsCount:j8,getWindowId:S9,getWindowById:Z8,hasWindow:$8,onDidRegisterWindow:S2,onWillUnregisterWindow:A8,onDidUnregisterWindow:J8}=function(){let x=new Map,H={window:A0,disposables:new a0};x.set(A0.vscodeWindowId,H);let F=new W,Y=new W,G=new W;function q(m,z){return(typeof m=="number"?x.get(m):void 0)??(z?H:void 0)}return{onDidRegisterWindow:F.event,onWillUnregisterWindow:G.event,onDidUnregisterWindow:Y.event,registerWindow(m){if(x.has(m.vscodeWindowId))return y.None;let z=new a0,C={window:m,disposables:z.add(new a0)};return x.set(m.vscodeWindowId,C),z.add(f(()=>{x.delete(m.vscodeWindowId),Y.fire(m)})),z.add(b(m,e.BEFORE_UNLOAD,()=>{G.fire(m)})),F.fire(C),z},getWindows(){return x.values()},getWindowsCount(){return x.size},getWindowId(m){return m.vscodeWindowId},hasWindow(m){return x.has(m)},getWindowById:q,getWindow(m){let z=m;if(z?.ownerDocument?.defaultView)return z.ownerDocument.defaultView.window;let C=m;return C?.view?C.view.window:A0},getDocument(m){return U0(m).document}}}(),Q2=class{constructor(x,H,F,Y){this._node=x,this._type=H,this._handler=F,this._options=Y||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}};function b(x,H,F,Y){return new Q2(x,H,F,Y)}function E2(x,H){return function(F){return H(new Wx(x,F))}}function h2(x){return function(H){return x(new d1(H))}}var Q9=function(x,H,F,Y){let G=F;return H==="click"||H==="mousedown"||H==="contextmenu"?G=E2(U0(x),F):(H==="keydown"||H==="keypress"||H==="keyup")&&(G=h2(F)),b(x,H,G,Y)},d2,ix,f2=class extends O2{constructor(x){super(),this.defaultTarget=x&&U0(x)}cancelAndSet(x,H,F){return super.cancelAndSet(x,H,F??this.defaultTarget)}},V1=class{constructor(x,H=0){this._runner=x,this.priority=H,this._canceled=!1}dispose(){this._canceled=!0}execute(){if(!this._canceled)try{this._runner()}catch(x){_x(x)}}static sort(x,H){return H.priority-x.priority}};(function(){let x=new Map,H=new Map,F=new Map,Y=new Map,G=(q)=>{F.set(q,!1);let m=x.get(q)??[];for(H.set(q,m),x.set(q,[]),Y.set(q,!0);m.length>0;)m.sort(V1.sort),m.shift().execute();Y.set(q,!1)};ix=(q,m,z=0)=>{let C=S9(q),R=new V1(m,z),M=x.get(C);return M||(M=[],x.set(C,M)),M.push(R),F.get(C)||(F.set(C,!0),q.requestAnimationFrame(()=>G(C))),R},d2=(q,m,z)=>{let C=S9(q);if(Y.get(C)){let R=new V1(m,z),M=H.get(C);return M||(M=[],H.set(C,M)),M.push(R),R}else return ix(q,m,z)}})();var E9=class x{constructor(H,F){this.width=H,this.height=F}with(H=this.width,F=this.height){return H!==this.width||F!==this.height?new x(H,F):this}static is(H){return typeof H=="object"&&typeof H.height=="number"&&typeof H.width=="number"}static lift(H){return H instanceof x?H:new x(H.width,H.height)}static equals(H,F){return H===F?!0:!H||!F?!1:H.width===F.width&&H.height===F.height}};E9.None=new E9(0,0);function _2(x){let H=x.getBoundingClientRect(),F=U0(x);return{left:H.left+F.scrollX,top:H.top+F.scrollY,width:H.width,height:H.height}}var V8=new class{constructor(){this.mutationObservers=new Map}observe(x,H,F){let Y=this.mutationObservers.get(x);Y||(Y=new Map,this.mutationObservers.set(x,Y));let G=b2(F),q=Y.get(G);if(q)q.users+=1;else{let m=new W,z=new MutationObserver((R)=>m.fire(R));z.observe(x,F);let C=q={users:1,observer:z,onDidMutate:m.event};H.add(f(()=>{C.users-=1,C.users===0&&(m.dispose(),z.disconnect(),Y?.delete(G),Y?.size===0&&this.mutationObservers.delete(x))})),Y.set(G,q)}return q.onDidMutate}},e={CLICK:"click",AUXCLICK:"auxclick",DBLCLICK:"dblclick",MOUSE_UP:"mouseup",MOUSE_DOWN:"mousedown",MOUSE_OVER:"mouseover",MOUSE_MOVE:"mousemove",MOUSE_OUT:"mouseout",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",POINTER_LEAVE:"pointerleave",CONTEXT_MENU:"contextmenu",WHEEL:"wheel",KEY_DOWN:"keydown",KEY_PRESS:"keypress",KEY_UP:"keyup",LOAD:"load",BEFORE_UNLOAD:"beforeunload",UNLOAD:"unload",PAGE_SHOW:"pageshow",PAGE_HIDE:"pagehide",PASTE:"paste",ABORT:"abort",ERROR:"error",RESIZE:"resize",SCROLL:"scroll",FULLSCREEN_CHANGE:"fullscreenchange",WK_FULLSCREEN_CHANGE:"webkitfullscreenchange",SELECT:"select",CHANGE:"change",SUBMIT:"submit",RESET:"reset",FOCUS:"focus",FOCUS_IN:"focusin",FOCUS_OUT:"focusout",BLUR:"blur",INPUT:"input",STORAGE:"storage",DRAG_START:"dragstart",DRAG:"drag",DRAG_ENTER:"dragenter",DRAG_LEAVE:"dragleave",DRAG_OVER:"dragover",DROP:"drop",DRAG_END:"dragend",ANIMATION_START:ux?"webkitAnimationStart":"animationstart",ANIMATION_END:ux?"webkitAnimationEnd":"animationend",ANIMATION_ITERATION:ux?"webkitAnimationIteration":"animationiteration"},v2=/([\w\-]+)?(#([\w\-]+))?((\.([\w\-]+))*)/;function d6(x,H,F,...Y){let G=v2.exec(H);if(!G)throw Error("Bad use of emmet");let q=G[1]||"div",m;return x!=="http://www.w3.org/1999/xhtml"?m=document.createElementNS(x,q):m=document.createElement(q),G[3]&&(m.id=G[3]),G[4]&&(m.className=G[4].replace(/\./g," ").trim()),F&&Object.entries(F).forEach(([z,C])=>{typeof C>"u"||(/^on\w+$/.test(z)?m[z]=C:z==="selected"?C&&m.setAttribute(z,"true"):m.setAttribute(z,C))}),m.append(...Y),m}function g2(x,H,...F){return d6("http://www.w3.org/1999/xhtml",x,H,...F)}g2.SVG=function(x,H,...F){return d6("http://www.w3.org/2000/svg",x,H,...F)};var u2=class{constructor(x){this.domNode=x,this._maxWidth="",this._width="",this._height="",this._top="",this._left="",this._bottom="",this._right="",this._paddingTop="",this._paddingLeft="",this._paddingBottom="",this._paddingRight="",this._fontFamily="",this._fontWeight="",this._fontSize="",this._fontStyle="",this._fontFeatureSettings="",this._fontVariationSettings="",this._textDecoration="",this._lineHeight="",this._letterSpacing="",this._className="",this._display="",this._position="",this._visibility="",this._color="",this._backgroundColor="",this._layerHint=!1,this._contain="none",this._boxShadow=""}setMaxWidth(x){let H=M0(x);this._maxWidth!==H&&(this._maxWidth=H,this.domNode.style.maxWidth=this._maxWidth)}setWidth(x){let H=M0(x);this._width!==H&&(this._width=H,this.domNode.style.width=this._width)}setHeight(x){let H=M0(x);this._height!==H&&(this._height=H,this.domNode.style.height=this._height)}setTop(x){let H=M0(x);this._top!==H&&(this._top=H,this.domNode.style.top=this._top)}setLeft(x){let H=M0(x);this._left!==H&&(this._left=H,this.domNode.style.left=this._left)}setBottom(x){let H=M0(x);this._bottom!==H&&(this._bottom=H,this.domNode.style.bottom=this._bottom)}setRight(x){let H=M0(x);this._right!==H&&(this._right=H,this.domNode.style.right=this._right)}setPaddingTop(x){let H=M0(x);this._paddingTop!==H&&(this._paddingTop=H,this.domNode.style.paddingTop=this._paddingTop)}setPaddingLeft(x){let H=M0(x);this._paddingLeft!==H&&(this._paddingLeft=H,this.domNode.style.paddingLeft=this._paddingLeft)}setPaddingBottom(x){let H=M0(x);this._paddingBottom!==H&&(this._paddingBottom=H,this.domNode.style.paddingBottom=this._paddingBottom)}setPaddingRight(x){let H=M0(x);this._paddingRight!==H&&(this._paddingRight=H,this.domNode.style.paddingRight=this._paddingRight)}setFontFamily(x){this._fontFamily!==x&&(this._fontFamily=x,this.domNode.style.fontFamily=this._fontFamily)}setFontWeight(x){this._fontWeight!==x&&(this._fontWeight=x,this.domNode.style.fontWeight=this._fontWeight)}setFontSize(x){let H=M0(x);this._fontSize!==H&&(this._fontSize=H,this.domNode.style.fontSize=this._fontSize)}setFontStyle(x){this._fontStyle!==x&&(this._fontStyle=x,this.domNode.style.fontStyle=this._fontStyle)}setFontFeatureSettings(x){this._fontFeatureSettings!==x&&(this._fontFeatureSettings=x,this.domNode.style.fontFeatureSettings=this._fontFeatureSettings)}setFontVariationSettings(x){this._fontVariationSettings!==x&&(this._fontVariationSettings=x,this.domNode.style.fontVariationSettings=this._fontVariationSettings)}setTextDecoration(x){this._textDecoration!==x&&(this._textDecoration=x,this.domNode.style.textDecoration=this._textDecoration)}setLineHeight(x){let H=M0(x);this._lineHeight!==H&&(this._lineHeight=H,this.domNode.style.lineHeight=this._lineHeight)}setLetterSpacing(x){let H=M0(x);this._letterSpacing!==H&&(this._letterSpacing=H,this.domNode.style.letterSpacing=this._letterSpacing)}setClassName(x){this._className!==x&&(this._className=x,this.domNode.className=this._className)}toggleClassName(x,H){this.domNode.classList.toggle(x,H),this._className=this.domNode.className}setDisplay(x){this._display!==x&&(this._display=x,this.domNode.style.display=this._display)}setPosition(x){this._position!==x&&(this._position=x,this.domNode.style.position=this._position)}setVisibility(x){this._visibility!==x&&(this._visibility=x,this.domNode.style.visibility=this._visibility)}setColor(x){this._color!==x&&(this._color=x,this.domNode.style.color=this._color)}setBackgroundColor(x){this._backgroundColor!==x&&(this._backgroundColor=x,this.domNode.style.backgroundColor=this._backgroundColor)}setLayerHinting(x){this._layerHint!==x&&(this._layerHint=x,this.domNode.style.transform=this._layerHint?"translate3d(0px, 0px, 0px)":"")}setBoxShadow(x){this._boxShadow!==x&&(this._boxShadow=x,this.domNode.style.boxShadow=x)}setContain(x){this._contain!==x&&(this._contain=x,this.domNode.style.contain=this._contain)}setAttribute(x,H){this.domNode.setAttribute(x,H)}removeAttribute(x){this.domNode.removeAttribute(x)}appendChild(x){this.domNode.appendChild(x.domNode)}removeChild(x){this.domNode.removeChild(x.domNode)}};function M0(x){return typeof x=="number"?`${x}px`:x}function kx(x){return new u2(x)}var f6=class{constructor(){this._hooks=new a0,this._pointerMoveCallback=null,this._onStopCallback=null}dispose(){this.stopMonitoring(!1),this._hooks.dispose()}stopMonitoring(x,H){if(!this.isMonitoring())return;this._hooks.clear(),this._pointerMoveCallback=null;let F=this._onStopCallback;this._onStopCallback=null,x&&F&&F(H)}isMonitoring(){return!!this._pointerMoveCallback}startMonitoring(x,H,F,Y,G){this.isMonitoring()&&this.stopMonitoring(!1),this._pointerMoveCallback=Y,this._onStopCallback=G;let q=x;try{x.setPointerCapture(H),this._hooks.add(f(()=>{try{x.releasePointerCapture(H)}catch{}}))}catch{q=U0(x)}this._hooks.add(b(q,e.POINTER_MOVE,(m)=>{if(m.buttons!==F){this.stopMonitoring(!0);return}m.preventDefault(),this._pointerMoveCallback(m)})),this._hooks.add(b(q,e.POINTER_UP,(m)=>this.stopMonitoring(!0)))}};function c2(x,H,F){let Y=null,G=null;if(typeof F.value=="function"?(Y="value",G=F.value,G.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof F.get=="function"&&(Y="get",G=F.get),!G)throw Error("not supported");let q=`$memoize$${H}`;F[Y]=function(...m){return this.hasOwnProperty(q)||Object.defineProperty(this,q,{configurable:!1,enumerable:!1,writable:!1,value:G.apply(this,m)}),this[q]}}var k0;((x)=>(x.Tap="-xterm-gesturetap",x.Change="-xterm-gesturechange",x.Start="-xterm-gesturestart",x.End="-xterm-gesturesend",x.Contextmenu="-xterm-gesturecontextmenu"))(k0||={});var Xx=class x extends y{constructor(){super();this.dispatched=!1,this.targets=new O9,this.ignoreTargets=new O9,this.activeTouches={},this.handle=null,this._lastSetTapCountTime=0,this._register(m0.runAndSubscribe(S2,({window:H,disposables:F})=>{F.add(b(H.document,"touchstart",(Y)=>this.onTouchStart(Y),{passive:!1})),F.add(b(H.document,"touchend",(Y)=>this.onTouchEnd(H,Y))),F.add(b(H.document,"touchmove",(Y)=>this.onTouchMove(Y),{passive:!1}))},{window:A0,disposables:this._store}))}static addTarget(H){if(!x.isTouchDevice())return y.None;x.INSTANCE||(x.INSTANCE=B9(new x));let F=x.INSTANCE.targets.push(H);return f(F)}static ignoreTarget(H){if(!x.isTouchDevice())return y.None;x.INSTANCE||(x.INSTANCE=B9(new x));let F=x.INSTANCE.ignoreTargets.push(H);return f(F)}static isTouchDevice(){return"ontouchstart"in A0||navigator.maxTouchPoints>0}dispose(){this.handle&&(this.handle.dispose(),this.handle=null),super.dispose()}onTouchStart(H){let F=Date.now();this.handle&&(this.handle.dispose(),this.handle=null);for(let Y=0,G=H.targetTouches.length;Y<G;Y++){let q=H.targetTouches.item(Y);this.activeTouches[q.identifier]={id:q.identifier,initialTarget:q.target,initialTimeStamp:F,initialPageX:q.pageX,initialPageY:q.pageY,rollingTimestamps:[F],rollingPageX:[q.pageX],rollingPageY:[q.pageY]};let m=this.newGestureEvent(k0.Start,q.target);m.pageX=q.pageX,m.pageY=q.pageY,this.dispatchEvent(m)}this.dispatched&&(H.preventDefault(),H.stopPropagation(),this.dispatched=!1)}onTouchEnd(H,F){let Y=Date.now(),G=Object.keys(this.activeTouches).length;for(let q=0,m=F.changedTouches.length;q<m;q++){let z=F.changedTouches.item(q);if(!this.activeTouches.hasOwnProperty(String(z.identifier))){console.warn("move of an UNKNOWN touch",z);continue}let C=this.activeTouches[z.identifier],R=Date.now()-C.initialTimeStamp;if(R<x.HOLD_DELAY&&Math.abs(C.initialPageX-j0(C.rollingPageX))<30&&Math.abs(C.initialPageY-j0(C.rollingPageY))<30){let M=this.newGestureEvent(k0.Tap,C.initialTarget);M.pageX=j0(C.rollingPageX),M.pageY=j0(C.rollingPageY),this.dispatchEvent(M)}else if(R>=x.HOLD_DELAY&&Math.abs(C.initialPageX-j0(C.rollingPageX))<30&&Math.abs(C.initialPageY-j0(C.rollingPageY))<30){let M=this.newGestureEvent(k0.Contextmenu,C.initialTarget);M.pageX=j0(C.rollingPageX),M.pageY=j0(C.rollingPageY),this.dispatchEvent(M)}else if(G===1){let M=j0(C.rollingPageX),N=j0(C.rollingPageY),Z=j0(C.rollingTimestamps)-C.rollingTimestamps[0],$=M-C.rollingPageX[0],j=N-C.rollingPageY[0],A=[...this.targets].filter((O)=>C.initialTarget instanceof Node&&O.contains(C.initialTarget));this.inertia(H,A,Y,Math.abs($)/Z,$>0?1:-1,M,Math.abs(j)/Z,j>0?1:-1,N)}this.dispatchEvent(this.newGestureEvent(k0.End,C.initialTarget)),delete this.activeTouches[z.identifier]}this.dispatched&&(F.preventDefault(),F.stopPropagation(),this.dispatched=!1)}newGestureEvent(H,F){let Y=document.createEvent("CustomEvent");return Y.initEvent(H,!1,!0),Y.initialTarget=F,Y.tapCount=0,Y}dispatchEvent(H){if(H.type===k0.Tap){let F=new Date().getTime(),Y=0;F-this._lastSetTapCountTime>x.CLEAR_TAP_COUNT_TIME?Y=1:Y=2,this._lastSetTapCountTime=F,H.tapCount=Y}else(H.type===k0.Change||H.type===k0.Contextmenu)&&(this._lastSetTapCountTime=0);if(H.initialTarget instanceof Node){for(let Y of this.ignoreTargets)if(Y.contains(H.initialTarget))return;let F=[];for(let Y of this.targets)if(Y.contains(H.initialTarget)){let G=0,q=H.initialTarget;for(;q&&q!==Y;)G++,q=q.parentElement;F.push([G,Y])}F.sort((Y,G)=>Y[0]-G[0]);for(let[Y,G]of F)G.dispatchEvent(H),this.dispatched=!0}}inertia(H,F,Y,G,q,m,z,C,R){this.handle=ix(H,()=>{let M=Date.now(),N=M-Y,Z=0,$=0,j=!0;G+=x.SCROLL_FRICTION*N,z+=x.SCROLL_FRICTION*N,G>0&&(j=!1,Z=q*G*N),z>0&&(j=!1,$=C*z*N);let A=this.newGestureEvent(k0.Change);A.translationX=Z,A.translationY=$,F.forEach((O)=>O.dispatchEvent(A)),j||this.inertia(H,F,M,G,q,m+Z,z,C,R+$)})}onTouchMove(H){let F=Date.now();for(let Y=0,G=H.changedTouches.length;Y<G;Y++){let q=H.changedTouches.item(Y);if(!this.activeTouches.hasOwnProperty(String(q.identifier))){console.warn("end of an UNKNOWN touch",q);continue}let m=this.activeTouches[q.identifier],z=this.newGestureEvent(k0.Change,m.initialTarget);z.translationX=q.pageX-j0(m.rollingPageX),z.translationY=q.pageY-j0(m.rollingPageY),z.pageX=q.pageX,z.pageY=q.pageY,this.dispatchEvent(z),m.rollingPageX.length>3&&(m.rollingPageX.shift(),m.rollingPageY.shift(),m.rollingTimestamps.shift()),m.rollingPageX.push(q.pageX),m.rollingPageY.push(q.pageY),m.rollingTimestamps.push(F)}this.dispatched&&(H.preventDefault(),H.stopPropagation(),this.dispatched=!1)}};Xx.SCROLL_FRICTION=-0.005,Xx.HOLD_DELAY=700,Xx.CLEAR_TAP_COUNT_TIME=400,a([c2],Xx,"isTouchDevice",1);var a2=Xx,N9=class extends y{onclick(x,H){this._register(b(x,e.CLICK,(F)=>H(new Wx(U0(x),F))))}onmousedown(x,H){this._register(b(x,e.MOUSE_DOWN,(F)=>H(new Wx(U0(x),F))))}onmouseover(x,H){this._register(b(x,e.MOUSE_OVER,(F)=>H(new Wx(U0(x),F))))}onmouseleave(x,H){this._register(b(x,e.MOUSE_LEAVE,(F)=>H(new Wx(U0(x),F))))}onkeydown(x,H){this._register(b(x,e.KEY_DOWN,(F)=>H(new d1(F))))}onkeyup(x,H){this._register(b(x,e.KEY_UP,(F)=>H(new d1(F))))}oninput(x,H){this._register(b(x,e.INPUT,H))}onblur(x,H){this._register(b(x,e.BLUR,H))}onfocus(x,H){this._register(b(x,e.FOCUS,H))}onchange(x,H){this._register(b(x,e.CHANGE,H))}ignoreGesture(x){return a2.ignoreTarget(x)}},h9=11,o2=class extends N9{constructor(x){super(),this._onActivate=x.onActivate,this.bgDomNode=document.createElement("div"),this.bgDomNode.className="arrow-background",this.bgDomNode.style.position="absolute",this.bgDomNode.style.width=x.bgWidth+"px",this.bgDomNode.style.height=x.bgHeight+"px",typeof x.top<"u"&&(this.bgDomNode.style.top="0px"),typeof x.left<"u"&&(this.bgDomNode.style.left="0px"),typeof x.bottom<"u"&&(this.bgDomNode.style.bottom="0px"),typeof x.right<"u"&&(this.bgDomNode.style.right="0px"),this.domNode=document.createElement("div"),this.domNode.className=x.className,this.domNode.style.position="absolute",this.domNode.style.width=h9+"px",this.domNode.style.height=h9+"px",typeof x.top<"u"&&(this.domNode.style.top=x.top+"px"),typeof x.left<"u"&&(this.domNode.style.left=x.left+"px"),typeof x.bottom<"u"&&(this.domNode.style.bottom=x.bottom+"px"),typeof x.right<"u"&&(this.domNode.style.right=x.right+"px"),this._pointerMoveMonitor=this._register(new f6),this._register(Q9(this.bgDomNode,e.POINTER_DOWN,(H)=>this._arrowPointerDown(H))),this._register(Q9(this.domNode,e.POINTER_DOWN,(H)=>this._arrowPointerDown(H))),this._pointerdownRepeatTimer=this._register(new f2),this._pointerdownScheduleRepeatTimer=this._register(new z9)}_arrowPointerDown(x){if(!x.target||!(x.target instanceof Element))return;let H=()=>{this._pointerdownRepeatTimer.cancelAndSet(()=>this._onActivate(),41.666666666666664,U0(x))};this._onActivate(),this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancelAndSet(H,200),this._pointerMoveMonitor.startMonitoring(x.target,x.pointerId,x.buttons,(F)=>{},()=>{this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancel()}),x.preventDefault()}},l2=class x{constructor(H,F,Y,G,q,m,z){this._forceIntegerValues=H,this._scrollStateBrand=void 0,this._forceIntegerValues&&(F=F|0,Y=Y|0,G=G|0,q=q|0,m=m|0,z=z|0),this.rawScrollLeft=G,this.rawScrollTop=z,F<0&&(F=0),G+F>Y&&(G=Y-F),G<0&&(G=0),q<0&&(q=0),z+q>m&&(z=m-q),z<0&&(z=0),this.width=F,this.scrollWidth=Y,this.scrollLeft=G,this.height=q,this.scrollHeight=m,this.scrollTop=z}equals(H){return this.rawScrollLeft===H.rawScrollLeft&&this.rawScrollTop===H.rawScrollTop&&this.width===H.width&&this.scrollWidth===H.scrollWidth&&this.scrollLeft===H.scrollLeft&&this.height===H.height&&this.scrollHeight===H.scrollHeight&&this.scrollTop===H.scrollTop}withScrollDimensions(H,F){return new x(this._forceIntegerValues,typeof H.width<"u"?H.width:this.width,typeof H.scrollWidth<"u"?H.scrollWidth:this.scrollWidth,F?this.rawScrollLeft:this.scrollLeft,typeof H.height<"u"?H.height:this.height,typeof H.scrollHeight<"u"?H.scrollHeight:this.scrollHeight,F?this.rawScrollTop:this.scrollTop)}withScrollPosition(H){return new x(this._forceIntegerValues,this.width,this.scrollWidth,typeof H.scrollLeft<"u"?H.scrollLeft:this.rawScrollLeft,this.height,this.scrollHeight,typeof H.scrollTop<"u"?H.scrollTop:this.rawScrollTop)}createScrollEvent(H,F){let Y=this.width!==H.width,G=this.scrollWidth!==H.scrollWidth,q=this.scrollLeft!==H.scrollLeft,m=this.height!==H.height,z=this.scrollHeight!==H.scrollHeight,C=this.scrollTop!==H.scrollTop;return{inSmoothScrolling:F,oldWidth:H.width,oldScrollWidth:H.scrollWidth,oldScrollLeft:H.scrollLeft,width:this.width,scrollWidth:this.scrollWidth,scrollLeft:this.scrollLeft,oldHeight:H.height,oldScrollHeight:H.scrollHeight,oldScrollTop:H.scrollTop,height:this.height,scrollHeight:this.scrollHeight,scrollTop:this.scrollTop,widthChanged:Y,scrollWidthChanged:G,scrollLeftChanged:q,heightChanged:m,scrollHeightChanged:z,scrollTopChanged:C}}},n2=class extends y{constructor(x){super();this._scrollableBrand=void 0,this._onScroll=this._register(new W),this.onScroll=this._onScroll.event,this._smoothScrollDuration=x.smoothScrollDuration,this._scheduleAtNextAnimationFrame=x.scheduleAtNextAnimationFrame,this._state=new l2(x.forceIntegerValues,0,0,0,0,0,0),this._smoothScrolling=null}dispose(){this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),super.dispose()}setSmoothScrollDuration(x){this._smoothScrollDuration=x}validateScrollPosition(x){return this._state.withScrollPosition(x)}getScrollDimensions(){return this._state}setScrollDimensions(x,H){let F=this._state.withScrollDimensions(x,H);this._setState(F,!!this._smoothScrolling),this._smoothScrolling?.acceptScrollDimensions(this._state)}getFutureScrollPosition(){return this._smoothScrolling?this._smoothScrolling.to:this._state}getCurrentScrollPosition(){return this._state}setScrollPositionNow(x){let H=this._state.withScrollPosition(x);this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),this._setState(H,!1)}setScrollPositionSmooth(x,H){if(this._smoothScrollDuration===0)return this.setScrollPositionNow(x);if(this._smoothScrolling){x={scrollLeft:typeof x.scrollLeft>"u"?this._smoothScrolling.to.scrollLeft:x.scrollLeft,scrollTop:typeof x.scrollTop>"u"?this._smoothScrolling.to.scrollTop:x.scrollTop};let F=this._state.withScrollPosition(x);if(this._smoothScrolling.to.scrollLeft===F.scrollLeft&&this._smoothScrolling.to.scrollTop===F.scrollTop)return;let Y;H?Y=new f9(this._smoothScrolling.from,F,this._smoothScrolling.startTime,this._smoothScrolling.duration):Y=this._smoothScrolling.combine(this._state,F,this._smoothScrollDuration),this._smoothScrolling.dispose(),this._smoothScrolling=Y}else{let F=this._state.withScrollPosition(x);this._smoothScrolling=f9.start(this._state,F,this._smoothScrollDuration)}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}hasPendingScrollAnimation(){return!!this._smoothScrolling}_performSmoothScrolling(){if(!this._smoothScrolling)return;let x=this._smoothScrolling.tick(),H=this._state.withScrollPosition(x);if(this._setState(H,!0),!!this._smoothScrolling){if(x.isDone){this._smoothScrolling.dispose(),this._smoothScrolling=null;return}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}}_setState(x,H){let F=this._state;F.equals(x)||(this._state=x,this._onScroll.fire(this._state.createScrollEvent(F,H)))}},d9=class{constructor(x,H,F){this.scrollLeft=x,this.scrollTop=H,this.isDone=F}};function W1(x,H){let F=H-x;return function(Y){return x+F*i2(Y)}}function s2(x,H,F){return function(Y){return Y<F?x(Y/F):H((Y-F)/(1-F))}}var f9=class x{constructor(H,F,Y,G){this.from=H,this.to=F,this.duration=G,this.startTime=Y,this.animationFrameDisposable=null,this._initAnimations()}_initAnimations(){this.scrollLeft=this._initAnimation(this.from.scrollLeft,this.to.scrollLeft,this.to.width),this.scrollTop=this._initAnimation(this.from.scrollTop,this.to.scrollTop,this.to.height)}_initAnimation(H,F,Y){if(Math.abs(H-F)>2.5*Y){let G,q;return H<F?(G=H+0.75*Y,q=F-0.75*Y):(G=H-0.75*Y,q=F+0.75*Y),s2(W1(H,G),W1(q,F),0.33)}return W1(H,F)}dispose(){this.animationFrameDisposable!==null&&(this.animationFrameDisposable.dispose(),this.animationFrameDisposable=null)}acceptScrollDimensions(H){this.to=H.withScrollPosition(this.to),this._initAnimations()}tick(){return this._tick(Date.now())}_tick(H){let F=(H-this.startTime)/this.duration;if(F<1){let Y=this.scrollLeft(F),G=this.scrollTop(F);return new d9(Y,G,!1)}return new d9(this.to.scrollLeft,this.to.scrollTop,!0)}combine(H,F,Y){return x.start(H,F,Y)}static start(H,F,Y){Y=Y+10;let G=Date.now()-10;return new x(H,F,G,Y)}};function r2(x){return Math.pow(x,3)}function i2(x){return 1-r2(1-x)}var t2=class extends y{constructor(x,H,F){super(),this._visibility=x,this._visibleClassName=H,this._invisibleClassName=F,this._domNode=null,this._isVisible=!1,this._isNeeded=!1,this._rawShouldBeVisible=!1,this._shouldBeVisible=!1,this._revealTimer=this._register(new z9)}setVisibility(x){this._visibility!==x&&(this._visibility=x,this._updateShouldBeVisible())}setShouldBeVisible(x){this._rawShouldBeVisible=x,this._updateShouldBeVisible()}_applyVisibilitySetting(){return this._visibility===2?!1:this._visibility===3?!0:this._rawShouldBeVisible}_updateShouldBeVisible(){let x=this._applyVisibilitySetting();this._shouldBeVisible!==x&&(this._shouldBeVisible=x,this.ensureVisibility())}setIsNeeded(x){this._isNeeded!==x&&(this._isNeeded=x,this.ensureVisibility())}setDomNode(x){this._domNode=x,this._domNode.setClassName(this._invisibleClassName),this.setShouldBeVisible(!1)}ensureVisibility(){if(!this._isNeeded){this._hide(!1);return}this._shouldBeVisible?this._reveal():this._hide(!0)}_reveal(){this._isVisible||(this._isVisible=!0,this._revealTimer.setIfNotSet(()=>{this._domNode?.setClassName(this._visibleClassName)},0))}_hide(x){this._revealTimer.cancel(),this._isVisible&&(this._isVisible=!1,this._domNode?.setClassName(this._invisibleClassName+(x?" fade":"")))}},e2=140,_6=class extends N9{constructor(x){super(),this._lazyRender=x.lazyRender,this._host=x.host,this._scrollable=x.scrollable,this._scrollByPage=x.scrollByPage,this._scrollbarState=x.scrollbarState,this._visibilityController=this._register(new t2(x.visibility,"visible scrollbar "+x.extraScrollbarClassName,"invisible scrollbar "+x.extraScrollbarClassName)),this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._pointerMoveMonitor=this._register(new f6),this._shouldRender=!0,this.domNode=kx(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this._visibilityController.setDomNode(this.domNode),this.domNode.setPosition("absolute"),this._register(b(this.domNode.domNode,e.POINTER_DOWN,(H)=>this._domNodePointerDown(H)))}_createArrow(x){let H=this._register(new o2(x));this.domNode.domNode.appendChild(H.bgDomNode),this.domNode.domNode.appendChild(H.domNode)}_createSlider(x,H,F,Y){this.slider=kx(document.createElement("div")),this.slider.setClassName("slider"),this.slider.setPosition("absolute"),this.slider.setTop(x),this.slider.setLeft(H),typeof F=="number"&&this.slider.setWidth(F),typeof Y=="number"&&this.slider.setHeight(Y),this.slider.setLayerHinting(!0),this.slider.setContain("strict"),this.domNode.domNode.appendChild(this.slider.domNode),this._register(b(this.slider.domNode,e.POINTER_DOWN,(G)=>{G.button===0&&(G.preventDefault(),this._sliderPointerDown(G))})),this.onclick(this.slider.domNode,(G)=>{G.leftButton&&G.stopPropagation()})}_onElementSize(x){return this._scrollbarState.setVisibleSize(x)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollSize(x){return this._scrollbarState.setScrollSize(x)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollPosition(x){return this._scrollbarState.setScrollPosition(x)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}beginReveal(){this._visibilityController.setShouldBeVisible(!0)}beginHide(){this._visibilityController.setShouldBeVisible(!1)}render(){this._shouldRender&&(this._shouldRender=!1,this._renderDomNode(this._scrollbarState.getRectangleLargeSize(),this._scrollbarState.getRectangleSmallSize()),this._updateSlider(this._scrollbarState.getSliderSize(),this._scrollbarState.getArrowSize()+this._scrollbarState.getSliderPosition()))}_domNodePointerDown(x){x.target===this.domNode.domNode&&this._onPointerDown(x)}delegatePointerDown(x){let H=this.domNode.domNode.getClientRects()[0].top,F=H+this._scrollbarState.getSliderPosition(),Y=H+this._scrollbarState.getSliderPosition()+this._scrollbarState.getSliderSize(),G=this._sliderPointerPosition(x);F<=G&&G<=Y?x.button===0&&(x.preventDefault(),this._sliderPointerDown(x)):this._onPointerDown(x)}_onPointerDown(x){let H,F;if(x.target===this.domNode.domNode&&typeof x.offsetX=="number"&&typeof x.offsetY=="number")H=x.offsetX,F=x.offsetY;else{let G=_2(this.domNode.domNode);H=x.pageX-G.left,F=x.pageY-G.top}let Y=this._pointerDownRelativePosition(H,F);this._setDesiredScrollPositionNow(this._scrollByPage?this._scrollbarState.getDesiredScrollPositionFromOffsetPaged(Y):this._scrollbarState.getDesiredScrollPositionFromOffset(Y)),x.button===0&&(x.preventDefault(),this._sliderPointerDown(x))}_sliderPointerDown(x){if(!x.target||!(x.target instanceof Element))return;let H=this._sliderPointerPosition(x),F=this._sliderOrthogonalPointerPosition(x),Y=this._scrollbarState.clone();this.slider.toggleClassName("active",!0),this._pointerMoveMonitor.startMonitoring(x.target,x.pointerId,x.buttons,(G)=>{let q=this._sliderOrthogonalPointerPosition(G),m=Math.abs(q-F);if(S6&&m>e2){this._setDesiredScrollPositionNow(Y.getScrollPosition());return}let z=this._sliderPointerPosition(G)-H;this._setDesiredScrollPositionNow(Y.getDesiredScrollPositionFromDelta(z))},()=>{this.slider.toggleClassName("active",!1),this._host.onDragEnd()}),this._host.onDragStart()}_setDesiredScrollPositionNow(x){let H={};this.writeScrollPosition(H,x),this._scrollable.setScrollPositionNow(H)}updateScrollbarSize(x){this._updateScrollbarSize(x),this._scrollbarState.setScrollbarSize(x),this._shouldRender=!0,this._lazyRender||this.render()}isNeeded(){return this._scrollbarState.isNeeded()}},v6=class x{constructor(H,F,Y,G,q,m){this._scrollbarSize=Math.round(F),this._oppositeScrollbarSize=Math.round(Y),this._arrowSize=Math.round(H),this._visibleSize=G,this._scrollSize=q,this._scrollPosition=m,this._computedAvailableSize=0,this._computedIsNeeded=!1,this._computedSliderSize=0,this._computedSliderRatio=0,this._computedSliderPosition=0,this._refreshComputedValues()}clone(){return new x(this._arrowSize,this._scrollbarSize,this._oppositeScrollbarSize,this._visibleSize,this._scrollSize,this._scrollPosition)}setVisibleSize(H){let F=Math.round(H);return this._visibleSize!==F?(this._visibleSize=F,this._refreshComputedValues(),!0):!1}setScrollSize(H){let F=Math.round(H);return this._scrollSize!==F?(this._scrollSize=F,this._refreshComputedValues(),!0):!1}setScrollPosition(H){let F=Math.round(H);return this._scrollPosition!==F?(this._scrollPosition=F,this._refreshComputedValues(),!0):!1}setScrollbarSize(H){this._scrollbarSize=Math.round(H)}setOppositeScrollbarSize(H){this._oppositeScrollbarSize=Math.round(H)}static _computeValues(H,F,Y,G,q){let m=Math.max(0,Y-H),z=Math.max(0,m-2*F),C=G>0&&G>Y;if(!C)return{computedAvailableSize:Math.round(m),computedIsNeeded:C,computedSliderSize:Math.round(z),computedSliderRatio:0,computedSliderPosition:0};let R=Math.round(Math.max(20,Math.floor(Y*z/G))),M=(z-R)/(G-Y),N=q*M;return{computedAvailableSize:Math.round(m),computedIsNeeded:C,computedSliderSize:Math.round(R),computedSliderRatio:M,computedSliderPosition:Math.round(N)}}_refreshComputedValues(){let H=x._computeValues(this._oppositeScrollbarSize,this._arrowSize,this._visibleSize,this._scrollSize,this._scrollPosition);this._computedAvailableSize=H.computedAvailableSize,this._computedIsNeeded=H.computedIsNeeded,this._computedSliderSize=H.computedSliderSize,this._computedSliderRatio=H.computedSliderRatio,this._computedSliderPosition=H.computedSliderPosition}getArrowSize(){return this._arrowSize}getScrollPosition(){return this._scrollPosition}getRectangleLargeSize(){return this._computedAvailableSize}getRectangleSmallSize(){return this._scrollbarSize}isNeeded(){return this._computedIsNeeded}getSliderSize(){return this._computedSliderSize}getSliderPosition(){return this._computedSliderPosition}getDesiredScrollPositionFromOffset(H){if(!this._computedIsNeeded)return 0;let F=H-this._arrowSize-this._computedSliderSize/2;return Math.round(F/this._computedSliderRatio)}getDesiredScrollPositionFromOffsetPaged(H){if(!this._computedIsNeeded)return 0;let F=H-this._arrowSize,Y=this._scrollPosition;return F<this._computedSliderPosition?Y-=this._visibleSize:Y+=this._visibleSize,Y}getDesiredScrollPositionFromDelta(H){if(!this._computedIsNeeded)return 0;let F=this._computedSliderPosition+H;return Math.round(F/this._computedSliderRatio)}},x5=class extends _6{constructor(x,H,F){let Y=x.getScrollDimensions(),G=x.getCurrentScrollPosition();if(super({lazyRender:H.lazyRender,host:F,scrollbarState:new v6(H.horizontalHasArrows?H.arrowSize:0,H.horizontal===2?0:H.horizontalScrollbarSize,H.vertical===2?0:H.verticalScrollbarSize,Y.width,Y.scrollWidth,G.scrollLeft),visibility:H.horizontal,extraScrollbarClassName:"horizontal",scrollable:x,scrollByPage:H.scrollByPage}),H.horizontalHasArrows)throw Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(Math.floor((H.horizontalScrollbarSize-H.horizontalSliderSize)/2),0,void 0,H.horizontalSliderSize)}_updateSlider(x,H){this.slider.setWidth(x),this.slider.setLeft(H)}_renderDomNode(x,H){this.domNode.setWidth(x),this.domNode.setHeight(H),this.domNode.setLeft(0),this.domNode.setBottom(0)}onDidScroll(x){return this._shouldRender=this._onElementScrollSize(x.scrollWidth)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(x.scrollLeft)||this._shouldRender,this._shouldRender=this._onElementSize(x.width)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(x,H){return x}_sliderPointerPosition(x){return x.pageX}_sliderOrthogonalPointerPosition(x){return x.pageY}_updateScrollbarSize(x){this.slider.setHeight(x)}writeScrollPosition(x,H){x.scrollLeft=H}updateOptions(x){this.updateScrollbarSize(x.horizontal===2?0:x.horizontalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(x.vertical===2?0:x.verticalScrollbarSize),this._visibilityController.setVisibility(x.horizontal),this._scrollByPage=x.scrollByPage}},H5=class extends _6{constructor(x,H,F){let Y=x.getScrollDimensions(),G=x.getCurrentScrollPosition();if(super({lazyRender:H.lazyRender,host:F,scrollbarState:new v6(H.verticalHasArrows?H.arrowSize:0,H.vertical===2?0:H.verticalScrollbarSize,0,Y.height,Y.scrollHeight,G.scrollTop),visibility:H.vertical,extraScrollbarClassName:"vertical",scrollable:x,scrollByPage:H.scrollByPage}),H.verticalHasArrows)throw Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(0,Math.floor((H.verticalScrollbarSize-H.verticalSliderSize)/2),H.verticalSliderSize,void 0)}_updateSlider(x,H){this.slider.setHeight(x),this.slider.setTop(H)}_renderDomNode(x,H){this.domNode.setWidth(H),this.domNode.setHeight(x),this.domNode.setRight(0),this.domNode.setTop(0)}onDidScroll(x){return this._shouldRender=this._onElementScrollSize(x.scrollHeight)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(x.scrollTop)||this._shouldRender,this._shouldRender=this._onElementSize(x.height)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(x,H){return H}_sliderPointerPosition(x){return x.pageY}_sliderOrthogonalPointerPosition(x){return x.pageX}_updateScrollbarSize(x){this.slider.setWidth(x)}writeScrollPosition(x,H){x.scrollTop=H}updateOptions(x){this.updateScrollbarSize(x.vertical===2?0:x.verticalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(0),this._visibilityController.setVisibility(x.vertical),this._scrollByPage=x.scrollByPage}},F5=500,_9=50,v9=!0,Y5=class{constructor(x,H,F){this.timestamp=x,this.deltaX=H,this.deltaY=F,this.score=0}},f1=class{constructor(){this._capacity=5,this._memory=[],this._front=-1,this._rear=-1}isPhysicalMouseWheel(){if(this._front===-1&&this._rear===-1)return!1;let H=1,F=0,Y=1,G=this._rear;do{let q=G===this._front?H:Math.pow(2,-Y);if(H-=q,F+=this._memory[G].score*q,G===this._front)break;G=(this._capacity+G-1)%this._capacity,Y++}while(!0);return F<=0.5}acceptStandardWheelEvent(H){if(m9){let F=U0(H.browserEvent),Y=r3(F);this.accept(Date.now(),H.deltaX*Y,H.deltaY*Y)}else this.accept(Date.now(),H.deltaX,H.deltaY)}accept(H,F,Y){let G=null,q=new Y5(H,F,Y);this._front===-1&&this._rear===-1?(this._memory[0]=q,this._front=0,this._rear=0):(G=this._memory[this._rear],this._rear=(this._rear+1)%this._capacity,this._rear===this._front&&(this._front=(this._front+1)%this._capacity),this._memory[this._rear]=q),q.score=this._computeScore(q,G)}_computeScore(H,F){if(Math.abs(H.deltaX)>0&&Math.abs(H.deltaY)>0)return 1;let Y=0.5;if((!this._isAlmostInt(H.deltaX)||!this._isAlmostInt(H.deltaY))&&(Y+=0.25),F){let G=Math.abs(H.deltaX),q=Math.abs(H.deltaY),m=Math.abs(F.deltaX),z=Math.abs(F.deltaY),C=Math.max(Math.min(G,m),1),R=Math.max(Math.min(q,z),1),M=Math.max(G,m),N=Math.max(q,z);M%C===0&&N%R===0&&(Y-=0.5)}return Math.min(Math.max(Y,0),1)}_isAlmostInt(H){return Math.abs(Math.round(H)-H)<0.01}};f1.INSTANCE=new f1;var G5=f1,q5=class extends N9{constructor(x,H,F){super();this._onScroll=this._register(new W),this.onScroll=this._onScroll.event,this._onWillScroll=this._register(new W),this.onWillScroll=this._onWillScroll.event,this._options=R5(H),this._scrollable=F,this._register(this._scrollable.onScroll((G)=>{this._onWillScroll.fire(G),this._onDidScroll(G),this._onScroll.fire(G)}));let Y={onMouseWheel:(G)=>this._onMouseWheel(G),onDragStart:()=>this._onDragStart(),onDragEnd:()=>this._onDragEnd()};this._verticalScrollbar=this._register(new H5(this._scrollable,this._options,Y)),this._horizontalScrollbar=this._register(new x5(this._scrollable,this._options,Y)),this._domNode=document.createElement("div"),this._domNode.className="xterm-scrollable-element "+this._options.className,this._domNode.setAttribute("role","presentation"),this._domNode.style.position="relative",this._domNode.appendChild(x),this._domNode.appendChild(this._horizontalScrollbar.domNode.domNode),this._domNode.appendChild(this._verticalScrollbar.domNode.domNode),this._options.useShadows?(this._leftShadowDomNode=kx(document.createElement("div")),this._leftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._leftShadowDomNode.domNode),this._topShadowDomNode=kx(document.createElement("div")),this._topShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topShadowDomNode.domNode),this._topLeftShadowDomNode=kx(document.createElement("div")),this._topLeftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topLeftShadowDomNode.domNode)):(this._leftShadowDomNode=null,this._topShadowDomNode=null,this._topLeftShadowDomNode=null),this._listenOnDomNode=this._options.listenOnDomNode||this._domNode,this._mouseWheelToDispose=[],this._setListeningToMouseWheel(this._options.handleMouseWheel),this.onmouseover(this._listenOnDomNode,(G)=>this._onMouseOver(G)),this.onmouseleave(this._listenOnDomNode,(G)=>this._onMouseLeave(G)),this._hideTimeout=this._register(new z9),this._isDragging=!1,this._mouseIsOver=!1,this._shouldRender=!0,this._revealOnScroll=!0}get options(){return this._options}dispose(){this._mouseWheelToDispose=t0(this._mouseWheelToDispose),super.dispose()}getDomNode(){return this._domNode}getOverviewRulerLayoutInfo(){return{parent:this._domNode,insertBefore:this._verticalScrollbar.domNode.domNode}}delegateVerticalScrollbarPointerDown(x){this._verticalScrollbar.delegatePointerDown(x)}getScrollDimensions(){return this._scrollable.getScrollDimensions()}setScrollDimensions(x){this._scrollable.setScrollDimensions(x,!1)}updateClassName(x){this._options.className=x,p0&&(this._options.className+=" mac"),this._domNode.className="xterm-scrollable-element "+this._options.className}updateOptions(x){typeof x.handleMouseWheel<"u"&&(this._options.handleMouseWheel=x.handleMouseWheel,this._setListeningToMouseWheel(this._options.handleMouseWheel)),typeof x.mouseWheelScrollSensitivity<"u"&&(this._options.mouseWheelScrollSensitivity=x.mouseWheelScrollSensitivity),typeof x.fastScrollSensitivity<"u"&&(this._options.fastScrollSensitivity=x.fastScrollSensitivity),typeof x.scrollPredominantAxis<"u"&&(this._options.scrollPredominantAxis=x.scrollPredominantAxis),typeof x.horizontal<"u"&&(this._options.horizontal=x.horizontal),typeof x.vertical<"u"&&(this._options.vertical=x.vertical),typeof x.horizontalScrollbarSize<"u"&&(this._options.horizontalScrollbarSize=x.horizontalScrollbarSize),typeof x.verticalScrollbarSize<"u"&&(this._options.verticalScrollbarSize=x.verticalScrollbarSize),typeof x.scrollByPage<"u"&&(this._options.scrollByPage=x.scrollByPage),this._horizontalScrollbar.updateOptions(this._options),this._verticalScrollbar.updateOptions(this._options),this._options.lazyRender||this._render()}setRevealOnScroll(x){this._revealOnScroll=x}delegateScrollFromMouseWheelEvent(x){this._onMouseWheel(new w9(x))}_setListeningToMouseWheel(x){if(this._mouseWheelToDispose.length>0!==x&&(this._mouseWheelToDispose=t0(this._mouseWheelToDispose),x)){let H=(F)=>{this._onMouseWheel(new w9(F))};this._mouseWheelToDispose.push(b(this._listenOnDomNode,e.MOUSE_WHEEL,H,{passive:!1}))}}_onMouseWheel(x){if(x.browserEvent?.defaultPrevented)return;let H=G5.INSTANCE;v9&&H.acceptStandardWheelEvent(x);let F=!1;if(x.deltaY||x.deltaX){let G=x.deltaY*this._options.mouseWheelScrollSensitivity,q=x.deltaX*this._options.mouseWheelScrollSensitivity;this._options.scrollPredominantAxis&&(this._options.scrollYToX&&q+G===0?q=G=0:Math.abs(G)>=Math.abs(q)?q=0:G=0),this._options.flipAxes&&([G,q]=[q,G]);let m=!p0&&x.browserEvent&&x.browserEvent.shiftKey;(this._options.scrollYToX||m)&&!q&&(q=G,G=0),x.browserEvent&&x.browserEvent.altKey&&(q=q*this._options.fastScrollSensitivity,G=G*this._options.fastScrollSensitivity);let z=this._scrollable.getFutureScrollPosition(),C={};if(G){let R=_9*G,M=z.scrollTop-(R<0?Math.floor(R):Math.ceil(R));this._verticalScrollbar.writeScrollPosition(C,M)}if(q){let R=_9*q,M=z.scrollLeft-(R<0?Math.floor(R):Math.ceil(R));this._horizontalScrollbar.writeScrollPosition(C,M)}C=this._scrollable.validateScrollPosition(C),(z.scrollLeft!==C.scrollLeft||z.scrollTop!==C.scrollTop)&&(v9&&this._options.mouseWheelSmoothScroll&&H.isPhysicalMouseWheel()?this._scrollable.setScrollPositionSmooth(C):this._scrollable.setScrollPositionNow(C),F=!0)}let Y=F;!Y&&this._options.alwaysConsumeMouseWheel&&(Y=!0),!Y&&this._options.consumeMouseWheelIfScrollbarIsNeeded&&(this._verticalScrollbar.isNeeded()||this._horizontalScrollbar.isNeeded())&&(Y=!0),Y&&(x.preventDefault(),x.stopPropagation())}_onDidScroll(x){this._shouldRender=this._horizontalScrollbar.onDidScroll(x)||this._shouldRender,this._shouldRender=this._verticalScrollbar.onDidScroll(x)||this._shouldRender,this._options.useShadows&&(this._shouldRender=!0),this._revealOnScroll&&this._reveal(),this._options.lazyRender||this._render()}renderNow(){if(!this._options.lazyRender)throw Error("Please use `lazyRender` together with `renderNow`!");this._render()}_render(){if(this._shouldRender&&(this._shouldRender=!1,this._horizontalScrollbar.render(),this._verticalScrollbar.render(),this._options.useShadows)){let x=this._scrollable.getCurrentScrollPosition(),H=x.scrollTop>0,F=x.scrollLeft>0,Y=F?" left":"",G=H?" top":"",q=F||H?" top-left-corner":"";this._leftShadowDomNode.setClassName(`shadow${Y}`),this._topShadowDomNode.setClassName(`shadow${G}`),this._topLeftShadowDomNode.setClassName(`shadow${q}${G}${Y}`)}}_onDragStart(){this._isDragging=!0,this._reveal()}_onDragEnd(){this._isDragging=!1,this._hide()}_onMouseLeave(x){this._mouseIsOver=!1,this._hide()}_onMouseOver(x){this._mouseIsOver=!0,this._reveal()}_reveal(){this._verticalScrollbar.beginReveal(),this._horizontalScrollbar.beginReveal(),this._scheduleHide()}_hide(){!this._mouseIsOver&&!this._isDragging&&(this._verticalScrollbar.beginHide(),this._horizontalScrollbar.beginHide())}_scheduleHide(){!this._mouseIsOver&&!this._isDragging&&this._hideTimeout.cancelAndSet(()=>this._hide(),F5)}},m5=class extends q5{constructor(x,H,F){super(x,H,F)}setScrollPosition(x){x.reuseAnimation?this._scrollable.setScrollPositionSmooth(x,x.reuseAnimation):this._scrollable.setScrollPositionNow(x)}getScrollPosition(){return this._scrollable.getCurrentScrollPosition()}};function R5(x){let H={lazyRender:typeof x.lazyRender<"u"?x.lazyRender:!1,className:typeof x.className<"u"?x.className:"",useShadows:typeof x.useShadows<"u"?x.useShadows:!0,handleMouseWheel:typeof x.handleMouseWheel<"u"?x.handleMouseWheel:!0,flipAxes:typeof x.flipAxes<"u"?x.flipAxes:!1,consumeMouseWheelIfScrollbarIsNeeded:typeof x.consumeMouseWheelIfScrollbarIsNeeded<"u"?x.consumeMouseWheelIfScrollbarIsNeeded:!1,alwaysConsumeMouseWheel:typeof x.alwaysConsumeMouseWheel<"u"?x.alwaysConsumeMouseWheel:!1,scrollYToX:typeof x.scrollYToX<"u"?x.scrollYToX:!1,mouseWheelScrollSensitivity:typeof x.mouseWheelScrollSensitivity<"u"?x.mouseWheelScrollSensitivity:1,fastScrollSensitivity:typeof x.fastScrollSensitivity<"u"?x.fastScrollSensitivity:5,scrollPredominantAxis:typeof x.scrollPredominantAxis<"u"?x.scrollPredominantAxis:!0,mouseWheelSmoothScroll:typeof x.mouseWheelSmoothScroll<"u"?x.mouseWheelSmoothScroll:!0,arrowSize:typeof x.arrowSize<"u"?x.arrowSize:11,listenOnDomNode:typeof x.listenOnDomNode<"u"?x.listenOnDomNode:null,horizontal:typeof x.horizontal<"u"?x.horizontal:1,horizontalScrollbarSize:typeof x.horizontalScrollbarSize<"u"?x.horizontalScrollbarSize:10,horizontalSliderSize:typeof x.horizontalSliderSize<"u"?x.horizontalSliderSize:0,horizontalHasArrows:typeof x.horizontalHasArrows<"u"?x.horizontalHasArrows:!1,vertical:typeof x.vertical<"u"?x.vertical:1,verticalScrollbarSize:typeof x.verticalScrollbarSize<"u"?x.verticalScrollbarSize:10,verticalHasArrows:typeof x.verticalHasArrows<"u"?x.verticalHasArrows:!1,verticalSliderSize:typeof x.verticalSliderSize<"u"?x.verticalSliderSize:0,scrollByPage:typeof x.scrollByPage<"u"?x.scrollByPage:!1};return H.horizontalSliderSize=typeof x.horizontalSliderSize<"u"?x.horizontalSliderSize:H.horizontalScrollbarSize,H.verticalSliderSize=typeof x.verticalSliderSize<"u"?x.verticalSliderSize:H.verticalScrollbarSize,p0&&(H.className+=" mac"),H}var _1=class extends y{constructor(x,H,F,Y,G,q,m,z){super();this._bufferService=F,this._optionsService=m,this._renderService=z,this._onRequestScrollLines=this._register(new W),this.onRequestScrollLines=this._onRequestScrollLines.event,this._isSyncing=!1,this._isHandlingScroll=!1,this._suppressOnScrollHandler=!1;let C=this._register(new n2({forceIntegerValues:!1,smoothScrollDuration:this._optionsService.rawOptions.smoothScrollDuration,scheduleAtNextAnimationFrame:(R)=>ix(Y.window,R)}));this._register(this._optionsService.onSpecificOptionChange("smoothScrollDuration",()=>{C.setSmoothScrollDuration(this._optionsService.rawOptions.smoothScrollDuration)})),this._scrollableElement=this._register(new m5(H,{vertical:1,horizontal:2,useShadows:!1,mouseWheelSmoothScroll:!0,...this._getChangeOptions()},C)),this._register(this._optionsService.onMultipleOptionChange(["scrollSensitivity","fastScrollSensitivity","overviewRuler"],()=>this._scrollableElement.updateOptions(this._getChangeOptions()))),this._register(G.onProtocolChange((R)=>{this._scrollableElement.updateOptions({handleMouseWheel:!(R&16)})})),this._scrollableElement.setScrollDimensions({height:0,scrollHeight:0}),this._register(m0.runAndSubscribe(q.onChangeColors,()=>{this._scrollableElement.getDomNode().style.backgroundColor=q.colors.background.css})),x.appendChild(this._scrollableElement.getDomNode()),this._register(f(()=>this._scrollableElement.getDomNode().remove())),this._styleElement=Y.mainDocument.createElement("style"),H.appendChild(this._styleElement),this._register(f(()=>this._styleElement.remove())),this._register(m0.runAndSubscribe(q.onChangeColors,()=>{this._styleElement.textContent=[".xterm .xterm-scrollable-element > .scrollbar > .slider {",`  background: ${q.colors.scrollbarSliderBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider:hover {",`  background: ${q.colors.scrollbarSliderHoverBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider.active {",`  background: ${q.colors.scrollbarSliderActiveBackground.css};`,"}"].join(`
`)})),this._register(this._bufferService.onResize(()=>this.queueSync())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._latestYDisp=void 0,this.queueSync()})),this._register(this._bufferService.onScroll(()=>this._sync())),this._register(this._scrollableElement.onScroll((R)=>this._handleScroll(R)))}scrollLines(x){let H=this._scrollableElement.getScrollPosition();this._scrollableElement.setScrollPosition({reuseAnimation:!0,scrollTop:H.scrollTop+x*this._renderService.dimensions.css.cell.height})}scrollToLine(x,H){H&&(this._latestYDisp=x),this._scrollableElement.setScrollPosition({reuseAnimation:!H,scrollTop:x*this._renderService.dimensions.css.cell.height})}_getChangeOptions(){return{mouseWheelScrollSensitivity:this._optionsService.rawOptions.scrollSensitivity,fastScrollSensitivity:this._optionsService.rawOptions.fastScrollSensitivity,verticalScrollbarSize:this._optionsService.rawOptions.overviewRuler?.width||14}}queueSync(x){x!==void 0&&(this._latestYDisp=x),this._queuedAnimationFrame===void 0&&(this._queuedAnimationFrame=this._renderService.addRefreshCallback(()=>{this._queuedAnimationFrame=void 0,this._sync(this._latestYDisp)}))}_sync(x=this._bufferService.buffer.ydisp){!this._renderService||this._isSyncing||(this._isSyncing=!0,this._suppressOnScrollHandler=!0,this._scrollableElement.setScrollDimensions({height:this._renderService.dimensions.css.canvas.height,scrollHeight:this._renderService.dimensions.css.cell.height*this._bufferService.buffer.lines.length}),this._suppressOnScrollHandler=!1,x!==this._latestYDisp&&this._scrollableElement.setScrollPosition({scrollTop:x*this._renderService.dimensions.css.cell.height}),this._isSyncing=!1)}_handleScroll(x){if(!this._renderService||this._isHandlingScroll||this._suppressOnScrollHandler)return;this._isHandlingScroll=!0;let H=Math.round(x.scrollTop/this._renderService.dimensions.css.cell.height),F=H-this._bufferService.buffer.ydisp;F!==0&&(this._latestYDisp=H,this._onRequestScrollLines.fire(F)),this._isHandlingScroll=!1}};_1=a([K(2,C0),K(3,I0),K(4,K6),K(5,Gx),K(6,N0),K(7,S0)],_1);var v1=class extends y{constructor(x,H,F,Y,G){super();this._screenElement=x,this._bufferService=H,this._coreBrowserService=F,this._decorationService=Y,this._renderService=G,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this._register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this._register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this._register(this._decorationService.onDecorationRemoved((q)=>this._removeDecoration(q))),this._register(f(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let x of this._decorationService.decorations)this._renderDecoration(x);this._dimensionsChanged=!1}_renderDecoration(x){this._refreshStyle(x),this._dimensionsChanged&&this._refreshXPosition(x)}_createElement(x){let H=this._coreBrowserService.mainDocument.createElement("div");H.classList.add("xterm-decoration"),H.classList.toggle("xterm-decoration-top-layer",x?.options?.layer==="top"),H.style.width=`${Math.round((x.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,H.style.height=`${(x.options.height||1)*this._renderService.dimensions.css.cell.height}px`,H.style.top=`${(x.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height}px`,H.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;let F=x.options.x??0;return F&&F>this._bufferService.cols&&(H.style.display="none"),this._refreshXPosition(x,H),H}_refreshStyle(x){let H=x.marker.line-this._bufferService.buffers.active.ydisp;if(H<0||H>=this._bufferService.rows)x.element&&(x.element.style.display="none",x.onRenderEmitter.fire(x.element));else{let F=this._decorationElements.get(x);F||(F=this._createElement(x),x.element=F,this._decorationElements.set(x,F),this._container.appendChild(F),x.onDispose(()=>{this._decorationElements.delete(x),F.remove()})),F.style.display=this._altBufferIsActive?"none":"block",this._altBufferIsActive||(F.style.width=`${Math.round((x.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,F.style.height=`${(x.options.height||1)*this._renderService.dimensions.css.cell.height}px`,F.style.top=`${H*this._renderService.dimensions.css.cell.height}px`,F.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`),x.onRenderEmitter.fire(F)}}_refreshXPosition(x,H=x.element){if(!H)return;let F=x.options.x??0;(x.options.anchor||"left")==="right"?H.style.right=F?`${F*this._renderService.dimensions.css.cell.width}px`:"":H.style.left=F?`${F*this._renderService.dimensions.css.cell.width}px`:""}_removeDecoration(x){this._decorationElements.get(x)?.remove(),this._decorationElements.delete(x),x.dispose()}};v1=a([K(1,C0),K(2,I0),K(3,Tx),K(4,S0)],v1);var z5=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(x){if(x.options.overviewRulerOptions){for(let H of this._zones)if(H.color===x.options.overviewRulerOptions.color&&H.position===x.options.overviewRulerOptions.position){if(this._lineIntersectsZone(H,x.marker.line))return;if(this._lineAdjacentToZone(H,x.marker.line,x.options.overviewRulerOptions.position)){this._addLineToZone(H,x.marker.line);return}}if(this._zonePoolIndex<this._zonePool.length){this._zonePool[this._zonePoolIndex].color=x.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=x.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=x.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=x.marker.line,this._zones.push(this._zonePool[this._zonePoolIndex++]);return}this._zones.push({color:x.options.overviewRulerOptions.color,position:x.options.overviewRulerOptions.position,startBufferLine:x.marker.line,endBufferLine:x.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(x){this._linePadding=x}_lineIntersectsZone(x,H){return H>=x.startBufferLine&&H<=x.endBufferLine}_lineAdjacentToZone(x,H,F){return H>=x.startBufferLine-this._linePadding[F||"full"]&&H<=x.endBufferLine+this._linePadding[F||"full"]}_addLineToZone(x,H){x.startBufferLine=Math.min(x.startBufferLine,H),x.endBufferLine=Math.max(x.endBufferLine,H)}},O0={full:0,left:0,center:0,right:0},v0={full:0,left:0,center:0,right:0},jx={full:0,left:0,center:0,right:0},tx=class extends y{constructor(x,H,F,Y,G,q,m,z){super();this._viewportElement=x,this._screenElement=H,this._bufferService=F,this._decorationService=Y,this._renderService=G,this._optionsService=q,this._themeService=m,this._coreBrowserService=z,this._colorZoneStore=new z5,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),this._viewportElement.parentElement?.insertBefore(this._canvas,this._viewportElement),this._register(f(()=>this._canvas?.remove()));let C=this._canvas.getContext("2d");if(C)this._ctx=C;else throw Error("Ctx cannot be null");this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this._register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0))),this._register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this._register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})),this._register(this._renderService.onRender(()=>{(!this._containerHeight||this._containerHeight!==this._screenElement.clientHeight)&&(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh(!0))),this._register(this._optionsService.onSpecificOptionChange("overviewRuler",()=>this._queueRefresh(!0))),this._register(this._themeService.onChangeColors(()=>this._queueRefresh())),this._queueRefresh(!0)}get _width(){return this._optionsService.options.overviewRuler?.width||0}_refreshDrawConstants(){let x=Math.floor((this._canvas.width-1)/3),H=Math.ceil((this._canvas.width-1)/3);v0.full=this._canvas.width,v0.left=x,v0.center=H,v0.right=x,this._refreshDrawHeightConstants(),jx.full=1,jx.left=1,jx.center=1+v0.left,jx.right=1+v0.left+v0.center}_refreshDrawHeightConstants(){O0.full=Math.round(2*this._coreBrowserService.dpr);let x=this._canvas.height/this._bufferService.buffer.lines.length,H=Math.round(Math.max(Math.min(x,12),6)*this._coreBrowserService.dpr);O0.left=H,O0.center=H,O0.right=H}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*O0.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*O0.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*O0.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*O0.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(let H of this._decorationService.decorations)this._colorZoneStore.addDecoration(H);this._ctx.lineWidth=1,this._renderRulerOutline();let x=this._colorZoneStore.zones;for(let H of x)H.position!=="full"&&this._renderColorZone(H);for(let H of x)H.position==="full"&&this._renderColorZone(H);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderRulerOutline(){this._ctx.fillStyle=this._themeService.colors.overviewRulerBorder.css,this._ctx.fillRect(0,0,1,this._canvas.height),this._optionsService.rawOptions.overviewRuler.showTopBorder&&this._ctx.fillRect(1,0,this._canvas.width-1,1),this._optionsService.rawOptions.overviewRuler.showBottomBorder&&this._ctx.fillRect(1,this._canvas.height-1,this._canvas.width-1,this._canvas.height)}_renderColorZone(x){this._ctx.fillStyle=x.color,this._ctx.fillRect(jx[x.position||"full"],Math.round((this._canvas.height-1)*(x.startBufferLine/this._bufferService.buffers.active.lines.length)-O0[x.position||"full"]/2),v0[x.position||"full"],Math.round((this._canvas.height-1)*((x.endBufferLine-x.startBufferLine)/this._bufferService.buffers.active.lines.length)+O0[x.position||"full"]))}_queueRefresh(x,H){this._shouldUpdateDimensions=x||this._shouldUpdateDimensions,this._shouldUpdateAnchor=H||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};tx=a([K(2,C0),K(3,Tx),K(4,S0),K(5,N0),K(6,Gx),K(7,I0)],tx);var J;((x)=>(x.NUL="\x00",x.SOH="\x01",x.STX="\x02",x.ETX="\x03",x.EOT="\x04",x.ENQ="\x05",x.ACK="\x06",x.BEL="\x07",x.BS="\b",x.HT="\t",x.LF=`
`,x.VT="\v",x.FF="\f",x.CR="\r",x.SO="\x0E",x.SI="\x0F",x.DLE="\x10",x.DC1="\x11",x.DC2="\x12",x.DC3="\x13",x.DC4="\x14",x.NAK="\x15",x.SYN="\x16",x.ETB="\x17",x.CAN="\x18",x.EM="\x19",x.SUB="\x1A",x.ESC="\x1B",x.FS="\x1C",x.GS="\x1D",x.RS="\x1E",x.US="\x1F",x.SP=" ",x.DEL=""))(J||={});var ox;((x)=>(x.PAD="",x.HOP="",x.BPH="",x.NBH="",x.IND="",x.NEL="",x.SSA="",x.ESA="",x.HTS="",x.HTJ="",x.VTS="",x.PLD="",x.PLU="",x.RI="",x.SS2="",x.SS3="",x.DCS="",x.PU1="",x.PU2="",x.STS="",x.CCH="",x.MW="",x.SPA="",x.EPA="",x.SOS="",x.SGCI="",x.SCI="",x.CSI="",x.ST="",x.OSC="",x.PM="",x.APC=""))(ox||={});var g6;((x)=>x.ST=`${J.ESC}\\`)(g6||={});var g1=class{constructor(x,H,F,Y,G,q){this._textarea=x,this._compositionView=H,this._bufferService=F,this._optionsService=Y,this._coreService=G,this._renderService=q,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}get isComposing(){return this._isComposing}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(x){this._compositionView.textContent=x.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(x){if(this._isComposing||this._isSendingComposition){if(x.keyCode===20||x.keyCode===229||x.keyCode===16||x.keyCode===17||x.keyCode===18)return!1;this._finalizeComposition(!1)}return x.keyCode===229?(this._handleAnyTextareaChanges(),!1):!0}_finalizeComposition(x){if(this._compositionView.classList.remove("active"),this._isComposing=!1,x){let H={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){this._isSendingComposition=!1;let F;H.start+=this._dataAlreadySent.length,this._isComposing?F=this._textarea.value.substring(H.start,this._compositionPosition.start):F=this._textarea.value.substring(H.start),F.length>0&&this._coreService.triggerDataEvent(F,!0)}},0)}else{this._isSendingComposition=!1;let H=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(H,!0)}}_handleAnyTextareaChanges(){let x=this._textarea.value;setTimeout(()=>{if(!this._isComposing){let H=this._textarea.value,F=H.replace(x,"");this._dataAlreadySent=F,H.length>x.length?this._coreService.triggerDataEvent(F,!0):H.length<x.length?this._coreService.triggerDataEvent(`${J.DEL}`,!0):H.length===x.length&&H!==x&&this._coreService.triggerDataEvent(H,!0)}},0)}updateCompositionElements(x){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){let H=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),F=this._renderService.dimensions.css.cell.height,Y=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,G=H*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=G+"px",this._compositionView.style.top=Y+"px",this._compositionView.style.height=F+"px",this._compositionView.style.lineHeight=F+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";let q=this._compositionView.getBoundingClientRect();this._textarea.style.left=G+"px",this._textarea.style.top=Y+"px",this._textarea.style.width=Math.max(q.width,1)+"px",this._textarea.style.height=Math.max(q.height,1)+"px",this._textarea.style.lineHeight=q.height+"px"}x||setTimeout(()=>this.updateCompositionElements(!0),0)}}};g1=a([K(2,C0),K(3,N0),K(4,xx),K(5,S0)],g1);var x0=0,H0=0,F0=0,c=0,g9={css:"#00000000",rgba:0},n;((x)=>{function H(G,q,m,z){return z!==void 0?`#${l0(G)}${l0(q)}${l0(m)}${l0(z)}`:`#${l0(G)}${l0(q)}${l0(m)}`}x.toCss=H;function F(G,q,m,z=255){return(G<<24|q<<16|m<<8|z)>>>0}x.toRgba=F;function Y(G,q,m,z){return{css:x.toCss(G,q,m,z),rgba:x.toRgba(G,q,m,z)}}x.toColor=Y})(n||={});var d;((x)=>{function H(C,R){if(c=(R.rgba&255)/255,c===1)return{css:R.css,rgba:R.rgba};let M=R.rgba>>24&255,N=R.rgba>>16&255,Z=R.rgba>>8&255,$=C.rgba>>24&255,j=C.rgba>>16&255,A=C.rgba>>8&255;x0=$+Math.round((M-$)*c),H0=j+Math.round((N-j)*c),F0=A+Math.round((Z-A)*c);let O=n.toCss(x0,H0,F0),L=n.toRgba(x0,H0,F0);return{css:O,rgba:L}}x.blend=H;function F(C){return(C.rgba&255)===255}x.isOpaque=F;function Y(C,R,M){let N=lx.ensureContrastRatio(C.rgba,R.rgba,M);if(N)return n.toColor(N>>24&255,N>>16&255,N>>8&255)}x.ensureContrastRatio=Y;function G(C){let R=(C.rgba|255)>>>0;return[x0,H0,F0]=lx.toChannels(R),{css:n.toCss(x0,H0,F0),rgba:R}}x.opaque=G;function q(C,R){return c=Math.round(R*255),[x0,H0,F0]=lx.toChannels(C.rgba),{css:n.toCss(x0,H0,F0,c),rgba:n.toRgba(x0,H0,F0,c)}}x.opacity=q;function m(C,R){return c=C.rgba&255,q(C,c*R/255)}x.multiplyOpacity=m;function z(C){return[C.rgba>>24&255,C.rgba>>16&255,C.rgba>>8&255]}x.toColorRGB=z})(d||={});var u;((x)=>{let H,F;try{let G=document.createElement("canvas");G.width=1,G.height=1;let q=G.getContext("2d",{willReadFrequently:!0});q&&(H=q,H.globalCompositeOperation="copy",F=H.createLinearGradient(0,0,1,1))}catch{}function Y(G){if(G.match(/#[\da-f]{3,8}/i))switch(G.length){case 4:return x0=parseInt(G.slice(1,2).repeat(2),16),H0=parseInt(G.slice(2,3).repeat(2),16),F0=parseInt(G.slice(3,4).repeat(2),16),n.toColor(x0,H0,F0);case 5:return x0=parseInt(G.slice(1,2).repeat(2),16),H0=parseInt(G.slice(2,3).repeat(2),16),F0=parseInt(G.slice(3,4).repeat(2),16),c=parseInt(G.slice(4,5).repeat(2),16),n.toColor(x0,H0,F0,c);case 7:return{css:G,rgba:(parseInt(G.slice(1),16)<<8|255)>>>0};case 9:return{css:G,rgba:parseInt(G.slice(1),16)>>>0}}let q=G.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(q)return x0=parseInt(q[1]),H0=parseInt(q[2]),F0=parseInt(q[3]),c=Math.round((q[5]===void 0?1:parseFloat(q[5]))*255),n.toColor(x0,H0,F0,c);if(!H||!F)throw Error("css.toColor: Unsupported css format");if(H.fillStyle=F,H.fillStyle=G,typeof H.fillStyle!="string")throw Error("css.toColor: Unsupported css format");if(H.fillRect(0,0,1,1),[x0,H0,F0,c]=H.getImageData(0,0,1,1).data,c!==255)throw Error("css.toColor: Unsupported css format");return{rgba:n.toRgba(x0,H0,F0,c),css:G}}x.toColor=Y})(u||={});var z0;((x)=>{function H(Y){return F(Y>>16&255,Y>>8&255,Y&255)}x.relativeLuminance=H;function F(Y,G,q){let m=Y/255,z=G/255,C=q/255,R=m<=0.03928?m/12.92:Math.pow((m+0.055)/1.055,2.4),M=z<=0.03928?z/12.92:Math.pow((z+0.055)/1.055,2.4),N=C<=0.03928?C/12.92:Math.pow((C+0.055)/1.055,2.4);return R*0.2126+M*0.7152+N*0.0722}x.relativeLuminance2=F})(z0||={});var lx;((x)=>{function H(m,z){if(c=(z&255)/255,c===1)return z;let C=z>>24&255,R=z>>16&255,M=z>>8&255,N=m>>24&255,Z=m>>16&255,$=m>>8&255;return x0=N+Math.round((C-N)*c),H0=Z+Math.round((R-Z)*c),F0=$+Math.round((M-$)*c),n.toRgba(x0,H0,F0)}x.blend=H;function F(m,z,C){let R=z0.relativeLuminance(m>>8),M=z0.relativeLuminance(z>>8);if(y0(R,M)<C){if(M<R){let $=Y(m,z,C),j=y0(R,z0.relativeLuminance($>>8));if(j<C){let A=G(m,z,C),O=y0(R,z0.relativeLuminance(A>>8));return j>O?$:A}return $}let N=G(m,z,C),Z=y0(R,z0.relativeLuminance(N>>8));if(Z<C){let $=Y(m,z,C),j=y0(R,z0.relativeLuminance($>>8));return Z>j?N:$}return N}}x.ensureContrastRatio=F;function Y(m,z,C){let R=m>>24&255,M=m>>16&255,N=m>>8&255,Z=z>>24&255,$=z>>16&255,j=z>>8&255,A=y0(z0.relativeLuminance2(Z,$,j),z0.relativeLuminance2(R,M,N));for(;A<C&&(Z>0||$>0||j>0);)Z-=Math.max(0,Math.ceil(Z*0.1)),$-=Math.max(0,Math.ceil($*0.1)),j-=Math.max(0,Math.ceil(j*0.1)),A=y0(z0.relativeLuminance2(Z,$,j),z0.relativeLuminance2(R,M,N));return(Z<<24|$<<16|j<<8|255)>>>0}x.reduceLuminance=Y;function G(m,z,C){let R=m>>24&255,M=m>>16&255,N=m>>8&255,Z=z>>24&255,$=z>>16&255,j=z>>8&255,A=y0(z0.relativeLuminance2(Z,$,j),z0.relativeLuminance2(R,M,N));for(;A<C&&(Z<255||$<255||j<255);)Z=Math.min(255,Z+Math.ceil((255-Z)*0.1)),$=Math.min(255,$+Math.ceil((255-$)*0.1)),j=Math.min(255,j+Math.ceil((255-j)*0.1)),A=y0(z0.relativeLuminance2(Z,$,j),z0.relativeLuminance2(R,M,N));return(Z<<24|$<<16|j<<8|255)>>>0}x.increaseLuminance=G;function q(m){return[m>>24&255,m>>16&255,m>>8&255,m&255]}x.toChannels=q})(lx||={});function l0(x){let H=x.toString(16);return H.length<2?"0"+H:H}function y0(x,H){return x<H?(H+0.05)/(x+0.05):(x+0.05)/(H+0.05)}var C5=class extends wx{constructor(x,H,F){super();this.content=0,this.combinedData="",this.fg=x.fg,this.bg=x.bg,this.combinedData=H,this._width=F}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(x){throw Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},ex=class{constructor(x){this._bufferService=x,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new W0}register(x){let H={id:this._nextCharacterJoinerId++,handler:x};return this._characterJoiners.push(H),H.id}deregister(x){for(let H=0;H<this._characterJoiners.length;H++)if(this._characterJoiners[H].id===x)return this._characterJoiners.splice(H,1),!0;return!1}getJoinedCharacters(x){if(this._characterJoiners.length===0)return[];let H=this._bufferService.buffer.lines.get(x);if(!H||H.length===0)return[];let F=[],Y=H.translateToString(!0),G=0,q=0,m=0,z=H.getFg(0),C=H.getBg(0);for(let R=0;R<H.getTrimmedLength();R++)if(H.loadCell(R,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==z||this._workCell.bg!==C){if(R-G>1){let M=this._getJoinedRanges(Y,m,q,H,G);for(let N=0;N<M.length;N++)F.push(M[N])}G=R,m=q,z=this._workCell.fg,C=this._workCell.bg}q+=this._workCell.getChars().length||c0.length}if(this._bufferService.cols-G>1){let R=this._getJoinedRanges(Y,m,q,H,G);for(let M=0;M<R.length;M++)F.push(R[M])}return F}_getJoinedRanges(x,H,F,Y,G){let q=x.substring(H,F),m=[];try{m=this._characterJoiners[0].handler(q)}catch(z){console.error(z)}for(let z=1;z<this._characterJoiners.length;z++)try{let C=this._characterJoiners[z].handler(q);for(let R=0;R<C.length;R++)ex._mergeRanges(m,C[R])}catch(C){console.error(C)}return this._stringRangesToCellRanges(m,Y,G),m}_stringRangesToCellRanges(x,H,F){let Y=0,G=!1,q=0,m=x[Y];if(m){for(let z=F;z<this._bufferService.cols;z++){let C=H.getWidth(z),R=H.getString(z).length||c0.length;if(C!==0){if(!G&&m[0]<=q&&(m[0]=z,G=!0),m[1]<=q){if(m[1]=z,m=x[++Y],!m)break;m[0]<=q?(m[0]=z,G=!0):G=!1}q+=R}}m&&(m[1]=this._bufferService.cols)}}static _mergeRanges(x,H){let F=!1;for(let Y=0;Y<x.length;Y++){let G=x[Y];if(F){if(H[1]<=G[0])return x[Y-1][1]=H[1],x;if(H[1]<=G[1])return x[Y-1][1]=Math.max(H[1],G[1]),x.splice(Y,1),x;x.splice(Y,1),Y--}else{if(H[1]<=G[0])return x.splice(Y,0,H),x;if(H[1]<=G[1])return G[0]=Math.min(H[0],G[0]),x;H[0]<G[1]&&(G[0]=Math.min(H[0],G[0]),F=!0);continue}}return F?x[x.length-1][1]=H[1]:x.push(H),x}};ex=a([K(0,C0)],ex);function N5(x){return 57508<=x&&x<=57558}function M5(x){return 9472<=x&&x<=9631}function j5(x){return N5(x)||M5(x)}function Z5(){return{css:{canvas:Ex(),cell:Ex()},device:{canvas:Ex(),cell:Ex(),char:{width:0,height:0,left:0,top:0}}}}function Ex(){return{width:0,height:0}}var u1=class{constructor(x,H,F,Y,G,q,m){this._document=x,this._characterJoinerService=H,this._optionsService=F,this._coreBrowserService=Y,this._coreService=G,this._decorationService=q,this._themeService=m,this._workCell=new W0,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(x,H,F){this._selectionStart=x,this._selectionEnd=H,this._columnSelectMode=F}createRow(x,H,F,Y,G,q,m,z,C,R,M){let N=[],Z=this._characterJoinerService.getJoinedCharacters(H),$=this._themeService.colors,j=x.getNoBgTrimmedLength();F&&j<q+1&&(j=q+1);let A,O=0,L="",E=0,T=0,k=0,I=0,S=!1,G0=0,X0=!1,K0=0,zx=0,_=[],C1=R!==-1&&M!==-1;for(let V=0;V<j;V++){x.loadCell(V,this._workCell);let X=this._workCell.getWidth();if(X===0)continue;let D=!1,B=V>=zx,p=V,U=this._workCell;if(Z.length>0&&V===Z[0][0]&&B){let Q=Z.shift(),N1=this._isCellInSelection(Q[0],H);for(E=Q[0]+1;E<Q[1];E++)B&&=N1===this._isCellInSelection(E,H);B&&=!F||q<Q[0]||q>=Q[1],B?(D=!0,U=new C5(this._workCell,x.translateToString(!0,Q[0],Q[1]),Q[1]-Q[0]),p=Q[1]-1,X=U.getWidth()):zx=Q[1]}let P=this._isCellInSelection(V,H),v=F&&V===q,q0=C1&&V>=R&&V<=M,B0=!1;this._decorationService.forEachDecorationAtCell(V,H,void 0,(Q)=>{B0=!0});let b0=U.getChars()||c0;if(b0===" "&&(U.isUnderline()||U.isOverline())&&(b0=""),K0=X*z-C.get(b0,U.isBold(),U.isItalic()),!A)A=this._document.createElement("span");else if(O&&(P&&X0||!P&&!X0&&U.bg===T)&&(P&&X0&&$.selectionForeground||U.fg===k)&&U.extended.ext===I&&q0===S&&K0===G0&&!v&&!D&&!B0&&B){U.isInvisible()?L+=c0:L+=b0,O++;continue}else O&&(A.textContent=L),A=this._document.createElement("span"),O=0,L="";if(T=U.bg,k=U.fg,I=U.extended.ext,S=q0,G0=K0,X0=P,D&&q>=V&&q<=p&&(q=V),!this._coreService.isCursorHidden&&v&&this._coreService.isCursorInitialized){if(_.push("xterm-cursor"),this._coreBrowserService.isFocused)m&&_.push("xterm-cursor-blink"),_.push(Y==="bar"?"xterm-cursor-bar":Y==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(G)switch(G){case"outline":_.push("xterm-cursor-outline");break;case"block":_.push("xterm-cursor-block");break;case"bar":_.push("xterm-cursor-bar");break;case"underline":_.push("xterm-cursor-underline");break;default:break}}if(U.isBold()&&_.push("xterm-bold"),U.isItalic()&&_.push("xterm-italic"),U.isDim()&&_.push("xterm-dim"),U.isInvisible()?L=c0:L=U.getChars()||c0,U.isUnderline()&&(_.push(`xterm-underline-${U.extended.underlineStyle}`),L===" "&&(L=""),!U.isUnderlineColorDefault()))if(U.isUnderlineColorRGB())A.style.textDecorationColor=`rgb(${wx.toColorRGB(U.getUnderlineColor()).join(",")})`;else{let Q=U.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&U.isBold()&&Q<8&&(Q+=8),A.style.textDecorationColor=$.ansi[Q].css}U.isOverline()&&(_.push("xterm-overline"),L===" "&&(L="")),U.isStrikethrough()&&_.push("xterm-strikethrough"),q0&&(A.style.textDecoration="underline");let t=U.getFgColor(),E0=U.getFgColorMode(),R0=U.getBgColor(),o0=U.getBgColorMode(),Cx=!!U.isInverse();if(Cx){let Q=t;t=R0,R0=Q;let N1=E0;E0=o0,o0=N1}let h0,Sx,Nx=!1;this._decorationService.forEachDecorationAtCell(V,H,void 0,(Q)=>{Q.options.layer!=="top"&&Nx||(Q.backgroundColorRGB&&(o0=50331648,R0=Q.backgroundColorRGB.rgba>>8&16777215,h0=Q.backgroundColorRGB),Q.foregroundColorRGB&&(E0=50331648,t=Q.foregroundColorRGB.rgba>>8&16777215,Sx=Q.foregroundColorRGB),Nx=Q.options.layer==="top")}),!Nx&&P&&(h0=this._coreBrowserService.isFocused?$.selectionBackgroundOpaque:$.selectionInactiveBackgroundOpaque,R0=h0.rgba>>8&16777215,o0=50331648,Nx=!0,$.selectionForeground&&(E0=50331648,t=$.selectionForeground.rgba>>8&16777215,Sx=$.selectionForeground)),Nx&&_.push("xterm-decoration-top");let d0;switch(o0){case 16777216:case 33554432:d0=$.ansi[R0],_.push(`xterm-bg-${R0}`);break;case 50331648:d0=n.toColor(R0>>16,R0>>8&255,R0&255),this._addStyle(A,`background-color:#${u9((R0>>>0).toString(16),"0",6)}`);break;case 0:default:Cx?(d0=$.foreground,_.push("xterm-bg-257")):d0=$.background}switch(h0||U.isDim()&&(h0=d.multiplyOpacity(d0,0.5)),E0){case 16777216:case 33554432:U.isBold()&&t<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(t+=8),this._applyMinimumContrast(A,d0,$.ansi[t],U,h0,void 0)||_.push(`xterm-fg-${t}`);break;case 50331648:let Q=n.toColor(t>>16&255,t>>8&255,t&255);this._applyMinimumContrast(A,d0,Q,U,h0,Sx)||this._addStyle(A,`color:#${u9(t.toString(16),"0",6)}`);break;case 0:default:this._applyMinimumContrast(A,d0,$.foreground,U,h0,Sx)||Cx&&_.push("xterm-fg-257")}_.length&&(A.className=_.join(" "),_.length=0),!v&&!D&&!B0&&B?O++:A.textContent=L,K0!==this.defaultSpacing&&(A.style.letterSpacing=`${K0}px`),N.push(A),V=p}return A&&O&&(A.textContent=L),N}_applyMinimumContrast(x,H,F,Y,G,q){if(this._optionsService.rawOptions.minimumContrastRatio===1||j5(Y.getCode()))return!1;let m=this._getContrastCache(Y),z;if(!G&&!q&&(z=m.getColor(H.rgba,F.rgba)),z===void 0){let C=this._optionsService.rawOptions.minimumContrastRatio/(Y.isDim()?2:1);z=d.ensureContrastRatio(G||H,q||F,C),m.setColor((G||H).rgba,(q||F).rgba,z??null)}return z?(this._addStyle(x,`color:${z.css}`),!0):!1}_getContrastCache(x){return x.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(x,H){x.setAttribute("style",`${x.getAttribute("style")||""}${H};`)}_isCellInSelection(x,H){let F=this._selectionStart,Y=this._selectionEnd;return!F||!Y?!1:this._columnSelectMode?F[0]<=Y[0]?x>=F[0]&&H>=F[1]&&x<Y[0]&&H<=Y[1]:x<F[0]&&H>=F[1]&&x>=Y[0]&&H<=Y[1]:H>F[1]&&H<Y[1]||F[1]===Y[1]&&H===F[1]&&x>=F[0]&&x<Y[0]||F[1]<Y[1]&&H===Y[1]&&x<Y[0]||F[1]<Y[1]&&H===F[1]&&x>=F[0]}};u1=a([K(1,D6),K(2,N0),K(3,I0),K(4,xx),K(5,Tx),K(6,Gx)],u1);function u9(x,H,F){for(;x.length<F;)x=H+x;return x}var $5=class{constructor(x,H){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=x.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";let F=x.createElement("span");F.classList.add("xterm-char-measure-element");let Y=x.createElement("span");Y.classList.add("xterm-char-measure-element"),Y.style.fontWeight="bold";let G=x.createElement("span");G.classList.add("xterm-char-measure-element"),G.style.fontStyle="italic";let q=x.createElement("span");q.classList.add("xterm-char-measure-element"),q.style.fontWeight="bold",q.style.fontStyle="italic",this._measureElements=[F,Y,G,q],this._container.appendChild(F),this._container.appendChild(Y),this._container.appendChild(G),this._container.appendChild(q),H.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(x,H,F,Y){x===this._font&&H===this._fontSize&&F===this._weight&&Y===this._weightBold||(this._font=x,this._fontSize=H,this._weight=F,this._weightBold=Y,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${F}`,this._measureElements[1].style.fontWeight=`${Y}`,this._measureElements[2].style.fontWeight=`${F}`,this._measureElements[3].style.fontWeight=`${Y}`,this.clear())}get(x,H,F){let Y=0;if(!H&&!F&&x.length===1&&(Y=x.charCodeAt(0))<256){if(this._flat[Y]!==-9999)return this._flat[Y];let m=this._measure(x,0);return m>0&&(this._flat[Y]=m),m}let G=x;H&&(G+="B"),F&&(G+="I");let q=this._holey.get(G);if(q===void 0){let m=0;H&&(m|=1),F&&(m|=2),q=this._measure(x,m),q>0&&this._holey.set(G,q)}return q}_measure(x,H){let F=this._measureElements[H];return F.textContent=x.repeat(32),F.offsetWidth/32}},A5=class{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(x,H,F,Y=!1){if(this.selectionStart=H,this.selectionEnd=F,!H||!F||H[0]===F[0]&&H[1]===F[1]){this.clear();return}let G=x.buffers.active.ydisp,q=H[1]-G,m=F[1]-G,z=Math.max(q,0),C=Math.min(m,x.rows-1);if(z>=x.rows||C<0){this.clear();return}this.hasSelection=!0,this.columnSelectMode=Y,this.viewportStartRow=q,this.viewportEndRow=m,this.viewportCappedStartRow=z,this.viewportCappedEndRow=C,this.startCol=H[0],this.endCol=F[0]}isCellSelected(x,H,F){return this.hasSelection?(F-=x.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?H>=this.startCol&&F>=this.viewportCappedStartRow&&H<this.endCol&&F<=this.viewportCappedEndRow:H<this.startCol&&F>=this.viewportCappedStartRow&&H>=this.endCol&&F<=this.viewportCappedEndRow:F>this.viewportStartRow&&F<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&F===this.viewportStartRow&&H>=this.startCol&&H<this.endCol||this.viewportStartRow<this.viewportEndRow&&F===this.viewportEndRow&&H<this.endCol||this.viewportStartRow<this.viewportEndRow&&F===this.viewportStartRow&&H>=this.startCol):!1}};function J5(){return new A5}var X1="xterm-dom-renderer-owner-",J0="xterm-rows",hx="xterm-fg-",c9="xterm-bg-",Zx="xterm-focus",dx="xterm-selection",V5=1,c1=class extends y{constructor(x,H,F,Y,G,q,m,z,C,R,M,N,Z,$){super();this._terminal=x,this._document=H,this._element=F,this._screenElement=Y,this._viewportElement=G,this._helperContainer=q,this._linkifier2=m,this._charSizeService=C,this._optionsService=R,this._bufferService=M,this._coreService=N,this._coreBrowserService=Z,this._themeService=$,this._terminalClass=V5++,this._rowElements=[],this._selectionRenderModel=J5(),this.onRequestRedraw=this._register(new W).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(J0),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(dx),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=Z5(),this._updateDimensions(),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._themeService.onChangeColors((j)=>this._injectCss(j))),this._injectCss(this._themeService.colors),this._rowFactory=z.createInstance(u1,document),this._element.classList.add(X1+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this._register(this._linkifier2.onShowLinkUnderline((j)=>this._handleLinkHover(j))),this._register(this._linkifier2.onHideLinkUnderline((j)=>this._handleLinkLeave(j))),this._register(f(()=>{this._element.classList.remove(X1+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new $5(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){let x=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*x,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*x),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/x),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/x),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(let F of this._rowElements)F.style.width=`${this.dimensions.css.canvas.width}px`,F.style.height=`${this.dimensions.css.cell.height}px`,F.style.lineHeight=`${this.dimensions.css.cell.height}px`,F.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));let H=`${this._terminalSelector} .${J0} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=H,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(x){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let H=`${this._terminalSelector} .${J0} { pointer-events: none; color: ${x.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;H+=`${this._terminalSelector} .${J0} .xterm-dim { color: ${d.multiplyOpacity(x.foreground,0.5).css};}`,H+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;let F=`blink_underline_${this._terminalClass}`,Y=`blink_bar_${this._terminalClass}`,G=`blink_block_${this._terminalClass}`;H+=`@keyframes ${F} { 50% {  border-bottom-style: hidden; }}`,H+=`@keyframes ${Y} { 50% {  box-shadow: none; }}`,H+=`@keyframes ${G} { 0% {  background-color: ${x.cursor.css};  color: ${x.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${x.cursor.css}; }}`,H+=`${this._terminalSelector} .${J0}.${Zx} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${F} 1s step-end infinite;}${this._terminalSelector} .${J0}.${Zx} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${Y} 1s step-end infinite;}${this._terminalSelector} .${J0}.${Zx} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${G} 1s step-end infinite;}${this._terminalSelector} .${J0} .xterm-cursor.xterm-cursor-block { background-color: ${x.cursor.css}; color: ${x.cursorAccent.css};}${this._terminalSelector} .${J0} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${x.cursor.css} !important; color: ${x.cursorAccent.css} !important;}${this._terminalSelector} .${J0} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${x.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${J0} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${x.cursor.css} inset;}${this._terminalSelector} .${J0} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${x.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,H+=`${this._terminalSelector} .${dx} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${dx} div { position: absolute; background-color: ${x.selectionBackgroundOpaque.css};}${this._terminalSelector} .${dx} div { position: absolute; background-color: ${x.selectionInactiveBackgroundOpaque.css};}`;for(let[q,m]of x.ansi.entries())H+=`${this._terminalSelector} .${hx}${q} { color: ${m.css}; }${this._terminalSelector} .${hx}${q}.xterm-dim { color: ${d.multiplyOpacity(m,0.5).css}; }${this._terminalSelector} .${c9}${q} { background-color: ${m.css}; }`;H+=`${this._terminalSelector} .${hx}257 { color: ${d.opaque(x.background).css}; }${this._terminalSelector} .${hx}257.xterm-dim { color: ${d.multiplyOpacity(d.opaque(x.background),0.5).css}; }${this._terminalSelector} .${c9}257 { background-color: ${x.foreground.css}; }`,this._themeStyleElement.textContent=H}_setDefaultSpacing(){let x=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${x}px`,this._rowFactory.defaultSpacing=x}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(x,H){for(let F=this._rowElements.length;F<=H;F++){let Y=this._document.createElement("div");this._rowContainer.appendChild(Y),this._rowElements.push(Y)}for(;this._rowElements.length>H;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(x,H){this._refreshRowElements(x,H),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(Zx),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(Zx),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(x,H,F){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(x,H,F),this.renderRows(0,this._bufferService.rows-1),!x||!H||(this._selectionRenderModel.update(this._terminal,x,H,F),!this._selectionRenderModel.hasSelection))return;let Y=this._selectionRenderModel.viewportStartRow,G=this._selectionRenderModel.viewportEndRow,q=this._selectionRenderModel.viewportCappedStartRow,m=this._selectionRenderModel.viewportCappedEndRow,z=this._document.createDocumentFragment();if(F){let C=x[0]>H[0];z.appendChild(this._createSelectionElement(q,C?H[0]:x[0],C?x[0]:H[0],m-q+1))}else{let C=Y===q?x[0]:0,R=q===G?H[0]:this._bufferService.cols;z.appendChild(this._createSelectionElement(q,C,R));let M=m-q-1;if(z.appendChild(this._createSelectionElement(q+1,0,this._bufferService.cols,M)),q!==m){let N=G===m?H[0]:this._bufferService.cols;z.appendChild(this._createSelectionElement(m,0,N))}}this._selectionContainer.appendChild(z)}_createSelectionElement(x,H,F,Y=1){let G=this._document.createElement("div"),q=H*this.dimensions.css.cell.width,m=this.dimensions.css.cell.width*(F-H);return q+m>this.dimensions.css.canvas.width&&(m=this.dimensions.css.canvas.width-q),G.style.height=`${Y*this.dimensions.css.cell.height}px`,G.style.top=`${x*this.dimensions.css.cell.height}px`,G.style.left=`${q}px`,G.style.width=`${m}px`,G}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(let x of this._rowElements)x.replaceChildren()}renderRows(x,H){let F=this._bufferService.buffer,Y=F.ybase+F.y,G=Math.min(F.x,this._bufferService.cols-1),q=this._coreService.decPrivateModes.cursorBlink??this._optionsService.rawOptions.cursorBlink,m=this._coreService.decPrivateModes.cursorStyle??this._optionsService.rawOptions.cursorStyle,z=this._optionsService.rawOptions.cursorInactiveStyle;for(let C=x;C<=H;C++){let R=C+F.ydisp,M=this._rowElements[C],N=F.lines.get(R);if(!M||!N)break;M.replaceChildren(...this._rowFactory.createRow(N,R,R===Y,m,z,G,q,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${X1}${this._terminalClass}`}_handleLinkHover(x){this._setCellUnderline(x.x1,x.x2,x.y1,x.y2,x.cols,!0)}_handleLinkLeave(x){this._setCellUnderline(x.x1,x.x2,x.y1,x.y2,x.cols,!1)}_setCellUnderline(x,H,F,Y,G,q){F<0&&(x=0),Y<0&&(H=0);let m=this._bufferService.rows-1;F=Math.max(Math.min(F,m),0),Y=Math.max(Math.min(Y,m),0),G=Math.min(G,this._bufferService.cols);let z=this._bufferService.buffer,C=z.ybase+z.y,R=Math.min(z.x,G-1),M=this._optionsService.rawOptions.cursorBlink,N=this._optionsService.rawOptions.cursorStyle,Z=this._optionsService.rawOptions.cursorInactiveStyle;for(let $=F;$<=Y;++$){let j=$+z.ydisp,A=this._rowElements[$],O=z.lines.get(j);if(!A||!O)break;A.replaceChildren(...this._rowFactory.createRow(O,j,j===C,N,Z,R,M,this.dimensions.css.cell.width,this._widthCache,q?$===F?x:0:-1,q?($===Y?H:G)-1:-1))}}};c1=a([K(7,Y9),K(8,G1),K(9,N0),K(10,C0),K(11,xx),K(12,I0),K(13,Gx)],c1);var a1=class extends y{constructor(x,H,F){super();this._optionsService=F,this.width=0,this.height=0,this._onCharSizeChange=this._register(new W),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this._register(new X5(this._optionsService))}catch{this._measureStrategy=this._register(new W5(x,H,this._optionsService))}this._register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}get hasValidSize(){return this.width>0&&this.height>0}measure(){let x=this._measureStrategy.measure();(x.width!==this.width||x.height!==this.height)&&(this.width=x.width,this.height=x.height,this._onCharSizeChange.fire())}};a1=a([K(2,N0)],a1);var u6=class extends y{constructor(){super(...arguments);this._result={width:0,height:0}}_validateAndSet(x,H){x!==void 0&&x>0&&H!==void 0&&H>0&&(this._result.width=x,this._result.height=H)}},W5=class extends u6{constructor(x,H,F){super();this._document=x,this._parentElement=H,this._optionsService=F,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}},X5=class extends u6{constructor(x){super();this._optionsService=x,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");let H=this._ctx.measureText("W");if(!(("width"in H)&&("fontBoundingBoxAscent"in H)&&("fontBoundingBoxDescent"in H)))throw Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;let x=this._ctx.measureText("W");return this._validateAndSet(x.width,x.fontBoundingBoxAscent+x.fontBoundingBoxDescent),this._result}},U5=class extends y{constructor(x,H,F){super();this._textarea=x,this._window=H,this.mainDocument=F,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=this._register(new K5(this._window)),this._onDprChange=this._register(new W),this.onDprChange=this._onDprChange.event,this._onWindowChange=this._register(new W),this.onWindowChange=this._onWindowChange.event,this._register(this.onWindowChange((Y)=>this._screenDprMonitor.setWindow(Y))),this._register(m0.forward(this._screenDprMonitor.onDprChange,this._onDprChange)),this._register(b(this._textarea,"focus",()=>this._isFocused=!0)),this._register(b(this._textarea,"blur",()=>this._isFocused=!1))}get window(){return this._window}set window(x){this._window!==x&&(this._window=x,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}},K5=class extends y{constructor(x){super();this._parentWindow=x,this._windowResizeListener=this._register(new Yx),this._onDprChange=this._register(new W),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this._register(f(()=>this.clearListener()))}setWindow(x){this._parentWindow=x,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=b(this._parentWindow,"resize",()=>this._setDprAndFireIfDiffers())}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){this._outerListener&&(this._resolutionMediaMatchList?.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){!this._resolutionMediaMatchList||!this._outerListener||(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}},B5=class extends y{constructor(){super();this.linkProviders=[],this._register(f(()=>this.linkProviders.length=0))}registerLinkProvider(x){return this.linkProviders.push(x),{dispose:()=>{let H=this.linkProviders.indexOf(x);H!==-1&&this.linkProviders.splice(H,1)}}}};function M9(x,H,F){let Y=F.getBoundingClientRect(),G=x.getComputedStyle(F),q=parseInt(G.getPropertyValue("padding-left")),m=parseInt(G.getPropertyValue("padding-top"));return[H.clientX-Y.left-q,H.clientY-Y.top-m]}function O5(x,H,F,Y,G,q,m,z,C){if(!q)return;let R=M9(x,H,F);if(R)return R[0]=Math.ceil((R[0]+(C?m/2:0))/m),R[1]=Math.ceil(R[1]/z),R[0]=Math.min(Math.max(R[0],1),Y+(C?1:0)),R[1]=Math.min(Math.max(R[1],1),G),R}var o1=class{constructor(x,H){this._renderService=x,this._charSizeService=H}getCoords(x,H,F,Y,G){return O5(window,x,H,F,Y,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,G)}getMouseReportCoords(x,H){let F=M9(window,x,H);if(this._charSizeService.hasValidSize)return F[0]=Math.min(Math.max(F[0],0),this._renderService.dimensions.css.canvas.width-1),F[1]=Math.min(Math.max(F[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(F[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(F[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(F[0]),y:Math.floor(F[1])}}};o1=a([K(0,S0),K(1,G1)],o1);var D5=class{constructor(x,H){this._renderCallback=x,this._coreBrowserService=H,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(x){return this._refreshCallbacks.push(x),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(x,H,F){this._rowCount=F,x=x!==void 0?x:0,H=H!==void 0?H:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,x):x,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,H):H,!this._animationFrame&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0){this._runRefreshCallbacks();return}let x=Math.max(this._rowStart,0),H=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(x,H),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let x of this._refreshCallbacks)x(0);this._refreshCallbacks=[]}},c6={};R3(c6,{getSafariVersion:()=>p5,isChromeOS:()=>n6,isFirefox:()=>a6,isIpad:()=>L5,isIphone:()=>b5,isLegacyEdge:()=>k5,isLinux:()=>j9,isMac:()=>x1,isNode:()=>R1,isSafari:()=>o6,isWindows:()=>l6});var R1=typeof process<"u"&&"title"in process,Px=R1?"node":navigator.userAgent,Ix=R1?"node":navigator.platform,a6=Px.includes("Firefox"),k5=Px.includes("Edge"),o6=/^((?!chrome|android).)*safari/i.test(Px);function p5(){if(!o6)return 0;let x=Px.match(/Version\/(\d+)/);return x===null||x.length<2?0:parseInt(x[1])}var x1=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(Ix),L5=Ix==="iPad",b5=Ix==="iPhone",l6=["Windows","Win16","Win32","WinCE"].includes(Ix),j9=Ix.indexOf("Linux")>=0,n6=/\bCrOS\b/.test(Px),s6=class{constructor(){this._tasks=[],this._i=0}enqueue(x){this._tasks.push(x),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(x){this._idleCallback=void 0;let H=0,F=0,Y=x.timeRemaining(),G=0;for(;this._i<this._tasks.length;){if(H=performance.now(),this._tasks[this._i]()||this._i++,H=Math.max(1,performance.now()-H),F=Math.max(H,F),G=x.timeRemaining(),F*1.5>G){Y-H<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(Y-H))}ms`),this._start();return}Y=G}this.clear()}},y5=class extends s6{_requestCallback(x){return setTimeout(()=>x(this._createDeadline(16)))}_cancelCallback(x){clearTimeout(x)}_createDeadline(x){let H=performance.now()+x;return{timeRemaining:()=>Math.max(0,H-performance.now())}}},w5=class extends s6{_requestCallback(x){return requestIdleCallback(x)}_cancelCallback(x){cancelIdleCallback(x)}},H1=!R1&&"requestIdleCallback"in window?w5:y5,T5=class{constructor(){this._queue=new H1}set(x){this._queue.clear(),this._queue.enqueue(x)}flush(){this._queue.flush()}},l1=class extends y{constructor(x,H,F,Y,G,q,m,z,C){super();this._rowCount=x,this._optionsService=F,this._charSizeService=Y,this._coreService=G,this._coreBrowserService=z,this._renderer=this._register(new Yx),this._pausedResizeTask=new T5,this._observerDisposable=this._register(new Yx),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this._register(new W),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this._register(new W),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this._register(new W),this.onRender=this._onRender.event,this._onRefreshRequest=this._register(new W),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new D5((R,M)=>this._renderRows(R,M),this._coreBrowserService),this._register(this._renderDebouncer),this._syncOutputHandler=new P5(this._coreBrowserService,this._coreService,()=>this._fullRefresh()),this._register(f(()=>this._syncOutputHandler.dispose())),this._register(this._coreBrowserService.onDprChange(()=>this.handleDevicePixelRatioChange())),this._register(m.onResize(()=>this._fullRefresh())),this._register(m.buffers.onBufferActivate(()=>this._renderer.value?.clear())),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this._register(q.onDecorationRegistered(()=>this._fullRefresh())),this._register(q.onDecorationRemoved(()=>this._fullRefresh())),this._register(this._optionsService.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],()=>{this.clear(),this.handleResize(m.cols,m.rows),this._fullRefresh()})),this._register(this._optionsService.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(m.buffer.y,m.buffer.y,!0))),this._register(C.onChangeColors(()=>this._fullRefresh())),this._registerIntersectionObserver(this._coreBrowserService.window,H),this._register(this._coreBrowserService.onWindowChange((R)=>this._registerIntersectionObserver(R,H)))}get dimensions(){return this._renderer.value.dimensions}_registerIntersectionObserver(x,H){if("IntersectionObserver"in x){let F=new x.IntersectionObserver((Y)=>this._handleIntersectionChange(Y[Y.length-1]),{threshold:0});F.observe(H),this._observerDisposable.value=f(()=>F.disconnect())}}_handleIntersectionChange(x){this._isPaused=x.isIntersecting===void 0?x.intersectionRatio===0:!x.isIntersecting,!this._isPaused&&!this._charSizeService.hasValidSize&&this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(x,H,F=!1){if(this._isPaused){this._needsFullRefresh=!0;return}if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows(x,H);return}let Y=this._syncOutputHandler.flush();Y&&(x=Math.min(x,Y.start),H=Math.max(H,Y.end)),F||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(x,H,this._rowCount)}_renderRows(x,H){if(this._renderer.value){if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows(x,H);return}x=Math.min(x,this._rowCount-1),H=Math.min(H,this._rowCount-1),this._renderer.value.renderRows(x,H),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:x,end:H}),this._onRender.fire({start:x,end:H}),this._isNextRenderRedrawOnly=!0}}resize(x,H){this._rowCount=H,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(x){this._renderer.value=x,this._renderer.value&&(this._renderer.value.onRequestRedraw((H)=>this.refreshRows(H.start,H.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(x){return this._renderDebouncer.addRefreshCallback(x)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){this._renderer.value&&(this._renderer.value.clearTextureAtlas?.(),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(x,H){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.value?.handleResize(x,H)):this._renderer.value.handleResize(x,H),this._fullRefresh())}handleCharSizeChanged(){this._renderer.value?.handleCharSizeChanged()}handleBlur(){this._renderer.value?.handleBlur()}handleFocus(){this._renderer.value?.handleFocus()}handleSelectionChanged(x,H,F){this._selectionState.start=x,this._selectionState.end=H,this._selectionState.columnSelectMode=F,this._renderer.value?.handleSelectionChanged(x,H,F)}handleCursorMove(){this._renderer.value?.handleCursorMove()}clear(){this._renderer.value?.clear()}};l1=a([K(2,N0),K(3,G1),K(4,xx),K(5,Tx),K(6,C0),K(7,I0),K(8,Gx)],l1);var P5=class{constructor(x,H,F){this._coreBrowserService=x,this._coreService=H,this._onTimeout=F,this._start=0,this._end=0,this._isBuffering=!1}bufferRows(x,H){this._isBuffering?(this._start=Math.min(this._start,x),this._end=Math.max(this._end,H)):(this._start=x,this._end=H,this._isBuffering=!0),this._timeout===void 0&&(this._timeout=this._coreBrowserService.window.setTimeout(()=>{this._timeout=void 0,this._coreService.decPrivateModes.synchronizedOutput=!1,this._onTimeout()},1000))}flush(){if(this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0),!this._isBuffering)return;let x={start:this._start,end:this._end};return this._isBuffering=!1,x}dispose(){this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0)}};function I5(x,H,F,Y){let G=F.buffer.x,q=F.buffer.y;if(!F.buffer.hasScrollback)return E5(G,q,x,H,F,Y)+z1(q,H,F,Y)+h5(G,q,x,H,F,Y);let m;if(q===H)return m=G>x?"D":"C",bx(Math.abs(G-x),Lx(m,Y));m=q>H?"D":"C";let z=Math.abs(q-H),C=Q5(q>H?x:G,F)+(z-1)*F.cols+1+S5(q>H?G:x,F);return bx(C,Lx(m,Y))}function S5(x,H){return x-1}function Q5(x,H){return H.cols-x}function E5(x,H,F,Y,G,q){return z1(H,Y,G,q).length===0?"":bx(i6(x,H,x,H-e0(H,G),!1,G).length,Lx("D",q))}function z1(x,H,F,Y){let G=x-e0(x,F),q=H-e0(H,F),m=Math.abs(G-q)-d5(x,H,F);return bx(m,Lx(r6(x,H),Y))}function h5(x,H,F,Y,G,q){let m;z1(H,Y,G,q).length>0?m=Y-e0(Y,G):m=H;let z=Y,C=f5(x,H,F,Y,G,q);return bx(i6(x,m,F,z,C==="C",G).length,Lx(C,q))}function d5(x,H,F){let Y=0,G=x-e0(x,F),q=H-e0(H,F);for(let m=0;m<Math.abs(G-q);m++){let z=r6(x,H)==="A"?-1:1;F.buffer.lines.get(G+z*m)?.isWrapped&&Y++}return Y}function e0(x,H){let F=0,Y=H.buffer.lines.get(x),G=Y?.isWrapped;for(;G&&x>=0&&x<H.rows;)F++,Y=H.buffer.lines.get(--x),G=Y?.isWrapped;return F}function f5(x,H,F,Y,G,q){let m;return z1(F,Y,G,q).length>0?m=Y-e0(Y,G):m=H,x<F&&m<=Y||x>=F&&m<Y?"C":"D"}function r6(x,H){return x>H?"A":"B"}function i6(x,H,F,Y,G,q){let m=x,z=H,C="";for(;(m!==F||z!==Y)&&z>=0&&z<q.buffer.lines.length;)m+=G?1:-1,G&&m>q.cols-1?(C+=q.buffer.translateBufferLineToString(z,!1,x,m),m=0,x=0,z++):!G&&m<0&&(C+=q.buffer.translateBufferLineToString(z,!1,0,x+1),m=q.cols-1,x=m,z--);return C+q.buffer.translateBufferLineToString(z,!1,x,m)}function Lx(x,H){let F=H?"O":"[";return J.ESC+F+x}function bx(x,H){x=Math.floor(x);let F="";for(let Y=0;Y<x;Y++)F+=H;return F}var _5=class{constructor(x){this._bufferService=x,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:!this.selectionEnd||!this.selectionStart?this.selectionStart:this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){let x=this.selectionStart[0]+this.selectionStartLength;return x>this._bufferService.cols?x%this._bufferService.cols===0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(x/this._bufferService.cols)-1]:[x%this._bufferService.cols,this.selectionStart[1]+Math.floor(x/this._bufferService.cols)]:[x,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){let x=this.selectionStart[0]+this.selectionStartLength;return x>this._bufferService.cols?[x%this._bufferService.cols,this.selectionStart[1]+Math.floor(x/this._bufferService.cols)]:[Math.max(x,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){let x=this.selectionStart,H=this.selectionEnd;return!x||!H?!1:x[1]>H[1]||x[1]===H[1]&&x[0]>H[0]}handleTrim(x){return this.selectionStart&&(this.selectionStart[1]-=x),this.selectionEnd&&(this.selectionEnd[1]-=x),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}};function a9(x,H){if(x.start.y>x.end.y)throw Error(`Buffer range end (${x.end.x}, ${x.end.y}) cannot be before start (${x.start.x}, ${x.start.y})`);return H*(x.end.y-x.start.y)+(x.end.x-x.start.x+1)}var U1=50,v5=15,g5=50,u5=500,c5="",a5=new RegExp(c5,"g"),n1=class extends y{constructor(x,H,F,Y,G,q,m,z,C){super();this._element=x,this._screenElement=H,this._linkifier=F,this._bufferService=Y,this._coreService=G,this._mouseService=q,this._optionsService=m,this._renderService=z,this._coreBrowserService=C,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new W0,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this._register(new W),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this._register(new W),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this._register(new W),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this._register(new W),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=(R)=>this._handleMouseMove(R),this._mouseUpListener=(R)=>this._handleMouseUp(R),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim((R)=>this._handleTrim(R)),this._register(this._bufferService.buffers.onBufferActivate((R)=>this._handleBufferActivate(R))),this.enable(),this._model=new _5(this._bufferService),this._activeSelectionMode=0,this._register(f(()=>{this._removeMouseDownListeners()})),this._register(this._bufferService.onResize((R)=>{R.rowsChanged&&this.clearSelection()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){let x=this._model.finalSelectionStart,H=this._model.finalSelectionEnd;return!x||!H?!1:x[0]!==H[0]||x[1]!==H[1]}get selectionText(){let x=this._model.finalSelectionStart,H=this._model.finalSelectionEnd;if(!x||!H)return"";let F=this._bufferService.buffer,Y=[];if(this._activeSelectionMode===3){if(x[0]===H[0])return"";let G=x[0]<H[0]?x[0]:H[0],q=x[0]<H[0]?H[0]:x[0];for(let m=x[1];m<=H[1];m++){let z=F.translateBufferLineToString(m,!0,G,q);Y.push(z)}}else{let G=x[1]===H[1]?H[0]:void 0;Y.push(F.translateBufferLineToString(x[1],!0,x[0],G));for(let q=x[1]+1;q<=H[1]-1;q++){let m=F.lines.get(q),z=F.translateBufferLineToString(q,!0);m?.isWrapped?Y[Y.length-1]+=z:Y.push(z)}if(x[1]!==H[1]){let q=F.lines.get(H[1]),m=F.translateBufferLineToString(H[1],!0,0,H[0]);q&&q.isWrapped?Y[Y.length-1]+=m:Y.push(m)}}return Y.map((G)=>G.replace(a5," ")).join(l6?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(x){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),j9&&x&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(x){let H=this._getMouseBufferCoords(x),F=this._model.finalSelectionStart,Y=this._model.finalSelectionEnd;return!F||!Y||!H?!1:this._areCoordsInSelection(H,F,Y)}isCellInSelection(x,H){let F=this._model.finalSelectionStart,Y=this._model.finalSelectionEnd;return!F||!Y?!1:this._areCoordsInSelection([x,H],F,Y)}_areCoordsInSelection(x,H,F){return x[1]>H[1]&&x[1]<F[1]||H[1]===F[1]&&x[1]===H[1]&&x[0]>=H[0]&&x[0]<F[0]||H[1]<F[1]&&x[1]===F[1]&&x[0]<F[0]||H[1]<F[1]&&x[1]===H[1]&&x[0]>=H[0]}_selectWordAtCursor(x,H){let F=this._linkifier.currentLink?.link?.range;if(F)return this._model.selectionStart=[F.start.x-1,F.start.y-1],this._model.selectionStartLength=a9(F,this._bufferService.cols),this._model.selectionEnd=void 0,!0;let Y=this._getMouseBufferCoords(x);return Y?(this._selectWordAt(Y,H),this._model.selectionEnd=void 0,!0):!1}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(x,H){this._model.clearSelection(),x=Math.max(x,0),H=Math.min(H,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,x],this._model.selectionEnd=[this._bufferService.cols,H],this.refresh(),this._onSelectionChange.fire()}_handleTrim(x){this._model.handleTrim(x)&&this.refresh()}_getMouseBufferCoords(x){let H=this._mouseService.getCoords(x,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(H)return H[0]--,H[1]--,H[1]+=this._bufferService.buffer.ydisp,H}_getMouseEventScrollAmount(x){let H=M9(this._coreBrowserService.window,x,this._screenElement)[1],F=this._renderService.dimensions.css.canvas.height;return H>=0&&H<=F?0:(H>F&&(H-=F),H=Math.min(Math.max(H,-U1),U1),H/=U1,H/Math.abs(H)+Math.round(H*(v5-1)))}shouldForceSelection(x){return x1?x.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:x.shiftKey}handleMouseDown(x){if(this._mouseDownTimeStamp=x.timeStamp,!(x.button===2&&this.hasSelection)&&x.button===0){if(!this._enabled){if(!this.shouldForceSelection(x))return;x.stopPropagation()}x.preventDefault(),this._dragScrollAmount=0,this._enabled&&x.shiftKey?this._handleIncrementalClick(x):x.detail===1?this._handleSingleClick(x):x.detail===2?this._handleDoubleClick(x):x.detail===3&&this._handleTripleClick(x),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),g5)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(x){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(x))}_handleSingleClick(x){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(x)?3:0,this._model.selectionStart=this._getMouseBufferCoords(x),!this._model.selectionStart)return;this._model.selectionEnd=void 0;let H=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);H&&H.length!==this._model.selectionStart[0]&&H.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(x){this._selectWordAtCursor(x,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(x){let H=this._getMouseBufferCoords(x);H&&(this._activeSelectionMode=2,this._selectLineAt(H[1]))}shouldColumnSelect(x){return x.altKey&&!(x1&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(x){if(x.stopImmediatePropagation(),!this._model.selectionStart)return;let H=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(x),!this._model.selectionEnd){this.refresh(!0);return}this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(x),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));let F=this._bufferService.buffer;if(this._model.selectionEnd[1]<F.lines.length){let Y=F.lines.get(this._model.selectionEnd[1]);Y&&Y.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}(!H||H[0]!==this._model.selectionEnd[0]||H[1]!==this._model.selectionEnd[1])&&this.refresh(!0)}_dragScroll(){if(!(!this._model.selectionEnd||!this._model.selectionStart)&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});let x=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(x.ydisp+this._bufferService.rows,x.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=x.ydisp),this.refresh()}}_handleMouseUp(x){let H=x.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&H<u5&&x.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){let F=this._mouseService.getCoords(x,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(F&&F[0]!==void 0&&F[1]!==void 0){let Y=I5(F[0]-1,F[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(Y,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){let x=this._model.finalSelectionStart,H=this._model.finalSelectionEnd,F=!!x&&!!H&&(x[0]!==H[0]||x[1]!==H[1]);if(!F){this._oldHasSelection&&this._fireOnSelectionChange(x,H,F);return}!x||!H||(!this._oldSelectionStart||!this._oldSelectionEnd||x[0]!==this._oldSelectionStart[0]||x[1]!==this._oldSelectionStart[1]||H[0]!==this._oldSelectionEnd[0]||H[1]!==this._oldSelectionEnd[1])&&this._fireOnSelectionChange(x,H,F)}_fireOnSelectionChange(x,H,F){this._oldSelectionStart=x,this._oldSelectionEnd=H,this._oldHasSelection=F,this._onSelectionChange.fire()}_handleBufferActivate(x){this.clearSelection(),this._trimListener.dispose(),this._trimListener=x.activeBuffer.lines.onTrim((H)=>this._handleTrim(H))}_convertViewportColToCharacterIndex(x,H){let F=H;for(let Y=0;H>=Y;Y++){let G=x.loadCell(Y,this._workCell).getChars().length;this._workCell.getWidth()===0?F--:G>1&&H!==Y&&(F+=G-1)}return F}setSelection(x,H,F){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[x,H],this._model.selectionStartLength=F,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(x){this._isClickInSelection(x)||(this._selectWordAtCursor(x,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(x,H,F=!0,Y=!0){if(x[0]>=this._bufferService.cols)return;let G=this._bufferService.buffer,q=G.lines.get(x[1]);if(!q)return;let m=G.translateBufferLineToString(x[1],!1),z=this._convertViewportColToCharacterIndex(q,x[0]),C=z,R=x[0]-z,M=0,N=0,Z=0,$=0;if(m.charAt(z)===" "){for(;z>0&&m.charAt(z-1)===" ";)z--;for(;C<m.length&&m.charAt(C+1)===" ";)C++}else{let O=x[0],L=x[0];q.getWidth(O)===0&&(M++,O--),q.getWidth(L)===2&&(N++,L++);let E=q.getString(L).length;for(E>1&&($+=E-1,C+=E-1);O>0&&z>0&&!this._isCharWordSeparator(q.loadCell(O-1,this._workCell));){q.loadCell(O-1,this._workCell);let T=this._workCell.getChars().length;this._workCell.getWidth()===0?(M++,O--):T>1&&(Z+=T-1,z-=T-1),z--,O--}for(;L<q.length&&C+1<m.length&&!this._isCharWordSeparator(q.loadCell(L+1,this._workCell));){q.loadCell(L+1,this._workCell);let T=this._workCell.getChars().length;this._workCell.getWidth()===2?(N++,L++):T>1&&($+=T-1,C+=T-1),C++,L++}}C++;let j=z+R-M+Z,A=Math.min(this._bufferService.cols,C-z+M+N-Z-$);if(!(!H&&m.slice(z,C).trim()==="")){if(F&&j===0&&q.getCodePoint(0)!==32){let O=G.lines.get(x[1]-1);if(O&&q.isWrapped&&O.getCodePoint(this._bufferService.cols-1)!==32){let L=this._getWordAt([this._bufferService.cols-1,x[1]-1],!1,!0,!1);if(L){let E=this._bufferService.cols-L.start;j-=E,A+=E}}}if(Y&&j+A===this._bufferService.cols&&q.getCodePoint(this._bufferService.cols-1)!==32){let O=G.lines.get(x[1]+1);if(O?.isWrapped&&O.getCodePoint(0)!==32){let L=this._getWordAt([0,x[1]+1],!1,!1,!0);L&&(A+=L.length)}}return{start:j,length:A}}}_selectWordAt(x,H){let F=this._getWordAt(x,H);if(F){for(;F.start<0;)F.start+=this._bufferService.cols,x[1]--;this._model.selectionStart=[F.start,x[1]],this._model.selectionStartLength=F.length}}_selectToWordAt(x){let H=this._getWordAt(x,!0);if(H){let F=x[1];for(;H.start<0;)H.start+=this._bufferService.cols,F--;if(!this._model.areSelectionValuesReversed())for(;H.start+H.length>this._bufferService.cols;)H.length-=this._bufferService.cols,F++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?H.start:H.start+H.length,F]}}_isCharWordSeparator(x){return x.getWidth()===0?!1:this._optionsService.rawOptions.wordSeparator.indexOf(x.getChars())>=0}_selectLineAt(x){let H=this._bufferService.buffer.getWrappedRangeForLine(x),F={start:{x:0,y:H.first},end:{x:this._bufferService.cols-1,y:H.last}};this._model.selectionStart=[0,H.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=a9(F,this._bufferService.cols)}};n1=a([K(3,C0),K(4,xx),K(5,G9),K(6,N0),K(7,S0),K(8,I0)],n1);var o9=class{constructor(){this._data={}}set(x,H,F){this._data[x]||(this._data[x]={}),this._data[x][H]=F}get(x,H){return this._data[x]?this._data[x][H]:void 0}clear(){this._data={}}},l9=class{constructor(){this._color=new o9,this._css=new o9}setCss(x,H,F){this._css.set(x,H,F)}getCss(x,H){return this._css.get(x,H)}setColor(x,H,F){this._color.set(x,H,F)}getColor(x,H){return this._color.get(x,H)}clear(){this._color.clear(),this._css.clear()}},s=Object.freeze((()=>{let x=[u.toColor("#2e3436"),u.toColor("#cc0000"),u.toColor("#4e9a06"),u.toColor("#c4a000"),u.toColor("#3465a4"),u.toColor("#75507b"),u.toColor("#06989a"),u.toColor("#d3d7cf"),u.toColor("#555753"),u.toColor("#ef2929"),u.toColor("#8ae234"),u.toColor("#fce94f"),u.toColor("#729fcf"),u.toColor("#ad7fa8"),u.toColor("#34e2e2"),u.toColor("#eeeeec")],H=[0,95,135,175,215,255];for(let F=0;F<216;F++){let Y=H[F/36%6|0],G=H[F/6%6|0],q=H[F%6];x.push({css:n.toCss(Y,G,q),rgba:n.toRgba(Y,G,q)})}for(let F=0;F<24;F++){let Y=8+F*10;x.push({css:n.toCss(Y,Y,Y),rgba:n.toRgba(Y,Y,Y)})}return x})()),n0=u.toColor("#ffffff"),Ux=u.toColor("#000000"),n9=u.toColor("#ffffff"),s9=Ux,$x={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117},o5=n0,s1=class extends y{constructor(x){super();this._optionsService=x,this._contrastCache=new l9,this._halfContrastCache=new l9,this._onChangeColors=this._register(new W),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:n0,background:Ux,cursor:n9,cursorAccent:s9,selectionForeground:void 0,selectionBackgroundTransparent:$x,selectionBackgroundOpaque:d.blend(Ux,$x),selectionInactiveBackgroundTransparent:$x,selectionInactiveBackgroundOpaque:d.blend(Ux,$x),scrollbarSliderBackground:d.opacity(n0,0.2),scrollbarSliderHoverBackground:d.opacity(n0,0.4),scrollbarSliderActiveBackground:d.opacity(n0,0.5),overviewRulerBorder:n0,ansi:s.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this._register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this._register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}get colors(){return this._colors}_setTheme(x={}){let H=this._colors;if(H.foreground=h(x.foreground,n0),H.background=h(x.background,Ux),H.cursor=d.blend(H.background,h(x.cursor,n9)),H.cursorAccent=d.blend(H.background,h(x.cursorAccent,s9)),H.selectionBackgroundTransparent=h(x.selectionBackground,$x),H.selectionBackgroundOpaque=d.blend(H.background,H.selectionBackgroundTransparent),H.selectionInactiveBackgroundTransparent=h(x.selectionInactiveBackground,H.selectionBackgroundTransparent),H.selectionInactiveBackgroundOpaque=d.blend(H.background,H.selectionInactiveBackgroundTransparent),H.selectionForeground=x.selectionForeground?h(x.selectionForeground,g9):void 0,H.selectionForeground===g9&&(H.selectionForeground=void 0),d.isOpaque(H.selectionBackgroundTransparent)&&(H.selectionBackgroundTransparent=d.opacity(H.selectionBackgroundTransparent,0.3)),d.isOpaque(H.selectionInactiveBackgroundTransparent)&&(H.selectionInactiveBackgroundTransparent=d.opacity(H.selectionInactiveBackgroundTransparent,0.3)),H.scrollbarSliderBackground=h(x.scrollbarSliderBackground,d.opacity(H.foreground,0.2)),H.scrollbarSliderHoverBackground=h(x.scrollbarSliderHoverBackground,d.opacity(H.foreground,0.4)),H.scrollbarSliderActiveBackground=h(x.scrollbarSliderActiveBackground,d.opacity(H.foreground,0.5)),H.overviewRulerBorder=h(x.overviewRulerBorder,o5),H.ansi=s.slice(),H.ansi[0]=h(x.black,s[0]),H.ansi[1]=h(x.red,s[1]),H.ansi[2]=h(x.green,s[2]),H.ansi[3]=h(x.yellow,s[3]),H.ansi[4]=h(x.blue,s[4]),H.ansi[5]=h(x.magenta,s[5]),H.ansi[6]=h(x.cyan,s[6]),H.ansi[7]=h(x.white,s[7]),H.ansi[8]=h(x.brightBlack,s[8]),H.ansi[9]=h(x.brightRed,s[9]),H.ansi[10]=h(x.brightGreen,s[10]),H.ansi[11]=h(x.brightYellow,s[11]),H.ansi[12]=h(x.brightBlue,s[12]),H.ansi[13]=h(x.brightMagenta,s[13]),H.ansi[14]=h(x.brightCyan,s[14]),H.ansi[15]=h(x.brightWhite,s[15]),x.extendedAnsi){let F=Math.min(H.ansi.length-16,x.extendedAnsi.length);for(let Y=0;Y<F;Y++)H.ansi[Y+16]=h(x.extendedAnsi[Y],s[Y+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(x){this._restoreColor(x),this._onChangeColors.fire(this.colors)}_restoreColor(x){if(x===void 0){for(let H=0;H<this._restoreColors.ansi.length;++H)this._colors.ansi[H]=this._restoreColors.ansi[H];return}switch(x){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[x]=this._restoreColors.ansi[x]}}modifyColors(x){x(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};s1=a([K(0,N0)],s1);function h(x,H){if(x!==void 0)try{return u.toColor(x)}catch{}return H}var l5=class{constructor(...x){this._entries=new Map;for(let[H,F]of x)this.set(H,F)}set(x,H){let F=this._entries.get(x);return this._entries.set(x,H),F}forEach(x){for(let[H,F]of this._entries.entries())x(H,F)}has(x){return this._entries.has(x)}get(x){return this._entries.get(x)}},n5=class{constructor(){this._services=new l5,this._services.set(Y9,this)}setService(x,H){this._services.set(x,H)}getService(x){return this._services.get(x)}createInstance(x,...H){let F=$3(x).sort((q,m)=>q.index-m.index),Y=[];for(let q of F){let m=this._services.get(q.id);if(!m)throw Error(`[createInstance] ${x.name} depends on UNKNOWN service ${q.id._id}.`);Y.push(m)}let G=F.length>0?F[0].index:H.length;if(H.length!==G)throw Error(`[createInstance] First service dependency of ${x.name} at position ${G+1} conflicts with ${H.length} static arguments`);return new x(...H,...Y)}},s5={trace:0,debug:1,info:2,warn:3,error:4,off:5},r5="xterm.js: ",r1=class extends y{constructor(x){super();this._optionsService=x,this._logLevel=5,this._updateLogLevel(),this._register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),i5=this}get logLevel(){return this._logLevel}_updateLogLevel(){this._logLevel=s5[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(x){for(let H=0;H<x.length;H++)typeof x[H]=="function"&&(x[H]=x[H]())}_log(x,H,F){this._evalLazyOptionalParams(F),x.call(console,(this._optionsService.options.logger?"":r5)+H,...F)}trace(x,...H){this._logLevel<=0&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,x,H)}debug(x,...H){this._logLevel<=1&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,x,H)}info(x,...H){this._logLevel<=2&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,x,H)}warn(x,...H){this._logLevel<=3&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,x,H)}error(x,...H){this._logLevel<=4&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,x,H)}};r1=a([K(0,N0)],r1);var i5,r9=class extends y{constructor(x){super();this._maxLength=x,this.onDeleteEmitter=this._register(new W),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this._register(new W),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this._register(new W),this.onTrim=this.onTrimEmitter.event,this._array=Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(x){if(this._maxLength===x)return;let H=Array(x);for(let F=0;F<Math.min(x,this.length);F++)H[F]=this._array[this._getCyclicIndex(F)];this._array=H,this._maxLength=x,this._startIndex=0}get length(){return this._length}set length(x){if(x>this._length)for(let H=this._length;H<x;H++)this._array[H]=void 0;this._length=x}get(x){return this._array[this._getCyclicIndex(x)]}set(x,H){this._array[this._getCyclicIndex(x)]=H}push(x){this._array[this._getCyclicIndex(this._length)]=x,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(x,H,...F){if(H){for(let Y=x;Y<this._length-H;Y++)this._array[this._getCyclicIndex(Y)]=this._array[this._getCyclicIndex(Y+H)];this._length-=H,this.onDeleteEmitter.fire({index:x,amount:H})}for(let Y=this._length-1;Y>=x;Y--)this._array[this._getCyclicIndex(Y+F.length)]=this._array[this._getCyclicIndex(Y)];for(let Y=0;Y<F.length;Y++)this._array[this._getCyclicIndex(x+Y)]=F[Y];if(F.length&&this.onInsertEmitter.fire({index:x,amount:F.length}),this._length+F.length>this._maxLength){let Y=this._length+F.length-this._maxLength;this._startIndex+=Y,this._length=this._maxLength,this.onTrimEmitter.fire(Y)}else this._length+=F.length}trimStart(x){x>this._length&&(x=this._length),this._startIndex+=x,this._length-=x,this.onTrimEmitter.fire(x)}shiftElements(x,H,F){if(!(H<=0)){if(x<0||x>=this._length)throw Error("start argument out of range");if(x+F<0)throw Error("Cannot shift elements in list beyond index 0");if(F>0){for(let G=H-1;G>=0;G--)this.set(x+G+F,this.get(x+G));let Y=x+H+F-this._length;if(Y>0)for(this._length+=Y;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let Y=0;Y<H;Y++)this.set(x+Y+F,this.get(x+Y))}}_getCyclicIndex(x){return(this._startIndex+x)%this._maxLength}},w=3,l=Object.freeze(new wx),fx=0,K1=2,Kx=class x{constructor(H,F,Y=!1){this.isWrapped=Y,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(H*w);let G=F||W0.fromCharData([0,U6,1,0]);for(let q=0;q<H;++q)this.setCell(q,G);this.length=H}get(H){let F=this._data[H*w+0],Y=F&2097151;return[this._data[H*w+1],F&2097152?this._combined[H]:Y?u0(Y):"",F>>22,F&2097152?this._combined[H].charCodeAt(this._combined[H].length-1):Y]}set(H,F){this._data[H*w+1]=F[0],F[1].length>1?(this._combined[H]=F[1],this._data[H*w+0]=H|2097152|F[2]<<22):this._data[H*w+0]=F[1].charCodeAt(0)|F[2]<<22}getWidth(H){return this._data[H*w+0]>>22}hasWidth(H){return this._data[H*w+0]&12582912}getFg(H){return this._data[H*w+1]}getBg(H){return this._data[H*w+2]}hasContent(H){return this._data[H*w+0]&4194303}getCodePoint(H){let F=this._data[H*w+0];return F&2097152?this._combined[H].charCodeAt(this._combined[H].length-1):F&2097151}isCombined(H){return this._data[H*w+0]&2097152}getString(H){let F=this._data[H*w+0];return F&2097152?this._combined[H]:F&2097151?u0(F&2097151):""}isProtected(H){return this._data[H*w+2]&536870912}loadCell(H,F){return fx=H*w,F.content=this._data[fx+0],F.fg=this._data[fx+1],F.bg=this._data[fx+2],F.content&2097152&&(F.combinedData=this._combined[H]),F.bg&268435456&&(F.extended=this._extendedAttrs[H]),F}setCell(H,F){F.content&2097152&&(this._combined[H]=F.combinedData),F.bg&268435456&&(this._extendedAttrs[H]=F.extended),this._data[H*w+0]=F.content,this._data[H*w+1]=F.fg,this._data[H*w+2]=F.bg}setCellFromCodepoint(H,F,Y,G){G.bg&268435456&&(this._extendedAttrs[H]=G.extended),this._data[H*w+0]=F|Y<<22,this._data[H*w+1]=G.fg,this._data[H*w+2]=G.bg}addCodepointToCell(H,F,Y){let G=this._data[H*w+0];G&2097152?this._combined[H]+=u0(F):G&2097151?(this._combined[H]=u0(G&2097151)+u0(F),G&=-2097152,G|=2097152):G=F|4194304,Y&&(G&=-12582913,G|=Y<<22),this._data[H*w+0]=G}insertCells(H,F,Y){if(H%=this.length,H&&this.getWidth(H-1)===2&&this.setCellFromCodepoint(H-1,0,1,Y),F<this.length-H){let G=new W0;for(let q=this.length-H-F-1;q>=0;--q)this.setCell(H+F+q,this.loadCell(H+q,G));for(let q=0;q<F;++q)this.setCell(H+q,Y)}else for(let G=H;G<this.length;++G)this.setCell(G,Y);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,Y)}deleteCells(H,F,Y){if(H%=this.length,F<this.length-H){let G=new W0;for(let q=0;q<this.length-H-F;++q)this.setCell(H+q,this.loadCell(H+F+q,G));for(let q=this.length-F;q<this.length;++q)this.setCell(q,Y)}else for(let G=H;G<this.length;++G)this.setCell(G,Y);H&&this.getWidth(H-1)===2&&this.setCellFromCodepoint(H-1,0,1,Y),this.getWidth(H)===0&&!this.hasContent(H)&&this.setCellFromCodepoint(H,0,1,Y)}replaceCells(H,F,Y,G=!1){if(G){for(H&&this.getWidth(H-1)===2&&!this.isProtected(H-1)&&this.setCellFromCodepoint(H-1,0,1,Y),F<this.length&&this.getWidth(F-1)===2&&!this.isProtected(F)&&this.setCellFromCodepoint(F,0,1,Y);H<F&&H<this.length;)this.isProtected(H)||this.setCell(H,Y),H++;return}for(H&&this.getWidth(H-1)===2&&this.setCellFromCodepoint(H-1,0,1,Y),F<this.length&&this.getWidth(F-1)===2&&this.setCellFromCodepoint(F,0,1,Y);H<F&&H<this.length;)this.setCell(H++,Y)}resize(H,F){if(H===this.length)return this._data.length*4*K1<this._data.buffer.byteLength;let Y=H*w;if(H>this.length){if(this._data.buffer.byteLength>=Y*4)this._data=new Uint32Array(this._data.buffer,0,Y);else{let G=new Uint32Array(Y);G.set(this._data),this._data=G}for(let G=this.length;G<H;++G)this.setCell(G,F)}else{this._data=this._data.subarray(0,Y);let G=Object.keys(this._combined);for(let m=0;m<G.length;m++){let z=parseInt(G[m],10);z>=H&&delete this._combined[z]}let q=Object.keys(this._extendedAttrs);for(let m=0;m<q.length;m++){let z=parseInt(q[m],10);z>=H&&delete this._extendedAttrs[z]}}return this.length=H,Y*4*K1<this._data.buffer.byteLength}cleanupMemory(){if(this._data.length*4*K1<this._data.buffer.byteLength){let H=new Uint32Array(this._data.length);return H.set(this._data),this._data=H,1}return 0}fill(H,F=!1){if(F){for(let Y=0;Y<this.length;++Y)this.isProtected(Y)||this.setCell(Y,H);return}this._combined={},this._extendedAttrs={};for(let Y=0;Y<this.length;++Y)this.setCell(Y,H)}copyFrom(H){this.length!==H.length?this._data=new Uint32Array(H._data):this._data.set(H._data),this.length=H.length,this._combined={};for(let F in H._combined)this._combined[F]=H._combined[F];this._extendedAttrs={};for(let F in H._extendedAttrs)this._extendedAttrs[F]=H._extendedAttrs[F];this.isWrapped=H.isWrapped}clone(){let H=new x(0);H._data=new Uint32Array(this._data),H.length=this.length;for(let F in this._combined)H._combined[F]=this._combined[F];for(let F in this._extendedAttrs)H._extendedAttrs[F]=this._extendedAttrs[F];return H.isWrapped=this.isWrapped,H}getTrimmedLength(){for(let H=this.length-1;H>=0;--H)if(this._data[H*w+0]&4194303)return H+(this._data[H*w+0]>>22);return 0}getNoBgTrimmedLength(){for(let H=this.length-1;H>=0;--H)if(this._data[H*w+0]&4194303||this._data[H*w+2]&50331648)return H+(this._data[H*w+0]>>22);return 0}copyCellsFrom(H,F,Y,G,q){let m=H._data;if(q)for(let C=G-1;C>=0;C--){for(let R=0;R<w;R++)this._data[(Y+C)*w+R]=m[(F+C)*w+R];m[(F+C)*w+2]&268435456&&(this._extendedAttrs[Y+C]=H._extendedAttrs[F+C])}else for(let C=0;C<G;C++){for(let R=0;R<w;R++)this._data[(Y+C)*w+R]=m[(F+C)*w+R];m[(F+C)*w+2]&268435456&&(this._extendedAttrs[Y+C]=H._extendedAttrs[F+C])}let z=Object.keys(H._combined);for(let C=0;C<z.length;C++){let R=parseInt(z[C],10);R>=F&&(this._combined[R-F+Y]=H._combined[R])}}translateToString(H,F,Y,G){F=F??0,Y=Y??this.length,H&&(Y=Math.min(Y,this.getTrimmedLength())),G&&(G.length=0);let q="";for(;F<Y;){let m=this._data[F*w+0],z=m&2097151,C=m&2097152?this._combined[F]:z?u0(z):c0;if(q+=C,G)for(let R=0;R<C.length;++R)G.push(F);F+=m>>22||1}return G&&G.push(F),q}};function t5(x,H,F,Y,G,q){let m=[];for(let z=0;z<x.length-1;z++){let C=z,R=x.get(++C);if(!R.isWrapped)continue;let M=[x.get(z)];for(;C<x.length&&R.isWrapped;)M.push(R),R=x.get(++C);if(!q&&Y>=z&&Y<C){z+=M.length-1;continue}let N=0,Z=yx(M,N,H),$=1,j=0;for(;$<M.length;){let O=yx(M,$,H),L=O-j,E=F-Z,T=Math.min(L,E);M[N].copyCellsFrom(M[$],j,Z,T,!1),Z+=T,Z===F&&(N++,Z=0),j+=T,j===O&&($++,j=0),Z===0&&N!==0&&M[N-1].getWidth(F-1)===2&&(M[N].copyCellsFrom(M[N-1],F-1,Z++,1,!1),M[N-1].setCell(F-1,G))}M[N].replaceCells(Z,F,G);let A=0;for(let O=M.length-1;O>0&&(O>N||M[O].getTrimmedLength()===0);O--)A++;A>0&&(m.push(z+M.length-A),m.push(A)),z+=M.length-1}return m}function e5(x,H){let F=[],Y=0,G=H[Y],q=0;for(let m=0;m<x.length;m++)if(G===m){let z=H[++Y];x.onDeleteEmitter.fire({index:m-q,amount:z}),m+=z-1,q+=z,G=H[++Y]}else F.push(m);return{layout:F,countRemoved:q}}function x4(x,H){let F=[];for(let Y=0;Y<H.length;Y++)F.push(x.get(H[Y]));for(let Y=0;Y<F.length;Y++)x.set(Y,F[Y]);x.length=H.length}function H4(x,H,F){let Y=[],G=x.map((C,R)=>yx(x,R,H)).reduce((C,R)=>C+R),q=0,m=0,z=0;for(;z<G;){if(G-z<F){Y.push(G-z);break}q+=F;let C=yx(x,m,H);q>C&&(q-=C,m++);let R=x[m].getWidth(q-1)===2;R&&q--;let M=R?F-1:F;Y.push(M),z+=M}return Y}function yx(x,H,F){if(H===x.length-1)return x[H].getTrimmedLength();let Y=!x[H].hasContent(F-1)&&x[H].getWidth(F-1)===1,G=x[H+1].getWidth(0)===2;return Y&&G?F-1:F}var t6=class x{constructor(H){this.line=H,this.isDisposed=!1,this._disposables=[],this._id=x._nextId++,this._onDispose=this.register(new W),this.onDispose=this._onDispose.event}get id(){return this._id}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),t0(this._disposables),this._disposables.length=0)}register(H){return this._disposables.push(H),H}};t6._nextId=1;var F4=t6,i={},s0=i.B;i[0]={"`":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:"","{":"","|":"","}":"","~":""};i.A={"#":""};i.B=void 0;i[4]={"#":"","@":"","[":"ij","\\":"","]":"|","{":"","|":"f","}":"","~":""};i.C=i[5]={"[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};i.R={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""};i.Q={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};i.K={"@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""};i.Y={"#":"","@":"","[":"","\\":"","]":"","`":"","{":"","|":"","}":"","~":""};i.E=i[6]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};i.Z={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":""};i.H=i[7]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};i["="]={"#":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":""};var i9=4294967295,t9=class{constructor(x,H,F){this._hasScrollback=x,this._optionsService=H,this._bufferService=F,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=l.clone(),this.savedCharset=s0,this.markers=[],this._nullCell=W0.fromCharData([0,U6,1,0]),this._whitespaceCell=W0.fromCharData([0,c0,1,32]),this._isClearing=!1,this._memoryCleanupQueue=new H1,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new r9(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(x){return x?(this._nullCell.fg=x.fg,this._nullCell.bg=x.bg,this._nullCell.extended=x.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new nx),this._nullCell}getWhitespaceCell(x){return x?(this._whitespaceCell.fg=x.fg,this._whitespaceCell.bg=x.bg,this._whitespaceCell.extended=x.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new nx),this._whitespaceCell}getBlankLine(x,H){return new Kx(this._bufferService.cols,this.getNullCell(x),H)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let x=this.ybase+this.y-this.ydisp;return x>=0&&x<this._rows}_getCorrectBufferLength(x){if(!this._hasScrollback)return x;let H=x+this._optionsService.rawOptions.scrollback;return H>i9?i9:H}fillViewportRows(x){if(this.lines.length===0){x===void 0&&(x=l);let H=this._rows;for(;H--;)this.lines.push(this.getBlankLine(x))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new r9(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(x,H){let F=this.getNullCell(l),Y=0,G=this._getCorrectBufferLength(H);if(G>this.lines.maxLength&&(this.lines.maxLength=G),this.lines.length>0){if(this._cols<x)for(let m=0;m<this.lines.length;m++)Y+=+this.lines.get(m).resize(x,F);let q=0;if(this._rows<H)for(let m=this._rows;m<H;m++)this.lines.length<H+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new Kx(x,F)):this.ybase>0&&this.lines.length<=this.ybase+this.y+q+1?(this.ybase--,q++,this.ydisp>0&&this.ydisp--):this.lines.push(new Kx(x,F)));else for(let m=this._rows;m>H;m--)this.lines.length>H+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(G<this.lines.maxLength){let m=this.lines.length-G;m>0&&(this.lines.trimStart(m),this.ybase=Math.max(this.ybase-m,0),this.ydisp=Math.max(this.ydisp-m,0),this.savedY=Math.max(this.savedY-m,0)),this.lines.maxLength=G}this.x=Math.min(this.x,x-1),this.y=Math.min(this.y,H-1),q&&(this.y+=q),this.savedX=Math.min(this.savedX,x-1),this.scrollTop=0}if(this.scrollBottom=H-1,this._isReflowEnabled&&(this._reflow(x,H),this._cols>x))for(let q=0;q<this.lines.length;q++)Y+=+this.lines.get(q).resize(x,F);this._cols=x,this._rows=H,this._memoryCleanupQueue.clear(),Y>0.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let x=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,x=!1);let H=0;for(;this._memoryCleanupPosition<this.lines.length;)if(H+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),H>100)return!0;return x}get _isReflowEnabled(){let x=this._optionsService.rawOptions.windowsPty;return x&&x.buildNumber?this._hasScrollback&&x.backend==="conpty"&&x.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(x,H){this._cols!==x&&(x>this._cols?this._reflowLarger(x,H):this._reflowSmaller(x,H))}_reflowLarger(x,H){let F=this._optionsService.rawOptions.reflowCursorLine,Y=t5(this.lines,this._cols,x,this.ybase+this.y,this.getNullCell(l),F);if(Y.length>0){let G=e5(this.lines,Y);x4(this.lines,G.layout),this._reflowLargerAdjustViewport(x,H,G.countRemoved)}}_reflowLargerAdjustViewport(x,H,F){let Y=this.getNullCell(l),G=F;for(;G-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<H&&this.lines.push(new Kx(x,Y))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-F,0)}_reflowSmaller(x,H){let F=this._optionsService.rawOptions.reflowCursorLine,Y=this.getNullCell(l),G=[],q=0;for(let m=this.lines.length-1;m>=0;m--){let z=this.lines.get(m);if(!z||!z.isWrapped&&z.getTrimmedLength()<=x)continue;let C=[z];for(;z.isWrapped&&m>0;)z=this.lines.get(--m),C.unshift(z);if(!F){let T=this.ybase+this.y;if(T>=m&&T<m+C.length)continue}let R=C[C.length-1].getTrimmedLength(),M=H4(C,this._cols,x),N=M.length-C.length,Z;this.ybase===0&&this.y!==this.lines.length-1?Z=Math.max(0,this.y-this.lines.maxLength+N):Z=Math.max(0,this.lines.length-this.lines.maxLength+N);let $=[];for(let T=0;T<N;T++){let k=this.getBlankLine(l,!0);$.push(k)}$.length>0&&(G.push({start:m+C.length+q,newLines:$}),q+=$.length),C.push(...$);let j=M.length-1,A=M[j];A===0&&(j--,A=M[j]);let O=C.length-N-1,L=R;for(;O>=0;){let T=Math.min(L,A);if(C[j]===void 0)break;if(C[j].copyCellsFrom(C[O],L-T,A-T,T,!0),A-=T,A===0&&(j--,A=M[j]),L-=T,L===0){O--;let k=Math.max(O,0);L=yx(C,k,this._cols)}}for(let T=0;T<C.length;T++)M[T]<x&&C[T].setCell(M[T],Y);let E=N-Z;for(;E-- >0;)this.ybase===0?this.y<H-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+q)-H&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+N,this.ybase+H-1)}if(G.length>0){let m=[],z=[];for(let A=0;A<this.lines.length;A++)z.push(this.lines.get(A));let C=this.lines.length,R=C-1,M=0,N=G[M];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+q);let Z=0;for(let A=Math.min(this.lines.maxLength-1,C+q-1);A>=0;A--)if(N&&N.start>R+Z){for(let O=N.newLines.length-1;O>=0;O--)this.lines.set(A--,N.newLines[O]);A++,m.push({index:R+1,amount:N.newLines.length}),Z+=N.newLines.length,N=G[++M]}else this.lines.set(A,z[R--]);let $=0;for(let A=m.length-1;A>=0;A--)m[A].index+=$,this.lines.onInsertEmitter.fire(m[A]),$+=m[A].amount;let j=Math.max(0,C+q-this.lines.maxLength);j>0&&this.lines.onTrimEmitter.fire(j)}}translateBufferLineToString(x,H,F=0,Y){let G=this.lines.get(x);return G?G.translateToString(H,F,Y):""}getWrappedRangeForLine(x){let H=x,F=x;for(;H>0&&this.lines.get(H).isWrapped;)H--;for(;F+1<this.lines.length&&this.lines.get(F+1).isWrapped;)F++;return{first:H,last:F}}setupTabStops(x){for(x!=null?this.tabs[x]||(x=this.prevStop(x)):(this.tabs={},x=0);x<this._cols;x+=this._optionsService.rawOptions.tabStopWidth)this.tabs[x]=!0}prevStop(x){for(x==null&&(x=this.x);!this.tabs[--x]&&x>0;);return x>=this._cols?this._cols-1:x<0?0:x}nextStop(x){for(x==null&&(x=this.x);!this.tabs[++x]&&x<this._cols;);return x>=this._cols?this._cols-1:x<0?0:x}clearMarkers(x){this._isClearing=!0;for(let H=0;H<this.markers.length;H++)this.markers[H].line===x&&(this.markers[H].dispose(),this.markers.splice(H--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let x=0;x<this.markers.length;x++)this.markers[x].dispose();this.markers.length=0,this._isClearing=!1}addMarker(x){let H=new F4(x);return this.markers.push(H),H.register(this.lines.onTrim((F)=>{H.line-=F,H.line<0&&H.dispose()})),H.register(this.lines.onInsert((F)=>{H.line>=F.index&&(H.line+=F.amount)})),H.register(this.lines.onDelete((F)=>{H.line>=F.index&&H.line<F.index+F.amount&&H.dispose(),H.line>F.index&&(H.line-=F.amount)})),H.register(H.onDispose(()=>this._removeMarker(H))),H}_removeMarker(x){this._isClearing||this.markers.splice(this.markers.indexOf(x),1)}},Y4=class extends y{constructor(x,H){super();this._optionsService=x,this._bufferService=H,this._onBufferActivate=this._register(new W),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this._register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this._register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new t9(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new t9(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(x){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(x),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(x,H){this._normal.resize(x,H),this._alt.resize(x,H),this.setupTabStops(x)}setupTabStops(x){this._normal.setupTabStops(x),this._alt.setupTabStops(x)}},e6=2,x3=1,i1=class extends y{constructor(x){super();this.isUserScrolling=!1,this._onResize=this._register(new W),this.onResize=this._onResize.event,this._onScroll=this._register(new W),this.onScroll=this._onScroll.event,this.cols=Math.max(x.rawOptions.cols||0,e6),this.rows=Math.max(x.rawOptions.rows||0,x3),this.buffers=this._register(new Y4(x,this)),this._register(this.buffers.onBufferActivate((H)=>{this._onScroll.fire(H.activeBuffer.ydisp)}))}get buffer(){return this.buffers.active}resize(x,H){let F=this.cols!==x,Y=this.rows!==H;this.cols=x,this.rows=H,this.buffers.resize(x,H),this._onResize.fire({cols:x,rows:H,colsChanged:F,rowsChanged:Y})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(x,H=!1){let F=this.buffer,Y;Y=this._cachedBlankLine,(!Y||Y.length!==this.cols||Y.getFg(0)!==x.fg||Y.getBg(0)!==x.bg)&&(Y=F.getBlankLine(x,H),this._cachedBlankLine=Y),Y.isWrapped=H;let G=F.ybase+F.scrollTop,q=F.ybase+F.scrollBottom;if(F.scrollTop===0){let m=F.lines.isFull;q===F.lines.length-1?m?F.lines.recycle().copyFrom(Y):F.lines.push(Y.clone()):F.lines.splice(q+1,0,Y.clone()),m?this.isUserScrolling&&(F.ydisp=Math.max(F.ydisp-1,0)):(F.ybase++,this.isUserScrolling||F.ydisp++)}else{let m=q-G+1;F.lines.shiftElements(G+1,m-1,-1),F.lines.set(q,Y.clone())}this.isUserScrolling||(F.ydisp=F.ybase),this._onScroll.fire(F.ydisp)}scrollLines(x,H){let F=this.buffer;if(x<0){if(F.ydisp===0)return;this.isUserScrolling=!0}else x+F.ydisp>=F.ybase&&(this.isUserScrolling=!1);let Y=F.ydisp;F.ydisp=Math.max(Math.min(F.ydisp+x,F.ybase),0),Y!==F.ydisp&&(H||this._onScroll.fire(F.ydisp))}};i1=a([K(0,N0)],i1);var Hx={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1000,scrollOnEraseInDisplay:!1,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},reflowCursorLine:!1,rescaleOverlappingGlyphs:!1,rightClickSelectsWord:x1,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRuler:{}},G4=["normal","bold","100","200","300","400","500","600","700","800","900"],q4=class extends y{constructor(x){super();this._onOptionChange=this._register(new W),this.onOptionChange=this._onOptionChange.event;let H={...Hx};for(let F in x)if(F in H)try{let Y=x[F];H[F]=this._sanitizeAndValidateOption(F,Y)}catch(Y){console.error(Y)}this.rawOptions=H,this.options={...H},this._setupOptions(),this._register(f(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange(x,H){return this.onOptionChange((F)=>{F===x&&H(this.rawOptions[x])})}onMultipleOptionChange(x,H){return this.onOptionChange((F)=>{x.indexOf(F)!==-1&&H()})}_setupOptions(){let x=(F)=>{if(!(F in Hx))throw Error(`No option with key "${F}"`);return this.rawOptions[F]},H=(F,Y)=>{if(!(F in Hx))throw Error(`No option with key "${F}"`);Y=this._sanitizeAndValidateOption(F,Y),this.rawOptions[F]!==Y&&(this.rawOptions[F]=Y,this._onOptionChange.fire(F))};for(let F in this.rawOptions){let Y={get:x.bind(this,F),set:H.bind(this,F)};Object.defineProperty(this.options,F,Y)}}_sanitizeAndValidateOption(x,H){switch(x){case"cursorStyle":if(H||(H=Hx[x]),!m4(H))throw Error(`"${H}" is not a valid value for ${x}`);break;case"wordSeparator":H||(H=Hx[x]);break;case"fontWeight":case"fontWeightBold":if(typeof H=="number"&&1<=H&&H<=1000)break;H=G4.includes(H)?H:Hx[x];break;case"cursorWidth":H=Math.floor(H);case"lineHeight":case"tabStopWidth":if(H<1)throw Error(`${x} cannot be less than 1, value: ${H}`);break;case"minimumContrastRatio":H=Math.max(1,Math.min(21,Math.round(H*10)/10));break;case"scrollback":if(H=Math.min(H,4294967295),H<0)throw Error(`${x} cannot be less than 0, value: ${H}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(H<=0)throw Error(`${x} cannot be less than or equal to 0, value: ${H}`);break;case"rows":case"cols":if(!H&&H!==0)throw Error(`${x} must be numeric, value: ${H}`);break;case"windowsPty":H=H??{};break}return H}};function m4(x){return x==="block"||x==="underline"||x==="bar"}function Bx(x,H=5){if(typeof x!="object")return x;let F=Array.isArray(x)?[]:{};for(let Y in x)F[Y]=H<=1?x[Y]:x[Y]&&Bx(x[Y],H-1);return F}var e9=Object.freeze({insertMode:!1}),x6=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,cursorBlink:void 0,cursorStyle:void 0,origin:!1,reverseWraparound:!1,sendFocus:!1,synchronizedOutput:!1,wraparound:!0}),t1=class extends y{constructor(x,H,F){super();this._bufferService=x,this._logService=H,this._optionsService=F,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this._register(new W),this.onData=this._onData.event,this._onUserInput=this._register(new W),this.onUserInput=this._onUserInput.event,this._onBinary=this._register(new W),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this._register(new W),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=Bx(e9),this.decPrivateModes=Bx(x6)}reset(){this.modes=Bx(e9),this.decPrivateModes=Bx(x6)}triggerDataEvent(x,H=!1){if(this._optionsService.rawOptions.disableStdin)return;let F=this._bufferService.buffer;H&&this._optionsService.rawOptions.scrollOnUserInput&&F.ybase!==F.ydisp&&this._onRequestScrollToBottom.fire(),H&&this._onUserInput.fire(),this._logService.debug(`sending data "${x}"`),this._logService.trace("sending data (codes)",()=>x.split("").map((Y)=>Y.charCodeAt(0))),this._onData.fire(x)}triggerBinaryEvent(x){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${x}"`),this._logService.trace("sending binary (codes)",()=>x.split("").map((H)=>H.charCodeAt(0))),this._onBinary.fire(x))}};t1=a([K(0,C0),K(1,B6),K(2,N0)],t1);var H6={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:(x)=>x.button===4||x.action!==1?!1:(x.ctrl=!1,x.alt=!1,x.shift=!1,!0)},VT200:{events:19,restrict:(x)=>x.action!==32},DRAG:{events:23,restrict:(x)=>!(x.action===32&&x.button===3)},ANY:{events:31,restrict:(x)=>!0}};function B1(x,H){let F=(x.ctrl?16:0)|(x.shift?4:0)|(x.alt?8:0);return x.button===4?(F|=64,F|=x.action):(F|=x.button&3,x.button&4&&(F|=64),x.button&8&&(F|=128),x.action===32?F|=32:x.action===0&&!H&&(F|=3)),F}var O1=String.fromCharCode,F6={DEFAULT:(x)=>{let H=[B1(x,!1)+32,x.col+32,x.row+32];return H[0]>255||H[1]>255||H[2]>255?"":`\x1B[M${O1(H[0])}${O1(H[1])}${O1(H[2])}`},SGR:(x)=>{let H=x.action===0&&x.button!==4?"m":"M";return`\x1B[<${B1(x,!0)};${x.col};${x.row}${H}`},SGR_PIXELS:(x)=>{let H=x.action===0&&x.button!==4?"m":"M";return`\x1B[<${B1(x,!0)};${x.x};${x.y}${H}`}},e1=class extends y{constructor(x,H,F){super();this._bufferService=x,this._coreService=H,this._optionsService=F,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._wheelPartialScroll=0,this._onProtocolChange=this._register(new W),this.onProtocolChange=this._onProtocolChange.event;for(let Y of Object.keys(H6))this.addProtocol(Y,H6[Y]);for(let Y of Object.keys(F6))this.addEncoding(Y,F6[Y]);this.reset()}addProtocol(x,H){this._protocols[x]=H}addEncoding(x,H){this._encodings[x]=H}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(x){if(!this._protocols[x])throw Error(`unknown protocol "${x}"`);this._activeProtocol=x,this._onProtocolChange.fire(this._protocols[x].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(x){if(!this._encodings[x])throw Error(`unknown encoding "${x}"`);this._activeEncoding=x}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null,this._wheelPartialScroll=0}consumeWheelEvent(x,H,F){if(x.deltaY===0||x.shiftKey||H===void 0||F===void 0)return 0;let Y=H/F,G=this._applyScrollModifier(x.deltaY,x);return x.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(G/=Y+0,Math.abs(x.deltaY)<50&&(G*=0.3),this._wheelPartialScroll+=G,G=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):x.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(G*=this._bufferService.rows),G}_applyScrollModifier(x,H){return H.altKey||H.ctrlKey||H.shiftKey?x*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:x*this._optionsService.rawOptions.scrollSensitivity}triggerMouseEvent(x){if(x.col<0||x.col>=this._bufferService.cols||x.row<0||x.row>=this._bufferService.rows||x.button===4&&x.action===32||x.button===3&&x.action!==32||x.button!==4&&(x.action===2||x.action===3)||(x.col++,x.row++,x.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,x,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(x))return!1;let H=this._encodings[this._activeEncoding](x);return H&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(H):this._coreService.triggerDataEvent(H,!0)),this._lastEvent=x,!0}explainEvents(x){return{down:!!(x&1),up:!!(x&2),drag:!!(x&4),move:!!(x&8),wheel:!!(x&16)}}_equalEvents(x,H,F){if(F){if(x.x!==H.x||x.y!==H.y)return!1}else if(x.col!==H.col||x.row!==H.row)return!1;return!(x.button!==H.button||x.action!==H.action||x.ctrl!==H.ctrl||x.alt!==H.alt||x.shift!==H.shift)}};e1=a([K(0,C0),K(1,xx),K(2,N0)],e1);var D1=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],R4=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],r;function z4(x,H){let F=0,Y=H.length-1,G;if(x<H[0][0]||x>H[Y][1])return!1;for(;Y>=F;)if(G=F+Y>>1,x>H[G][1])F=G+1;else if(x<H[G][0])Y=G-1;else return!0;return!1}var C4=class{constructor(){if(this.version="6",!r){r=new Uint8Array(65536),r.fill(1),r[0]=0,r.fill(0,1,32),r.fill(0,127,160),r.fill(2,4352,4448),r[9001]=2,r[9002]=2,r.fill(2,11904,42192),r[12351]=1,r.fill(2,44032,55204),r.fill(2,63744,64256),r.fill(2,65040,65050),r.fill(2,65072,65136),r.fill(2,65280,65377),r.fill(2,65504,65511);for(let x=0;x<D1.length;++x)r.fill(0,D1[x][0],D1[x][1]+1)}}wcwidth(x){return x<32?0:x<127?1:x<65536?r[x]:z4(x,R4)?0:x>=131072&&x<=196605||x>=196608&&x<=262141?2:1}charProperties(x,H){let F=this.wcwidth(x),Y=F===0&&H!==0;if(Y){let G=r0.extractWidth(H);G===0?Y=!1:G>F&&(F=G)}return r0.createPropertyValue(0,F,Y)}},r0=class x{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new W,this.onChange=this._onChange.event;let H=new C4;this.register(H),this._active=H.version,this._activeProvider=H}static extractShouldJoin(H){return(H&1)!==0}static extractWidth(H){return H>>1&3}static extractCharKind(H){return H>>3}static createPropertyValue(H,F,Y=!1){return(H&16777215)<<3|(F&3)<<1|(Y?1:0)}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(H){if(!this._providers[H])throw Error(`unknown Unicode version "${H}"`);this._active=H,this._activeProvider=this._providers[H],this._onChange.fire(H)}register(H){this._providers[H.version]=H}wcwidth(H){return this._activeProvider.wcwidth(H)}getStringCellWidth(H){let F=0,Y=0,G=H.length;for(let q=0;q<G;++q){let m=H.charCodeAt(q);if(55296<=m&&m<=56319){if(++q>=G)return F+this.wcwidth(m);let R=H.charCodeAt(q);56320<=R&&R<=57343?m=(m-55296)*1024+R-56320+65536:F+=this.wcwidth(R)}let z=this.charProperties(m,Y),C=x.extractWidth(z);x.extractShouldJoin(z)&&(C-=x.extractWidth(Y)),F+=C,Y=z}return F}charProperties(H,F){return this._activeProvider.charProperties(H,F)}},N4=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(x){this.glevel=x,this.charset=this._charsets[x]}setgCharset(x,H){this._charsets[x]=H,this.glevel===x&&(this.charset=H)}};function Y6(x){let H=x.buffer.lines.get(x.buffer.ybase+x.buffer.y-1)?.get(x.cols-1),F=x.buffer.lines.get(x.buffer.ybase+x.buffer.y);F&&H&&(F.isWrapped=H[3]!==0&&H[3]!==32)}var Ax=2147483647,M4=256,H3=class x{constructor(H=32,F=32){if(this.maxLength=H,this.maxSubParamsLength=F,F>M4)throw Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(H),this.length=0,this._subParams=new Int32Array(F),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(H),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}static fromArray(H){let F=new x;if(!H.length)return F;for(let Y=Array.isArray(H[0])?1:0;Y<H.length;++Y){let G=H[Y];if(Array.isArray(G))for(let q=0;q<G.length;++q)F.addSubParam(G[q]);else F.addParam(G)}return F}clone(){let H=new x(this.maxLength,this.maxSubParamsLength);return H.params.set(this.params),H.length=this.length,H._subParams.set(this._subParams),H._subParamsLength=this._subParamsLength,H._subParamsIdx.set(this._subParamsIdx),H._rejectDigits=this._rejectDigits,H._rejectSubDigits=this._rejectSubDigits,H._digitIsSub=this._digitIsSub,H}toArray(){let H=[];for(let F=0;F<this.length;++F){H.push(this.params[F]);let Y=this._subParamsIdx[F]>>8,G=this._subParamsIdx[F]&255;G-Y>0&&H.push(Array.prototype.slice.call(this._subParams,Y,G))}return H}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(H){if(this._digitIsSub=!1,this.length>=this.maxLength){this._rejectDigits=!0;return}if(H<-1)throw Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=H>Ax?Ax:H}addSubParam(H){if(this._digitIsSub=!0,!!this.length){if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength){this._rejectSubDigits=!0;return}if(H<-1)throw Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=H>Ax?Ax:H,this._subParamsIdx[this.length-1]++}}hasSubParams(H){return(this._subParamsIdx[H]&255)-(this._subParamsIdx[H]>>8)>0}getSubParams(H){let F=this._subParamsIdx[H]>>8,Y=this._subParamsIdx[H]&255;return Y-F>0?this._subParams.subarray(F,Y):null}getSubParamsAll(){let H={};for(let F=0;F<this.length;++F){let Y=this._subParamsIdx[F]>>8,G=this._subParamsIdx[F]&255;G-Y>0&&(H[F]=this._subParams.slice(Y,G))}return H}addDigit(H){let F;if(this._rejectDigits||!(F=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let Y=this._digitIsSub?this._subParams:this.params,G=Y[F-1];Y[F-1]=~G?Math.min(G*10+H,Ax):H}},Jx=[],j4=class{constructor(){this._state=0,this._active=Jx,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(x,H){this._handlers[x]===void 0&&(this._handlers[x]=[]);let F=this._handlers[x];return F.push(H),{dispose:()=>{let Y=F.indexOf(H);Y!==-1&&F.splice(Y,1)}}}clearHandler(x){this._handlers[x]&&delete this._handlers[x]}setHandlerFallback(x){this._handlerFb=x}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=Jx}reset(){if(this._state===2)for(let x=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;x>=0;--x)this._active[x].end(!1);this._stack.paused=!1,this._active=Jx,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||Jx,!this._active.length)this._handlerFb(this._id,"START");else for(let x=this._active.length-1;x>=0;x--)this._active[x].start()}_put(x,H,F){if(!this._active.length)this._handlerFb(this._id,"PUT",Y1(x,H,F));else for(let Y=this._active.length-1;Y>=0;Y--)this._active[Y].put(x,H,F)}start(){this.reset(),this._state=1}put(x,H,F){if(this._state!==3){if(this._state===1)for(;H<F;){let Y=x[H++];if(Y===59){this._state=2,this._start();break}if(Y<48||57<Y){this._state=3;return}this._id===-1&&(this._id=0),this._id=this._id*10+Y-48}this._state===2&&F-H>0&&this._put(x,H,F)}}end(x,H=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),!this._active.length)this._handlerFb(this._id,"END",x);else{let F=!1,Y=this._active.length-1,G=!1;if(this._stack.paused&&(Y=this._stack.loopPosition-1,F=H,G=this._stack.fallThrough,this._stack.paused=!1),!G&&F===!1){for(;Y>=0&&(F=this._active[Y].end(x),F!==!0);Y--)if(F instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=Y,this._stack.fallThrough=!1,F;Y--}for(;Y>=0;Y--)if(F=this._active[Y].end(!1),F instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=Y,this._stack.fallThrough=!0,F}this._active=Jx,this._id=-1,this._state=0}}},Z0=class{constructor(x){this._handler=x,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(x,H,F){this._hitLimit||(this._data+=Y1(x,H,F),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}end(x){let H=!1;if(this._hitLimit)H=!1;else if(x&&(H=this._handler(this._data),H instanceof Promise))return H.then((F)=>(this._data="",this._hitLimit=!1,F));return this._data="",this._hitLimit=!1,H}},Vx=[],Z4=class{constructor(){this._handlers=Object.create(null),this._active=Vx,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=Vx}registerHandler(x,H){this._handlers[x]===void 0&&(this._handlers[x]=[]);let F=this._handlers[x];return F.push(H),{dispose:()=>{let Y=F.indexOf(H);Y!==-1&&F.splice(Y,1)}}}clearHandler(x){this._handlers[x]&&delete this._handlers[x]}setHandlerFallback(x){this._handlerFb=x}reset(){if(this._active.length)for(let x=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;x>=0;--x)this._active[x].unhook(!1);this._stack.paused=!1,this._active=Vx,this._ident=0}hook(x,H){if(this.reset(),this._ident=x,this._active=this._handlers[x]||Vx,!this._active.length)this._handlerFb(this._ident,"HOOK",H);else for(let F=this._active.length-1;F>=0;F--)this._active[F].hook(H)}put(x,H,F){if(!this._active.length)this._handlerFb(this._ident,"PUT",Y1(x,H,F));else for(let Y=this._active.length-1;Y>=0;Y--)this._active[Y].put(x,H,F)}unhook(x,H=!0){if(!this._active.length)this._handlerFb(this._ident,"UNHOOK",x);else{let F=!1,Y=this._active.length-1,G=!1;if(this._stack.paused&&(Y=this._stack.loopPosition-1,F=H,G=this._stack.fallThrough,this._stack.paused=!1),!G&&F===!1){for(;Y>=0&&(F=this._active[Y].unhook(x),F!==!0);Y--)if(F instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=Y,this._stack.fallThrough=!1,F;Y--}for(;Y>=0;Y--)if(F=this._active[Y].unhook(!1),F instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=Y,this._stack.fallThrough=!0,F}this._active=Vx,this._ident=0}},Ox=new H3;Ox.addParam(0);var G6=class{constructor(x){this._handler=x,this._data="",this._params=Ox,this._hitLimit=!1}hook(x){this._params=x.length>1||x.params[0]?x.clone():Ox,this._data="",this._hitLimit=!1}put(x,H,F){this._hitLimit||(this._data+=Y1(x,H,F),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}unhook(x){let H=!1;if(this._hitLimit)H=!1;else if(x&&(H=this._handler(this._data,this._params),H instanceof Promise))return H.then((F)=>(this._params=Ox,this._data="",this._hitLimit=!1,F));return this._params=Ox,this._data="",this._hitLimit=!1,H}},$4=class{constructor(x){this.table=new Uint8Array(x)}setDefault(x,H){this.table.fill(x<<4|H)}add(x,H,F,Y){this.table[H<<8|x]=F<<4|Y}addMany(x,H,F,Y){for(let G=0;G<x.length;G++)this.table[H<<8|x[G]]=F<<4|Y}},V0=160,A4=function(){let x=new $4(4095),H=Array.apply(null,Array(256)).map((z,C)=>C),F=(z,C)=>H.slice(z,C),Y=F(32,127),G=F(0,24);G.push(25),G.push.apply(G,F(28,32));let q=F(0,14),m;x.setDefault(1,0),x.addMany(Y,0,2,0);for(m in q)x.addMany([24,26,153,154],m,3,0),x.addMany(F(128,144),m,3,0),x.addMany(F(144,152),m,3,0),x.add(156,m,0,0),x.add(27,m,11,1),x.add(157,m,4,8),x.addMany([152,158,159],m,0,7),x.add(155,m,11,3),x.add(144,m,11,9);return x.addMany(G,0,3,0),x.addMany(G,1,3,1),x.add(127,1,0,1),x.addMany(G,8,0,8),x.addMany(G,3,3,3),x.add(127,3,0,3),x.addMany(G,4,3,4),x.add(127,4,0,4),x.addMany(G,6,3,6),x.addMany(G,5,3,5),x.add(127,5,0,5),x.addMany(G,2,3,2),x.add(127,2,0,2),x.add(93,1,4,8),x.addMany(Y,8,5,8),x.add(127,8,5,8),x.addMany([156,27,24,26,7],8,6,0),x.addMany(F(28,32),8,0,8),x.addMany([88,94,95],1,0,7),x.addMany(Y,7,0,7),x.addMany(G,7,0,7),x.add(156,7,0,0),x.add(127,7,0,7),x.add(91,1,11,3),x.addMany(F(64,127),3,7,0),x.addMany(F(48,60),3,8,4),x.addMany([60,61,62,63],3,9,4),x.addMany(F(48,60),4,8,4),x.addMany(F(64,127),4,7,0),x.addMany([60,61,62,63],4,0,6),x.addMany(F(32,64),6,0,6),x.add(127,6,0,6),x.addMany(F(64,127),6,0,0),x.addMany(F(32,48),3,9,5),x.addMany(F(32,48),5,9,5),x.addMany(F(48,64),5,0,6),x.addMany(F(64,127),5,7,0),x.addMany(F(32,48),4,9,5),x.addMany(F(32,48),1,9,2),x.addMany(F(32,48),2,9,2),x.addMany(F(48,127),2,10,0),x.addMany(F(48,80),1,10,0),x.addMany(F(81,88),1,10,0),x.addMany([89,90,92],1,10,0),x.addMany(F(96,127),1,10,0),x.add(80,1,11,9),x.addMany(G,9,0,9),x.add(127,9,0,9),x.addMany(F(28,32),9,0,9),x.addMany(F(32,48),9,9,12),x.addMany(F(48,60),9,8,10),x.addMany([60,61,62,63],9,9,10),x.addMany(G,11,0,11),x.addMany(F(32,128),11,0,11),x.addMany(F(28,32),11,0,11),x.addMany(G,10,0,10),x.add(127,10,0,10),x.addMany(F(28,32),10,0,10),x.addMany(F(48,60),10,8,10),x.addMany([60,61,62,63],10,0,11),x.addMany(F(32,48),10,9,12),x.addMany(G,12,0,12),x.add(127,12,0,12),x.addMany(F(28,32),12,0,12),x.addMany(F(32,48),12,9,12),x.addMany(F(48,64),12,0,11),x.addMany(F(64,127),12,12,13),x.addMany(F(64,127),10,12,13),x.addMany(F(64,127),9,12,13),x.addMany(G,13,13,13),x.addMany(Y,13,13,13),x.add(127,13,0,13),x.addMany([27,156,24,26],13,14,0),x.add(V0,0,2,0),x.add(V0,8,5,8),x.add(V0,6,0,6),x.add(V0,11,0,11),x.add(V0,13,13,13),x}(),J4=class extends y{constructor(x=A4){super();this._transitions=x,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new H3,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(H,F,Y)=>{},this._executeHandlerFb=(H)=>{},this._csiHandlerFb=(H,F)=>{},this._escHandlerFb=(H)=>{},this._errorHandlerFb=(H)=>H,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this._register(f(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this._register(new j4),this._dcsParser=this._register(new Z4),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(x,H=[64,126]){let F=0;if(x.prefix){if(x.prefix.length>1)throw Error("only one byte as prefix supported");if(F=x.prefix.charCodeAt(0),F&&60>F||F>63)throw Error("prefix must be in range 0x3c .. 0x3f")}if(x.intermediates){if(x.intermediates.length>2)throw Error("only two bytes as intermediates are supported");for(let G=0;G<x.intermediates.length;++G){let q=x.intermediates.charCodeAt(G);if(32>q||q>47)throw Error("intermediate must be in range 0x20 .. 0x2f");F<<=8,F|=q}}if(x.final.length!==1)throw Error("final must be a single byte");let Y=x.final.charCodeAt(0);if(H[0]>Y||Y>H[1])throw Error(`final must be in range ${H[0]} .. ${H[1]}`);return F<<=8,F|=Y,F}identToString(x){let H=[];for(;x;)H.push(String.fromCharCode(x&255)),x>>=8;return H.reverse().join("")}setPrintHandler(x){this._printHandler=x}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(x,H){let F=this._identifier(x,[48,126]);this._escHandlers[F]===void 0&&(this._escHandlers[F]=[]);let Y=this._escHandlers[F];return Y.push(H),{dispose:()=>{let G=Y.indexOf(H);G!==-1&&Y.splice(G,1)}}}clearEscHandler(x){this._escHandlers[this._identifier(x,[48,126])]&&delete this._escHandlers[this._identifier(x,[48,126])]}setEscHandlerFallback(x){this._escHandlerFb=x}setExecuteHandler(x,H){this._executeHandlers[x.charCodeAt(0)]=H}clearExecuteHandler(x){this._executeHandlers[x.charCodeAt(0)]&&delete this._executeHandlers[x.charCodeAt(0)]}setExecuteHandlerFallback(x){this._executeHandlerFb=x}registerCsiHandler(x,H){let F=this._identifier(x);this._csiHandlers[F]===void 0&&(this._csiHandlers[F]=[]);let Y=this._csiHandlers[F];return Y.push(H),{dispose:()=>{let G=Y.indexOf(H);G!==-1&&Y.splice(G,1)}}}clearCsiHandler(x){this._csiHandlers[this._identifier(x)]&&delete this._csiHandlers[this._identifier(x)]}setCsiHandlerFallback(x){this._csiHandlerFb=x}registerDcsHandler(x,H){return this._dcsParser.registerHandler(this._identifier(x),H)}clearDcsHandler(x){this._dcsParser.clearHandler(this._identifier(x))}setDcsHandlerFallback(x){this._dcsParser.setHandlerFallback(x)}registerOscHandler(x,H){return this._oscParser.registerHandler(x,H)}clearOscHandler(x){this._oscParser.clearHandler(x)}setOscHandlerFallback(x){this._oscParser.setHandlerFallback(x)}setErrorHandler(x){this._errorHandler=x}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(x,H,F,Y,G){this._parseStack.state=x,this._parseStack.handlers=H,this._parseStack.handlerPos=F,this._parseStack.transition=Y,this._parseStack.chunkPos=G}parse(x,H,F){let Y=0,G=0,q=0,m;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,q=this._parseStack.chunkPos+1;else{if(F===void 0||this._parseStack.state===1)throw this._parseStack.state=1,Error("improper continuation due to previous async handler, giving up parsing");let z=this._parseStack.handlers,C=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(F===!1&&C>-1){for(;C>=0&&(m=z[C](this._params),m!==!0);C--)if(m instanceof Promise)return this._parseStack.handlerPos=C,m}this._parseStack.handlers=[];break;case 4:if(F===!1&&C>-1){for(;C>=0&&(m=z[C](),m!==!0);C--)if(m instanceof Promise)return this._parseStack.handlerPos=C,m}this._parseStack.handlers=[];break;case 6:if(Y=x[this._parseStack.chunkPos],m=this._dcsParser.unhook(Y!==24&&Y!==26,F),m)return m;Y===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(Y=x[this._parseStack.chunkPos],m=this._oscParser.end(Y!==24&&Y!==26,F),m)return m;Y===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break}this._parseStack.state=0,q=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=this._parseStack.transition&15}for(let z=q;z<H;++z){switch(Y=x[z],G=this._transitions.table[this.currentState<<8|(Y<160?Y:V0)],G>>4){case 2:for(let Z=z+1;;++Z){if(Z>=H||(Y=x[Z])<32||Y>126&&Y<V0){this._printHandler(x,z,Z),z=Z-1;break}if(++Z>=H||(Y=x[Z])<32||Y>126&&Y<V0){this._printHandler(x,z,Z),z=Z-1;break}if(++Z>=H||(Y=x[Z])<32||Y>126&&Y<V0){this._printHandler(x,z,Z),z=Z-1;break}if(++Z>=H||(Y=x[Z])<32||Y>126&&Y<V0){this._printHandler(x,z,Z),z=Z-1;break}}break;case 3:this._executeHandlers[Y]?this._executeHandlers[Y]():this._executeHandlerFb(Y),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:z,code:Y,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let C=this._csiHandlers[this._collect<<8|Y],R=C?C.length-1:-1;for(;R>=0&&(m=C[R](this._params),m!==!0);R--)if(m instanceof Promise)return this._preserveStack(3,C,R,G,z),m;R<0&&this._csiHandlerFb(this._collect<<8|Y,this._params),this.precedingJoinState=0;break;case 8:do switch(Y){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(Y-48)}while(++z<H&&(Y=x[z])>47&&Y<60);z--;break;case 9:this._collect<<=8,this._collect|=Y;break;case 10:let M=this._escHandlers[this._collect<<8|Y],N=M?M.length-1:-1;for(;N>=0&&(m=M[N](),m!==!0);N--)if(m instanceof Promise)return this._preserveStack(4,M,N,G,z),m;N<0&&this._escHandlerFb(this._collect<<8|Y),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|Y,this._params);break;case 13:for(let Z=z+1;;++Z)if(Z>=H||(Y=x[Z])===24||Y===26||Y===27||Y>127&&Y<V0){this._dcsParser.put(x,z,Z),z=Z-1;break}break;case 14:if(m=this._dcsParser.unhook(Y!==24&&Y!==26),m)return this._preserveStack(6,[],0,G,z),m;Y===27&&(G|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let Z=z+1;;Z++)if(Z>=H||(Y=x[Z])<32||Y>127&&Y<V0){this._oscParser.put(x,z,Z),z=Z-1;break}break;case 6:if(m=this._oscParser.end(Y!==24&&Y!==26),m)return this._preserveStack(5,[],0,G,z),m;Y===27&&(G|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break}this.currentState=G&15}}},V4=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,W4=/^[\da-f]+$/;function q6(x){if(!x)return;let H=x.toLowerCase();if(H.indexOf("rgb:")===0){H=H.slice(4);let F=V4.exec(H);if(F){let Y=F[1]?15:F[4]?255:F[7]?4095:65535;return[Math.round(parseInt(F[1]||F[4]||F[7]||F[10],16)/Y*255),Math.round(parseInt(F[2]||F[5]||F[8]||F[11],16)/Y*255),Math.round(parseInt(F[3]||F[6]||F[9]||F[12],16)/Y*255)]}}else if(H.indexOf("#")===0&&(H=H.slice(1),W4.exec(H)&&[3,6,9,12].includes(H.length))){let F=H.length/3,Y=[0,0,0];for(let G=0;G<3;++G){let q=parseInt(H.slice(F*G,F*G+F),16);Y[G]=F===1?q<<4:F===2?q:F===3?q>>4:q>>8}return Y}}function k1(x,H){let F=x.toString(16),Y=F.length<2?"0"+F:F;switch(H){case 4:return F[0];case 8:return Y;case 12:return(Y+Y).slice(0,3);default:return Y+Y}}function X4(x,H=16){let[F,Y,G]=x;return`rgb:${k1(F,H)}/${k1(Y,H)}/${k1(G,H)}`}var U4={"(":0,")":1,"*":2,"+":3,"-":1,".":2},g0=131072,m6=10;function R6(x,H){if(x>24)return H.setWinLines||!1;switch(x){case 1:return!!H.restoreWin;case 2:return!!H.minimizeWin;case 3:return!!H.setWinPosition;case 4:return!!H.setWinSizePixels;case 5:return!!H.raiseWin;case 6:return!!H.lowerWin;case 7:return!!H.refreshWin;case 8:return!!H.setWinSizeChars;case 9:return!!H.maximizeWin;case 10:return!!H.fullscreenWin;case 11:return!!H.getWinState;case 13:return!!H.getWinPosition;case 14:return!!H.getWinSizePixels;case 15:return!!H.getScreenSizePixels;case 16:return!!H.getCellSizePixels;case 18:return!!H.getWinSizeChars;case 19:return!!H.getScreenSizeChars;case 20:return!!H.getIconTitle;case 21:return!!H.getWinTitle;case 22:return!!H.pushTitle;case 23:return!!H.popTitle;case 24:return!!H.setWinLines}return!1}var z6=5000,C6=0,K4=class extends y{constructor(x,H,F,Y,G,q,m,z,C=new J4){super();this._bufferService=x,this._charsetService=H,this._coreService=F,this._logService=Y,this._optionsService=G,this._oscLinkService=q,this._coreMouseService=m,this._unicodeService=z,this._parser=C,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new j3,this._utf8Decoder=new Z3,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=l.clone(),this._eraseAttrDataInternal=l.clone(),this._onRequestBell=this._register(new W),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this._register(new W),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this._register(new W),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this._register(new W),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this._register(new W),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this._register(new W),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this._register(new W),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this._register(new W),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this._register(new W),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this._register(new W),this.onLineFeed=this._onLineFeed.event,this._onScroll=this._register(new W),this.onScroll=this._onScroll.event,this._onTitleChange=this._register(new W),this.onTitleChange=this._onTitleChange.event,this._onColor=this._register(new W),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this._register(this._parser),this._dirtyRowTracker=new x9(this._bufferService),this._activeBuffer=this._bufferService.buffer,this._register(this._bufferService.buffers.onBufferActivate((R)=>this._activeBuffer=R.activeBuffer)),this._parser.setCsiHandlerFallback((R,M)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(R),params:M.toArray()})}),this._parser.setEscHandlerFallback((R)=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(R)})}),this._parser.setExecuteHandlerFallback((R)=>{this._logService.debug("Unknown EXECUTE code: ",{code:R})}),this._parser.setOscHandlerFallback((R,M,N)=>{this._logService.debug("Unknown OSC code: ",{identifier:R,action:M,data:N})}),this._parser.setDcsHandlerFallback((R,M,N)=>{M==="HOOK"&&(N=N.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(R),action:M,payload:N})}),this._parser.setPrintHandler((R,M,N)=>this.print(R,M,N)),this._parser.registerCsiHandler({final:"@"},(R)=>this.insertChars(R)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},(R)=>this.scrollLeft(R)),this._parser.registerCsiHandler({final:"A"},(R)=>this.cursorUp(R)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},(R)=>this.scrollRight(R)),this._parser.registerCsiHandler({final:"B"},(R)=>this.cursorDown(R)),this._parser.registerCsiHandler({final:"C"},(R)=>this.cursorForward(R)),this._parser.registerCsiHandler({final:"D"},(R)=>this.cursorBackward(R)),this._parser.registerCsiHandler({final:"E"},(R)=>this.cursorNextLine(R)),this._parser.registerCsiHandler({final:"F"},(R)=>this.cursorPrecedingLine(R)),this._parser.registerCsiHandler({final:"G"},(R)=>this.cursorCharAbsolute(R)),this._parser.registerCsiHandler({final:"H"},(R)=>this.cursorPosition(R)),this._parser.registerCsiHandler({final:"I"},(R)=>this.cursorForwardTab(R)),this._parser.registerCsiHandler({final:"J"},(R)=>this.eraseInDisplay(R,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},(R)=>this.eraseInDisplay(R,!0)),this._parser.registerCsiHandler({final:"K"},(R)=>this.eraseInLine(R,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},(R)=>this.eraseInLine(R,!0)),this._parser.registerCsiHandler({final:"L"},(R)=>this.insertLines(R)),this._parser.registerCsiHandler({final:"M"},(R)=>this.deleteLines(R)),this._parser.registerCsiHandler({final:"P"},(R)=>this.deleteChars(R)),this._parser.registerCsiHandler({final:"S"},(R)=>this.scrollUp(R)),this._parser.registerCsiHandler({final:"T"},(R)=>this.scrollDown(R)),this._parser.registerCsiHandler({final:"X"},(R)=>this.eraseChars(R)),this._parser.registerCsiHandler({final:"Z"},(R)=>this.cursorBackwardTab(R)),this._parser.registerCsiHandler({final:"`"},(R)=>this.charPosAbsolute(R)),this._parser.registerCsiHandler({final:"a"},(R)=>this.hPositionRelative(R)),this._parser.registerCsiHandler({final:"b"},(R)=>this.repeatPrecedingCharacter(R)),this._parser.registerCsiHandler({final:"c"},(R)=>this.sendDeviceAttributesPrimary(R)),this._parser.registerCsiHandler({prefix:">",final:"c"},(R)=>this.sendDeviceAttributesSecondary(R)),this._parser.registerCsiHandler({final:"d"},(R)=>this.linePosAbsolute(R)),this._parser.registerCsiHandler({final:"e"},(R)=>this.vPositionRelative(R)),this._parser.registerCsiHandler({final:"f"},(R)=>this.hVPosition(R)),this._parser.registerCsiHandler({final:"g"},(R)=>this.tabClear(R)),this._parser.registerCsiHandler({final:"h"},(R)=>this.setMode(R)),this._parser.registerCsiHandler({prefix:"?",final:"h"},(R)=>this.setModePrivate(R)),this._parser.registerCsiHandler({final:"l"},(R)=>this.resetMode(R)),this._parser.registerCsiHandler({prefix:"?",final:"l"},(R)=>this.resetModePrivate(R)),this._parser.registerCsiHandler({final:"m"},(R)=>this.charAttributes(R)),this._parser.registerCsiHandler({final:"n"},(R)=>this.deviceStatus(R)),this._parser.registerCsiHandler({prefix:"?",final:"n"},(R)=>this.deviceStatusPrivate(R)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},(R)=>this.softReset(R)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},(R)=>this.setCursorStyle(R)),this._parser.registerCsiHandler({final:"r"},(R)=>this.setScrollRegion(R)),this._parser.registerCsiHandler({final:"s"},(R)=>this.saveCursor(R)),this._parser.registerCsiHandler({final:"t"},(R)=>this.windowOptions(R)),this._parser.registerCsiHandler({final:"u"},(R)=>this.restoreCursor(R)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},(R)=>this.insertColumns(R)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},(R)=>this.deleteColumns(R)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},(R)=>this.selectProtected(R)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},(R)=>this.requestMode(R,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},(R)=>this.requestMode(R,!1)),this._parser.setExecuteHandler(J.BEL,()=>this.bell()),this._parser.setExecuteHandler(J.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(J.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(J.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(J.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(J.BS,()=>this.backspace()),this._parser.setExecuteHandler(J.HT,()=>this.tab()),this._parser.setExecuteHandler(J.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(J.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(ox.IND,()=>this.index()),this._parser.setExecuteHandler(ox.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(ox.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new Z0((R)=>(this.setTitle(R),this.setIconName(R),!0))),this._parser.registerOscHandler(1,new Z0((R)=>this.setIconName(R))),this._parser.registerOscHandler(2,new Z0((R)=>this.setTitle(R))),this._parser.registerOscHandler(4,new Z0((R)=>this.setOrReportIndexedColor(R))),this._parser.registerOscHandler(8,new Z0((R)=>this.setHyperlink(R))),this._parser.registerOscHandler(10,new Z0((R)=>this.setOrReportFgColor(R))),this._parser.registerOscHandler(11,new Z0((R)=>this.setOrReportBgColor(R))),this._parser.registerOscHandler(12,new Z0((R)=>this.setOrReportCursorColor(R))),this._parser.registerOscHandler(104,new Z0((R)=>this.restoreIndexedColor(R))),this._parser.registerOscHandler(110,new Z0((R)=>this.restoreFgColor(R))),this._parser.registerOscHandler(111,new Z0((R)=>this.restoreBgColor(R))),this._parser.registerOscHandler(112,new Z0((R)=>this.restoreCursorColor(R))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let R in i)this._parser.registerEscHandler({intermediates:"(",final:R},()=>this.selectCharset("("+R)),this._parser.registerEscHandler({intermediates:")",final:R},()=>this.selectCharset(")"+R)),this._parser.registerEscHandler({intermediates:"*",final:R},()=>this.selectCharset("*"+R)),this._parser.registerEscHandler({intermediates:"+",final:R},()=>this.selectCharset("+"+R)),this._parser.registerEscHandler({intermediates:"-",final:R},()=>this.selectCharset("-"+R)),this._parser.registerEscHandler({intermediates:".",final:R},()=>this.selectCharset("."+R)),this._parser.registerEscHandler({intermediates:"/",final:R},()=>this.selectCharset("/"+R));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler((R)=>(this._logService.error("Parsing error: ",R),R)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new G6((R,M)=>this.requestStatusString(R,M)))}getAttrData(){return this._curAttrData}_preserveStack(x,H,F,Y){this._parseStack.paused=!0,this._parseStack.cursorStartX=x,this._parseStack.cursorStartY=H,this._parseStack.decodedLength=F,this._parseStack.position=Y}_logSlowResolvingAsync(x){this._logService.logLevel<=3&&Promise.race([x,new Promise((H,F)=>setTimeout(()=>F("#SLOW_TIMEOUT"),z6))]).catch((H)=>{if(H!=="#SLOW_TIMEOUT")throw H;console.warn(`async parser handler taking longer than ${z6} ms`)})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(x,H){let F,Y=this._activeBuffer.x,G=this._activeBuffer.y,q=0,m=this._parseStack.paused;if(m){if(F=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,H))return this._logSlowResolvingAsync(F),F;Y=this._parseStack.cursorStartX,G=this._parseStack.cursorStartY,this._parseStack.paused=!1,x.length>g0&&(q=this._parseStack.position+g0)}if(this._logService.logLevel<=1&&this._logService.debug(`parsing data ${typeof x=="string"?` "${x}"`:` "${Array.prototype.map.call(x,(R)=>String.fromCharCode(R)).join("")}"`}`),this._logService.logLevel===0&&this._logService.trace("parsing data (codes)",typeof x=="string"?x.split("").map((R)=>R.charCodeAt(0)):x),this._parseBuffer.length<x.length&&this._parseBuffer.length<g0&&(this._parseBuffer=new Uint32Array(Math.min(x.length,g0))),m||this._dirtyRowTracker.clearRange(),x.length>g0)for(let R=q;R<x.length;R+=g0){let M=R+g0<x.length?R+g0:x.length,N=typeof x=="string"?this._stringDecoder.decode(x.substring(R,M),this._parseBuffer):this._utf8Decoder.decode(x.subarray(R,M),this._parseBuffer);if(F=this._parser.parse(this._parseBuffer,N))return this._preserveStack(Y,G,N,R),this._logSlowResolvingAsync(F),F}else if(!m){let R=typeof x=="string"?this._stringDecoder.decode(x,this._parseBuffer):this._utf8Decoder.decode(x,this._parseBuffer);if(F=this._parser.parse(this._parseBuffer,R))return this._preserveStack(Y,G,R,0),this._logSlowResolvingAsync(F),F}(this._activeBuffer.x!==Y||this._activeBuffer.y!==G)&&this._onCursorMove.fire();let z=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),C=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);C<this._bufferService.rows&&this._onRequestRefreshRows.fire({start:Math.min(C,this._bufferService.rows-1),end:Math.min(z,this._bufferService.rows-1)})}print(x,H,F){let Y,G,q=this._charsetService.charset,m=this._optionsService.rawOptions.screenReaderMode,z=this._bufferService.cols,C=this._coreService.decPrivateModes.wraparound,R=this._coreService.modes.insertMode,M=this._curAttrData,N=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&F-H>0&&N.getWidth(this._activeBuffer.x-1)===2&&N.setCellFromCodepoint(this._activeBuffer.x-1,0,1,M);let Z=this._parser.precedingJoinState;for(let $=H;$<F;++$){if(Y=x[$],Y<127&&q){let L=q[String.fromCharCode(Y)];L&&(Y=L.charCodeAt(0))}let j=this._unicodeService.charProperties(Y,Z);G=r0.extractWidth(j);let A=r0.extractShouldJoin(j),O=A?r0.extractWidth(Z):0;if(Z=j,m&&this._onA11yChar.fire(u0(Y)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+G-O>z){if(C){let L=N,E=this._activeBuffer.x-O;for(this._activeBuffer.x=O,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),N=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),O>0&&N instanceof Kx&&N.copyCellsFrom(L,E,0,O,!1);E<z;)L.setCellFromCodepoint(E++,0,1,M)}else if(this._activeBuffer.x=z-1,G===2)continue}if(A&&this._activeBuffer.x){let L=N.getWidth(this._activeBuffer.x-1)?1:2;N.addCodepointToCell(this._activeBuffer.x-L,Y,G);for(let E=G-O;--E>=0;)N.setCellFromCodepoint(this._activeBuffer.x++,0,0,M);continue}if(R&&(N.insertCells(this._activeBuffer.x,G-O,this._activeBuffer.getNullCell(M)),N.getWidth(z-1)===2&&N.setCellFromCodepoint(z-1,0,1,M)),N.setCellFromCodepoint(this._activeBuffer.x++,Y,G,M),G>0)for(;--G;)N.setCellFromCodepoint(this._activeBuffer.x++,0,0,M)}this._parser.precedingJoinState=Z,this._activeBuffer.x<z&&F-H>0&&N.getWidth(this._activeBuffer.x)===0&&!N.hasContent(this._activeBuffer.x)&&N.setCellFromCodepoint(this._activeBuffer.x,0,1,M),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(x,H){return x.final==="t"&&!x.prefix&&!x.intermediates?this._parser.registerCsiHandler(x,(F)=>R6(F.params[0],this._optionsService.rawOptions.windowOptions)?H(F):!0):this._parser.registerCsiHandler(x,H)}registerDcsHandler(x,H){return this._parser.registerDcsHandler(x,new G6(H))}registerEscHandler(x,H){return this._parser.registerEscHandler(x,H)}registerOscHandler(x,H){return this._parser.registerOscHandler(x,new Z0(H))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let x=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);x.hasWidth(this._activeBuffer.x)&&!x.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let x=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-x),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(x=this._bufferService.cols-1){this._activeBuffer.x=Math.min(x,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(x,H){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=x,this._activeBuffer.y=this._activeBuffer.scrollTop+H):(this._activeBuffer.x=x,this._activeBuffer.y=H),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(x,H){this._restrictCursor(),this._setCursor(this._activeBuffer.x+x,this._activeBuffer.y+H)}cursorUp(x){let H=this._activeBuffer.y-this._activeBuffer.scrollTop;return H>=0?this._moveCursor(0,-Math.min(H,x.params[0]||1)):this._moveCursor(0,-(x.params[0]||1)),!0}cursorDown(x){let H=this._activeBuffer.scrollBottom-this._activeBuffer.y;return H>=0?this._moveCursor(0,Math.min(H,x.params[0]||1)):this._moveCursor(0,x.params[0]||1),!0}cursorForward(x){return this._moveCursor(x.params[0]||1,0),!0}cursorBackward(x){return this._moveCursor(-(x.params[0]||1),0),!0}cursorNextLine(x){return this.cursorDown(x),this._activeBuffer.x=0,!0}cursorPrecedingLine(x){return this.cursorUp(x),this._activeBuffer.x=0,!0}cursorCharAbsolute(x){return this._setCursor((x.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(x){return this._setCursor(x.length>=2?(x.params[1]||1)-1:0,(x.params[0]||1)-1),!0}charPosAbsolute(x){return this._setCursor((x.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(x){return this._moveCursor(x.params[0]||1,0),!0}linePosAbsolute(x){return this._setCursor(this._activeBuffer.x,(x.params[0]||1)-1),!0}vPositionRelative(x){return this._moveCursor(0,x.params[0]||1),!0}hVPosition(x){return this.cursorPosition(x),!0}tabClear(x){let H=x.params[0];return H===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:H===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(x){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let H=x.params[0]||1;for(;H--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(x){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let H=x.params[0]||1;for(;H--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(x){let H=x.params[0];return H===1&&(this._curAttrData.bg|=536870912),(H===2||H===0)&&(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(x,H,F,Y=!1,G=!1){let q=this._activeBuffer.lines.get(this._activeBuffer.ybase+x);q.replaceCells(H,F,this._activeBuffer.getNullCell(this._eraseAttrData()),G),Y&&(q.isWrapped=!1)}_resetBufferLine(x,H=!1){let F=this._activeBuffer.lines.get(this._activeBuffer.ybase+x);F&&(F.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),H),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+x),F.isWrapped=!1)}eraseInDisplay(x,H=!1){this._restrictCursor(this._bufferService.cols);let F;switch(x.params[0]){case 0:for(F=this._activeBuffer.y,this._dirtyRowTracker.markDirty(F),this._eraseInBufferLine(F++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,H);F<this._bufferService.rows;F++)this._resetBufferLine(F,H);this._dirtyRowTracker.markDirty(F);break;case 1:for(F=this._activeBuffer.y,this._dirtyRowTracker.markDirty(F),this._eraseInBufferLine(F,0,this._activeBuffer.x+1,!0,H),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(F+1).isWrapped=!1);F--;)this._resetBufferLine(F,H);this._dirtyRowTracker.markDirty(0);break;case 2:if(this._optionsService.rawOptions.scrollOnEraseInDisplay){for(F=this._bufferService.rows,this._dirtyRowTracker.markRangeDirty(0,F-1);F--&&!this._activeBuffer.lines.get(this._activeBuffer.ybase+F)?.getTrimmedLength(););for(;F>=0;F--)this._bufferService.scroll(this._eraseAttrData())}else{for(F=this._bufferService.rows,this._dirtyRowTracker.markDirty(F-1);F--;)this._resetBufferLine(F,H);this._dirtyRowTracker.markDirty(0)}break;case 3:let Y=this._activeBuffer.lines.length-this._bufferService.rows;Y>0&&(this._activeBuffer.lines.trimStart(Y),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-Y,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-Y,0),this._onScroll.fire(0));break}return!0}eraseInLine(x,H=!1){switch(this._restrictCursor(this._bufferService.cols),x.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,H);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,H);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,H);break}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(x){this._restrictCursor();let H=x.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let F=this._activeBuffer.ybase+this._activeBuffer.y,Y=this._bufferService.rows-1-this._activeBuffer.scrollBottom,G=this._bufferService.rows-1+this._activeBuffer.ybase-Y+1;for(;H--;)this._activeBuffer.lines.splice(G-1,1),this._activeBuffer.lines.splice(F,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(x){this._restrictCursor();let H=x.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let F=this._activeBuffer.ybase+this._activeBuffer.y,Y;for(Y=this._bufferService.rows-1-this._activeBuffer.scrollBottom,Y=this._bufferService.rows-1+this._activeBuffer.ybase-Y;H--;)this._activeBuffer.lines.splice(F,1),this._activeBuffer.lines.splice(Y,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(x){this._restrictCursor();let H=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return H&&(H.insertCells(this._activeBuffer.x,x.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(x){this._restrictCursor();let H=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return H&&(H.deleteCells(this._activeBuffer.x,x.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(x){let H=x.params[0]||1;for(;H--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(x){let H=x.params[0]||1;for(;H--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(l));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(x){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let H=x.params[0]||1;for(let F=this._activeBuffer.scrollTop;F<=this._activeBuffer.scrollBottom;++F){let Y=this._activeBuffer.lines.get(this._activeBuffer.ybase+F);Y.deleteCells(0,H,this._activeBuffer.getNullCell(this._eraseAttrData())),Y.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(x){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let H=x.params[0]||1;for(let F=this._activeBuffer.scrollTop;F<=this._activeBuffer.scrollBottom;++F){let Y=this._activeBuffer.lines.get(this._activeBuffer.ybase+F);Y.insertCells(0,H,this._activeBuffer.getNullCell(this._eraseAttrData())),Y.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(x){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let H=x.params[0]||1;for(let F=this._activeBuffer.scrollTop;F<=this._activeBuffer.scrollBottom;++F){let Y=this._activeBuffer.lines.get(this._activeBuffer.ybase+F);Y.insertCells(this._activeBuffer.x,H,this._activeBuffer.getNullCell(this._eraseAttrData())),Y.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(x){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let H=x.params[0]||1;for(let F=this._activeBuffer.scrollTop;F<=this._activeBuffer.scrollBottom;++F){let Y=this._activeBuffer.lines.get(this._activeBuffer.ybase+F);Y.deleteCells(this._activeBuffer.x,H,this._activeBuffer.getNullCell(this._eraseAttrData())),Y.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(x){this._restrictCursor();let H=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return H&&(H.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(x.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(x){let H=this._parser.precedingJoinState;if(!H)return!0;let F=x.params[0]||1,Y=r0.extractWidth(H),G=this._activeBuffer.x-Y,q=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(G),m=new Uint32Array(q.length*F),z=0;for(let R=0;R<q.length;){let M=q.codePointAt(R)||0;m[z++]=M,R+=M>65535?2:1}let C=z;for(let R=1;R<F;++R)m.copyWithin(C,0,z),C+=z;return this.print(m,0,C),!0}sendDeviceAttributesPrimary(x){return x.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(J.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(J.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(x){return x.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(J.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(J.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(x.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(J.ESC+"[>83;40003;0c")),!0}_is(x){return(this._optionsService.rawOptions.termName+"").indexOf(x)===0}setMode(x){for(let H=0;H<x.length;H++)switch(x.params[H]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0;break}return!0}setModePrivate(x){for(let H=0;H<x.length;H++)switch(x.params[H]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,s0),this._charsetService.setgCharset(1,s0),this._charsetService.setgCharset(2,s0),this._charsetService.setgCharset(3,s0);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1000:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!0;break}return!0}resetMode(x){for(let H=0;H<x.length;H++)switch(x.params[H]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1;break}return!0}resetModePrivate(x){for(let H=0;H<x.length;H++)switch(x.params[H]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1000:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),x.params[H]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!1,this._onRequestRefreshRows.fire(void 0);break}return!0}requestMode(x,H){let F;((A)=>(A[A.NOT_RECOGNIZED=0]="NOT_RECOGNIZED",A[A.SET=1]="SET",A[A.RESET=2]="RESET",A[A.PERMANENTLY_SET=3]="PERMANENTLY_SET",A[A.PERMANENTLY_RESET=4]="PERMANENTLY_RESET"))(F||={});let Y=this._coreService.decPrivateModes,{activeProtocol:G,activeEncoding:q}=this._coreMouseService,m=this._coreService,{buffers:z,cols:C}=this._bufferService,{active:R,alt:M}=z,N=this._optionsService.rawOptions,Z=(A,O)=>(m.triggerDataEvent(`${J.ESC}[${H?"":"?"}${A};${O}$y`),!0),$=(A)=>A?1:2,j=x.params[0];return H?j===2?Z(j,4):j===4?Z(j,$(m.modes.insertMode)):j===12?Z(j,3):j===20?Z(j,$(N.convertEol)):Z(j,0):j===1?Z(j,$(Y.applicationCursorKeys)):j===3?Z(j,N.windowOptions.setWinLines?C===80?2:C===132?1:0:0):j===6?Z(j,$(Y.origin)):j===7?Z(j,$(Y.wraparound)):j===8?Z(j,3):j===9?Z(j,$(G==="X10")):j===12?Z(j,$(N.cursorBlink)):j===25?Z(j,$(!m.isCursorHidden)):j===45?Z(j,$(Y.reverseWraparound)):j===66?Z(j,$(Y.applicationKeypad)):j===67?Z(j,4):j===1000?Z(j,$(G==="VT200")):j===1002?Z(j,$(G==="DRAG")):j===1003?Z(j,$(G==="ANY")):j===1004?Z(j,$(Y.sendFocus)):j===1005?Z(j,4):j===1006?Z(j,$(q==="SGR")):j===1015?Z(j,4):j===1016?Z(j,$(q==="SGR_PIXELS")):j===1048?Z(j,1):j===47||j===1047||j===1049?Z(j,$(R===M)):j===2004?Z(j,$(Y.bracketedPasteMode)):j===2026?Z(j,$(Y.synchronizedOutput)):Z(j,0)}_updateAttrColor(x,H,F,Y,G){return H===2?(x|=50331648,x&=-16777216,x|=wx.fromColorRGB([F,Y,G])):H===5&&(x&=-50331904,x|=33554432|F&255),x}_extractColor(x,H,F){let Y=[0,0,-1,0,0,0],G=0,q=0;do{if(Y[q+G]=x.params[H+q],x.hasSubParams(H+q)){let m=x.getSubParams(H+q),z=0;do Y[1]===5&&(G=1),Y[q+z+1+G]=m[z];while(++z<m.length&&z+q+1+G<Y.length);break}if(Y[1]===5&&q+G>=2||Y[1]===2&&q+G>=5)break;Y[1]&&(G=1)}while(++q+H<x.length&&q+G<Y.length);for(let m=2;m<Y.length;++m)Y[m]===-1&&(Y[m]=0);switch(Y[0]){case 38:F.fg=this._updateAttrColor(F.fg,Y[1],Y[3],Y[4],Y[5]);break;case 48:F.bg=this._updateAttrColor(F.bg,Y[1],Y[3],Y[4],Y[5]);break;case 58:F.extended=F.extended.clone(),F.extended.underlineColor=this._updateAttrColor(F.extended.underlineColor,Y[1],Y[3],Y[4],Y[5])}return q}_processUnderline(x,H){H.extended=H.extended.clone(),(!~x||x>5)&&(x=1),H.extended.underlineStyle=x,H.fg|=268435456,x===0&&(H.fg&=-268435457),H.updateExtended()}_processSGR0(x){x.fg=l.fg,x.bg=l.bg,x.extended=x.extended.clone(),x.extended.underlineStyle=0,x.extended.underlineColor&=-67108864,x.updateExtended()}charAttributes(x){if(x.length===1&&x.params[0]===0)return this._processSGR0(this._curAttrData),!0;let H=x.length,F,Y=this._curAttrData;for(let G=0;G<H;G++)F=x.params[G],F>=30&&F<=37?(Y.fg&=-50331904,Y.fg|=16777216|F-30):F>=40&&F<=47?(Y.bg&=-50331904,Y.bg|=16777216|F-40):F>=90&&F<=97?(Y.fg&=-50331904,Y.fg|=16777216|F-90|8):F>=100&&F<=107?(Y.bg&=-50331904,Y.bg|=16777216|F-100|8):F===0?this._processSGR0(Y):F===1?Y.fg|=134217728:F===3?Y.bg|=67108864:F===4?(Y.fg|=268435456,this._processUnderline(x.hasSubParams(G)?x.getSubParams(G)[0]:1,Y)):F===5?Y.fg|=536870912:F===7?Y.fg|=67108864:F===8?Y.fg|=1073741824:F===9?Y.fg|=2147483648:F===2?Y.bg|=134217728:F===21?this._processUnderline(2,Y):F===22?(Y.fg&=-134217729,Y.bg&=-134217729):F===23?Y.bg&=-67108865:F===24?(Y.fg&=-268435457,this._processUnderline(0,Y)):F===25?Y.fg&=-536870913:F===27?Y.fg&=-67108865:F===28?Y.fg&=-1073741825:F===29?Y.fg&=2147483647:F===39?(Y.fg&=-67108864,Y.fg|=l.fg&16777215):F===49?(Y.bg&=-67108864,Y.bg|=l.bg&16777215):F===38||F===48||F===58?G+=this._extractColor(x,G,Y):F===53?Y.bg|=1073741824:F===55?Y.bg&=-1073741825:F===59?(Y.extended=Y.extended.clone(),Y.extended.underlineColor=-1,Y.updateExtended()):F===100?(Y.fg&=-67108864,Y.fg|=l.fg&16777215,Y.bg&=-67108864,Y.bg|=l.bg&16777215):this._logService.debug("Unknown SGR attribute: %d.",F);return!0}deviceStatus(x){switch(x.params[0]){case 5:this._coreService.triggerDataEvent(`${J.ESC}[0n`);break;case 6:let H=this._activeBuffer.y+1,F=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${J.ESC}[${H};${F}R`);break}return!0}deviceStatusPrivate(x){switch(x.params[0]){case 6:let H=this._activeBuffer.y+1,F=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${J.ESC}[?${H};${F}R`);break;case 15:break;case 25:break;case 26:break;case 53:break}return!0}softReset(x){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=l.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(x){let H=x.length===0?1:x.params[0];if(H===0)this._coreService.decPrivateModes.cursorStyle=void 0,this._coreService.decPrivateModes.cursorBlink=void 0;else{switch(H){case 1:case 2:this._coreService.decPrivateModes.cursorStyle="block";break;case 3:case 4:this._coreService.decPrivateModes.cursorStyle="underline";break;case 5:case 6:this._coreService.decPrivateModes.cursorStyle="bar";break}let F=H%2===1;this._coreService.decPrivateModes.cursorBlink=F}return!0}setScrollRegion(x){let H=x.params[0]||1,F;return(x.length<2||(F=x.params[1])>this._bufferService.rows||F===0)&&(F=this._bufferService.rows),F>H&&(this._activeBuffer.scrollTop=H-1,this._activeBuffer.scrollBottom=F-1,this._setCursor(0,0)),!0}windowOptions(x){if(!R6(x.params[0],this._optionsService.rawOptions.windowOptions))return!0;let H=x.length>1?x.params[1]:0;switch(x.params[0]){case 14:H!==2&&this._onRequestWindowsOptionsReport.fire(0);break;case 16:this._onRequestWindowsOptionsReport.fire(1);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${J.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:(H===0||H===2)&&(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>m6&&this._windowTitleStack.shift()),(H===0||H===1)&&(this._iconNameStack.push(this._iconName),this._iconNameStack.length>m6&&this._iconNameStack.shift());break;case 23:(H===0||H===2)&&this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),(H===0||H===1)&&this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop());break}return!0}saveCursor(x){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(x){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(x){return this._windowTitle=x,this._onTitleChange.fire(x),!0}setIconName(x){return this._iconName=x,!0}setOrReportIndexedColor(x){let H=[],F=x.split(";");for(;F.length>1;){let Y=F.shift(),G=F.shift();if(/^\d+$/.exec(Y)){let q=parseInt(Y);if(N6(q))if(G==="?")H.push({type:0,index:q});else{let m=q6(G);m&&H.push({type:1,index:q,color:m})}}}return H.length&&this._onColor.fire(H),!0}setHyperlink(x){let H=x.indexOf(";");if(H===-1)return!0;let F=x.slice(0,H).trim(),Y=x.slice(H+1);return Y?this._createHyperlink(F,Y):F.trim()?!1:this._finishHyperlink()}_createHyperlink(x,H){this._getCurrentLinkId()&&this._finishHyperlink();let F=x.split(":"),Y,G=F.findIndex((q)=>q.startsWith("id="));return G!==-1&&(Y=F[G].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:Y,uri:H}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(x,H){let F=x.split(";");for(let Y=0;Y<F.length&&!(H>=this._specialColors.length);++Y,++H)if(F[Y]==="?")this._onColor.fire([{type:0,index:this._specialColors[H]}]);else{let G=q6(F[Y]);G&&this._onColor.fire([{type:1,index:this._specialColors[H],color:G}])}return!0}setOrReportFgColor(x){return this._setOrReportSpecialColor(x,0)}setOrReportBgColor(x){return this._setOrReportSpecialColor(x,1)}setOrReportCursorColor(x){return this._setOrReportSpecialColor(x,2)}restoreIndexedColor(x){if(!x)return this._onColor.fire([{type:2}]),!0;let H=[],F=x.split(";");for(let Y=0;Y<F.length;++Y)if(/^\d+$/.exec(F[Y])){let G=parseInt(F[Y]);N6(G)&&H.push({type:2,index:G})}return H.length&&this._onColor.fire(H),!0}restoreFgColor(x){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(x){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(x){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,s0),!0}selectCharset(x){return x.length!==2?(this.selectDefaultCharset(),!0):(x[0]==="/"||this._charsetService.setgCharset(U4[x[0]],i[x[1]]||s0),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let x=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,x,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=l.clone(),this._eraseAttrDataInternal=l.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=this._curAttrData.bg&67108863,this._eraseAttrDataInternal}setgLevel(x){return this._charsetService.setgLevel(x),!0}screenAlignmentPattern(){let x=new W0;x.content=4194373,x.fg=this._curAttrData.fg,x.bg=this._curAttrData.bg,this._setCursor(0,0);for(let H=0;H<this._bufferService.rows;++H){let F=this._activeBuffer.ybase+this._activeBuffer.y+H,Y=this._activeBuffer.lines.get(F);Y&&(Y.fill(x),Y.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(x,H){let F=(m)=>(this._coreService.triggerDataEvent(`${J.ESC}${m}${J.ESC}\\`),!0),Y=this._bufferService.buffer,G=this._optionsService.rawOptions;return F(x==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:x==='"p'?'P1$r61;1"p':x==="r"?`P1$r${Y.scrollTop+1};${Y.scrollBottom+1}r`:x==="m"?"P1$r0m":x===" q"?`P1$r${{block:2,underline:4,bar:6}[G.cursorStyle]-(G.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(x,H){this._dirtyRowTracker.markRangeDirty(x,H)}},x9=class{constructor(x){this._bufferService=x,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(x){x<this.start?this.start=x:x>this.end&&(this.end=x)}markRangeDirty(x,H){x>H&&(C6=x,x=H,H=C6),x<this.start&&(this.start=x),H>this.end&&(this.end=H)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};x9=a([K(0,C0)],x9);function N6(x){return 0<=x&&x<256}var B4=50000000,M6=12,O4=50,D4=class extends y{constructor(x){super();this._action=x,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this._register(new W),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(x,H){if(H!==void 0&&this._syncCalls>H){this._syncCalls=0;return}if(this._pendingData+=x.length,this._writeBuffer.push(x),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;this._isSyncWriting=!0;let F;for(;F=this._writeBuffer.shift();){this._action(F);let Y=this._callbacks.shift();Y&&Y()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(x,H){if(this._pendingData>B4)throw Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput){this._didUserInput=!1,this._pendingData+=x.length,this._writeBuffer.push(x),this._callbacks.push(H),this._innerWrite();return}setTimeout(()=>this._innerWrite())}this._pendingData+=x.length,this._writeBuffer.push(x),this._callbacks.push(H)}_innerWrite(x=0,H=!0){let F=x||performance.now();for(;this._writeBuffer.length>this._bufferOffset;){let Y=this._writeBuffer[this._bufferOffset],G=this._action(Y,H);if(G){let m=(z)=>performance.now()-F>=M6?setTimeout(()=>this._innerWrite(0,z)):this._innerWrite(F,z);G.catch((z)=>(queueMicrotask(()=>{throw z}),Promise.resolve(!1))).then(m);return}let q=this._callbacks[this._bufferOffset];if(q&&q(),this._bufferOffset++,this._pendingData-=Y.length,performance.now()-F>=M6)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>O4&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}},H9=class{constructor(x){this._bufferService=x,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(x){let H=this._bufferService.buffer;if(x.id===void 0){let z=H.addMarker(H.ybase+H.y),C={data:x,id:this._nextId++,lines:[z]};return z.onDispose(()=>this._removeMarkerFromLink(C,z)),this._dataByLinkId.set(C.id,C),C.id}let F=x,Y=this._getEntryIdKey(F),G=this._entriesWithId.get(Y);if(G)return this.addLineToLink(G.id,H.ybase+H.y),G.id;let q=H.addMarker(H.ybase+H.y),m={id:this._nextId++,key:this._getEntryIdKey(F),data:F,lines:[q]};return q.onDispose(()=>this._removeMarkerFromLink(m,q)),this._entriesWithId.set(m.key,m),this._dataByLinkId.set(m.id,m),m.id}addLineToLink(x,H){let F=this._dataByLinkId.get(x);if(F&&F.lines.every((Y)=>Y.line!==H)){let Y=this._bufferService.buffer.addMarker(H);F.lines.push(Y),Y.onDispose(()=>this._removeMarkerFromLink(F,Y))}}getLinkData(x){return this._dataByLinkId.get(x)?.data}_getEntryIdKey(x){return`${x.id};;${x.uri}`}_removeMarkerFromLink(x,H){let F=x.lines.indexOf(H);F!==-1&&(x.lines.splice(F,1),x.lines.length===0&&(x.data.id!==void 0&&this._entriesWithId.delete(x.key),this._dataByLinkId.delete(x.id)))}};H9=a([K(0,C0)],H9);var j6=!1,k4=class extends y{constructor(x){super();this._windowsWrappingHeuristics=this._register(new Yx),this._onBinary=this._register(new W),this.onBinary=this._onBinary.event,this._onData=this._register(new W),this.onData=this._onData.event,this._onLineFeed=this._register(new W),this.onLineFeed=this._onLineFeed.event,this._onResize=this._register(new W),this.onResize=this._onResize.event,this._onWriteParsed=this._register(new W),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this._register(new W),this._instantiationService=new n5,this.optionsService=this._register(new q4(x)),this._instantiationService.setService(N0,this.optionsService),this._bufferService=this._register(this._instantiationService.createInstance(i1)),this._instantiationService.setService(C0,this._bufferService),this._logService=this._register(this._instantiationService.createInstance(r1)),this._instantiationService.setService(B6,this._logService),this.coreService=this._register(this._instantiationService.createInstance(t1)),this._instantiationService.setService(xx,this.coreService),this.coreMouseService=this._register(this._instantiationService.createInstance(e1)),this._instantiationService.setService(K6,this.coreMouseService),this.unicodeService=this._register(this._instantiationService.createInstance(r0)),this._instantiationService.setService(V3,this.unicodeService),this._charsetService=this._instantiationService.createInstance(N4),this._instantiationService.setService(J3,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(H9),this._instantiationService.setService(O6,this._oscLinkService),this._inputHandler=this._register(new K4(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this._register(m0.forward(this._inputHandler.onLineFeed,this._onLineFeed)),this._register(this._inputHandler),this._register(m0.forward(this._bufferService.onResize,this._onResize)),this._register(m0.forward(this.coreService.onData,this._onData)),this._register(m0.forward(this.coreService.onBinary,this._onBinary)),this._register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom(!0))),this._register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this._register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this._register(this._bufferService.onScroll(()=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this._register(new D4((H,F)=>this._inputHandler.parse(H,F))),this._register(m0.forward(this._writeBuffer.onWriteParsed,this._onWriteParsed))}get onScroll(){return this._onScrollApi||(this._onScrollApi=this._register(new W),this._onScroll.event((x)=>{this._onScrollApi?.fire(x.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(x){for(let H in x)this.optionsService.options[H]=x[H]}write(x,H){this._writeBuffer.write(x,H)}writeSync(x,H){this._logService.logLevel<=3&&!j6&&(this._logService.warn("writeSync is unreliable and will be removed soon."),j6=!0),this._writeBuffer.writeSync(x,H)}input(x,H=!0){this.coreService.triggerDataEvent(x,H)}resize(x,H){isNaN(x)||isNaN(H)||(x=Math.max(x,e6),H=Math.max(H,x3),this._bufferService.resize(x,H))}scroll(x,H=!1){this._bufferService.scroll(x,H)}scrollLines(x,H){this._bufferService.scrollLines(x,H)}scrollPages(x){this.scrollLines(x*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(x){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(x){let H=x-this._bufferService.buffer.ydisp;H!==0&&this.scrollLines(H)}registerEscHandler(x,H){return this._inputHandler.registerEscHandler(x,H)}registerDcsHandler(x,H){return this._inputHandler.registerDcsHandler(x,H)}registerCsiHandler(x,H){return this._inputHandler.registerCsiHandler(x,H)}registerOscHandler(x,H){return this._inputHandler.registerOscHandler(x,H)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let x=!1,H=this.optionsService.rawOptions.windowsPty;H&&H.buildNumber!==void 0&&H.buildNumber!==void 0?x=H.backend==="conpty"&&H.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(x=!0),x?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let x=[];x.push(this.onLineFeed(Y6.bind(null,this._bufferService))),x.push(this.registerCsiHandler({final:"H"},()=>(Y6(this._bufferService),!1))),this._windowsWrappingHeuristics.value=f(()=>{for(let H of x)H.dispose()})}}},p4={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};function L4(x,H,F,Y){let G={type:0,cancel:!1,key:void 0},q=(x.shiftKey?1:0)|(x.altKey?2:0)|(x.ctrlKey?4:0)|(x.metaKey?8:0);switch(x.keyCode){case 0:x.key==="UIKeyInputUpArrow"?H?G.key=J.ESC+"OA":G.key=J.ESC+"[A":x.key==="UIKeyInputLeftArrow"?H?G.key=J.ESC+"OD":G.key=J.ESC+"[D":x.key==="UIKeyInputRightArrow"?H?G.key=J.ESC+"OC":G.key=J.ESC+"[C":x.key==="UIKeyInputDownArrow"&&(H?G.key=J.ESC+"OB":G.key=J.ESC+"[B");break;case 8:G.key=x.ctrlKey?"\b":J.DEL,x.altKey&&(G.key=J.ESC+G.key);break;case 9:if(x.shiftKey){G.key=J.ESC+"[Z";break}G.key=J.HT,G.cancel=!0;break;case 13:G.key=x.altKey?J.ESC+J.CR:J.CR,G.cancel=!0;break;case 27:G.key=J.ESC,x.altKey&&(G.key=J.ESC+J.ESC),G.cancel=!0;break;case 37:if(x.metaKey)break;q?G.key=J.ESC+"[1;"+(q+1)+"D":H?G.key=J.ESC+"OD":G.key=J.ESC+"[D";break;case 39:if(x.metaKey)break;q?G.key=J.ESC+"[1;"+(q+1)+"C":H?G.key=J.ESC+"OC":G.key=J.ESC+"[C";break;case 38:if(x.metaKey)break;q?G.key=J.ESC+"[1;"+(q+1)+"A":H?G.key=J.ESC+"OA":G.key=J.ESC+"[A";break;case 40:if(x.metaKey)break;q?G.key=J.ESC+"[1;"+(q+1)+"B":H?G.key=J.ESC+"OB":G.key=J.ESC+"[B";break;case 45:!x.shiftKey&&!x.ctrlKey&&(G.key=J.ESC+"[2~");break;case 46:q?G.key=J.ESC+"[3;"+(q+1)+"~":G.key=J.ESC+"[3~";break;case 36:q?G.key=J.ESC+"[1;"+(q+1)+"H":H?G.key=J.ESC+"OH":G.key=J.ESC+"[H";break;case 35:q?G.key=J.ESC+"[1;"+(q+1)+"F":H?G.key=J.ESC+"OF":G.key=J.ESC+"[F";break;case 33:x.shiftKey?G.type=2:x.ctrlKey?G.key=J.ESC+"[5;"+(q+1)+"~":G.key=J.ESC+"[5~";break;case 34:x.shiftKey?G.type=3:x.ctrlKey?G.key=J.ESC+"[6;"+(q+1)+"~":G.key=J.ESC+"[6~";break;case 112:q?G.key=J.ESC+"[1;"+(q+1)+"P":G.key=J.ESC+"OP";break;case 113:q?G.key=J.ESC+"[1;"+(q+1)+"Q":G.key=J.ESC+"OQ";break;case 114:q?G.key=J.ESC+"[1;"+(q+1)+"R":G.key=J.ESC+"OR";break;case 115:q?G.key=J.ESC+"[1;"+(q+1)+"S":G.key=J.ESC+"OS";break;case 116:q?G.key=J.ESC+"[15;"+(q+1)+"~":G.key=J.ESC+"[15~";break;case 117:q?G.key=J.ESC+"[17;"+(q+1)+"~":G.key=J.ESC+"[17~";break;case 118:q?G.key=J.ESC+"[18;"+(q+1)+"~":G.key=J.ESC+"[18~";break;case 119:q?G.key=J.ESC+"[19;"+(q+1)+"~":G.key=J.ESC+"[19~";break;case 120:q?G.key=J.ESC+"[20;"+(q+1)+"~":G.key=J.ESC+"[20~";break;case 121:q?G.key=J.ESC+"[21;"+(q+1)+"~":G.key=J.ESC+"[21~";break;case 122:q?G.key=J.ESC+"[23;"+(q+1)+"~":G.key=J.ESC+"[23~";break;case 123:q?G.key=J.ESC+"[24;"+(q+1)+"~":G.key=J.ESC+"[24~";break;default:if(x.ctrlKey&&!x.shiftKey&&!x.altKey&&!x.metaKey)x.keyCode>=65&&x.keyCode<=90?G.key=String.fromCharCode(x.keyCode-64):x.keyCode===32?G.key=J.NUL:x.keyCode>=51&&x.keyCode<=55?G.key=String.fromCharCode(x.keyCode-51+27):x.keyCode===56?G.key=J.DEL:x.keyCode===219?G.key=J.ESC:x.keyCode===220?G.key=J.FS:x.keyCode===221&&(G.key=J.GS);else if((!F||Y)&&x.altKey&&!x.metaKey){let m=p4[x.keyCode]?.[x.shiftKey?1:0];if(m)G.key=J.ESC+m;else if(x.keyCode>=65&&x.keyCode<=90){let z=x.ctrlKey?x.keyCode-64:x.keyCode+32,C=String.fromCharCode(z);x.shiftKey&&(C=C.toUpperCase()),G.key=J.ESC+C}else if(x.keyCode===32)G.key=J.ESC+(x.ctrlKey?J.NUL:" ");else if(x.key==="Dead"&&x.code.startsWith("Key")){let z=x.code.slice(3,4);x.shiftKey||(z=z.toLowerCase()),G.key=J.ESC+z,G.cancel=!0}}else F&&!x.altKey&&!x.ctrlKey&&!x.shiftKey&&x.metaKey?x.keyCode===65&&(G.type=1):x.key&&!x.ctrlKey&&!x.altKey&&!x.metaKey&&x.keyCode>=48&&x.key.length===1?G.key=x.key:x.key&&x.ctrlKey&&(x.key==="_"&&(G.key=J.US),x.key==="@"&&(G.key=J.NUL));break}return G}var o=0,b4=class{constructor(x){this._getKey=x,this._array=[],this._insertedValues=[],this._flushInsertedTask=new H1,this._isFlushingInserted=!1,this._deletedIndices=[],this._flushDeletedTask=new H1,this._isFlushingDeleted=!1}clear(){this._array.length=0,this._insertedValues.length=0,this._flushInsertedTask.clear(),this._isFlushingInserted=!1,this._deletedIndices.length=0,this._flushDeletedTask.clear(),this._isFlushingDeleted=!1}insert(x){this._flushCleanupDeleted(),this._insertedValues.length===0&&this._flushInsertedTask.enqueue(()=>this._flushInserted()),this._insertedValues.push(x)}_flushInserted(){let x=this._insertedValues.sort((G,q)=>this._getKey(G)-this._getKey(q)),H=0,F=0,Y=Array(this._array.length+this._insertedValues.length);for(let G=0;G<Y.length;G++)F>=this._array.length||this._getKey(x[H])<=this._getKey(this._array[F])?(Y[G]=x[H],H++):Y[G]=this._array[F++];this._array=Y,this._insertedValues.length=0}_flushCleanupInserted(){!this._isFlushingInserted&&this._insertedValues.length>0&&this._flushInsertedTask.flush()}delete(x){if(this._flushCleanupInserted(),this._array.length===0)return!1;let H=this._getKey(x);if(H===void 0||(o=this._search(H),o===-1)||this._getKey(this._array[o])!==H)return!1;do if(this._array[o]===x)return this._deletedIndices.length===0&&this._flushDeletedTask.enqueue(()=>this._flushDeleted()),this._deletedIndices.push(o),!0;while(++o<this._array.length&&this._getKey(this._array[o])===H);return!1}_flushDeleted(){this._isFlushingDeleted=!0;let x=this._deletedIndices.sort((G,q)=>G-q),H=0,F=Array(this._array.length-x.length),Y=0;for(let G=0;G<this._array.length;G++)x[H]===G?H++:F[Y++]=this._array[G];this._array=F,this._deletedIndices.length=0,this._isFlushingDeleted=!1}_flushCleanupDeleted(){!this._isFlushingDeleted&&this._deletedIndices.length>0&&this._flushDeletedTask.flush()}*getKeyIterator(x){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(o=this._search(x),!(o<0||o>=this._array.length)&&this._getKey(this._array[o])===x))do yield this._array[o];while(++o<this._array.length&&this._getKey(this._array[o])===x)}forEachByKey(x,H){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(o=this._search(x),!(o<0||o>=this._array.length)&&this._getKey(this._array[o])===x))do H(this._array[o]);while(++o<this._array.length&&this._getKey(this._array[o])===x)}values(){return this._flushCleanupInserted(),this._flushCleanupDeleted(),[...this._array].values()}_search(x){let H=0,F=this._array.length-1;for(;F>=H;){let Y=H+F>>1,G=this._getKey(this._array[Y]);if(G>x)F=Y-1;else if(G<x)H=Y+1;else{for(;Y>0&&this._getKey(this._array[Y-1])===x;)Y--;return Y}}return H}},p1=0,Z6=0,y4=class extends y{constructor(){super();this._decorations=new b4((x)=>x?.marker.line),this._onDecorationRegistered=this._register(new W),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this._register(new W),this.onDecorationRemoved=this._onDecorationRemoved.event,this._register(f(()=>this.reset()))}get decorations(){return this._decorations.values()}registerDecoration(x){if(x.marker.isDisposed)return;let H=new w4(x);if(H){let F=H.marker.onDispose(()=>H.dispose()),Y=H.onDispose(()=>{Y.dispose(),H&&(this._decorations.delete(H)&&this._onDecorationRemoved.fire(H),F.dispose())});this._decorations.insert(H),this._onDecorationRegistered.fire(H)}return H}reset(){for(let x of this._decorations.values())x.dispose();this._decorations.clear()}*getDecorationsAtCell(x,H,F){let Y=0,G=0;for(let q of this._decorations.getKeyIterator(H))Y=q.options.x??0,G=Y+(q.options.width??1),x>=Y&&x<G&&(!F||(q.options.layer??"bottom")===F)&&(yield q)}forEachDecorationAtCell(x,H,F,Y){this._decorations.forEachByKey(H,(G)=>{p1=G.options.x??0,Z6=p1+(G.options.width??1),x>=p1&&x<Z6&&(!F||(G.options.layer??"bottom")===F)&&Y(G)})}},w4=class extends a0{constructor(x){super();this.options=x,this.onRenderEmitter=this.add(new W),this.onRender=this.onRenderEmitter.event,this._onDispose=this.add(new W),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=x.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=u.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=u.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}dispose(){this._onDispose.fire(),super.dispose()}},T4=1000,P4=class{constructor(x,H=T4){this._renderCallback=x,this._debounceThresholdMS=H,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(x,H,F){this._rowCount=F,x=x!==void 0?x:0,H=H!==void 0?H:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,x):x,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,H):H;let Y=performance.now();if(Y-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=Y,this._innerRefresh();else if(!this._additionalRefreshRequested){let G=Y-this._lastRefreshMs,q=this._debounceThresholdMS-G;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=performance.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},q)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;let x=Math.max(this._rowStart,0),H=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(x,H)}},$6=20,A6=!1,F1=class extends y{constructor(x,H,F,Y){super();this._terminal=x,this._coreBrowserService=F,this._renderService=Y,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="";let G=this._coreBrowserService.mainDocument;this._accessibilityContainer=G.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=G.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let q=0;q<this._terminal.rows;q++)this._rowElements[q]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[q]);if(this._topBoundaryFocusListener=(q)=>this._handleBoundaryFocus(q,0),this._bottomBoundaryFocusListener=(q)=>this._handleBoundaryFocus(q,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=G.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this._register(new P4(this._renderRows.bind(this))),!this._terminal.element)throw Error("Cannot enable accessibility before Terminal.open");A6?(this._accessibilityContainer.classList.add("debug"),this._rowContainer.classList.add("debug"),this._debugRootContainer=G.createElement("div"),this._debugRootContainer.classList.add("xterm"),this._debugRootContainer.appendChild(G.createTextNode("------start a11y------")),this._debugRootContainer.appendChild(this._accessibilityContainer),this._debugRootContainer.appendChild(G.createTextNode("------end a11y------")),this._terminal.element.insertAdjacentElement("afterend",this._debugRootContainer)):this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this._register(this._terminal.onResize((q)=>this._handleResize(q.rows))),this._register(this._terminal.onRender((q)=>this._refreshRows(q.start,q.end))),this._register(this._terminal.onScroll(()=>this._refreshRows())),this._register(this._terminal.onA11yChar((q)=>this._handleChar(q))),this._register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this._register(this._terminal.onA11yTab((q)=>this._handleTab(q))),this._register(this._terminal.onKey((q)=>this._handleKey(q.key))),this._register(this._terminal.onBlur(()=>this._clearLiveRegion())),this._register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._register(b(G,"selectionchange",()=>this._handleSelectionChange())),this._register(this._coreBrowserService.onDprChange(()=>this._refreshRowsDimensions())),this._refreshRowsDimensions(),this._refreshRows(),this._register(f(()=>{A6?this._debugRootContainer.remove():this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(x){for(let H=0;H<x;H++)this._handleChar(" ")}_handleChar(x){this._liveRegionLineCount<$6+1&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==x&&(this._charsToAnnounce+=x):this._charsToAnnounce+=x,x===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===$6+1&&(this._liveRegion.textContent+=b1.get())))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(x){this._clearLiveRegion(),/\p{Control}/u.test(x)||this._charsToConsume.push(x)}_refreshRows(x,H){this._liveRegionDebouncer.refresh(x,H,this._terminal.rows)}_renderRows(x,H){let F=this._terminal.buffer,Y=F.lines.length.toString();for(let G=x;G<=H;G++){let q=F.lines.get(F.ydisp+G),m=[],z=q?.translateToString(!0,void 0,void 0,m)||"",C=(F.ydisp+G+1).toString(),R=this._rowElements[G];R&&(z.length===0?(R.textContent="",this._rowColumns.set(R,[0,1])):(R.textContent=z,this._rowColumns.set(R,m)),R.setAttribute("aria-posinset",C),R.setAttribute("aria-setsize",Y),this._alignRowWidth(R))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(x,H){let F=x.target,Y=this._rowElements[H===0?1:this._rowElements.length-2],G=F.getAttribute("aria-posinset"),q=H===0?"1":`${this._terminal.buffer.lines.length}`;if(G===q||x.relatedTarget!==Y)return;let m,z;if(H===0?(m=F,z=this._rowElements.pop(),this._rowContainer.removeChild(z)):(m=this._rowElements.shift(),z=F,this._rowContainer.removeChild(m)),m.removeEventListener("focus",this._topBoundaryFocusListener),z.removeEventListener("focus",this._bottomBoundaryFocusListener),H===0){let C=this._createAccessibilityTreeNode();this._rowElements.unshift(C),this._rowContainer.insertAdjacentElement("afterbegin",C)}else{let C=this._createAccessibilityTreeNode();this._rowElements.push(C),this._rowContainer.appendChild(C)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(H===0?-1:1),this._rowElements[H===0?1:this._rowElements.length-2].focus(),x.preventDefault(),x.stopImmediatePropagation()}_handleSelectionChange(){if(this._rowElements.length===0)return;let x=this._coreBrowserService.mainDocument.getSelection();if(!x)return;if(x.isCollapsed){this._rowContainer.contains(x.anchorNode)&&this._terminal.clearSelection();return}if(!x.anchorNode||!x.focusNode){console.error("anchorNode and/or focusNode are null");return}let H={node:x.anchorNode,offset:x.anchorOffset},F={node:x.focusNode,offset:x.focusOffset};if((H.node.compareDocumentPosition(F.node)&Node.DOCUMENT_POSITION_PRECEDING||H.node===F.node&&H.offset>F.offset)&&([H,F]=[F,H]),H.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(H={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(H.node))return;let Y=this._rowElements.slice(-1)[0];if(F.node.compareDocumentPosition(Y)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(F={node:Y,offset:Y.textContent?.length??0}),!this._rowContainer.contains(F.node))return;let G=({node:z,offset:C})=>{let R=z instanceof Text?z.parentNode:z,M=parseInt(R?.getAttribute("aria-posinset"),10)-1;if(isNaN(M))return console.warn("row is invalid. Race condition?"),null;let N=this._rowColumns.get(R);if(!N)return console.warn("columns is null. Race condition?"),null;let Z=C<N.length?N[C]:N.slice(-1)[0]+1;return Z>=this._terminal.cols&&(++M,Z=0),{row:M,column:Z}},q=G(H),m=G(F);if(!(!q||!m)){if(q.row>m.row||q.row===m.row&&q.column>=m.column)throw Error("invalid range");this._terminal.select(q.column,q.row,(m.row-q.row)*this._terminal.cols-q.column+m.column)}}_handleResize(x){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let H=this._rowContainer.children.length;H<this._terminal.rows;H++)this._rowElements[H]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[H]);for(;this._rowElements.length>x;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){let x=this._coreBrowserService.mainDocument.createElement("div");return x.setAttribute("role","listitem"),x.tabIndex=-1,this._refreshRowDimensions(x),x}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){Object.assign(this._accessibilityContainer.style,{width:`${this._renderService.dimensions.css.canvas.width}px`,fontSize:`${this._terminal.options.fontSize}px`}),this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let x=0;x<this._terminal.rows;x++)this._refreshRowDimensions(this._rowElements[x]),this._alignRowWidth(this._rowElements[x])}}_refreshRowDimensions(x){x.style.height=`${this._renderService.dimensions.css.cell.height}px`}_alignRowWidth(x){x.style.transform="";let H=x.getBoundingClientRect().width,F=this._rowColumns.get(x)?.slice(-1)?.[0];if(!F)return;let Y=F*this._renderService.dimensions.css.cell.width;x.style.transform=`scaleX(${Y/H})`}};F1=a([K(1,Y9),K(2,I0),K(3,S0)],F1);var F9=class extends y{constructor(x,H,F,Y,G){super();this._element=x,this._mouseService=H,this._renderService=F,this._bufferService=Y,this._linkProviderService=G,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this._register(new W),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this._register(new W),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this._register(f(()=>{t0(this._linkCacheDisposables),this._linkCacheDisposables.length=0,this._lastMouseEvent=void 0,this._activeProviderReplies?.clear()})),this._register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0})),this._register(b(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this._register(b(this._element,"mousemove",this._handleMouseMove.bind(this))),this._register(b(this._element,"mousedown",this._handleMouseDown.bind(this))),this._register(b(this._element,"mouseup",this._handleMouseUp.bind(this)))}get currentLink(){return this._currentLink}_handleMouseMove(x){this._lastMouseEvent=x;let H=this._positionFromMouseEvent(x,this._element,this._mouseService);if(!H)return;this._isMouseOut=!1;let F=x.composedPath();for(let Y=0;Y<F.length;Y++){let G=F[Y];if(G.classList.contains("xterm"))break;if(G.classList.contains("xterm-hover"))return}(!this._lastBufferCell||H.x!==this._lastBufferCell.x||H.y!==this._lastBufferCell.y)&&(this._handleHover(H),this._lastBufferCell=H)}_handleHover(x){if(this._activeLine!==x.y||this._wasResized){this._clearCurrentLink(),this._askForLink(x,!1),this._wasResized=!1;return}this._currentLink&&this._linkAtPosition(this._currentLink.link,x)||(this._clearCurrentLink(),this._askForLink(x,!0))}_askForLink(x,H){(!this._activeProviderReplies||!H)&&(this._activeProviderReplies?.forEach((Y)=>{Y?.forEach((G)=>{G.link.dispose&&G.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=x.y);let F=!1;for(let[Y,G]of this._linkProviderService.linkProviders.entries())H?this._activeProviderReplies?.get(Y)&&(F=this._checkLinkProviderResult(Y,x,F)):G.provideLinks(x.y,(q)=>{if(this._isMouseOut)return;let m=q?.map((z)=>({link:z}));this._activeProviderReplies?.set(Y,m),F=this._checkLinkProviderResult(Y,x,F),this._activeProviderReplies?.size===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(x.y,this._activeProviderReplies)})}_removeIntersectingLinks(x,H){let F=new Set;for(let Y=0;Y<H.size;Y++){let G=H.get(Y);if(G)for(let q=0;q<G.length;q++){let m=G[q],z=m.link.range.start.y<x?0:m.link.range.start.x,C=m.link.range.end.y>x?this._bufferService.cols:m.link.range.end.x;for(let R=z;R<=C;R++){if(F.has(R)){G.splice(q--,1);break}F.add(R)}}}}_checkLinkProviderResult(x,H,F){if(!this._activeProviderReplies)return F;let Y=this._activeProviderReplies.get(x),G=!1;for(let q=0;q<x;q++)(!this._activeProviderReplies.has(q)||this._activeProviderReplies.get(q))&&(G=!0);if(!G&&Y){let q=Y.find((m)=>this._linkAtPosition(m.link,H));q&&(F=!0,this._handleNewLink(q))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!F)for(let q=0;q<this._activeProviderReplies.size;q++){let m=this._activeProviderReplies.get(q)?.find((z)=>this._linkAtPosition(z.link,H));if(m){F=!0,this._handleNewLink(m);break}}return F}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(x){if(!this._currentLink)return;let H=this._positionFromMouseEvent(x,this._element,this._mouseService);H&&this._mouseDownLink&&I4(this._mouseDownLink.link,this._currentLink.link)&&this._linkAtPosition(this._currentLink.link,H)&&this._currentLink.link.activate(x,this._currentLink.link.text)}_clearCurrentLink(x,H){!this._currentLink||!this._lastMouseEvent||(!x||!H||this._currentLink.link.range.start.y>=x&&this._currentLink.link.range.end.y<=H)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,t0(this._linkCacheDisposables),this._linkCacheDisposables.length=0)}_handleNewLink(x){if(!this._lastMouseEvent)return;let H=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);H&&this._linkAtPosition(x.link,H)&&(this._currentLink=x,this._currentLink.state={decorations:{underline:x.link.decorations===void 0?!0:x.link.decorations.underline,pointerCursor:x.link.decorations===void 0?!0:x.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,x.link,this._lastMouseEvent),x.link.decorations={},Object.defineProperties(x.link.decorations,{pointerCursor:{get:()=>this._currentLink?.state?.decorations.pointerCursor,set:(F)=>{this._currentLink?.state&&this._currentLink.state.decorations.pointerCursor!==F&&(this._currentLink.state.decorations.pointerCursor=F,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",F))}},underline:{get:()=>this._currentLink?.state?.decorations.underline,set:(F)=>{this._currentLink?.state&&this._currentLink?.state?.decorations.underline!==F&&(this._currentLink.state.decorations.underline=F,this._currentLink.state.isHovered&&this._fireUnderlineEvent(x.link,F))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange((F)=>{if(!this._currentLink)return;let Y=F.start===0?0:F.start+1+this._bufferService.buffer.ydisp,G=this._bufferService.buffer.ydisp+1+F.end;if(this._currentLink.link.range.start.y>=Y&&this._currentLink.link.range.end.y<=G&&(this._clearCurrentLink(Y,G),this._lastMouseEvent)){let q=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);q&&this._askForLink(q,!1)}})))}_linkHover(x,H,F){this._currentLink?.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(H,!0),this._currentLink.state.decorations.pointerCursor&&x.classList.add("xterm-cursor-pointer")),H.hover&&H.hover(F,H.text)}_fireUnderlineEvent(x,H){let F=x.range,Y=this._bufferService.buffer.ydisp,G=this._createLinkUnderlineEvent(F.start.x-1,F.start.y-Y-1,F.end.x,F.end.y-Y-1,void 0);(H?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(G)}_linkLeave(x,H,F){this._currentLink?.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(H,!1),this._currentLink.state.decorations.pointerCursor&&x.classList.remove("xterm-cursor-pointer")),H.leave&&H.leave(F,H.text)}_linkAtPosition(x,H){let F=x.range.start.y*this._bufferService.cols+x.range.start.x,Y=x.range.end.y*this._bufferService.cols+x.range.end.x,G=H.y*this._bufferService.cols+H.x;return F<=G&&G<=Y}_positionFromMouseEvent(x,H,F){let Y=F.getCoords(x,H,this._bufferService.cols,this._bufferService.rows);if(Y)return{x:Y[0],y:Y[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(x,H,F,Y,G){return{x1:x,y1:H,x2:F,y2:Y,cols:this._bufferService.cols,fg:G}}};F9=a([K(1,G9),K(2,S0),K(3,C0),K(4,k6)],F9);function I4(x,H){return x.text===H.text&&x.range.start.x===H.range.start.x&&x.range.start.y===H.range.start.y&&x.range.end.x===H.range.end.x&&x.range.end.y===H.range.end.y}var S4=class extends k4{constructor(x={}){super(x);this._linkifier=this._register(new Yx),this.browser=c6,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this._register(new Yx),this._onCursorMove=this._register(new W),this.onCursorMove=this._onCursorMove.event,this._onKey=this._register(new W),this.onKey=this._onKey.event,this._onRender=this._register(new W),this.onRender=this._onRender.event,this._onSelectionChange=this._register(new W),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this._register(new W),this.onTitleChange=this._onTitleChange.event,this._onBell=this._register(new W),this.onBell=this._onBell.event,this._onFocus=this._register(new W),this._onBlur=this._register(new W),this._onA11yCharEmitter=this._register(new W),this._onA11yTabEmitter=this._register(new W),this._onWillOpen=this._register(new W),this._setup(),this._decorationService=this._instantiationService.createInstance(y4),this._instantiationService.setService(Tx,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(B5),this._instantiationService.setService(k6,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(w1)),this._register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this._register(this._inputHandler.onRequestRefreshRows((H)=>this.refresh(H?.start??0,H?.end??this.rows-1))),this._register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this._register(this._inputHandler.onRequestReset(()=>this.reset())),this._register(this._inputHandler.onRequestWindowsOptionsReport((H)=>this._reportWindowsOptions(H))),this._register(this._inputHandler.onColor((H)=>this._handleColorEvent(H))),this._register(m0.forward(this._inputHandler.onCursorMove,this._onCursorMove)),this._register(m0.forward(this._inputHandler.onTitleChange,this._onTitleChange)),this._register(m0.forward(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this._register(m0.forward(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this._register(this._bufferService.onResize((H)=>this._afterResize(H.cols,H.rows))),this._register(f(()=>{this._customKeyEventHandler=void 0,this.element?.parentNode?.removeChild(this.element)}))}get linkifier(){return this._linkifier.value}get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}_handleColorEvent(x){if(this._themeService)for(let H of x){let F,Y="";switch(H.index){case 256:F="foreground",Y="10";break;case 257:F="background",Y="11";break;case 258:F="cursor",Y="12";break;default:F="ansi",Y="4;"+H.index}switch(H.type){case 0:let G=d.toColorRGB(F==="ansi"?this._themeService.colors.ansi[H.index]:this._themeService.colors[F]);this.coreService.triggerDataEvent(`${J.ESC}]${Y};${X4(G)}${g6.ST}`);break;case 1:if(F==="ansi")this._themeService.modifyColors((q)=>q.ansi[H.index]=n.toColor(...H.color));else{let q=F;this._themeService.modifyColors((m)=>m[q]=n.toColor(...H.color))}break;case 2:this._themeService.restoreColor(H.index);break}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(x){x?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(F1,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(x){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(J.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){return this.textarea?.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(J.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;let x=this.buffer.ybase+this.buffer.y,H=this.buffer.lines.get(x);if(!H)return;let F=Math.min(this.buffer.x,this.cols-1),Y=this._renderService.dimensions.css.cell.height,G=H.getWidth(F),q=this._renderService.dimensions.css.cell.width*G,m=this.buffer.y*this._renderService.dimensions.css.cell.height,z=F*this._renderService.dimensions.css.cell.width;this.textarea.style.left=z+"px",this.textarea.style.top=m+"px",this.textarea.style.width=q+"px",this.textarea.style.height=Y+"px",this.textarea.style.lineHeight=Y+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this._register(b(this.element,"copy",(H)=>{this.hasSelection()&&N3(H,this._selectionService)}));let x=(H)=>M3(H,this.textarea,this.coreService,this.optionsService);this._register(b(this.textarea,"paste",x)),this._register(b(this.element,"paste",x)),a6?this._register(b(this.element,"mousedown",(H)=>{H.button===2&&J9(H,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this._register(b(this.element,"contextmenu",(H)=>{J9(H,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),j9&&this._register(b(this.element,"auxclick",(H)=>{H.button===1&&X6(H,this.textarea,this.screenElement)}))}_bindKeys(){this._register(b(this.textarea,"keyup",(x)=>this._keyUp(x),!0)),this._register(b(this.textarea,"keydown",(x)=>this._keyDown(x),!0)),this._register(b(this.textarea,"keypress",(x)=>this._keyPress(x),!0)),this._register(b(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this._register(b(this.textarea,"compositionupdate",(x)=>this._compositionHelper.compositionupdate(x))),this._register(b(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this._register(b(this.textarea,"input",(x)=>this._inputEvent(x),!0)),this._register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(x){if(!x)throw Error("Terminal requires a parent element.");if(x.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this.element?.ownerDocument.defaultView&&this._coreBrowserService){this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView);return}this._document=x.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),x.appendChild(this.element);let H=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),H.appendChild(this._viewportElement),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._register(b(this.screenElement,"mousemove",(G)=>this.updateCursorStyle(G))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),H.appendChild(this.screenElement);let F=this.textarea=this._document.createElement("textarea");this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",L1.get()),n6||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._register(this.optionsService.onSpecificOptionChange("disableStdin",()=>F.readOnly=this.optionsService.rawOptions.disableStdin)),this.textarea.readOnly=this.optionsService.rawOptions.disableStdin,this._coreBrowserService=this._register(this._instantiationService.createInstance(U5,this.textarea,x.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(I0,this._coreBrowserService),this._register(b(this.textarea,"focus",(G)=>this._handleTextAreaFocus(G))),this._register(b(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(a1,this._document,this._helperContainer),this._instantiationService.setService(G1,this._charSizeService),this._themeService=this._instantiationService.createInstance(s1),this._instantiationService.setService(Gx,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(ex),this._instantiationService.setService(D6,this._characterJoinerService),this._renderService=this._register(this._instantiationService.createInstance(l1,this.rows,this.screenElement)),this._instantiationService.setService(S0,this._renderService),this._register(this._renderService.onRenderedViewportChange((G)=>this._onRender.fire(G))),this.onResize((G)=>this._renderService.resize(G.cols,G.rows)),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(g1,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(o1),this._instantiationService.setService(G9,this._mouseService);let Y=this._linkifier.value=this._register(this._instantiationService.createInstance(F9,this.screenElement));this.element.appendChild(H);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this._register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this._register(this.onBlur(()=>this._renderService.handleBlur())),this._register(this.onFocus(()=>this._renderService.handleFocus())),this._viewport=this._register(this._instantiationService.createInstance(_1,this.element,this.screenElement)),this._register(this._viewport.onRequestScrollLines((G)=>{super.scrollLines(G,!1),this.refresh(0,this.rows-1)})),this._selectionService=this._register(this._instantiationService.createInstance(n1,this.element,this.screenElement,Y)),this._instantiationService.setService(X3,this._selectionService),this._register(this._selectionService.onRequestScrollLines((G)=>this.scrollLines(G.amount,G.suppressScrollEvent))),this._register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this._register(this._selectionService.onRequestRedraw((G)=>this._renderService.handleSelectionChanged(G.start,G.end,G.columnSelectMode))),this._register(this._selectionService.onLinuxMouseSelection((G)=>{this.textarea.value=G,this.textarea.focus(),this.textarea.select()})),this._register(m0.any(this._onScroll.event,this._inputHandler.onScroll)(()=>{this._selectionService.refresh(),this._viewport?.queueSync()})),this._register(this._instantiationService.createInstance(v1,this.screenElement)),this._register(b(this.element,"mousedown",(G)=>this._selectionService.handleMouseDown(G))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(F1,this)),this._register(this.optionsService.onSpecificOptionChange("screenReaderMode",(G)=>this._handleScreenReaderModeOptionChange(G))),this.options.overviewRuler.width&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(tx,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRuler",(G)=>{!this._overviewRulerRenderer&&G&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(tx,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(c1,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){let x=this,H=this.element;function F(q){let m=x._mouseService.getMouseReportCoords(q,x.screenElement);if(!m)return!1;let z,C;switch(q.overrideType||q.type){case"mousemove":C=32,q.buttons===void 0?(z=3,q.button!==void 0&&(z=q.button<3?q.button:3)):z=q.buttons&1?0:q.buttons&4?1:q.buttons&2?2:3;break;case"mouseup":C=0,z=q.button<3?q.button:3;break;case"mousedown":C=1,z=q.button<3?q.button:3;break;case"wheel":if(x._customWheelEventHandler&&x._customWheelEventHandler(q)===!1)return!1;let R=q.deltaY;if(R===0||x.coreMouseService.consumeWheelEvent(q,x._renderService?.dimensions?.device?.cell?.height,x._coreBrowserService?.dpr)===0)return!1;C=R<0?0:1,z=4;break;default:return!1}return C===void 0||z===void 0||z>4?!1:x.coreMouseService.triggerMouseEvent({col:m.col,row:m.row,x:m.x,y:m.y,button:z,action:C,ctrl:q.ctrlKey,alt:q.altKey,shift:q.shiftKey})}let Y={mouseup:null,wheel:null,mousedrag:null,mousemove:null},G={mouseup:(q)=>(F(q),q.buttons||(this._document.removeEventListener("mouseup",Y.mouseup),Y.mousedrag&&this._document.removeEventListener("mousemove",Y.mousedrag)),this.cancel(q)),wheel:(q)=>(F(q),this.cancel(q,!0)),mousedrag:(q)=>{q.buttons&&F(q)},mousemove:(q)=>{q.buttons||F(q)}};this._register(this.coreMouseService.onProtocolChange((q)=>{q?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(q)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),q&8?Y.mousemove||(H.addEventListener("mousemove",G.mousemove),Y.mousemove=G.mousemove):(H.removeEventListener("mousemove",Y.mousemove),Y.mousemove=null),q&16?Y.wheel||(H.addEventListener("wheel",G.wheel,{passive:!1}),Y.wheel=G.wheel):(H.removeEventListener("wheel",Y.wheel),Y.wheel=null),q&2?Y.mouseup||(Y.mouseup=G.mouseup):(this._document.removeEventListener("mouseup",Y.mouseup),Y.mouseup=null),q&4?Y.mousedrag||(Y.mousedrag=G.mousedrag):(this._document.removeEventListener("mousemove",Y.mousedrag),Y.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this._register(b(H,"mousedown",(q)=>{if(q.preventDefault(),this.focus(),!(!this.coreMouseService.areMouseEventsActive||this._selectionService.shouldForceSelection(q)))return F(q),Y.mouseup&&this._document.addEventListener("mouseup",Y.mouseup),Y.mousedrag&&this._document.addEventListener("mousemove",Y.mousedrag),this.cancel(q)})),this._register(b(H,"wheel",(q)=>{if(!Y.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(q)===!1)return!1;if(!this.buffer.hasScrollback){if(q.deltaY===0)return!1;if(x.coreMouseService.consumeWheelEvent(q,x._renderService?.dimensions?.device?.cell?.height,x._coreBrowserService?.dpr)===0)return this.cancel(q,!0);let m=J.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(q.deltaY<0?"A":"B");return this.coreService.triggerDataEvent(m,!0),this.cancel(q,!0)}}},{passive:!1}))}refresh(x,H){this._renderService?.refreshRows(x,H)}updateCursorStyle(x){this._selectionService?.shouldColumnSelect(x)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(x,H){this._viewport?this._viewport.scrollLines(x):super.scrollLines(x,H),this.refresh(0,this.rows-1)}scrollPages(x){this.scrollLines(x*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(x){x&&this._viewport?this._viewport.scrollToLine(this.buffer.ybase,!0):this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(x){let H=x-this._bufferService.buffer.ydisp;H!==0&&this.scrollLines(H)}paste(x){W6(x,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(x){this._customKeyEventHandler=x}attachCustomWheelEventHandler(x){this._customWheelEventHandler=x}registerLinkProvider(x){return this._linkProviderService.registerLinkProvider(x)}registerCharacterJoiner(x){if(!this._characterJoinerService)throw Error("Terminal must be opened first");let H=this._characterJoinerService.register(x);return this.refresh(0,this.rows-1),H}deregisterCharacterJoiner(x){if(!this._characterJoinerService)throw Error("Terminal must be opened first");this._characterJoinerService.deregister(x)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(x){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+x)}registerDecoration(x){return this._decorationService.registerDecoration(x)}hasSelection(){return this._selectionService?this._selectionService.hasSelection:!1}select(x,H,F){this._selectionService.setSelection(x,H,F)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(!(!this._selectionService||!this._selectionService.hasSelection))return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){this._selectionService?.clearSelection()}selectAll(){this._selectionService?.selectAll()}selectLines(x,H){this._selectionService?.selectLines(x,H)}_keyDown(x){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(x)===!1)return!1;let H=this.browser.isMac&&this.options.macOptionIsMeta&&x.altKey;if(!H&&!this._compositionHelper.keydown(x))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(!0),!1;!H&&(x.key==="Dead"||x.key==="AltGraph")&&(this._unprocessedDeadKey=!0);let F=L4(x,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(x),F.type===3||F.type===2){let Y=this.rows-1;return this.scrollLines(F.type===2?-Y:Y),this.cancel(x,!0)}if(F.type===1&&this.selectAll(),this._isThirdLevelShift(this.browser,x)||(F.cancel&&this.cancel(x,!0),!F.key)||x.key&&!x.ctrlKey&&!x.altKey&&!x.metaKey&&x.key.length===1&&x.key.charCodeAt(0)>=65&&x.key.charCodeAt(0)<=90)return!0;if(this._unprocessedDeadKey)return this._unprocessedDeadKey=!1,!0;if((F.key===J.ETX||F.key===J.CR)&&(this.textarea.value=""),this._onKey.fire({key:F.key,domEvent:x}),this._showCursor(),this.coreService.triggerDataEvent(F.key,!0),!this.optionsService.rawOptions.screenReaderMode||x.altKey||x.ctrlKey)return this.cancel(x,!0);this._keyDownHandled=!0}_isThirdLevelShift(x,H){let F=x.isMac&&!this.options.macOptionIsMeta&&H.altKey&&!H.ctrlKey&&!H.metaKey||x.isWindows&&H.altKey&&H.ctrlKey&&!H.metaKey||x.isWindows&&H.getModifierState("AltGraph");return H.type==="keypress"?F:F&&(!H.keyCode||H.keyCode>47)}_keyUp(x){this._keyDownSeen=!1,!(this._customKeyEventHandler&&this._customKeyEventHandler(x)===!1)&&(Q4(x)||this.focus(),this.updateCursorStyle(x),this._keyPressHandled=!1)}_keyPress(x){let H;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(x)===!1)return!1;if(this.cancel(x),x.charCode)H=x.charCode;else if(x.which===null||x.which===void 0)H=x.keyCode;else if(x.which!==0&&x.charCode!==0)H=x.which;else return!1;return!H||(x.altKey||x.ctrlKey||x.metaKey)&&!this._isThirdLevelShift(this.browser,x)?!1:(H=String.fromCharCode(H),this._onKey.fire({key:H,domEvent:x}),this._showCursor(),this.coreService.triggerDataEvent(H,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,!0)}_inputEvent(x){if(x.data&&x.inputType==="insertText"&&(!x.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;let H=x.data;return this.coreService.triggerDataEvent(H,!0),this.cancel(x),!0}return!1}resize(x,H){if(x===this.cols&&H===this.rows){this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure();return}super.resize(x,H)}_afterResize(x,H){this._charSizeService?.measure()}clear(){if(!(this.buffer.ybase===0&&this.buffer.y===0)){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let x=1;x<this.rows;x++)this.buffer.lines.push(this.buffer.getBlankLine(l));this._onScroll.fire({position:this.buffer.ydisp}),this.refresh(0,this.rows-1)}}reset(){this.options.rows=this.rows,this.options.cols=this.cols;let x=this._customKeyEventHandler;this._setup(),super.reset(),this._selectionService?.reset(),this._decorationService.reset(),this._customKeyEventHandler=x,this.refresh(0,this.rows-1)}clearTextureAtlas(){this._renderService?.clearTextureAtlas()}_reportFocus(){this.element?.classList.contains("focus")?this.coreService.triggerDataEvent(J.ESC+"[I"):this.coreService.triggerDataEvent(J.ESC+"[O")}_reportWindowsOptions(x){if(this._renderService)switch(x){case 0:let H=this._renderService.dimensions.css.canvas.width.toFixed(0),F=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${J.ESC}[4;${F};${H}t`);break;case 1:let Y=this._renderService.dimensions.css.cell.width.toFixed(0),G=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${J.ESC}[6;${G};${Y}t`);break}}cancel(x,H){if(!(!this.options.cancelEvents&&!H))return x.preventDefault(),x.stopPropagation(),!1}};function Q4(x){return x.keyCode===16||x.keyCode===17||x.keyCode===18}var E4=class{constructor(){this._addons=[]}dispose(){for(let x=this._addons.length-1;x>=0;x--)this._addons[x].instance.dispose()}loadAddon(x,H){let F={instance:H,dispose:H.dispose,isDisposed:!1};this._addons.push(F),H.dispose=()=>this._wrappedAddonDispose(F),H.activate(x)}_wrappedAddonDispose(x){if(x.isDisposed)return;let H=-1;for(let F=0;F<this._addons.length;F++)if(this._addons[F]===x){H=F;break}if(H===-1)throw Error("Could not dispose an addon that has not been loaded");x.isDisposed=!0,x.dispose.apply(x.instance),this._addons.splice(H,1)}},h4=class{constructor(x){this._line=x}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(x,H){if(!(x<0||x>=this._line.length))return H?(this._line.loadCell(x,H),H):this._line.loadCell(x,new W0)}translateToString(x,H,F){return this._line.translateToString(x,H,F)}},J6=class{constructor(x,H){this._buffer=x,this.type=H}init(x){return this._buffer=x,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(x){let H=this._buffer.lines.get(x);if(H)return new h4(H)}getNullCell(){return new W0}},d4=class extends y{constructor(x){super();this._core=x,this._onBufferChange=this._register(new W),this.onBufferChange=this._onBufferChange.event,this._normal=new J6(this._core.buffers.normal,"normal"),this._alternate=new J6(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}},f4=class{constructor(x){this._core=x}registerCsiHandler(x,H){return this._core.registerCsiHandler(x,(F)=>H(F.toArray()))}addCsiHandler(x,H){return this.registerCsiHandler(x,H)}registerDcsHandler(x,H){return this._core.registerDcsHandler(x,(F,Y)=>H(F,Y.toArray()))}addDcsHandler(x,H){return this.registerDcsHandler(x,H)}registerEscHandler(x,H){return this._core.registerEscHandler(x,H)}addEscHandler(x,H){return this.registerEscHandler(x,H)}registerOscHandler(x,H){return this._core.registerOscHandler(x,H)}addOscHandler(x,H){return this.registerOscHandler(x,H)}},_4=class{constructor(x){this._core=x}register(x){this._core.unicodeService.register(x)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(x){this._core.unicodeService.activeVersion=x}},v4=["cols","rows"],D0=0,F3=class extends y{constructor(x){super(),this._core=this._register(new S4(x)),this._addonManager=this._register(new E4),this._publicOptions={...this._core.options};let H=(Y)=>this._core.options[Y],F=(Y,G)=>{this._checkReadonlyOptions(Y),this._core.options[Y]=G};for(let Y in this._core.options){let G={get:H.bind(this,Y),set:F.bind(this,Y)};Object.defineProperty(this._publicOptions,Y,G)}}_checkReadonlyOptions(x){if(v4.includes(x))throw Error(`Option "${x}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new f4(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new _4(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this._register(new d4(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let x=this._core.coreService.decPrivateModes,H="none";switch(this._core.coreMouseService.activeProtocol){case"X10":H="x10";break;case"VT200":H="vt200";break;case"DRAG":H="drag";break;case"ANY":H="any";break}return{applicationCursorKeysMode:x.applicationCursorKeys,applicationKeypadMode:x.applicationKeypad,bracketedPasteMode:x.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:H,originMode:x.origin,reverseWraparoundMode:x.reverseWraparound,sendFocusMode:x.sendFocus,synchronizedOutputMode:x.synchronizedOutput,wraparoundMode:x.wraparound}}get options(){return this._publicOptions}set options(x){for(let H in x)this._publicOptions[H]=x[H]}blur(){this._core.blur()}focus(){this._core.focus()}input(x,H=!0){this._core.input(x,H)}resize(x,H){this._verifyIntegers(x,H),this._core.resize(x,H)}open(x){this._core.open(x)}attachCustomKeyEventHandler(x){this._core.attachCustomKeyEventHandler(x)}attachCustomWheelEventHandler(x){this._core.attachCustomWheelEventHandler(x)}registerLinkProvider(x){return this._core.registerLinkProvider(x)}registerCharacterJoiner(x){return this._checkProposedApi(),this._core.registerCharacterJoiner(x)}deregisterCharacterJoiner(x){this._checkProposedApi(),this._core.deregisterCharacterJoiner(x)}registerMarker(x=0){return this._verifyIntegers(x),this._core.registerMarker(x)}registerDecoration(x){return this._checkProposedApi(),this._verifyPositiveIntegers(x.x??0,x.width??0,x.height??0),this._core.registerDecoration(x)}hasSelection(){return this._core.hasSelection()}select(x,H,F){this._verifyIntegers(x,H,F),this._core.select(x,H,F)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(x,H){this._verifyIntegers(x,H),this._core.selectLines(x,H)}dispose(){super.dispose()}scrollLines(x){this._verifyIntegers(x),this._core.scrollLines(x)}scrollPages(x){this._verifyIntegers(x),this._core.scrollPages(x)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(x){this._verifyIntegers(x),this._core.scrollToLine(x)}clear(){this._core.clear()}write(x,H){this._core.write(x,H)}writeln(x,H){this._core.write(x),this._core.write(`\r
`,H)}paste(x){this._core.paste(x)}refresh(x,H){this._verifyIntegers(x,H),this._core.refresh(x,H)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(x){this._addonManager.loadAddon(this,x)}static get strings(){return{get promptLabel(){return L1.get()},set promptLabel(x){L1.set(x)},get tooMuchOutput(){return b1.get()},set tooMuchOutput(x){b1.set(x)}}}_verifyIntegers(...x){for(D0 of x)if(D0===1/0||isNaN(D0)||D0%1!==0)throw Error("This API only accepts integers")}_verifyPositiveIntegers(...x){for(D0 of x)if(D0&&(D0===1/0||isNaN(D0)||D0%1!==0||D0<0))throw Error("This API only accepts positive integers")}};var g4=2,u4=1,Y3=class{activate(x){this._terminal=x}dispose(){}fit(){let x=this.proposeDimensions();if(!x||!this._terminal||isNaN(x.cols)||isNaN(x.rows))return;let H=this._terminal._core;(this._terminal.rows!==x.rows||this._terminal.cols!==x.cols)&&(H._renderService.clear(),this._terminal.resize(x.cols,x.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let x=this._terminal._core._renderService.dimensions;if(x.css.cell.width===0||x.css.cell.height===0)return;let H=this._terminal.options.scrollback===0?0:this._terminal.options.overviewRuler?.width||14,F=window.getComputedStyle(this._terminal.element.parentElement),Y=parseInt(F.getPropertyValue("height")),G=Math.max(0,parseInt(F.getPropertyValue("width"))),q=window.getComputedStyle(this._terminal.element),m={top:parseInt(q.getPropertyValue("padding-top")),bottom:parseInt(q.getPropertyValue("padding-bottom")),right:parseInt(q.getPropertyValue("padding-right")),left:parseInt(q.getPropertyValue("padding-left"))},z=m.top+m.bottom,C=m.right+m.left,R=Y-z,M=G-C-H;return{cols:Math.max(g4,Math.floor(M/x.css.cell.width)),rows:Math.max(u4,Math.floor(R/x.css.cell.height))}}};var Rx,Z9,mx=null,c4=window.location.origin;async function q3(x,H={}){let Y=`api/api.php?${new URLSearchParams({action:x,...H}).toString()}`;try{let G=await fetch(Y);if(!(G.headers.get("Content-Type")||"").includes("application/json"))return{error:"Server returned nonJSON response"};return await G.json()}catch{return{error:"Network error: please check connection"}}}function a4(){document.querySelectorAll(".page").forEach((x)=>x.style.display="none")}function Q0(x){a4();let H=document.getElementById(x);if(H)H.style.display="block"}function o4(x,H){let F="YELLOW";if(H==="normal")F="GREEN";else if(H==="untrusted")F="RED";else if(H==="doubtful")F="YELLOW";let Y=x.toLowerCase(),G="Unknown";if(Y.includes("cisco"))G="Cisco";else if(Y.includes("apple"))G="Apple";else if(Y.includes("google"))G="Google";else if(Y.includes("tp-link")||Y.includes("d-link")||Y.includes("asus")||Y.includes("msi")||Y.includes("huawei")||Y.includes("router"))G="Routers";else if(Y.includes("samsung"))G="Samsung";else if(Y.includes("microsoft"))G="Microsoft";return`icons/${G}${F}.svg`}async function l4(x){let H=document.getElementById("pingOutput");if(H)H.textContent="Pinging...";let F=await q3("ping",{ip:x});if(F.error){H.textContent=F.error;return}H.textContent=F.output||"No response"}async function n4(x){let H=document.getElementById("macResults");if(H)H.textContent="Scanning...";let F=await q3("macscan",{target:x});if(F.error){H.textContent=F.error;return}let Y=document.getElementById("macDeviceList");if(!Y)return;Y.innerHTML="",F.devices.forEach((G)=>{let q=o4(G.vendor,G.safety),m=document.createElement("div");m.className="device-card",m.innerHTML=`
      <img class="device-icon" src="${q}">
      <div class="device-name">${G.vendor}</div>
      <div class="device-ip">${G.mac}</div>
    `,Y.appendChild(m)}),Q0("page-mac-addresses")}function s4(){Rx=new F3({cursorBlink:!0,fontFamily:"monospace",fontSize:16,theme:{background:"#000000",foreground:"#00FF00"}}),Z9=new Y3,Rx.loadAddon(Z9);let x=document.getElementById("consoleBox");if(x)Rx.open(x),Z9.fit();let H=document.getElementById("consoleInput"),F=document.getElementById("consoleRun");if(F)F.addEventListener("click",()=>{if(H)G3(H.value)});if(H)H.addEventListener("keydown",(Y)=>{if(Y.key==="Enter")G3(H.value)})}function G3(x){if(mx)mx.close();Rx.clear(),mx=new EventSource(`${c4}/console.php?cmd=${encodeURIComponent(x)}`),mx.onmessage=(H)=>{let F=JSON.parse(H.data);Rx.write(F.output)},mx.onerror=()=>{Rx.write(`\r
[Connection closed]\r
`),mx?.close()}}function r4(){s4(),document.querySelectorAll("[data-back]").forEach((x)=>{x.addEventListener("click",()=>Q0("page-main"))}),document.querySelectorAll(".card").forEach((x)=>{x.addEventListener("click",()=>{let H=x.getAttribute("data-view");if(!H)return;if(H==="scan-network")Q0("page-scan-start");else if(H==="ping-device")Q0("page-ping-device");else if(H==="security-audit")Q0("page-security-audit");else if(H==="saved-profiles")Q0("page-profiles-list");else if(H==="mac-addresses")Q0("page-mac-addresses");else if(H==="saved-devices")Q0("page-saved-devices");else if(H==="user-command")Q0("page-user-command")})}),document.getElementById("btnMacScan")?.addEventListener("click",()=>{let x=document.getElementById("macTarget").value;n4(x)}),document.getElementById("pingGoBtn")?.addEventListener("click",()=>{let x=document.getElementById("pingAddress").value;l4(x)})}window.addEventListener("DOMContentLoaded",r4);
